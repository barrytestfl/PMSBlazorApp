var t = {
    4683: function() {
        function i() {
            return e = null == e ? 0 < $("#room-list.cp-diary-sidebar-list li.p-row").length : e
        }
        function o(e) {
            i() || (null != e && null != e.Blocks && $.each(e.Blocks, function(e, o) {
                var t = o.id;
                n(t = null == t ? o.Id : t)
            }),
            t(e),
            $(".mod-diary span.selected").removeClass("selected"),
            $(".mod-diary table.grid-body").removeClass("mask"),
            selectedBlock = null,
            gridIsScrolling = !1,
            isMouseButtonDown = !1)
        }
        function n(e) {
            i() || ((e = $("td[class!='closed'] span[data-id='" + e + "']")).parent().removeClass(d),
            r(e))
        }
        function t(a) {
            i() || null != a && null != a.Blocks && $.each(a.Blocks, function(e, o) {
                var t = $("#" + e);
                0 < t.length && (t.hasClass("closure") ? t.attr("class", o.CellCssClass + " closure") : t.attr("class", o.CellCssClass),
                l(t, o.IsFirstCell, o.Id, a.CellHtmlBlocks[o.Id]),
                null != o.Overbookings) && 0 < o.Overbookings.length && $.each(o.Overbookings, function(e, o) {
                    n(o.Id),
                    l(t, o.IsFirstCell, o.Id, a.CellHtmlBlocks[o.Id])
                })
            })
        }
        function s(e) {
            i() || eviivo.webcore.ajaxHelper.executeAjax({
                url: eviivoSuiteApp + "/diary/RetrieveBooking",
                data: JSON.stringify({
                    request: e
                }),
                actionId: "getBooking_v2",
                method: eviivo.webcore.ajaxHelper.methods.POST,
                contentType: eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                callback: function(e) {
                    o(e)
                },
                failCallback: function(e) {
                    alert("ERROR")
                }
            })
        }
        function a(e) {
            var o, t, a, i = e.attr("id");
            return (null != i || null != e.parent() && null != e.parent() && null != e.parent().attr("id") && null != e.parent().attr("id")) && "c" == (i = (i = null == i ? e.parent().attr("id") : i).split("-"))[0] ? (o = new Date(new Date(i[2],i[3] - 1,i[4]).toUTCString()),
            (t = null) != (a = e.attr("data-length")) && ((a = parseInt(a) - 1) < 0 && (a = 0),
            t = eviivo.webcore.datetime.utils.addDaysToDate(new Date(o), a)),
            {
                roomId: parseInt(i[1]),
                id: e.attr("data-id"),
                startDate: o,
                endDate: t,
                length: a
            }) : null
        }
        function r(e) {
            e.addClass("removing"),
            e.stop().animate({
                width: 0
            }, 1e3, function() {
                e.remove()
            })
        }
        function l(e, o, t, a) {
            !0 === o && (e.html(a),
            a = (o = e.find("span.inner[data-id='" + t + "']")).width(),
            o.css("width", "0px"),
            o.stop().animate({
                width: a
            }, 1e3))
        }
        var d, e;
        window.eviivo = window.eviivo || {},
        window.eviivo.eagle = window.eviivo.eagle || {},
        window.eviivo.eagle.gridBlock = window.eviivo.eagle.gridBlock || {},
        window.eviivo.eagle.gridBlock = (d = "online offline closed overbooking checkedin checkedout tentative",
        e = null,
        {
            updateBookingElement: function(e, o, t, a) {
                i() || s({
                    DiaryViewTypeForPostBack: t,
                    SelectedDate: a,
                    BookingIds: [e],
                    RefreshOrderId: o
                })
            },
            updateDiaryBlock: o,
            removeDiaryBlock: n,
            addDiaryBlock: t,
            removeCloseoutDiaryBlock: function(e) {
                (e = $("td.closed span[data-id='" + e + "']")).parent().removeClass(d),
                r(e)
            },
            cancelBookingElement: function(e) {
                i() || jQuery.each(e, function(e, o) {
                    var t = a(jQuery("#grid-table td[class!='closed'] span[data-id='" + o + "']"));
                    t && (n(o),
                    s({
                        DiaryViewTypeForPostBack: viewType,
                        SelectedDate: diaryStartDate,
                        RefreshStartDate: t.startDate,
                        RefreshEndDate: t.endDate,
                        RefreshRoomId: t.roomId
                    }))
                })
            },
            extractCellIdParts: a,
            postGetWithData: s
        })
    },
    3764: function() {
        function o() {
            var e = this;
            e.notes = ko.observable(),
            e.price = ko.observable(),
            e.viewType = ko.observable(),
            e.viewState = ko.computed(function() {
                return this.viewType() === R.BlockRoom ? "popup popup-generic block-room-view s-draggable" : (R.Booking,
                "popup popup-generic s-guestSearch s-draggable booking-view")
            }, e)
        }
        function i() {
            eviivo.component.form.telephone.reset(),
            eviivo.component.form.telephone.init("guest-new-booking-form");
            jQuery("input[name='PhoneNumber']").attr("id", "Booking-Guest-Phone")
        }
        function t(e) {
            s({
                businessId: eviivo.eagle.basePageModelState.businessId,
                onActionCallback: eviivo.pms.diary.grid.addBooking.refreshData
            }),
            eviivo.eagle.booking.guest.populateGuestDetails(null, e)
        }
        function a() {
            var e = {
                start: P.startDate().toDateString(),
                nights: P.nights(),
                diaryView: E.diaryViewType,
                requestBId: parseInt($(".s-d-bus").val()) || E.businessId
            };
            eviivo.webcore.navigatorHelper.redirectTo(eviivoSuiteApp + "/multiroom", e, eviivo.webcore.navigatorHelper.options.target.sameWindow, eviivo.webcore.navigatorHelper.options.method.post)
        }
        function n(e) {
            $(e.target).hasClass("is-allocation") ? ($(".is-allocation").addClass("btn-active"),
            $(".alloc").is(":empty") && eviivo.webcore.ajaxHelper.executeAjax({
                url: eviivoSuiteApp + "/api/closeoutreasons/GetAllocationReasons",
                actionId: "getAllocationReasons",
                method: eviivo.webcore.ajaxHelper.methods.GET,
                contentType: eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                callback: function(e) {
                    T(e, !0)
                }
            }),
            $(".alloc").closest(".new-booking-container").show(),
            0 === (e = $(".reasons-fields .alloc")).find("span").length && e.append('<span class="error-asterix">*</span>')) : ($(".alloc").closest(".new-booking-container").hide(),
            $(".is-allocation").removeClass("btn-active"))
        }
        function s(e) {
            var o, t, a;
            i(),
            !1 !== bookingModelInitialised && eviivo.pms.businessSettingsAndDefaultMessages.isLoaded() ? ($("#loading-overlay").hasClass("active") && $("#loading-overlay").toggleClass("hide active"),
            jQuery("#isIcal").attr("value", ""),
            E.isAddBookingToGroup = e.isAddBookingToGroup,
            E.parentOrderReference = e.parentOrderReference,
            E.parentOrderId = e.parentOrderId,
            E = $.extend(E, e),
            $("body").data("visiblePopup", "newBookingPopup"),
            !0 !== M && (M = !0,
            E.popupBox) && (eviivo.eagle.booking.guest.initForm(),
            null != e.businessId ? jQuery("select.s-d-bus").val(e.businessId) : jQuery("select.s-d-bus").val(eviivo.eagle.basePageModelState.businessId),
            D.GuestModel = {},
            D.isAvailabilityIgnored(!1),
            D.viewType(R.Booking),
            E.popupBox.find(".s-booking-notes textarea").attr("maxlength", A),
            w(),
            o = "",
            t = E.popupBox.find(".s-heading-title"),
            o = E.isAddBookingToGroup ? E.resources.addBookingToGroupView.Title + " " + E.parentOrderReference + " " + E.parentGuestName : E.resources.bookingView.Title,
            t.html(o),
            E.popupBox.find(".eviivo-reasons span").remove(),
            E.popupBox.find(".s-booking-notes span").remove(),
            (E = $.extend(E, {
                viewType: D.viewType(),
                adults: E.carouselOptions.defaultAdults,
                children: E.carouselOptions.defaultChildren,
                nights: E.carouselOptions.defaultNights,
                resetRoomSelection: !0,
                bookingId: null,
                rateTypeCode: eviivo.eagle.occupancy.RateTypes.BestAvailable,
                isOtaBooking: !1,
                isModifyBookingFlow: !1
            })).isAddBookingToGroup && (E.startDate = e.parentStartDate,
            E.nights = e.parentNights,
            $("#txt-combo-Booking-Guest-Group").val(E.groupReference)),
            P.canBeModified(null),
            P.isOta(null),
            eviivo.eagle.occupancy.show(E, P),
            $(".booking-action-button").removeClass("hide"),
            $(".block-room-buttons").addClass("hide"),
            $(".new-booking-container.reasons-fields").addClass("hide"),
            eviivo.component.flyout.showFlyout(E.popupBox.attr("id")),
            $("#add-booking .s-cancel").hide(),
            M = !1,
            a = e,
            $("#BusinessesForBookingPopups > option").each(function() {
                $(this).show()
            }),
            E.isAddBookingToGroup && $("#BusinessesForBookingPopups > option").each(function() {
                this.value != a.businessId && $(this).hide()
            }),
            jQuery(".new-booking-container #availability-validation-summary").toggle(!1),
            jQuery(".new-booking-container #availability-search-form").validate().resetForm(),
            E.popupBox.find(".btn-book, .btn-book-continue, .confirm-checkbox").show(),
            eviivo.eagle.booking.guestMessage.setConfirmationMessage(null, null, null),
            $("#Booking-Guest-Surname").trigger("focus"))) : setTimeout(function() {
                s(e)
            }, 1e3)
        }
        function r(o, e, t, a) {
            o.on(e, function() {
                var e = o.val();
                e.length > t && o.val(e.slice(0, t)),
                "function" == typeof a && a()
            })
        }
        function l() {
            g(),
            v()
        }
        function d() {
            m(),
            p()
        }
        function c() {
            g(),
            p()
        }
        function u() {
            eviivo.webcore.ajaxHelper.executeAjax({
                url: eviivoSuiteApp + "/api/closeoutreasons/GetCloseoutReasons",
                actionId: "getCloseoutReasons",
                method: eviivo.webcore.ajaxHelper.methods.GET,
                contentType: eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                callback: function(e) {
                    T(e, !1)
                }
            })
        }
        function v() {
            E.popupBox.find("#new-booking-spinner").removeClass("hide").addClass("active")
        }
        function p() {
            E.popupBox.find("#new-booking-spinner").addClass("hide").removeClass("active")
        }
        function g() {
            E.popupBox.find(".s-btn-book").attr("disabled", !0),
            E.popupBox.find(".s-btn-book-continue").attr("disabled", !0)
        }
        function m() {
            E.popupBox.find(".s-btn-book").removeAttr("disabled"),
            E.popupBox.find(".s-btn-book-continue").removeAttr("disabled")
        }
        function f(e, o) {
            var t, a;
            e.keyCode && e.keyCode !== $.ui.keyCode.ENTER && e.keyCode !== $.ui.keyCode.SPACE || (g(),
            v(),
            jQuery("#availability-search-form").valid() && !!eviivo.eagle.booking.guest.isValid() && 0 == eviivo.component.form.telephone.validate("#guest-new-booking-form") ? (e = eviivo.eagle.booking.guest.formData(),
            t = eviivo.eagle.occupancy.getPricesForAddBooking(),
            a = E.bookingModel,
            a = $.extend(a, {
                StartDate: D.startDate().evStandardIso8601DateExtended(),
                EndDate: D.endDate().evStandardIso8601DateExtended(),
                Cost: t.cost,
                RateTypeCode: D.rateTypeCode(),
                BookingStatusCode: N.confirmed,
                NumberOfAdults: D.adults(),
                NumberOfChildren: D.children(),
                RoomId: D.roomId(),
                RoomTypeId: D.roomType(),
                RoomTypeBedConfigId: D.roomBedConfig(),
                RatePlanId: D.ratePlan(),
                Notes: function() {
                    if (0 < E.popupBox.find(".s-booking-notes textarea").length)
                        return E.popupBox.find(".s-booking-notes textarea").val().replace(/(?:\\[rn]|[\r\n]+)+/g, "");
                    return ""
                }(),
                IsAvailabilityIgnored: D.isAvailabilityIgnored(),
                Order: {
                    GroupReference: e.Group,
                    GuestMessage: e["Booking-Guest-Message"],
                    IsAddBookingToGroup: E.isAddBookingToGroup,
                    ParentOrderId: E.parentOrderId
                },
                GuestModel: e,
                DiaryViewTypeForPostBack: E.diaryViewType,
                SelectedDate: eviivo.webcore.calendar.getSelectedDate(),
                Promotions: t.promotion,
                BusinessId: parseInt($(".s-d-bus").val()) || E.businessId
            }),
            eviivo.webcore.ajaxHelper.executeAjax({
                url: eviivoSuiteApp + "/api/diary/addBooking",
                data: a,
                xhrFields: {
                    withCredentials: !0
                },
                actionId: "addBookings_v2",
                method: eviivo.webcore.ajaxHelper.methods.POST,
                contentType: eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                callback: function(e) {
                    eviivo.component.flyout.hideFlyout(E.popupBox.attr("id")),
                    E.diaryViewType !== eviivo.eagle.occupancy.getDiaryViewTypes().List && eviivo.eagle.gridBlock.postGetWithData({
                        DiaryViewTypeForPostBack: E.diaryViewType,
                        SelectedDate: E.diaryStart,
                        RefreshRoomId: a.RoomId,
                        RefreshStartDate: a.StartDate,
                        RefreshEndDate: a.EndDate
                    }),
                    E.isAddBookingToGroup && null == e ? h() : (o && eviivo.eagle.viewBookingPopup.showViewBookingPopupByBusinessId(e.Id, null, e.BusinessId),
                    "function" == typeof E.onActionCallback && (E.diaryViewType !== eviivo.eagle.occupancy.getDiaryViewTypes().List ? E.onActionCallback(e.Id, e.BookingReferenceNumber, e.Guest.Surname, a.BusinessId, o) : E.onActionCallback(e.StartDate, e.EndDate, e, !0, o)))
                },
                failCallback: function() {
                    eviivo.component.flyout.hideFlyout(E.popupBox.attr("id")),
                    h(),
                    jQuery(".mod-close-notice").on("click", function() {
                        jQuery(".notifyjs-wrapper").remove()
                    })
                }
            })) : (m(),
            p()))
        }
        function h() {
            eviivo.webcore.notifier.show({
                type: eviivo.webcore.notifier.types.warn,
                message: E.resources.AddBookingError,
                autoHide: !1
            }),
            jQuery(".mod-close-notice").on("click", function() {
                jQuery(".notifyjs-wrapper").remove()
            })
        }
        function b() {
            var e = ""
              , o = (null != E.popupBox.find(".s-booking-notes textarea").val() && (e = E.popupBox.find(".s-booking-notes textarea").val().replace("\n", "").replace("\r", "").replace("\r\n", "")),
            E.blockRoomModel);
            null == (o = $.extend(o, {
                StartDate: D.startDate().evStandardIso8601DateExtended(),
                EndDate: D.endDate().evStandardIso8601DateExtended(),
                RoomId: D.room(),
                Description: e,
                BlockReason: j,
                DiaryViewTypeForPostBack: E.diaryViewType,
                SelectedDate: eviivo.webcore.calendar.getSelectedDate(),
                BusinessId: parseInt($(".s-d-bus").val()) || E.businessId
            })).RoomId ? eviivo.webcore.notifier.show({
                type: eviivo.webcore.notifier.types.warn,
                message: E.resources.blockRoomView.PleaseSelectRoom,
                autoHide: !1
            }) : null == j || j == E.allocationId ? eviivo.webcore.notifier.show({
                type: eviivo.webcore.notifier.types.warn,
                message: E.resources.blockRoomView.PleaseSelectReason,
                autoHide: !1
            }) : (v(),
            E.popupBox.find(".s-btn-submit-block").attr("disabled", !0),
            E.diaryViewType !== eviivo.eagle.occupancy.getDiaryViewTypes().List ? eviivo.webcore.ajaxHelper.executeAjax({
                url: eviivoSuiteApp + "/diary/AddBlockedRoom",
                data: o,
                xhrFields: {
                    withCredentials: !0
                },
                actionId: "addBlockedRooms_v2",
                method: eviivo.webcore.ajaxHelper.methods.POST,
                contentType: eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                callback: function(e) {
                    eviivo.eagle.gridBlock.updateDiaryBlock(e),
                    "function" == typeof E.onBlockActionCallback && E.onBlockActionCallback(),
                    y()
                },
                failCallback: function() {
                    C()
                }
            }) : eviivo.webcore.ajaxHelper.executeAjax({
                url: eviivoSuiteApp + "/api/blockedrooms/add",
                data: o,
                actionId: "addBlockedRooms",
                method: eviivo.webcore.ajaxHelper.methods.POST,
                contentType: eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                callback: function(e) {
                    "function" == typeof E.onBlockActionCallback && E.onBlockActionCallback(),
                    y()
                },
                failCallback: function() {
                    C()
                }
            }),
            eviivo.component.flyout.hideFlyout(E.popupBox.attr("id")),
            $(".booking-action-button").removeClass("hide"),
            $(".block-room-buttons").addClass("hide"))
        }
        function y() {
            eviivo.webcore.notifier.show({
                type: eviivo.webcore.notifier.types.success,
                message: E.resources.blockRoomView.RoomBlockCreated,
                position: eviivo.webcore.notifier.positions.bottomRight
            })
        }
        function C() {
            eviivo.webcore.notifier.show({
                type: eviivo.webcore.notifier.types.warn,
                message: E.resources.blockRoomView.AddBlockError
            })
        }
        function k() {
            E.popupBox.find(".heading-title").html(E.resources.blockRoomView.Title),
            E.popupBox.find(".eviivo-startdate label").html(E.resources.blockRoomView.StartDate),
            E.popupBox.find(".eviivo-enddate label").html(E.resources.blockRoomView.EndDate),
            E.popupBox.find(".s-booking-notes label").html(E.resources.blockRoomView.Notes),
            E.popupBox.find(".s-booking-notes span").remove(),
            E.popupBox.find(".eviivo-reasons .reasons-container .block").after('<span class="error-asterix">*</span>'),
            E.popupBox.find(".s-btn-submit-block").html(E.resources.blockRoomView.ButtonText),
            S.addClass("hide")
        }
        function w() {
            $(".eviivo-reasons .alloc").find("span").remove(),
            E.popupBox.find(".heading-title").html(E.resources.bookingView.Title),
            E.popupBox.find(".eviivo-startdate label").html(E.resources.bookingView.StartDate),
            E.popupBox.find(".eviivo-enddate label").html(E.resources.bookingView.EndDate),
            E.popupBox.find(".s-booking-notes label").html(E.resources.bookingView.Notes),
            E.popupBox.find(".eviivo-reasons span").remove(),
            E.popupBox.find(".s-booking-notes span").remove(),
            S.removeClass("hide"),
            E.popupBox.find("#add-booking-note").attr("placeholder", E.resources.BookingNote)
        }
        function I(e) {
            var o = E.popupBox.find(".s-booking-notes textarea")
              , t = (o.val(""),
            j = null,
            {
                viewType: e,
                adults: E.carouselOptions.defaultAdults,
                children: E.carouselOptions.defaultChildren,
                nights: E.carouselOptions.defaultNights,
                resetRoomSelection: !1
            });
            switch ((E = $.extend(E, t)).startDate = P.startDate(),
            E.nights = P.nights(),
            E.roomId = D.room(),
            $(".booking-action-button").removeClass("hide"),
            $(".block-room-buttons").addClass("hide"),
            e) {
            case R.Booking:
                $("body").data("visiblePopup", "newBookingPopup"),
                eviivo.eagle.booking.guest.initForm(),
                o.off("keyup blur"),
                r(o, "keyup blur", A),
                D.viewType(R.Booking),
                w(),
                eviivo.eagle.occupancy.show(E, P),
                E.popupBox.find(".btn-book, .btn-book-continue, .confirm-checkbox").show(),
                $(".s-heading-title").html(E.resources.bookingView.Title),
                $("#chargeLabel").parent().show();
                break;
            case R.BlockRoom:
                $("body").data("visiblePopup", "blockRoomPopup"),
                B(),
                o.off("keyup blur"),
                r(o, "keyup blur", O),
                j = null,
                $(".eviivo-reasons .reasons-container").html(""),
                E.popupBox.find(".s-btn-submit-block").attr("disabled", !0),
                D.viewType(R.BlockRoom),
                k(),
                eviivo.eagle.occupancy.show(E, P),
                u(),
                E.popupBox.find(".btn-book, .btn-book-continue, .confirm-checkbox").hide(),
                $(".s-heading-title").html(E.resources.blockTitle),
                $("#chargeLabel").parent().hide()
            }
        }
        function T(e, o) {
            if (null != e && 0 !== e.length)
                for (var t = 0; t < e.length; t++) {
                    var a, i = e[t];
                    0 == $("#" + i.Id).length && (a = $("<button>"),
                    o ? a.appendTo($(".eviivo-reasons .alloc ")) : a.appendTo($(".eviivo-reasons .block")),
                    a.html(i.Name).attr("id", i.Id),
                    a.addClass("btn btn-grouped btn-invert btn-small").on("click", x),
                    i.IsAllocation && a.addClass("is-allocation"),
                    1 == e.length) && (a.trigger("click"),
                    E.popupBox.find(".s-btn-submit-block").attr("disabled", !1))
                }
        }
        function x() {
            var e;
            $(".eviivo-reasons .reasons-container button").not(".is-allocation").removeClass("btn-active"),
            $(this).addClass("btn-active"),
            $(".eviivo-reasons span").remove(),
            j = parseInt($(this).attr("id")),
            e = E.popupBox.find(".s-booking-notes"),
            D.viewType() == R.BlockRoom ? (e.find("span").remove(),
            null !== j && E.popupBox.find(".s-btn-submit-block").attr("disabled", !1)) : (E.popupBox.find(".s-btn-submit-block").attr("disabled", !0),
            0 === e.find("span").length && e.append('<span class="error-asterix">*</span>'))
        }
        function B() {
            $(".booking-action-button").addClass("hide"),
            $(".block-room-buttons").removeClass("hide")
        }
        var S, D, P, j, N, A, O, M, R, E;
        window.eviivo = window.eviivo || {},
        window.eviivo.eagle = window.eviivo.eagle || {},
        window.eviivo.eagle.bookingPopup = window.eviivo.eagle.bookingPopup || {},
        window.eviivo.eagle.bookingPopup = (N = {
            tentative: "T",
            confirmed: "C"
        },
        A = 4e3,
        M = !(O = 100),
        R = eviivo.eagle.occupancy.viewPanel,
        E = {
            top: 100,
            popupBox: $("#add-booking"),
            closeButton: $("#add-booking .s-close"),
            startDate: null,
            endDate: null,
            adults: 1,
            children: 0,
            roomId: null,
            roomTypeId: null,
            resources: null,
            bookingModel: null,
            diaryViewType: null,
            diaryStart: null,
            guestId: null,
            isAddBookingToGroup: !1,
            parentOrderReference: null,
            parentOrderId: null
        },
        {
            init: function(e) {
                E = $.extend(E, e),
                E.diaryViewUrls,
                E.beforeAjaxRequest = l,
                E.afterAjaxRequest = d,
                E.ajaxRequestNoResults = c,
                E.persistRoomSelection = !0,
                P = eviivo.eagle.occupancy.init(E),
                void 0 === D && (D = new o),
                D = $.extend(D, P),
                bookingModelInitialised = !0,
                S = $("#new-booking-container"),
                ko.applyBindings(D, document.getElementById("add-booking")),
                $("#link_MultiroomBooking").on("click", a),
                $(document).on("click", ".eviivo-reasons .block", n),
                $(".s-d-bus").on("change", function(e) {
                    eviivo.eagle.occupancy.checkAvailability(),
                    eviivo.eagle.basePageModelState.businessId = jQuery(".s-d-bus").val(),
                    eviivo.eagle.booking.guestMessage.setConfirmationMessage(e, null, null)
                }),
                E.popupBox.find(".s-btn-book").on("click touch keypress", function(e) {
                    f(e, !1)
                }),
                E.popupBox.find(".s-btn-book-continue").on("click touch keypress", function(e) {
                    f(e, !0)
                }),
                E.popupBox.find(".s-btn-submit-block").attr("disabled", !0).on("mouseup", b),
                E.popupBox.find(".s-btn-block").on("click touch", function() {
                    I(R.BlockRoom)
                }),
                E.popupBox.find(".s-btn-back").on("click touch", function() {
                    I(R.Booking)
                }),
                E.popupBox.find(".availability").tip(),
                e = eviivo.webcore.queryStringHelper.getAllKeys(window.location.href),
                e = parseInt(e.guestid),
                isNaN(e) || 0 === e || eviivo.webcore.ajaxHelper.executeAjax({
                    actionId: "GuestController.GetGuestForBookingPopup",
                    url: eviivoSuiteApp + "/api/Guest/GetGuestForBookingPopup?businessId=" + eviivo.eagle.basePageModelState.businessId + "&guestId=" + e,
                    method: eviivo.webcore.ajaxHelper.methods.GET,
                    contentType: eviivo.webcore.ajaxHelper.contentTypes.URL_ENCODED_UTF8,
                    dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                    callback: t
                }),
                i(),
                $("section#add-booking .cp-flyout_footer").append($("#Booking-Guest-Confirm-Email").parent())
            },
            extendOptions: function(e) {
                E = $.extend(E, e)
            },
            show: s,
            setDiaryGridSettings: function(e) {
                E = $.extend(E, e)
            },
            showBlockOnly: function e(o) {
                var t;
                E = $.extend(E, o),
                !1 === bookingModelInitialised ? setTimeout(function() {
                    e(o)
                }, 3e3) : !0 !== M && (M = !0,
                E.popupBox && (D.viewType(R.BlockRoom),
                E.popupBox.find(".s-booking-notes textarea").attr("maxlength", A),
                (t = E.popupBox.find(".s-booking-notes textarea")).val(""),
                j = null,
                t.off("keyup blur"),
                r(t, "keyup blur", O),
                j = null,
                $(".eviivo-reasons .reasons-container").html(""),
                E.popupBox.find(".s-btn-submit-block").attr("disabled", !0),
                E = $.extend(E, {
                    viewType: D.viewType(),
                    adults: E.carouselOptions.defaultAdults,
                    children: E.carouselOptions.defaultChildren,
                    nights: E.carouselOptions.defaultNights,
                    resetRoomSelection: !1,
                    isOtaBooking: !1
                }),
                P.canBeModified(null),
                P.isOta(null),
                k(),
                eviivo.eagle.occupancy.show(E, P),
                u(),
                eviivo.component.flyout.showFlyout(E.popupBox.attr("id")),
                $(".s-heading-title").html(E.resources.blockTitle),
                $("#add-booking .s-cancel").hide(),
                M = !1),
                B(),
                E.popupBox.find(".btn-book, .btn-book-continue, .confirm-checkbox").hide())
            }
        })
    },
    5785: function() {
        function i() {
            if (null != s && null != l && null != r) {
                var e = s.offset().left
                  , o = s.offset().top;
                switch (r.options.position) {
                case c.bottomLeft:
                    o = o + s.outerHeight() + l.topOffset;
                    break;
                case c.topRight:
                    e = e + s.outerWidth() + l.leftOffset,
                    r.options.toLeft && (e -= r.outerWidth(!0));
                    break;
                case c.bottomRight:
                    o = o + s.outerHeight() + l.topOffset,
                    e = e + s.outerWidth() + l.leftOffset,
                    r.options.toLeft && (e -= r.outerWidth(!0));
                    break;
                case c.middleRight:
                    o = o - r.outerHeight() / 2 + l.topOffset,
                    e = e + s.outerWidth() + l.leftOffset,
                    r.options.toLeft && (e -= r.outerWidth(!0))
                }
                r.css({
                    top: o,
                    left: e
                }),
                r.show();
                var t = $(".body-wrapper")
                  , a = (t = null == t ? $(".mod-diary-outer") : t).outerHeight(!0)
                  , t = t.outerWidth(!0)
                  , i = (null == a && (a = window.innerHeight),
                null == t && (t = window.innerWidth),
                r.find(".popup-outer-element"))
                  , n = (i = null != i && 0 !== i.length ? i : r).outerHeight(!0);
                a < o + n && 0 < a && (o = o - n - s.outerHeight(!0));
                a = (a = i.outerWidth(!0)) || r.outerWidth();
                r.css({
                    top: o = o < 0 ? 0 : o,
                    left: e = (e = t < e + a && 0 < t ? t - a : e) < 0 ? 0 : e
                })
            }
        }
        function o(e) {
            l = s = r = n = null;
            for (var o = 0; o < t.length; o++)
                t[o].hideMenu();
            "function" == typeof e && e()
        }
        var t, n, s, r, l, d, c;
        window.eviivo = window.eviivo || {},
        window.eviivo.eagle = window.eviivo.eagle || {},
        window.eviivo.eagle.contextMenu = window.eviivo.eagle.contextMenu || {},
        window.eviivo.eagle.contextMenu = (types = {
            NotesContextMenu: 1
        },
        d = {
            position: l = r = s = n = null,
            toLeft: null,
            onshow: null,
            onhide: null,
            toggleCallback: null,
            type: null,
            outsideClose: !(t = [])
        },
        c = {
            topLeft: 1,
            topRight: 2,
            bottomLeft: 3,
            bottomRight: 4,
            middleRight: 5
        },
        $.fn.contextMenu = function(e) {
            this.options = $.extend({}, d, e);
            var a = this;
            return $(document).on("keyup", function(e) {
                27 == e.keyCode && o()
            }),
            a.showMenu = function(e) {
                var o = $.extend({
                    target: null,
                    event: null,
                    callback: null,
                    topOffset: 0,
                    leftOffset: 0,
                    outsideClose: !1
                }, e)
                  , t = !1;
                n === o.target[0] && ("function" == typeof a.options.toggleCallback && a.options.toggleCallback(o.event),
                t = !0),
                null != e.position && (a.options.position = e.position),
                r && r.hideMenu(null, null, !1),
                r = a,
                !0 === t ? r = n = null : (n = o.target[0],
                s = (l = o).target,
                i(),
                !0 === o.outsideClose && $(document).on("click.eviivo_eagle_contextMenu", function(e) {
                    var o = a;
                    $(e.target).closest(o.options.popup).length || !1 === o.isNewPopup && o.hideMenu(),
                    o.isNewPopup = !1
                }),
                "function" == typeof o.callback && o.callback(o.event),
                "function" == typeof a.options.onshow && a.options.onshow(o.event),
                n = o.target[0])
            }
            ,
            a.hideMenu = function(e, o, t) {
                a.hide(),
                l = s = n = null,
                "function" == typeof o && o(e),
                "function" == typeof a.options.onhide && !1 !== t && a.options.onhide(e),
                $(document).off("click.eviivo_eagle_contextMenu")
            }
            ,
            a.setIsNewPopup = function(e) {
                a.isNewPopup = e
            }
            ,
            t.push(a),
            a
        }
        ,
        {
            closeAll: o,
            outsideClick: function(e) {
                var o, t;
                return e.pageX < $("#rooms-left-container").outerWidth(!0) || (t = o = 0,
                t = null != $("#body-content-roomview").offset() ? (o = $("#body-content-roomview").offset().top,
                $(".body-content-roomview-wrap").outerHeight(!0) + o) : (o = $(".mod-diary-outer").offset().top,
                $(".mod-diary-outer").outerHeight(!0) + o),
                e.pageY < o) || e.pageY > t
            },
            insideClick: function(e) {
                var o, t;
                return !!r && (t = o = !1,
                e.pageX >= r.offset().left && e.pageX <= r.offset().left + r.outerWidth(!0) && (o = !0),
                e.pageY >= r.offset().top && e.pageY <= r.offset().top + r.outerHeight(!0) && (t = !0),
                o) && t
            },
            getActiveMenuType: function() {
                return null == r ? null : r.options.type
            },
            positions: c,
            types: types,
            resetPositionOfContext: i
        })
    },
    1746: function() {
        function s() {
            k = $("#divDiaryNotes"),
            w = $("#diaryNotesTextOnly"),
            y = $("#btnEditNotes"),
            btnSaveNotes = $("#btnSaveNotes"),
            C = $("#btnCancelNotes"),
            h = $("#notes"),
            b = $("#txtNotes"),
            te = $("#cbSelectAll"),
            e = $(".check"),
            K = $("tr[data-type='booking'] > td"),
            Z = $("tr[data-type='overbooking'] > td"),
            ee = $("tr[data-type='blocked'] > td"),
            n = $("select[name='bookings-table_length']")
        }
        function r() {
            b.attr("placeholder", options.resources.NotePlaceholder),
            te.off().on("change", function() {
                $(this).is(":checked") ? e.prop("checked", !0) : e.prop("checked", !1),
                l()
            }),
            e.off().on("change", l),
            y.off().on("click", _),
            $("#iconClose").off().on("click", U),
            C.off().on("click", E),
            K.off().on("click", function() {
                var e, o, t = $(this);
                t.hasClass("s-contains-checkbox") || (e = t.parent().attr("data-id"),
                o = t.closest("tr").attr("data-bid"),
                eviivo.eagle.viewBookingPopup.showViewBookingPopup(e, null, c, d, null, null, null, null, null, o),
                d(t.parent()))
            }),
            Z.off().on("click", function(e) {
                var o, t, a, i, n, s = $(e.currentTarget);
                s.is("td:first-child") ? (a = s.find("input[type=checkbox]").prop("checked"),
                s.find("input[type=checkbox]").prop("checked", !a)) : (s = parseInt($(this).parents("tr").attr("data-bid")),
                a = parseInt($(this).parents("tr").attr("data-room-id")),
                i = $(this).parents("tr").find("td[data-startdate]").attr("data-startdate"),
                o = $(this).parents("tr").find("td[data-enddate]").attr("data-enddate"),
                g.setIsNewPopup(!1),
                t = s,
                s = a,
                a = eviivo.webcore.datetime.parse.shortDateString(eviivo.webcore.datetime.parse.parseDateDayFirst(i), "-"),
                i = eviivo.webcore.datetime.parse.shortDateString(eviivo.webcore.datetime.utils.addDaysToDate(eviivo.webcore.datetime.parse.parseDateDayFirst(o), -1), "-"),
                n = {
                    event: e,
                    target: $(this),
                    outsideClose: !0
                },
                eviivo.webcore.ajaxHelper.executeAjax({
                    url: eviivoSuiteApp + "/api/bookings/Overbookings",
                    data: {
                        businessId: t,
                        roomId: s,
                        startDate: a,
                        endDate: i
                    },
                    actionId: "getOverbookingsForContext",
                    method: eviivo.webcore.ajaxHelper.methods.GET,
                    contentType: eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,
                    dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                    callback: function(e) {
                        var o;
                        e && (e.bookings.length || e.blockedRooms.length) && (o = document.getElementById("popup-box-overbooking"),
                        ko.cleanNode(o),
                        ko.cleanNode(document.getElementById("overbooking-wrap")),
                        ko.cleanNode(document.getElementById("overbookBlockedRoom-wrap")),
                        e.bookings.length && $.each(e.bookings, function(e, o) {
                            o.viewNonTentativeBooking = function() {
                                !1 === o.IsTentative && (g.hideMenu(),
                                eviivo.eagle.viewBookingPopup.showViewBookingPopup(o.Id, null, c, null, null, null, null, null, null, t))
                            }
                            ,
                            o.modifyBooking = function() {
                                g.hideMenu(),
                                eviivo.eagle.viewBookingPopup.showViewBookingPopup(o.Id, me.Modify, c, null, null, null, null, null, null, t)
                            }
                        }),
                        e.blockedRooms.length && $.each(e.blockedRooms, function(e, o) {
                            o.removeBlockedRoom = function() {
                                J(o.Id, t)
                            }
                        }),
                        ko.applyBindings(e, o),
                        g.showMenu(n))
                    },
                    failCallback: q
                }),
                d($(this).parent()))
            }),
            ee.off().on("click", function(e) {
                var o, t, a, i = $(e.currentTarget);
                i.is("td:first-child") ? (o = i.find("input[type=checkbox]").prop("checked"),
                i.find("input[type=checkbox]").prop("checked", !o)) : (t = $(this).parents("tr").attr("data-id"),
                a = $(this).parents("tr").attr("data-bid"),
                i = $(this).parents("tr").attr("data-created-date"),
                oe.off("click").on("click", function() {
                    J(parseInt(t), parseInt(a))
                }),
                f.setIsNewPopup(!0),
                f.find("#check-in-created-date").html(i),
                f.showMenu({
                    event: e,
                    target: $(this),
                    outsideClose: !0
                }),
                d($(this)))
            }),
            n.val(options.defaultDisplayLength).trigger("change")
        }
        function E(e) {
            var o;
            v() === listViews.New ? (x.datepicker("setDate", new Date),
            B.datepicker("setDate", new Date),
            P.show(),
            D.hide()) : v() === listViews.Booked ? (o = new Date,
            B.datepicker("setDate", o),
            o.setDate(o.getDate() - 7),
            x.datepicker("setDate", o),
            P.hide(),
            D.show(),
            S.text(S.data("booked-between-text"))) : (P.hide(),
            D.show(),
            S.text(S.data("stays-between-text"))),
            c()
        }
        function l() {
            0 < $("input.check:checkbox:checked").length ? I.prop("disabled", !1) : (I.prop("disabled", !0),
            I.siblings().hide())
        }
        function H(e) {
            a(),
            eviivo.webcore.ajaxHelper.executeAjax({
                actionId: "checkInCheckOutBookings",
                url: eviivoSuiteApp + "/listBookings/checkInCheckOutBookings",
                traditional: !0,
                method: eviivo.webcore.ajaxHelper.methods.POST,
                contentType: eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                data: {
                    bookingIds: V(),
                    checkinStatusCode: e
                },
                callback: function() {
                    c()
                },
                failCallback: function() {}
            })
        }
        function F(e) {
            a(),
            eviivo.webcore.navigatorHelper.redirectTo(eviivoSuiteApp + "/diary/GuestRegistrations", t(), eviivo.webcore.navigatorHelper.options.target.newWindow, eviivo.webcore.navigatorHelper.options.method.post)
        }
        function G() {
            a(),
            eviivo.webcore.navigatorHelper.redirectTo(eviivoSuiteApp + "/diary/Statements", t(), eviivo.webcore.navigatorHelper.options.target.newWindow, eviivo.webcore.navigatorHelper.options.method.post)
        }
        function Q() {
            a(),
            eviivo.webcore.navigatorHelper.redirectTo(eviivoSuiteApp + "/diary/Invoices", t(), eviivo.webcore.navigatorHelper.options.target.newWindow, eviivo.webcore.navigatorHelper.options.method.post)
        }
        function L() {
            a(),
            eviivo.webcore.ajaxHelper.executeAjax({
                actionId: "reconcileMultipleBookings",
                url: eviivoSuiteApp + "/Payments/ReconciliationPaymentMultiple",
                method: eviivo.webcore.ajaxHelper.methods.POST,
                data: {
                    bookingReferences: V()
                },
                contentType: eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.HTML,
                callback: function(e) {
                    eviivo.webcore.parsers.stringToBool(e) ? o(!0, eviivo.eagle.translations.resources.notify.saveSuccessText) : o(!1, eviivo.eagle.translations.resources.notify.genericErrorMessage)
                },
                failCallback: function() {
                    o(!1, eviivo.eagle.translations.resources.notify.genericErrorMessage)
                }
            })
        }
        function o(e, o) {
            eviivo.webcore.notifier.show({
                type: e ? eviivo.webcore.notifier.types.success : eviivo.webcore.notifier.types.error,
                message: o
            })
        }
        function V() {
            var t = []
              , e = $("input.check:checkbox:checked");
            return 0 < e.length && e.map(function(e, o) {
                t.push($(o).attr("data-id"))
            }),
            t
        }
        function t() {
            var a = {
                BookingsList: []
            }
              , e = ""
              , o = $("input.check:checkbox:checked")
              , i = {};
            0 < o.length && o.each(function(e, o) {
                var t = parseInt($(o).closest("tr").attr("data-bid"))
                  , o = parseInt($(o).closest("tr").attr("data-id"));
                null == i[t] ? (i[t] = {
                    BusinessId: t,
                    BookingIds: [o]
                },
                a.BookingsList.push(i[t])) : i[t].BookingIds.push(o)
            });
            for (var t = 0; t < a.BookingsList.length; t++) {
                var n = a.BookingsList[t];
                e += n.BusinessId;
                for (var s = 0; s < n.BookingIds.length; s++)
                    e += "," + n.BookingIds[s];
                e += ";"
            }
            return e
        }
        function _(e) {
            k.hasClass("hide") || $("#modNotice").hasClass("hide") ? (k.removeClass("hide"),
            btnSaveNotes.removeClass("hide"),
            C.removeClass("hide"),
            b.removeClass("hide"),
            w.addClass("hide"),
            y.addClass("hide"),
            h.addClass("hide")) : (k.addClass("hide"),
            btnSaveNotes.addClass("hide"),
            C.addClass("hide"),
            b.addClass("hide"),
            h.removeClass("hide"),
            w.removeClass("hide")),
            $("#modNotice").removeClass("hide")
        }
        function U(e) {
            $("#iconClose").addClass("hide"),
            h.addClass("hide"),
            k.addClass("hide"),
            $("#modNotice").addClass("hide")
        }
        function q() {}
        function J(e, o) {
            eviivo.webcore.ajaxHelper.executeAjax({
                url: eviivoSuiteApp + "/api/blockedrooms/remove",
                data: {
                    BlockId: e,
                    BusinessId: o
                },
                actionId: "removeBlockedRooms",
                method: eviivo.webcore.ajaxHelper.methods.POST,
                contentType: eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                callback: function() {
                    g.hideMenu(),
                    f.hideMenu(),
                    c()
                }
            })
        }
        function W() {
            $(this).siblings().toggle("fast", function() {}),
            $(document).on("keyup", function(e) {
                27 == e.keyCode && (i.removeClass("active"),
                i.siblings().hide(),
                a())
            })
        }
        function a() {
            I.removeClass("active"),
            I.siblings().hide()
        }
        function d(e) {
            var o, t = !0;
            e && (t = e.hasClass("selected"),
            null != (o = null != (o = e.attr("data-bid")) && "" !== o ? parseInt(o) : null)) && (eviivo.eagle.basePageModelState.businessId = o),
            $("tr").removeClass("selected"),
            !1 === t && e.addClass("selected")
        }
        function c(e, o, t, a, i) {
            null == e && (e = x.datepicker("getDate")),
            null == o && (o = B.datepicker("getDate")),
            options.startDate = e,
            options.endDate = o,
            null != t && !0 !== i && null != t.Guest && z(t.Id, t.BookingReferenceNumber, t.Guest.Surname, t.BusinessId);
            var i = {
                selectedView: v()
            }
              , n = ""
              , t = "string" == typeof e ? e.substr(0, 10) : e.evStandardIso8601DateExtended()
              , e = "string" == typeof o ? o.substr(0, 10) : o.evStandardIso8601DateExtended();
            null != t && "" != t && (n = n + (0 <= n.indexOf("?") ? "&" : "?") + "startDate=" + t + "&endDate=" + e,
            i.startDate = t,
            i.endDate = e),
            0 == a && (i.bypassRefreshCheck = !1),
            null != A && (u(),
            A.abort()),
            function() {
                if (0 < M.length)
                    return M[0].checked;
                return
            }() && (i.withInvoiceOnly = !0),
            T.removeClass("hide").addClass("active"),
            A = eviivo.webcore.ajaxHelper.executeAjax({
                actionId: "GET",
                url: eviivoSuiteApp + "/listBookings/listDetails",
                method: eviivo.webcore.ajaxHelper.methods.GET,
                contentType: eviivo.webcore.ajaxHelper.contentTypes.TEXT_HTML_UTF8,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.HTML,
                data: i,
                callback: function(e) {
                    u(),
                    null != e && "" != e && (X.html(e),
                    options.initDatatable && options.initDatatable(),
                    s(),
                    r(),
                    l()),
                    history && (e = window.location.href.split("?")[0] + n,
                    history.replaceState({}, window.title, e)),
                    clearTimeout(N),
                    N = setTimeout(function() {
                        c(null, null, !1)
                    }, O * R)
                },
                failCallback: function() {
                    u()
                }
            })
        }
        function z(e, o, t, a) {
            eviivo.eagle.floatingNotification.showAddBookingNotification({
                ref: o,
                guestName: t,
                bookingId: e,
                businessId: a,
                messageFormat: options.resources.BookingCreatedMessage,
                customAction: eviivo.eagle.viewBookingPopup.showViewBookingPopup,
                resources: {
                    BookingCreatedMessage1: options.resources.BookingCreatedMessage1,
                    ClickHereToView: options.resources.ClickHereToView
                }
            }),
            history && (o = window.location.href.split("?")[0],
            history.replaceState({}, window.title, o))
        }
        function u() {
            T.removeClass("active").addClass("hide")
        }
        function v() {
            var e = $(".s-list-views input:radio:checked")[0];
            switch (null == e ? 0 : e.id) {
            case "radioArrivals":
                return listViews.Arrivals;
            case "radioDepatures":
                return listViews.Departures;
            case "radioInHouse":
                return listViews.InHouse;
            case "radioNew":
                return listViews.New;
            case "radioBooked":
                return listViews.Booked;
            case "radioWithInvoice":
                return listViews.WithInvoice;
            default:
                return listViews.All
            }
        }
        var X, i, Y, K, Z, n, p, g, m, f, ee, oe, h, b, y, C, k, w, te, e, I, ae, ie, ne, se, re, T, x, B, S, D, le, P, de, ce, ue, ve, pe, ge, me, j, N, A, O, M, R;
        window.eviivo = window.eviivo || {},
        window.eviivo.eagle = window.eviivo.eagle || {},
        window.eviivo.eagle.diaryList = window.eviivo.eagle.diaryList || {},
        window.eviivo.eagle.diaryList = (options = {
            cultureCode: null,
            hasDayNote: !1
        },
        listViews = {
            All: 0,
            Arrivals: 1,
            InHouse: 2,
            Departures: 3,
            New: 4,
            Booked: 5,
            WithInvoice: 6
        },
        me = eviivo.eagle.viewBookingPopup.getBookingViewTypes(),
        j = {
            checkedIn: "I",
            checkedOut: "O",
            notCheckedIn: "N"
        },
        A = N = null,
        O = 60,
        M = $("#withInvoice"),
        R = 6e4,
        {
            init: function(e) {
                if (options = $.extend(options, e),
                X = $("#divRoomBookings"),
                i = $("#buttonFilter"),
                x = $("#from-date-selector"),
                B = $("#to-date-selector"),
                Y = $(".s-list-views"),
                ge = $("#btnBlock"),
                se = $("#btnPrintRegForm"),
                re = $("#btnPrintStatement"),
                ue = $("#btnPrintInvoice"),
                ae = $("#btnAddBooking, #btnActionsAddBooking"),
                I = $("#btnActions"),
                ie = $("#btnActionsCheckin"),
                ne = $("#btnActionsCheckout"),
                p = $("#popup-box-overbooking"),
                m = $("#blocked-room-context"),
                oe = $("#remove-block"),
                n = $("select[name='bookings-table_length']"),
                S = $("#range-picker-label"),
                D = $("#range-picker-holder"),
                P = $("#range-message"),
                le = $("#getBookingsList"),
                T = $("#loading-overlay"),
                ce = $("#btnReconciliationPayment"),
                i.off().on("click", W),
                ge.off().on("click touchstart", function() {
                    a(),
                    eviivo.eagle.bookingPopup.showBlockOnly({
                        startDate: null,
                        roomId: null,
                        onActionCallback: c
                    })
                }),
                Y.off().on("change", E),
                ae.off().on("click touchstart", function() {
                    a(),
                    eviivo.eagle.bookingPopup.show({
                        startDate: null,
                        roomId: null,
                        onActionCallback: c
                    })
                }),
                I.off().on("click", W),
                se.off().on("click", F),
                re.off().on("click", G),
                ue.off().on("click", Q),
                ce.off().on("click", L),
                ie.off().on("click", function() {
                    H(j.checkedIn)
                }),
                ne.off().on("click", function() {
                    H(j.checkedOut)
                }),
                g = p.contextMenu({
                    popup: p,
                    position: eviivo.eagle.contextMenu.positions.topRight,
                    toLeft: !0,
                    toggleCallback: function() {
                        ko.cleanNode(p)
                    },
                    onhide: d,
                    outsideClose: !0
                }),
                f = m.contextMenu({
                    popup: m,
                    position: eviivo.eagle.contextMenu.positions.topRight,
                    toLeft: !0,
                    onhide: d,
                    outsideClose: !0
                }),
                le.off().on("click", function() {
                    c()
                }),
                "undefined" == typeof eviivo || void 0 === eviivo.webcore || void 0 === eviivo.webcore.queryStringHelper)
                    throw namespace + ": module depends on eviivo.webcore.queryStringHelper";
                null != (e = eviivo.webcore.queryStringHelper.getAllKeys(window.location.href).startdate) && "" !== e && (ve = new Date(e),
                pe = new Date(e)),
                null == de && (de = eviivo.webcore.calendar.init(eviivo.webcore.calendar.CALENDAR_TYPE.initFromToDateSelector, {
                    dateFormat: eviivo.eagle.dateFormat.getDateFormat("MEDIUM_DATE_FORMAT"),
                    daySpan: 0,
                    defaultCultureCode: options.defaultCultureCode,
                    yearRange: "c-4:c+5",
                    fromCalendarId: x,
                    toCalendarId: B,
                    startDateFromInit: ve,
                    endDateFromInit: pe,
                    updtStDtQueryOnChange: !0,
                    updtStDtPersistentElementsOnChange: !0
                })),
                s(),
                r(),
                N = setTimeout(function() {
                    c(null, null, !1)
                }, O * R),
                setTimeout(function() {
                    var e = eviivo.webcore.queryStringHelper.getUrlParameter("bookingRef");
                    e && z(eviivo.webcore.queryStringHelper.getUrlParameter("bookingId"), e, eviivo.webcore.queryStringHelper.getUrlParameter("guest"), eviivo.webcore.queryStringHelper.getUrlParameter("businessId"))
                }, 300),
                eviivo.eagle.bookingPopup.extendOptions({
                    onBlockActionCallback: c
                }),
                eviivo.eagle.multiProperty.applyButtonCallBackFunction({
                    callBackFunction: c
                }),
                eviivo.pms.accessGroup.headerSearch.extendOptions({
                    callBackFunction: c
                })
            },
            getListDetails: c
        })
    },
    8693: function() {
        function o(e) {
            e.stopPropagation(),
            e.preventDefault();
            var t, o = $(e.target);
            h = {
                Id: (g = o).attr("data-id"),
                Date: k.getDate(o),
                BusinessId: parseInt(k.getBusinessIdForNote(o)),
                Content: o.attr("data-tooltip-title")
            },
            !o.hasClass("s-note") || void 0 !== h.Content && "" !== h.Content ? a(e) : (t = e,
            eviivo.webcore.ajaxHelper.executeAjax({
                url: eviivoSuiteApp + "/api/diarynotes/get",
                data: h,
                actionId: "getNotes",
                method: eviivo.webcore.ajaxHelper.methods.POST,
                contentType: eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                callback: function(e) {
                    var o = e[0].Content.replace(/(?:\r\n|\r|\n)/g, "<br/>");
                    h.Content = o,
                    h.Id = e[0].Id,
                    r(!1),
                    a(t)
                },
                failCallback: function() {}
            }))
        }
        function a(e) {
            var o, t, a = h.Content;
            void 0 !== h.Content && (a = h.Content.replace(/(?:\r\n|\r|\n)/g, "<br/>")),
            "mouseover" === e.type ? (g.attr("data-tooltip-title", a),
            g.trigger("mouseover")) : p.noteEditingRestricted || (e = h.Content,
            a = g,
            o = eviivo.webcore.datetime.parse.parseDateShort(h.Date),
            null != (t = e) && (t = e.replace(/<br\/>/g, "\n")),
            e = eviivo.util.decodedHtml(t),
            m.val(e),
            f.find(".heading-title").text(o.evDisplayLongDate(eviivo.eagle.basePageModelState.userCultureCode)),
            f.showMenu({
                target: a,
                topOffset: 38,
                leftOffset: 10
            }))
        }
        function t(e) {
            b = setTimeout(function() {
                o(e)
            }, w)
        }
        function i() {
            clearTimeout(b),
            eviivo.webcore.ajaxHelper.abortAjax("getNotes")
        }
        function n(e) {
            e && (e.preventDefault(),
            e.stopImmediatePropagation()),
            h.Content = m.val(),
            h.Id = g.attr("data-id"),
            null === h.Id || void 0 === h.Id ? "" === h.Content ? c() : eviivo.webcore.ajaxHelper.executeAjax({
                url: eviivoSuiteApp + "/api/diarynotes/add",
                data: h,
                actionId: "addNote",
                method: eviivo.webcore.ajaxHelper.methods.POST,
                contentType: eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                callback: function(e) {
                    c(),
                    h.Id = e.Id,
                    s() ? r(!1) : eviivo.pms.diary.dataLoader.refreshDataOnly(),
                    l()
                },
                failCallback: function() {
                    c(),
                    jQuery(".notifyjs-wrapper").remove(),
                    eviivo.webcore.notifier.show({
                        type: eviivo.webcore.notifier.types.warn,
                        message: p.resources.AddNoteError
                    })
                }
            }) : eviivo.webcore.ajaxHelper.executeAjax({
                url: eviivoSuiteApp + "/api/diarynotes/modify",
                data: h,
                actionId: "modifyNote",
                method: eviivo.webcore.ajaxHelper.methods.POST,
                contentType: eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                callback: function() {
                    c(),
                    "" === h.Content ? (r(!0),
                    s() || eviivo.pms.diary.dataLoader.refreshDataAndUi("n_" + h.Id)) : r(!1),
                    l()
                },
                failCallback: function() {
                    c(),
                    jQuery(".notifyjs-wrapper").remove(),
                    eviivo.webcore.notifier.show({
                        type: eviivo.webcore.notifier.types.warn,
                        message: p.resources.ModifyNoteError
                    })
                }
            })
        }
        function s() {
            return e = null == e ? 0 < $("#DailyRatesDetail").length : e
        }
        function r(e) {
            g.attr("data-tooltip", "title"),
            g.attr("data-tooltip-pos", "top"),
            e ? (g.removeAttr("data-id"),
            g.removeClass("s-note"),
            g.attr("data-tooltip-title", ""),
            g.addClass("icon-font-note_edit").removeClass("icon-font-note")) : (null == g.attr("id") && g.attr("id", h.Id),
            g.addClass("s-note"),
            g.attr("data-id", h.Id),
            g.attr("data-tooltip-title", h.Content),
            g.removeClass("icon-font-note_edit").addClass("icon-font-note"))
        }
        function l() {
            jQuery(".notifyjs-wrapper").remove(),
            eviivo.webcore.notifier.show({
                type: eviivo.webcore.notifier.types.success,
                message: p.resources.AddNoteMessage
            })
        }
        function d() {
            g.attr("data-tooltip-title", ""),
            m.val("")
        }
        function c() {
            return null != eviivo.pms.diary.gridNavigation && eviivo.pms.diary.gridNavigation.resetHandlers(),
            eviivo.eagle.contextMenu.closeAll(),
            !0
        }
        function u(e) {
            return $(e).attr("data-date")
        }
        function v(e) {
            return $(e).closest("tr").attr("data-bid")
        }
        var p, g, m, f, h, b, y, C, k, w, e;
        window.eviivo = window.eviivo || {},
        window.eviivo.eagle = window.eviivo.eagle || {},
        window.eviivo.eagle.diaryNotes = window.eviivo.eagle.diaryNotes || {},
        window.eviivo.eagle.diaryNotes = (w = 1e3,
        e = null,
        {
            init: function(e) {
                p = $.extend(p, e),
                y = ".s-i-note",
                C = "td:has(.s-i-note)",
                f = $("#popup-add-note"),
                m = f.find("#txtDiaryNoteArea"),
                k = {
                    getDate: null == p.getDateForNoteFunc ? u : p.getDateForNoteFunc,
                    getBusinessIdForNote: null == p.getBusinessIdForNoteFunc ? v : p.getBusinessIdForNoteFunc
                },
                $(document).on("click", C, o),
                $(document).on("mouseover", y, t),
                $(document).on("mouseleave", y, i),
                f.find("#save-note").on("click", n),
                f.find("#clear-note").on("click", d),
                f.find(".s-close").on("click", c),
                m.attr("placeholder", p.resources.NotePlaceholder),
                f.contextMenu({
                    position: eviivo.eagle.contextMenu.positions.middleRight,
                    toLeft: !1,
                    type: eviivo.eagle.contextMenu.types.NotesContextMenu,
                    onhide: function() {
                        null != eviivo.pms.diary.gridNavigation && eviivo.pms.diary.gridNavigation.resetHandlers()
                    }
                })
            },
            onLeaveKeypressNote: function() {
                null != g && g.trigger("mouseleave")
            },
            reset: function() {
                $(document).off("click", C, o),
                $(document).off("mouseover", y, t),
                $(document).off("mouseleave", y, i),
                f.find("#save-note").off("click", n),
                f.find("#clear-note").off("click", d),
                f.find(".s-close").off("click", c),
                (k = m = f = C = y = null) != eviivo.pms.diary.gridNavigation && eviivo.pms.diary.gridNavigation.resetHandlers()
            }
        })
    },
    2935: function() {
        function H() {
            return {
                availablePromotionsList: {}
            }
        }
        function F() {
            var o = this;
            o.canBeModified = ko.observable(),
            o.isOta = ko.observable(),
            o.startDate = ko.observable(),
            o.startDateText = ko.observable(),
            o.endDate = ko.observable(),
            o.endDateText = ko.observable(),
            o.nights = ko.observable(),
            o.isMidStay = ko.observable(),
            o.adults = ko.observable(),
            o.children = ko.observable(),
            o.roomType = ko.observable(),
            o.roomTypeName = ko.observable(),
            o.roomTypes = ko.observableArray([]),
            o.roomBedConfigs = ko.observableArray([]),
            o.roomBedConfig = ko.observable(),
            o.room = ko.observable(),
            o.rooms = ko.observableArray([]),
            o.ratePlan = ko.observable(),
            o.ratePlanName = ko.observable(),
            o.ratePlans = ko.observableArray([]),
            o.currencyCode = ko.observable(),
            o.price = ko.observable(),
            o.promotions = ko.observableArray([]),
            o.selectedPromotion = ko.observable(),
            o.businessesIds = ko.observableArray([]),
            o.selectedBusiness = ko.observable(),
            o.isPromoAvailable = ko.observable(!1),
            o.autoChargeAmount = ko.observable(),
            o.modifiedPriceAutoChargeDisplay = ko.observable(),
            o.isAvailabilityIgnored = ko.observable(!1),
            o.checkAvailability = t,
            o.initialLoad = !0,
            o.ModifyPriceUpdated = !1,
            o.rateTypeCode = ko.computed(function() {
                var e = o;
                return 1 == M.priceIsUnlocked || he === D.Manual || j || je && (e.roomType() !== fe || e.ratePlan() !== x) ? D.Manual : D.BestAvailable
            }, o),
            o.roomId = ko.computed(function() {
                return -1 == o.room() ? k : o.room()
            }, o),
            o.isInCancellationWindow = ko.observable(!1),
            o.isInCancellationWindowModifyFailed = ko.observable(!1),
            o.isInCancellationWindowDisplay = ko.computed(function() {
                return !o.isInCancellationWindowModifyFailed() && o.isInCancellationWindow()
            }, o),
            o.isInCancellationWindowModifyFailedDisplay = ko.computed(function() {
                return o.isInCancellationWindowModifyFailed() && o.isInCancellationWindow()
            }, o),
            o.isInContactList = ko.observable(!1),
            o.canClickContactList = ko.observable(!1),
            o.canClickReadOnlyStatus = ko.computed(function() {
                return o.canClickContactList() ? null : "readonly"
            }),
            o.showBedConfigsSelector = ko.computed(function() {
                return m.bookingId || o.roomBedConfigs().some(function(e) {
                    return 1 <= e.Id
                })
            })
        }
        function G() {
            var e, o = m.popupBox.find("#availability-search-form"), a = m.popupBox.find("#availability-validation-summary");
            o.validate({
                errorPlacement: function() {
                    return !0
                },
                onkeyup: !1,
                errorClass: "error",
                ignore: "select.s-promotions-list"
            }),
            O.totalNightsPriceInput.rules("add", {
                eRequired: !0,
                eNumber: !0,
                eDisallowGroupingSeparator: !0,
                eTwoDecimalPlaces: !0,
                eMin: 0,
                eMax: 999999999
            }),
            o.addTriggersToJqueryValidate().triggerElementValidationsOnFormValidation(),
            o.formValidation(function(e, o) {
                var t, e = jQuery(e).validate().errorList;
                e && e.length && (t = a.empty().append("<ul></ul>").find("ul"),
                jQuery.each(e, function(e, o) {
                    t.append("<li>" + o.message + "</li>")
                }),
                a.html(t)),
                a.toggle(!o)
            });
            O.totalNightsPriceInput.elementValidation(function() {
                o.valid()
            }),
            1 == m.isModifyBookingFlow && 1 != m.isOtaBooking && null != O.futureNightsPriceInput && 0 != O.futureNightsPriceInput.length && (e = m.popupBox.find("#availability-search-form"),
            O.futureNightsPriceInput.rules("add", {
                eRequired: !0,
                eNumber: !0,
                eDisallowGroupingSeparator: !0,
                eTwoDecimalPlaces: !0,
                eMin: 0,
                eMax: 999999999
            }),
            O.futureNightsPriceInput.elementValidation(function() {
                e.valid()
            })),
            window.eviivo.webcore.decimals.restrictFieldsForDecimals($(".s-input-price"), {
                decimalPlaces: 2
            })
        }
        function o(e, o, t, a) {
            for (var i = e.find("ul"), n = e.parent(), s = t; s <= o; s++)
                $("<li>").html("<button class='" + Be + "' itemid='" + s + "'>" + s + "</button>").appendTo(i);
            e.on("jcarousel:createend", function() {
                $(this).jcarousel("scroll", t, !0)
            }).jcarousel(),
            n.find(".s-control-next").on("click", function() {
                $(this).siblings(".jcarousel").data("jcarousel").scroll("+=" + a)
            }),
            n.find(".s-control-prev").on("click", function() {
                $(this).siblings(".jcarousel").data("jcarousel").scroll("-=" + a)
            })
        }
        function Q(e) {
            null != e && 0 < e.length && e.off("blur paste keyup").on("paste keyup", L)
        }
        function L(e) {
            j = !0,
            jQuery(".promotion-select-id").val("00000000-0000-0000-0000-000000000000").disable(),
            M.promotionSelectionIsReadOnly = !0,
            R.selectedPromotion = null,
            clearTimeout(pe),
            pe = setTimeout(Z, 500),
            null != E && clearTimeout(E),
            "function" == typeof m.priceInputValueSetCallback && (E = setTimeout(m.priceInputValueSetCallback, 25))
        }
        function V(e) {
            this.roomBedConfig(e)
        }
        function _(o) {
            var e = this;
            if (e.roomType(o),
            null != h && null != o) {
                var t = []
                  , a = h.filter(function(e) {
                    return e.Id === o
                })
                  , i = (null !== m.bookingId && t.push({
                    Id: null,
                    Name: m.resources.BedConfigCurrentSelection
                }),
                t.push({
                    Id: 0,
                    Name: m.resources.BedConfigNoPreference
                }),
                1 === a.length && (a = a[0],
                $.each(a.RoomTypeBedConfigs, function(e, o) {
                    t.push({
                        Id: o.Id,
                        Name: o.HumanReadableName
                    })
                })),
                e.roomBedConfigs(t),
                []);
                k = null;
                for (var n = 0; n < h.length; n++)
                    if (h[n].Id === o) {
                        b = h[n];
                        for (var s = 0; s < b.Rooms.length; s++) {
                            var r = b.Rooms[s];
                            null === k && null === y && m.viewType !== S.Multiroom && (i.push({
                                Id: ye,
                                Name: m.resources.AnyAvailable
                            }),
                            k = r.Id),
                            i.push({
                                Id: r.Id,
                                Name: r.Name
                            })
                        }
                        break
                    }
                e.rooms(i);
                for (var l = [], d = 0; d < b.RatePlans.length; d++) {
                    var c = b.RatePlans[d];
                    l.push({
                        Id: c.Id,
                        Name: c.Name,
                        Price: c.Price,
                        PastNightsPrice: c.PastNightsPrice,
                        FutureNightsPrice: c.FutureNightsPrice
                    })
                }
                e.ratePlans(l),
                null != x && f.ratePlans().map(function(e) {
                    return e.Id
                }).includes(x) && f.ratePlanSelect(x),
                null !== k && (e.roomSelect(ye),
                e.room(k))
            }
        }
        function U(e) {
            this.room(e)
        }
        function q(e, o) {
            R.promotionAutoChargeAmount = null,
            (R.promotionPrice = null) != R.promotionOriginalPrice && (R.ratePlanTotalNightsPrice = R.promotionOriginalPrice),
            R.promotionOriginalPrice = null,
            R.selectedPromotion = null;
            var e = R.availablePromotionsList[e]
              , e = eviivo.eagle.promotion.selectList.getByReference(e, o);
            null == e || 0 == e.length || null == (e = e[0]) || eviivo.eagle.promotion.selectList.isEmptyItem(e) ? J() : (R.promotionAutoChargeAmount = e.AutoChargeAmount,
            R.promotionTotalNightsPrice = e.PromotionalRateValue,
            R.promotionPastNightsPrice = e.PastNights,
            R.promotionFutureNightsPrice = e.FutureNights,
            R.promotionOriginalPrice = eviivo.eagle.promotion.selectList.getOriginalPrice(e),
            R.selectedPromotion = e,
            O.promotionSelectionInput.val(o)),
            e = !M.totalNightsPriceIsReadOnly || !M.futureNightsPriceIsReadOnly,
            o = 0 != j || M.promotionSelectionIsReadOnly && M.futureNightsPriceIsReadOnly ? null : R.promotionTotalNightsPrice,
            u(O.totalNightsPriceInput, e, R.ratePlanTotalNightsPrice, o),
            e = R.promotionPastNightsPrice,
            u(O.pastNightsPriceInput, !0, R.ratePlanPastNightsPrice, e),
            o = 0 == j ? R.promotionFutureNightsPrice : null,
            u(O.futureNightsPriceInput, !M.futureNightsPriceIsReadOnly, R.ratePlanFutureNightsPrice, o),
            W()
        }
        function J() {
            R.promotionAutoChargeAmount = null,
            R.promotionTotalNightsPrice = null,
            R.promotionPastNightsPrice = null,
            R.promotionFutureNightsPrice = null,
            R.promotionOriginalPrice = null,
            R.selectedPromotion = null
        }
        function W() {
            var e;
            null == b || null == f.autoChargeAmount || (e = null != R.promotionAutoChargeAmount ? R.promotionAutoChargeAmount : R.ratePlanAutoChargeAmount,
            f.autoChargeAmount(e),
            ve()) || f.autoChargeAmount("")
        }
        function z(e) {
            var o = this;
            if (null != e && (o.ratePlan(e),
            null != b)) {
                j = !1;
                for (var t = 0; t < b.RatePlans.length; t++) {
                    var a = b.RatePlans[t];
                    if (o.modifiedPriceAutoChargeDisplay(a.ModifiedPriceAutoChargeDisplay),
                    a.Id === e) {
                        var i = y
                          , n = C
                          , i = "".concat(i, "_").concat(n, "_").concat(e)
                          , n = (!0 !== m.inShow && a.Id == m.ratePlanId && o.nights() == m.nights && o.adults() == m.adults && o.children() == m.children && o.isAvailabilityIgnored() == m.isAvailabilityIgnored || (m.ratePlanId = a.Id,
                        m.nights = o.nights(),
                        m.adults = o.adults(),
                        m.children = o.children(),
                        m.isAvailabilityIgnored = o.isAvailabilityIgnored()),
                        R.ratePlanTotalNightsPrice = a.Price,
                        R.promotionOriginalPrice = null)
                          , s = []
                          , r = 0 == M.promotionSelectionIsReadOnly && 1 == M.totalNightsPriceIsReadOnly
                          , l = 0 == M.promotionSelectionIsReadOnly && 0 == M.totalNightsPriceIsReadOnly
                          , d = (null != a.Promotions && 0 < a.Promotions.length ? (0 == f.isAvailabilityIgnored() && (n = a.Promotions[0].OriginalRateValue),
                        null != R.bookingPromotion ? s = null != (d = a.Promotions.find(function(e) {
                            return e.ExternalReference == R.bookingPromotion.ExternalReference
                        })) ? 0 == f.isAvailabilityIgnored() && (1 == r || 1 == l) ? a.Promotions : [d] : 0 == f.isAvailabilityIgnored() && (1 == r || 1 == l) ? a.Promotions : [R.bookingPromotion] : 0 != f.isAvailabilityIgnored() || 1 != r && 1 != l && 0 != m.isModifyBookingFlow || (s = a.Promotions)) : null != R.bookingPromotion && 0 == r && 0 == l && (s = [R.bookingPromotion]),
                        0 < s.length && 0 == f.isAvailabilityIgnored() && 1 == r && (s = null != R.bookingPromotion ? s.filter(function(e) {
                            return e.ExternalReference == R.bookingPromotion.ExternalReference
                        }) : []),
                        1 == f.isAvailabilityIgnored() && 0 == M.promotionSelectionIsReadOnly && (s = []),
                        R.ratePlanPastNightsPrice = a.PastNightsPrice,
                        R.ratePlanFutureNightsPrice = a.FutureNightsPrice,
                        R.ratePlanAutoChargeAmount = a.AutoChargeAmount,
                        v = u = c = l = d = void 0,
                        i)
                          , l = null == (l = s) ? [] : l
                          , c = eviivo.eagle.promotion.selectList.getOrderedListByDisplayName(l, m.resources.promotions.None);
                        R.availablePromotionsList[d] = c,
                        O.promotionSelectionInput.find("option").remove();
                        for (var u = 0; u < c.length; u++) {
                            var v = c[u];
                            jQuery('<option value="'.concat(v.ExternalReference, '">').concat(null == v.DisplayName ? v.Description : v.DisplayName, "</option>")).appendTo(O.promotionSelectionInput)
                        }
                        r = function(e, o) {
                            e = R.availablePromotionsList[e];
                            if (null != e && 1 < e.length) {
                                e = eviivo.eagle.promotion.selectList.getCheapestPromoReference(e, o);
                                if ("00000000-0000-0000-0000-000000000000" != e)
                                    return e
                            }
                            return null
                        }(i, null != R.bookingPromotion ? R.bookingPromotion.ExternalReference : null);
                        null == r && null != n && (R.ratePlanTotalNightsPrice = n,
                        R.promotionOriginalPrice = null),
                        a = i,
                        s = r,
                        !0 !== j && (O.promotionSelectionInput.val("00000000-0000-0000-0000-000000000000"),
                        q(a, s));
                        break
                    }
                }
            }
        }
        function t() {
            var e;
            return g && g.abort(),
            j = !1,
            1 == m.inAvailabilityLoad && 0 < m.availabilityLoadNumber || (m.availabilityLoadNumber += 1,
            isNaN(f.endDate().getTime()) && f.endDate(m.endDate),
            isNaN(f.startDate().getTime()) && f.startDate(m.startDate),
            isNaN(f.nights()) && f.nights(m.nights),
            e = 0 < $(".block-room-view").length,
            (f.isAvailabilityIgnored() || e ? Y : K)(),
            !0 == ("I" === jQuery("#isIcal").attr("value")) && (m.popupBox.find("#selRoomTypes").attr("disabled", !0),
            m.popupBox.find("#selRooms").attr("disabled", !0))),
            !0
        }
        function s(o) {
            var t = null;
            return null != h && h.map(function(e) {
                e.Rooms.map(function(e) {
                    o === e.Id && (t = e.TypeId)
                })
            }),
            y = t
        }
        function X(e, o, t) {
            f.roomTypeSelect(e),
            f.roomBedConfigSelect(o);
            for (var a = f.roomTypes(), i = 0; i < a.length; i++)
                e === a[i].Id && f.roomTypeName(a[i].Name);
            if (null == (t = 0 === m.popupBox.find("#selRooms option[value='" + t + "']").length ? null : t) && (t = parseInt(m.popupBox.find("#selRooms option:first-child").val())),
            f.roomSelect(t),
            0 < m.popupBox.find("#selRatePlans option").length)
                for (var n = f.ratePlanSelect(), s = (f.ratePlans().map(function(e) {
                    return e.Id
                }).includes(n) || (n = parseInt(m.popupBox.find("#selRatePlans option:first-child").val())),
                f.ratePlanSelect(n),
                f.ratePlans()), i = 0; i < s.length; i++)
                    n === s[i].Id && f.ratePlanName(s[i].Name)
        }
        function i() {
            1 == m.inAvailabilityLoad || m.viewType !== S.Booking && m.viewType !== S.Multiroom || (M.shouldPricesUnlock = !0,
            0 == M.priceIsUnlocked && c(!0),
            t())
        }
        function l(e) {
            return null != e && "undefined" != e ? e : null == (e = m.popupBox.find(".s-d-bus").val()) || "" == e ? m.businessId : parseInt(e)
        }
        function Y() {
            P++,
            ee(),
            g && g.abort(),
            j = !1,
            d();
            var e = f.startDate().evStandardIso8601DateExtended()
              , o = f.endDate().evStandardIso8601DateExtended()
              , t = l()
              , a = 0 != m.useSemiLockedMidstayModifications && 1 == M.totalNightsPriceIsReadOnly && null != m.bookingId ? m.bookingId : null
              , e = (f.adults(),
            f.children(),
            "".concat(eviivoSuiteApp, "/api/rooms/RoomTypesWithRates?StartDate=").concat(e, "&EndDate=").concat(o, "&RequestBId=").concat(t, "&BookingId=").concat(a));
            R.availablePromotionsList = {},
            g = eviivo.webcore.ajaxHelper.executeAjax({
                url: e,
                actionId: "getRoomTypesWithRates-".concat(P),
                method: eviivo.webcore.ajaxHelper.methods.GET,
                contentType: eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                callback: oe,
                failCallback: r
            })
        }
        function K() {
            P++,
            g && g.abort(),
            j = !1,
            ee();
            var e = f.startDate().evStandardIso8601DateExtended()
              , o = f.endDate().evStandardIso8601DateExtended()
              , t = l()
              , a = null != m.bookingId ? m.bookingId : null
              , i = f.adults()
              , n = f.children()
              , s = ue()
              , e = "".concat(eviivoSuiteApp, "/api/availability?StartDate=").concat(e, "&EndDate=").concat(o, "&Adults=").concat(i, "&Children=").concat(n, "&BusinessId=").concat(t, "&BookingId=").concat(a, "&PreservePastNights=").concat(s);
            g = eviivo.webcore.ajaxHelper.executeAjax({
                url: e,
                actionId: "getListOfAvailableRooms-".concat(P),
                method: eviivo.webcore.ajaxHelper.methods.GET,
                contentType: eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                callback: oe,
                failCallback: r
            })
        }
        function e(e, o, t, a, i, n) {
            var s;
            De++,
            m.chargesClaim ? g && g.abort() : (g && g.abort(),
            s = function() {
                var e = 0
                  , o = 0;
                null != O.pastNightsPriceInput && 0 < O.pastNightsPriceInput.length && (o = Globalize.parseNumber(O.pastNightsPriceInput.val()));
                null != O.totalNightsPriceInput && 0 < O.totalNightsPriceInput.length && 0 == M.totalNightsPriceIsReadOnly && (e = Globalize.parseNumber(O.totalNightsPriceInput.val()));
                {
                    var t;
                    null != O.futureNightsPriceInput && 0 < O.futureNightsPriceInput.length && 0 == M.futureNightsPriceIsReadOnly && (t = Globalize.parseNumber(O.futureNightsPriceInput.val()),
                    e = o + t)
                }
                return {
                    totalCost: e,
                    pastNightsCost: o
                }
            }(),
            e = {
                StartDate: f.startDate().evStandardIso8601DateExtended(),
                EndDate: f.endDate().evStandardIso8601DateExtended(),
                RatePlanId: e,
                RoomTypeId: o,
                Cost: null != t ? t : s.totalCost,
                NumberOfAdults: a,
                NumberOfChildren: i,
                BookingId: m.bookingId,
                PreservePastNights: ue(),
                PastNightsCost: s.pastNightsCost
            },
            g = eviivo.webcore.ajaxHelper.executeAjax({
                actionId: "GetAutoCharges-".concat(De),
                url: "".concat(eviivoSuiteApp, "/charges/calculateAutoChargesAmount"),
                method: eviivo.webcore.ajaxHelper.methods.POST,
                contentType: eviivo.webcore.ajaxHelper.contentTypes.URL_ENCODED_UTF8,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                data: e,
                callback: function(e) {
                    n(e)
                }
            }))
        }
        function Z() {
            !O.totalNightsPriceInput.valid() || null != O.futureNightsPriceInput && 0 < O.futureNightsPriceInput.length && !O.futureNightsPriceInput.valid() || e(f.ratePlan(), f.room(), null, f.adults(), f.children(), function(e) {
                null != e && (R.ratePlanTotalNightsPrice = e.TotalNightsPrice,
                R.ratePlanPastNightsPrice = e.PastNightsPrice,
                R.ratePlanFutureNightsPrice = e.FutureNightsPrice,
                R.ratePlanAutoChargeAmount = e.AdditionalChargesForDisplay,
                0 != j) && (u(O.totalNightsPriceInput, M.totalNightsPriceIsReadOnly, R.ratePlanTotalNightsPrice, null),
                u(O.pastNightsPriceInput, M.pastNightsPriceIsReadOnly, R.ratePlanPastNightsPrice, null),
                u(O.futureNightsPriceInput, M.futureNightsPriceIsReadOnly, R.ratePlanFutureNightsPrice, null),
                W())
            })
        }
        function ee() {
            A = !0,
            "function" == typeof m.beforeAjaxRequest && m.beforeAjaxRequest(),
            m.popupBox.find(".eviivo-guest select:not(.s-promotions-list), .eviivo-guest input:not(.input-price), #btnCreateBooking, #btnCreateBookingCnt").removeAttr("disabled").removeClass("disabled"),
            m.popupBox.find("#selRoomTypes option,#selRooms option,#selRatePlans option,select.s-promotions-list option").remove(),
            null != O.totalNightsPriceInput && 0 < O.totalNightsPriceInput.length && O.totalNightsPriceInput.val(""),
            null != O.futureNightsPriceInput && 0 < O.futureNightsPriceInput.length && O.futureNightsPriceInput.val(""),
            null != O.pastNightsPriceInput && 0 < O.pastNightsPriceInput.length && O.pastNightsPriceInput.val(""),
            f.roomTypes([]),
            f.rooms([]),
            f.ratePlans([]),
            m.isOtaBooking || O.totalNightsPriceInput.val(""),
            !(C = y = null) === m.persistRoomSelection && null != b ? y = b.Id : (k = null) !== m.roomId && s(m.roomId),
            !0 === m.persistRoomSelection && null != ge ? C = ge.Id : null !== m.roomId && (C = m.roomId),
            f.initialLoad = !0
        }
        function oe(e) {
            if (null != e && e && 0 < e.length) {
                if (h = e,
                1 == m.isModifyBookingFlow && 0 == M.priceIsUnlocked && 1 == M.shouldPricesUnlock && c(!0),
                m.viewType === S.Booking) {
                    var o = []
                      , t = null
                      , a = null;
                    null != m.roomId && 0 < m.roomId && (s(m.roomId),
                    C = m.roomId);
                    for (var i, n = 0; n < h.length; n++)
                        0 < h[n].Rooms.length && (i = {
                            Id: h[n].Id,
                            Name: h[n].Name
                        },
                        o.push(i),
                        null === a && (a = i),
                        h[n].Id === y) && (t = i);
                    f.roomTypes(o),
                    null != t ? X(t.Id, m.bookingId ? null : 0, C) : null != a && X(a.Id, m.bookingId ? null : 0, null)
                } else
                    m.viewType === S.Multiroom ? f.roomTypes(h) : (h.map(function(e) {
                        e.Rooms.map(function(e) {
                            f.rooms.push(e)
                        })
                    }),
                    null != m.roomId && 0 < m.roomId ? f.roomSelect(m.roomId) : null != N && 0 < N && f.roomSelect(N),
                    f.autoChargeAmount(""));
                "function" == typeof m.afterAjaxRequest && m.afterAjaxRequest(),
                1 == m.isModifyBookingFlow && 0 == M.priceIsUnlocked && 1 == B && (0 == M.futureNightsPriceIsReadOnly ? (u(O.totalNightsPriceInput, !0, R.ratePlanTotalNightsPrice, null),
                f.autoChargeAmount(null != R.promotionAutoChargeAmount ? R.promotionAutoChargeAmount : R.bookingAutoChargeAmount)) : u(O.totalNightsPriceInput, !0, R.bookingOriginalCost, null),
                ve() || f.autoChargeAmount("")),
                0 == m.isModifyBookingFlow ? ce() : 1 == M.totalNightsPriceIsReadOnly && 0 == M.futureNightsPriceIsReadOnly ? le() : 0 == M.totalNightsPriceIsReadOnly && 1 == M.futureNightsPriceIsReadOnly && ce()
            } else
                1 == m.isModifyBookingFlow && 0 == M.priceIsUnlocked && 1 == M.shouldPricesUnlock && c(!0),
                r();
            A = !1,
            d(),
            f.initialLoad = !1,
            m.inShow = !1
        }
        function r() {
            "function" == typeof m.ajaxRequestNoResults && m.ajaxRequestNoResults(),
            m.popupBox.find(".eviivo-guest select,.eviivo-guest input:not('.force-booking-checkbox'),#btnCreateBooking,#btnCreateBookingCnt").attr("disabled", "disabled").addClass("disabled"),
            m.popupBox.find(".s-d-bus").removeAttr("disabled").removeClass("disabled"),
            $("<option>").html(m.resources.NoAvailability).appendTo(m.popupBox.find("#selRoomTypes")),
            $("<option>").html("-").appendTo(m.popupBox.find("#selRooms,#selRatePlans")),
            O.promotionSelectionInput.find("option").remove(),
            $("<option>").html("-").appendTo(O.promotionSelectionInput),
            O.btnUnlockPriceDetails.attr("disabled", "disabled").addClass("forced-disable"),
            f.autoChargeAmount(null)
        }
        function d() {
            var e = eviivo.webcore.datetime.utils.addDaysToDate(f.startDate(), 1)
              , o = (isNaN(f.nights()) && (isNaN(m.nights) ? f.nights(1) : f.nights(m.nights)),
            eviivo.webcore.datetime.utils.addDaysToDate(f.startDate(), f.nights()));
            p.datepicker("option", "minDate", e),
            p.datepicker("setDate", o),
            f.endDate(o),
            !0 === f.isOta() || !1 === f.canBeModified() ? (f.startDateText(m.startDate.evDisplayLongDate(eviivo.eagle.basePageModelState.userCultureCode)),
            f.endDateText(o.evDisplayLongDate(eviivo.eagle.basePageModelState.userCultureCode))) : f.canBeModified(!0),
            a()
        }
        function te(e, o, t) {
            e.find("button").off("click");
            var a = e.find("button")
              , e = e.find("button[itemid='" + t + "']");
            o(a, e, !1),
            a.on("click", function() {
                o(a, $(this), !0)
            })
        }
        function n(e, o) {
            return e.attr("class", Be),
            o.attr("class", Se),
            parseInt(o.attr("itemid"))
        }
        function ae(e, o, t) {
            var e = isNaN(n(e, o)) ? f.nights() : n(e, o)
              , o = v.datepicker("getDate")
              , a = eviivo.webcore.datetime.utils.addDaysToDate(o, e);
            p.datepicker("setDate", a),
            f.nights(e),
            f.startDate(o),
            f.endDate(a),
            t && i()
        }
        function ie(e, o, t) {
            e = n(e, o);
            f.adults(e),
            t && i()
        }
        function ne(e, o, t) {
            e = n(e, o);
            f.children(e),
            t && i()
        }
        function a() {
            var e = v.datepicker("getDate")
              , o = p.datepicker("getDate")
              , t = eviivo.webcore.datetime.utils.getDaysBetween(e, o)
              , a = $(".eviivo-nights .jcarousel button");
            (me = T.data("jcarousel")).scroll(t - 1),
            $(".eviivo-nights .jcarousel").is(":visible") && (a.removeClass("btn-active"),
            $(".eviivo-nights").find("button[itemid='" + t + "']").addClass("btn-active")),
            f.nights(t),
            f.startDate(e),
            f.endDate(o)
        }
        function se(e) {
            var o;
            !1 === M.priceIsUnlocked ? (window.innerHeight,
            (o = jQuery("span.s-lock-price-btn")).offset().top,
            eviivo.webcore.notifier.show({
                type: eviivo.webcore.notifier.types.warn,
                style: eviivo.webcore.notifier.styles.withTwoActions,
                message: m.resources.unlockPriceConfirmation,
                buttonOne: "<button class='btn btn-cancel btn-secondary mr10 s-cancel-unlock-price' type='button'>".concat(m.resources.unlockPriceCancel, "</button>"),
                buttonTwo: "<button class='btn btn-right s-unlock-price' type='button'>".concat(m.resources.unlockPriceUnlock, "</button>"),
                selector: o,
                position: eviivo.webcore.notifier.positions.topRight,
                autoHide: !0,
                autoHideDelay: 1e5,
                callback: function() {
                    var e = m.popupBox.find("button.s-unlock-price")
                      , o = m.popupBox.find("button.s-cancel-unlock-price");
                    e.off("click.eviivo.eagle.occupancy").on("click.eviivo.eagle.occupancy", c),
                    o.off("click.eviivo.eagle.occupancy").on("click.eviivo.eagle.occupancy", eviivo.webcore.notifier.hideAll),
                    jQ("div.notifyjs-wrapper div.notifyjs-withTwoActions-base").addClass("v-2")
                }
            })) : 1 == M.totalNightsPriceIsReadOnly && 0 == M.futureNightsPriceIsReadOnly && re() && t()
        }
        function c(e) {
            M = {
                priceIsUnlocked: !0,
                totalNightsPriceIsReadOnly: !0,
                pastNightsPriceIsReadOnly: !0,
                futureNightsPriceIsReadOnly: !1,
                promotionSelectionIsReadOnly: !1
            },
            O.pastNightsPriceInput.val(""),
            O.pastNightsRow.removeClass("force-hide"),
            O.futureNightsPriceInput.val(""),
            O.futureNightsRow.removeClass("force-hide"),
            (1 == m.useSemiLockedMidstayModifications && 1 == m.isMidStay ? (M = {
                priceIsUnlocked: !0,
                totalNightsPriceIsReadOnly: !0,
                pastNightsPriceIsReadOnly: !0,
                futureNightsPriceIsReadOnly: !1,
                promotionSelectionIsReadOnly: !1
            },
            le) : re)(),
            !0 !== e && t()
        }
        function re() {
            if (null != O.btnUnlockPriceDetails && 0 != O.btnUnlockPriceDetails.length) {
                var e;
                if (0 != m.isModifyBookingFlow && 1 == m.useSemiLockedMidstayModifications && 1 != m.modifyBookingAllowFullUnlock)
                    return window.innerHeight,
                    (e = jQuery("span.s-lock-price-btn")).offset().top,
                    eviivo.webcore.notifier.show({
                        type: eviivo.webcore.notifier.types.warn,
                        style: eviivo.webcore.notifier.styles.withTwoActions,
                        message: m.resources.fullUnlockPricePermissionDenied,
                        buttonOne: null,
                        buttonTwo: "<button class='btn btn-right s-full-unlock-permission-denied' type='button'>".concat(m.resources.unlockPriceCancel, "</button>"),
                        selector: e,
                        position: eviivo.webcore.notifier.positions.topRight,
                        autoHide: !0,
                        autoHideDelay: 5e3,
                        callback: function() {
                            m.popupBox.find("button.s-full-unlock-permission-denied").off("click.eviivo.eagle.occupancy").on("click.eviivo.eagle.occupancy", eviivo.webcore.notifier.hideAll),
                            jQ("div.notifyjs-wrapper div.notifyjs-withTwoActions-base").addClass("v-2")
                        }
                    }),
                    !1;
                de()
            }
            return !0
        }
        function le() {
            O.totalNightsPriceInput.attr("disabled", "disabled"),
            O.pastNightsPriceInput.attr("disabled", "disabled"),
            O.futureNightsPriceInput.removeAttr("disabled"),
            O.promotionSelectionInput.removeAttr("disabled").removeClass("disabled"),
            O.btnUnlockPriceDetails.removeClass("semiunlock-price-display").removeClass("fullunlock-price-display").removeClass("forced-disable").removeAttr("disabled").addClass("fullunlock-price-display")
        }
        function de() {
            B = !(M = {
                priceIsUnlocked: !0,
                totalNightsPriceIsReadOnly: !1,
                pastNightsPriceIsReadOnly: !0,
                futureNightsPriceIsReadOnly: !0,
                promotionSelectionIsReadOnly: !1
            }),
            ce()
        }
        function ce() {
            O.totalNightsPriceInput.removeAttr("disabled"),
            O.promotionSelectionInput.removeAttr("disabled").removeClass("disabled"),
            O.pastNightsPriceInput.attr("disabled", "disabled"),
            O.pastNightsRow.addClass("force-hide"),
            O.futureNightsPriceInput.attr("disabled", "disabled"),
            O.futureNightsRow.addClass("force-hide"),
            O.btnUnlockPriceDetails.removeClass("fullunlock-price-display").removeClass("forced-disable").attr("disabled", "disabled")
        }
        function ue() {
            return 0 != m.useSemiLockedMidstayModifications && 1 == M.totalNightsPriceIsReadOnly && 1 != M.futureNightsPriceIsReadOnly
        }
        function u(e, o, t, a) {
            null != e && 0 < e.length && null != t && (t = Globalize.formatNumber(t, {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2,
                useGrouping: !1
            }),
            null != a && (t = Globalize.formatNumber(a, {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2,
                useGrouping: !1
            })),
            1 == o) && e.val(t)
        }
        function ve() {
            return M.priceIsUnlocked
        }
        var v, p, pe, g, m, f, h, b, y, ge, C, k, w, I, T, me, fe, x, he, B, S, D, be, ye, Ce, ke, we, Ie, Te, xe, Be, Se, P, De, Pe, je, j, N, A, Ne, Ae, O, M, R, E;
        window.eviivo = window.eviivo || {},
        window.eviivo.eagle = window.eviivo.eagle || {},
        window.eviivo.eagle.occupancy = window.eviivo.eagle.occupancy || {},
        window.eviivo.eagle.occupancy = (be = {
            Panoramic: 0,
            Standard: 1,
            Zoom: 2,
            List: 3
        },
        ye = -1,
        ke = Ce = 5,
        M = {
            shouldPricesUnlock: !(O = {}),
            priceIsUnlocked: !(A = j = je = !(Pe = {
                popupBox: null,
                startDate: null,
                endDate: null,
                adults: Te = Ie = 1,
                children: De = P = xe = 0,
                roomId: null,
                roomTypeId: null,
                isAvailabilityIgnored: !(Se = "btn btn-small btn-active"),
                availabilityLoadNumber: 0,
                inAvailabilityLoad: !0,
                inShow: !(Be = "btn btn-small btn-secondary"),
                resources: null
            })),
            totalNightsPriceIsReadOnly: !(Ae = {
                futureNightsRow: "#add-booking span.s-remaining-nights-row",
                pastNightsRow: "#add-booking span.s-consumed-nights-row",
                totalNightsPriceInput: "#add-booking #availability-amount-input",
                futureNightsPriceInput: "#add-booking #val-remaining-nights-price",
                pastNightsPriceInput: "#add-booking #val-consumed-nights-price",
                promotionSelectionInput: "#add-booking .s-promotions-list",
                btnUnlockPriceDetails: "#add-booking button.s-unlock-price-details",
                totalNightsPriceCurrencySpan: "#add-booking span.s-lock-price-btn"
            }),
            pastNightsPriceIsReadOnly: !(N = null),
            futureNightsPriceIsReadOnly: !0,
            promotionSelectionIsReadOnly: !(Ne = {
                futureNightsRow: "div.view-booking.tab-modify span.s-remaining-nights-row",
                pastNightsRow: "div.view-booking.tab-modify span.s-consumed-nights-row",
                totalNightsPriceInput: "div.view-booking.tab-modify #availability-amount-input",
                futureNightsPriceInput: "div.view-booking.tab-modify #val-remaining-nights-price",
                pastNightsPriceInput: "div.view-booking.tab-modify #val-consumed-nights-price",
                promotionSelectionInput: "div.view-booking.tab-modify .s-promotions-list",
                btnUnlockPriceDetails: "div.view-booking.tab-modify button.s-unlock-price-details",
                totalNightsPriceCurrencySpan: "div.view-booking.tab-modify span.s-lock-price-btn"
            })
        },
        R = H(),
        E = null,
        {
            init: function(e) {
                return m = $.extend(m, e),
                f = new F,
                o(T = m.popupBox.find(".eviivo-nights .jcarousel"), m.carouselOptions.maxNights, Ie, Ce),
                o(w = m.popupBox.find(".eviivo-adults .jcarousel"), m.carouselOptions.maxAdults, Te, ke),
                o(I = m.popupBox.find(".eviivo-children .jcarousel"), m.carouselOptions.maxChildren, xe, we),
                f.adults(m.adults),
                f.children(m.children),
                f.roomTypeSelect = ko.computed({
                    read: f.roomType,
                    write: _,
                    owner: f
                }),
                f.roomBedConfigSelect = ko.computed({
                    read: f.roomBedConfig,
                    write: V,
                    owner: f
                }),
                f.roomSelect = ko.computed({
                    read: f.room,
                    write: U,
                    owner: f
                }),
                f.ratePlanSelect = ko.computed({
                    read: f.ratePlan,
                    write: z,
                    owner: f
                }),
                f
            },
            show: function(e, o) {
                R = H(),
                M = {
                    shouldPricesUnlock: B = !1,
                    priceIsUnlocked: !0,
                    totalNightsPriceIsReadOnly: !1,
                    pastNightsPriceIsReadOnly: !0,
                    futureNightsPriceIsReadOnly: !0,
                    promotionSelectionIsReadOnly: !1
                },
                f.autoChargeAmount(""),
                m = $.extend(Pe, e),
                e = m.isModifyBookingFlow ? Ne : Ae,
                O.futureNightsRow = jQ(e.futureNightsRow),
                O.pastNightsRow = jQ(e.pastNightsRow),
                O.totalNightsPriceInput = jQ(e.totalNightsPriceInput),
                O.futureNightsPriceInput = jQ(e.futureNightsPriceInput),
                O.pastNightsPriceInput = jQ(e.pastNightsPriceInput),
                O.promotionSelectionInput = jQ(e.promotionSelectionInput),
                O.btnUnlockPriceDetails = jQ(e.btnUnlockPriceDetails),
                O.totalNightsPriceCurrencySpan = jQ(e.totalNightsPriceCurrencySpan),
                O.promotionSelectionInput.off("change.eviivo.eagle.occupancy").on("change.eviivo.eagle.occupancy", function(e) {
                    var o = O.promotionSelectionInput.val()
                      , t = y
                      , a = C
                      , i = f.ratePlan();
                    q("".concat(t, "_").concat(a, "_").concat(i), o)
                }),
                $(".notifyjs-wrapper").trigger("notify-hide"),
                (f = o).isAvailabilityIgnored(!1),
                1 == m.isModifyBookingFlow && (O.btnUnlockPriceDetails.off("click.eviivo.eagle.occupancy"),
                0 == m.isOtaBooking && O.btnUnlockPriceDetails.on("click.eviivo.eagle.occupancy", se),
                1 == m.isOtaBooking ? (O.totalNightsPriceCurrencySpan.removeClass("after"),
                O.btnUnlockPriceDetails.removeClass("hidden").addClass("hidden")) : (O.totalNightsPriceCurrencySpan.removeClass("after").addClass("after"),
                O.btnUnlockPriceDetails.removeClass("hidden")),
                M = {
                    priceIsUnlocked: !1,
                    totalNightsPriceIsReadOnly: !0,
                    pastNightsPriceIsReadOnly: !0,
                    futureNightsPriceIsReadOnly: !0,
                    promotionSelectionIsReadOnly: !0
                },
                O.btnUnlockPriceDetails.removeAttr("disabled"),
                O.btnUnlockPriceDetails.removeClass("semiunlock-price-display").removeClass("fullunlock-price-display"),
                O.pastNightsRow.addClass("force-hide"),
                O.futureNightsRow.addClass("force-hide"),
                O.totalNightsPriceInput.attr("disabled", "disabled"),
                O.pastNightsPriceInput.attr("disabled", "disabled"),
                O.futureNightsPriceInput.attr("disabled", "disabled"),
                O.promotionSelectionInput.attr("disabled", "disabled").addClass("disabled"),
                B = !0,
                R.bookingOriginalCost = m.priceSettings.bookingOriginalCost,
                R.bookingPromotion = m.priceSettings.bookingPromotion,
                R.bookingAutoChargeAmount = m.priceSettings.bookingAutoChargeAmountDisplay,
                null != m.priceSettings.bookingPreCancellationCost) && 1 == m.isOtaBooking && (R.bookingOriginalCost = m.priceSettings.bookingPreCancellationCost),
                -1 != m.roomId && (N = m.roomId),
                m.inShow = !0,
                m.resetRoomSelection && !0 === m.resetRoomSelection && (y = b = ge = null),
                null !== (e = eviivo.util.safeFunction("eviivo.pms.businessSettingsAndDefaultMessages.getValue")) && (o = (null != m.businessId ? m : eviivo.eagle.basePageModelState).businessId,
                null != (e = e(parseInt(o)))) && "" !== e && $(".s-price-currency").html(e.WorkingCurrencySymbol),
                Q(O.totalNightsPriceInput),
                Q(O.futureNightsPriceInput),
                O.totalNightsPriceCurrencySpan.tip(),
                G();
                var o = (new Date).evStandardFirstDayCalendarOffset(eviivo.eagle.basePageModelState.userCultureCode);
                v = m.popupBox.find(".eviivo-startdate input"),
                v = eviivo.webcore.calendar.init(eviivo.webcore.calendar.CALENDAR_TYPE.initCalendar, {
                    defaultCultureCode: eviivo.eagle.basePageModelState.userCultureCode,
                    calendar: v,
                    showOn: "both",
                    buttonImage: m.calendarIcon,
                    dateFormat: eviivo.eagle.dateFormat.getDateFormat("LONG_DATE_FORMAT"),
                    changeMonth: !0,
                    changeYear: !0,
                    yearRange: "c-1:c+5",
                    firstDay: o,
                    onSelect: function() {
                        var e = v.datepicker("getDate")
                          , o = p.datepicker("getDate")
                          , t = eviivo.webcore.datetime.utils.addDaysToDate(e, 1);
                        eviivo.webcore.datetime.utils.getDaysBetween(e, o) <= 0 && (p.datepicker("setDate", t),
                        a()),
                        p.datepicker("option", "minDate", t),
                        a(),
                        i(),
                        re()
                    }
                }),
                p = m.popupBox.find(".eviivo-enddate input"),
                p = eviivo.webcore.calendar.init(eviivo.webcore.calendar.CALENDAR_TYPE.initCalendar, {
                    defaultCultureCode: eviivo.eagle.basePageModelState.userCultureCode,
                    calendar: p,
                    showOn: "both",
                    buttonImage: m.calendarIcon,
                    dateFormat: eviivo.eagle.dateFormat.getDateFormat("LONG_DATE_FORMAT"),
                    changeMonth: !0,
                    changeYear: !0,
                    yearRange: "c-1:c+5",
                    firstDay: o,
                    onSelect: function() {
                        a(),
                        i()
                    }
                }),
                m.startDate ? f.startDate(m.startDate) : (f.startDate(new Date),
                m.startDate = f.startDate()),
                v.datepicker("setDate", f.startDate()),
                o = 1,
                m.nights && (o = m.nights,
                f.nights(o)),
                d(),
                T = m.popupBox.find("#nightsCarousel"),
                me = T.data("jcarousel"),
                m.nights > Ce && me.scroll(m.nights),
                w = m.popupBox.find("#adultsCarousel"),
                I = m.popupBox.find("#childrenCarousel"),
                e = w.data("jcarousel"),
                o = I.data("jcarousel"),
                e.scroll(m.adults - 1),
                o.scroll(m.children),
                te(T, ae, m.nights),
                (m.viewType === S.Booking ? (f.adults(m.adults),
                f.children(m.children),
                te(w, ie, m.adults),
                te(I, ne, m.children),
                t) : m.viewType === S.Multiroom ? (m.popupBox.find(".eviivo-nights").prev().removeClass("clear-both"),
                f.adults(m.adults),
                f.children(m.children),
                t) : Y)(),
                null != m.roomId && 0 < m.roomId && (fe = s(m.roomId)),
                m.isOtaBooking && (je = m.isOtaBooking),
                x = m.ratePlanId,
                he = m.rateTypeCode,
                m.availabilityLoadNumber = 0,
                m.inAvailabilityLoad = !1,
                1 == m.isModifyBookingFlow && (e = m,
                f.canBeModified(e.canDateBeChanged),
                f.isOta(e.isOtaBooking),
                "function" == typeof m.afterOccupancyInit) && m.afterOccupancyInit()
            },
            getAvailability: function(e, o, t, a, i) {
                P++,
                g && g.abort();
                var n = f.startDate().evStandardIso8601DateExtended()
                  , s = f.endDate().evStandardIso8601DateExtended()
                  , i = l(i)
                  , r = ue()
                  , n = "".concat(eviivoSuiteApp, "/api/availability?StartDate=").concat(n, "&EndDate=").concat(s, "&Adults=").concat(o, "&Children=").concat(t, "&ratePlanId=").concat(e, "&BusinessId=").concat(i, "&PreservePastNights=").concat(r);
                g = eviivo.webcore.ajaxHelper.executeAjax({
                    url: n,
                    actionId: "getAvailability-".concat(P),
                    method: eviivo.webcore.ajaxHelper.methods.GET,
                    contentType: eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON,
                    dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                    callback: function(e) {
                        "function" == typeof a && a(e)
                    },
                    failCallback: function(e) {
                        console.log(e)
                    }
                })
            },
            getAutoChargesAmount: e,
            RateTypes: D = {
                Manual: "MAN",
                BestAvailable: "BAR"
            },
            checkAvailability: t,
            getListOfAvailableRooms: K,
            getDiaryViewTypes: function() {
                return be
            },
            viewPanel: S = {
                Booking: 1,
                BlockRoom: 2,
                Multiroom: we = 4
            },
            isAvailabilitySearchCurrentlyHappening: function() {
                return A
            },
            getPricesForModifyBooking: function() {
                var e = null
                  , o = (null != O.totalNightsPriceInput && 0 < O.totalNightsPriceInput.length && (e = Globalize.parseNumber(O.totalNightsPriceInput.val())),
                null)
                  , t = (null != O.futureNightsPriceInput && 0 < O.futureNightsPriceInput.length && (o = Globalize.parseNumber(O.futureNightsPriceInput.val())),
                null)
                  , a = (null != O.pastNightsPriceInput && 0 < O.pastNightsPriceInput.length && (t = Globalize.parseNumber(O.pastNightsPriceInput.val())),
                null != R.selectedPromotion ? [R.selectedPromotion] : []);
                return 0 == M.priceIsUnlocked ? {
                    cost: e,
                    isCostLocked: !0,
                    pastNightsCost: t,
                    preservePastNights: !0,
                    futureNightsCost: o,
                    promotion: a
                } : 0 == M.totalNightsPriceIsReadOnly ? {
                    cost: e,
                    isCostLocked: !1,
                    pastNightsCost: t,
                    preservePastNights: !1,
                    futureNightsCost: o,
                    promotion: a
                } : 1 == M.totalNightsPriceIsReadOnly && 0 == M.futureNightsPriceIsReadOnly ? {
                    cost: e,
                    isCostLocked: !1,
                    pastNightsCost: t,
                    preservePastNights: !0,
                    futureNightsCost: o,
                    promotion: a
                } : void console.error("eviivo.eagle.occupancy.getPrices ERROR - logic case missing!")
            },
            getPricesForAddBooking: function() {
                var e = null;
                return {
                    cost: e = null != O.totalNightsPriceInput && 0 < O.totalNightsPriceInput.length ? Globalize.parseNumber(O.totalNightsPriceInput.val()) : e,
                    promotion: null != R.selectedPromotion ? [R.selectedPromotion] : []
                }
            },
            isPriceUnlocked: ve,
            resetCachedBookingDurationData: function(e, o, t) {
                m.startDate = e,
                f.nights(t),
                f.startDate(e),
                f.endDate(o)
            },
            isSemiPriceUnlocked: function() {
                return m.useSemiLockedMidstayModifications && M.priceIsUnlocked && !M.futureNightsPriceIsReadOnly
            }
        })
    },
    9099: function() {
        function F() {
            var a = this;
            a.isMultiRoomBooking = ko.observable(!1),
            a.guestStayTooltipText = ko.observable(),
            a.RoomNameFromBooking = we,
            a.arrivalTime = ko.observable(),
            a.bookingId = ko.observable(),
            a.selectedGuestId = ko.observable(),
            a.bookingReference = ko.observable(),
            a.orderReference = ko.observable(),
            a.transferCancelText = ko.observable(),
            a.group = ko.observable(""),
            a.isOtaBooking = ko.observable(!1),
            a.isIcalBooking = ko.observable(!1),
            a.price = ko.observable(),
            a.isGuestDifferentFromLead = ko.observable(!1),
            a.transactions = ko.observableArray([]),
            a.guestCultureCode = ko.observable(""),
            a.viewStatementButtonEnabled = ko.computed(function() {
                return 0 < a.transactions().filter(function(e) {
                    return e.IsIncludedOnStatement()
                }).length
            }),
            a.selectTransactionsState = ko.computed({
                read: function() {
                    a.transactions();
                    var e = a.transactions().filter(function(e) {
                        return !e.IsCheckboxHidden()
                    })
                      , o = e.filter(function(e) {
                        return e.IsIncludedOnStatement()
                    }).length;
                    return 0 !== o && (e.length === o || null)
                },
                write: function(o) {
                    a.transactions().forEach(function(e) {
                        e.IsIncludedOnStatement(o)
                    })
                }
            }),
            a.selectTransactionsState(!0),
            a.transactionsExist = ko.observable(!1),
            a.hasNonRefundableCharges = ko.observable(!1),
            a.transactionGenerateDocumentButtonStatus = ko.computed(function() {
                return 0 === a.transactions().filter(function(e) {
                    return !e.IsCheckboxHidden() && e.IsIncludedOnStatement() && e.TypeCode === Yo.ledger && e.StatusCode === Ko.Pending
                }).length
            }),
            a.notes = ko.observable(""),
            a.payments = ko.observableArray([]),
            a.depositAmountDue = ko.observable(),
            a.currentDepositAmount = ko.observable(),
            a.due = ko.observable(),
            a.dueDisplayValue = ko.computed(function() {
                return Math.abs(this.due())
            }, a),
            a.transactionalAmount = ko.observable(),
            a.paid = ko.observable(0),
            a.cancellationCharge = ko.observable(0),
            a.cancellationTooltipText = ko.observable(),
            a.depositTooltipText = ko.observable(),
            a.sourceTooltipText = ko.observable(),
            a.isFlexibleDeposit = ko.observable(!1),
            a.depositCancellationAmount = ko.computed(function() {
                return a.currentDepositAmount() >= a.cancellationCharge() ? a.currentDepositAmount() : a.cancellationCharge()
            }, a),
            a.useDepositAmount = ko.computed(function() {
                return a.depositCancellationAmount() === a.currentDepositAmount()
            }, a),
            a.total = ko.observable(),
            a.costDisplayWithCurrency = ko.observable(""),
            a.costDisplayWithOriginalCurrency = ko.observable(""),
            a.isOfflineBooking = ko.observable(!1),
            a.viewType = ko.observable(),
            a.checkInScenario = ko.observable(),
            a.isStayConfirmed = ko.computed(function() {
                return this.checkInScenario() == e.StayConfirmed
            }, a),
            a.isStayDeclined = ko.computed(function() {
                return this.checkInScenario() == e.StayAtRisk
            }, a),
            a.isOnlineCheckInStarted = ko.computed(function() {
                return this.checkInScenario() == e.OnlineCheckInStarted
            }, a),
            a.isOnlineCheckInComplete = ko.computed(function() {
                return this.checkInScenario() == e.OnlineCheckInComplete
            }, a),
            a.isCheckedIn = ko.computed(function() {
                return this.checkInScenario() == e.CheckedIn
            }, a),
            a.isCheckedOut = ko.computed(function() {
                return this.checkInScenario() == e.CheckedOut
            }, a),
            a.isNotCheckedIn = ko.computed(function() {
                return this.checkInScenario() != e.StayConfirmed && this.checkInScenario() != e.StayAtRisk && this.checkInScenario() != e.OnlineCheckInStarted && this.checkInScenario() != e.OnlineCheckInComplete && this.checkInScenario() != e.CheckedIn && this.checkInScenario() != e.CheckedOut
            }, a),
            a.isBookingLocked = ko.observable(),
            a.isOverBooking = ko.observable(!1),
            a.isSplitAvailibility = ko.observable(),
            a.isCancelled = ko.observable(!1),
            a.isTransferred = ko.observable(!1),
            a.isTransferrable = ko.observable(!1),
            a.canWaiveCancellationFees = ko.observable(!1),
            a.viewState = ko.computed(function() {
                var e = document.getElementById(D);
                switch (null != s && e.classList.contains(s) && e.classList.remove(s),
                null != co && e.classList.contains(co) && e.classList.remove(co),
                je(this.viewType()),
                this.viewType()) {
                case getBookingViewTypes().GuestInfo:
                    var o = "guestInfo-view"
                      , t = "s-guestSearch";
                    return e.classList.add(o),
                    e.classList.add(t),
                    (co = t) + " " + (s = o);
                case getBookingViewTypes().PaymentMultiCard:
                    o = "paymentMulticard-view";
                    return e.classList.add(o),
                    s = o;
                case getBookingViewTypes().Modify:
                    o = "modify-view";
                    return e.classList.add(o),
                    s = o;
                case getBookingViewTypes().Transactions:
                    var o = "transactions-view"
                      , t = (e.classList.add(o),
                    s = o,
                    document.querySelector(Go));
                    return null != t && t.classList.remove("hide"),
                    o;
                case getBookingViewTypes().Charges:
                case getBookingViewTypes().Owner:
                    o = "charges-view";
                    return e.classList.add(o),
                    s = o;
                case getBookingViewTypes().Emails:
                    o = "emails-view";
                    return e.classList.add(o),
                    s = o;
                default:
                    getBookingViewTypes().Summary;
                    o = "summary-view";
                    return e.classList.add(o),
                    s = o
                }
            }, a),
            a.isModifyView = ko.computed(function() {
                return this.viewType() === getBookingViewTypes().Modify
            }, a),
            a.isAddBookingToGroupEnabled = ko.computed(function() {
                return this.viewType() === getBookingViewTypes().Summary && !this.isOtaBooking() && !this.isTransferred() && !this.isIcalBooking()
            }, a),
            a.updateTotals = function(e) {
                e = parseFloat(e.toFixed(2)),
                a.isMultiRoomBooking() && (t = e,
                null != y) && $.each(y.Bookings, function(e, o) {
                    o.AmountPaid = t
                });
                var t, o = b.total() - e, e = (this.paid(e),
                this.due(o),
                this.transactionalAmount(o < 0 ? P.resources.Refund : P.resources.Balance),
                void 0), o = b.IsStartDateInFuture ? y.DepositAmountDue : b.due();
                void 0 !== e && (o -= e),
                o = 0 < o ? o : 0,
                b.depositAmountDue(o),
                b.currentDepositAmount(y.CurrentDepositAmount)
            }
            ,
            a.acceptBooking = function() {
                eviivo.webcore.ajaxHelper.executeAjax({
                    actionId: "DiaryAcceptBooking",
                    url: eviivoSuiteApp + "/api/bookings/accept?bookingId=" + a.Id,
                    method: eviivo.webcore.ajaxHelper.methods.GET,
                    contentType: eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,
                    dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                    callback: function(e) {
                        b.isBookingLocked(!1),
                        Ke(),
                        $(".guest-info").removeClass("locked"),
                        $("#nav-view-booking input").button("enable"),
                        $("#nav-summary").attr("checked", "checked").button("enable").button("refresh").trigger("click"),
                        null === b.CCToken && $("#nav-cctoken").button("disable"),
                        De()
                    },
                    failCallback: function() {
                        alert(P.resources.AcceptBookingError)
                    }
                })
            }
            ,
            a.appliedPromotions = ko.observableArray([]),
            a.transactionsViewType = ko.observable(ot),
            a.showTransactionsDetails = ko.computed({
                read: function() {
                    return parseInt(a.transactionsViewType()) !== o.Summary
                },
                write: function(e) {
                    switch (a.transactionsViewType(e),
                    parseInt(e)) {
                    case o.Void:
                        jQuery("#transactions-summary").closest("li").removeClass("state-active"),
                        jQuery("#transactions-void").closest("li").addClass("state-active"),
                        jQuery("#transactions-details").closest("li").removeClass("state-active");
                        break;
                    case o.Details:
                        jQuery("#transactions-summary").closest("li").removeClass("state-active"),
                        jQuery("#transactions-void").closest("li").removeClass("state-active"),
                        jQuery("#transactions-details").closest("li").addClass("state-active");
                        break;
                    default:
                    case o.Summary:
                        jQuery("#transactions-summary").closest("li").addClass("state-active"),
                        jQuery("#transactions-void").closest("li").removeClass("state-active"),
                        jQuery("#transactions-details").closest("li").removeClass("state-active")
                    }
                }
            }),
            a.showTransactionsDetails(ot),
            a.AutoChargeAmount = ko.observable(0)
        }
        function G() {
            this.bookings = ko.observableArray([])
        }
        function Q() {
            this.Title = ko.observable(),
            this.Body = ko.observable()
        }
        function L(e) {
            var o = jQuery(this).parent()
              , t = jQuery("#" + o.data("target"));
            o.hasClass("state-active") || (jQuery("#notes-tabs .s-tab").removeClass("state-active"),
            o.addClass("state-active"),
            jQuery("#notes-tabs .s-tab-section").addClass("hide"),
            t.removeClass("hide"))
        }
        function V() {
            $("#nav-view-booking").controlgroup().find("input:radio").on("click", function() {
                fe($(this).val()),
                Xe()
            }),
            $("#booking-action-buttons .btn-back").on("click", function() {
                $("#nav-summary").attr("checked", "checked").button("enable").button("refresh").trigger("click"),
                eviivo.eagle.occupancy.resetCachedBookingDurationData(b.StartDate, b.EndDate, b.nights),
                eviivo.eagle.basePageModelState.businessId = h.BusinessId
            }),
            $("#modify-booking").on("click", function() {
                $("#nav-modify").attr("checked", "checked").button("enable").button("refresh").trigger("click")
            }),
            Ho.on("click", function() {
                eviivo.eagle.bookingPopup.show({
                    businessId: eviivo.eagle.basePageModelState.businessId,
                    isAddBookingToGroup: !0,
                    parentOrderReference: b.Order.OrderReference,
                    parentOrderId: b.Order.Id,
                    parentGuestName: b.GuestModel.FullName,
                    parentStartDate: b.StartDate,
                    parentNights: b.nights,
                    groupReference: b.Order.GroupReference
                })
            }),
            x.on("keyup", ie),
            B.on("keyup", ne),
            S.on("keyup", se),
            To.on("keyup", re),
            xo.on("keyup", re),
            w.on("click", ce),
            I.on("click", ue),
            m.on("click", ve),
            T.on("click", pe),
            waiveCancellationFeesButton.on("click", le),
            po.on("change", ge),
            Bo.on("click", _),
            $(".booking-summary h3").on("click", function() {
                var e = $(this)
                  , o = e.data("isExpanded");
                (o = null != o && o) ? e.parent().removeClass("expanded") : e.parent().addClass("expanded"),
                e.data("isExpanded", !o)
            }),
            $(".modify-booking-occupancy select").on("change", Z),
            d(),
            Do.on("click", ae),
            bo.on("click", J),
            yo.on("click", W),
            Co.on("click", z)
        }
        function _() {
            if ("undefined" == typeof eviivo || void 0 === eviivo.eagle || void 0 === eviivo.eagle.cancellation)
                throw "window.eviivo.eagle.cancellation: module is not defined or not loaded";
            eviivo.eagle.cancellation.open({
                businessId: h.BusinessId,
                bookingId: h.Id,
                orderId: h.OrderId,
                showCardDeclineStep: !1,
                resources: {
                    cancellationChargeLabel: P.resources.cancellationChargeLabel,
                    ClickHereToView: P.resources.ClickHereToView
                }
            })
        }
        function U(e, o) {
            var t = "";
            if (null != h && null != h.CrossBookingReferences && 0 < h.CrossBookingReferences.length)
                for (var a = 0; a < h.CrossBookingReferences.length; a++) {
                    var i, n = h.CrossBookingReferences[a];
                    null != n.BookingReference && "" != n.BookingReference && (null != e && "" != e && 0 < e.indexOf(n.BookingReference) || !0 === o) && (i = e,
                    !0 === o && (i = !0 === n.IsTargetBooking ? eviivo.eagle.translations.resources.viewBookingPopup.CrossBookingReference_NewBooking : eviivo.eagle.translations.resources.viewBookingPopup.CrossBookingReference_PreviousBooking,
                    i += " " + n.BookingReference),
                    t += "<a class='s-transaction-link-other-booking' href='#'" + (!0 !== o ? " data-booking-popup-view='" + getBookingViewTypes().Transactions + "'" : "") + " data-bookingId='" + n.BookingId + "' data-businessId='" + n.BookingBusinessId + "'>" + i + "</a>",
                    !0 === o) && (t += "<br/>")
                }
            return "" === t ? e : t
        }
        function q(e) {
            var t = !1
              , i = 2 == $(".view-booking-transactions .mod-tab-toggle.state-active").data("tab")
              , n = xe(b.BusinessId);
            $.each(e, function(e, a) {
                a.room = a.RoomName;
                var o = U(a.DescriptionDisplay.replace("\n", "<br />"));
                a.DescriptionDisplay = o,
                a.IsCheckboxHidden = ko.observable(null !== a.BookingItemPromoParentId),
                a.IsIncludedOnStatement = ko.observable((a.BookingItemStatusCode !== A.Deleted && a.BookingItemStatusCode !== A.Transferred || null == a.DocumentId) && a.BookingItemTypeCode !== Zo.AdvancedDeposit && a.BookingItemTypeCode !== Zo.PrepaidServices && a.BookingItemTypeCode !== Zo.PrepaidServicesTPD && !1 === a.IsNotSelectedByDefault),
                a.IsDeleted = ko.observable(a.BookingItemStatusCode === A.Deleted || a.BookingItemStatusCode === A.Transferred || a.BookingItemStatusCode === A.Cancelled && null == a.DocumentId && a.StatusCode === Ko.Inactive),
                a.IsRowHidden = ko.observable(!b.showTransactionsDetails() && !a.IsGroupHeader),
                a.GrossAmountShow = ko.observable(b.showTransactionsDetails() ? a.GrossAmountDisplay : a.GroupGrossAmountDisplay),
                a.TransactionDateShow = ko.observable(b.showTransactionsDetails() ? a.TransactionDateDisplay : a.GroupTransactionDate),
                a.PriorDocumentLinks = ko.observableArray(),
                $.each(a.PriorDocuments, function(e, o) {
                    a.PriorDocumentLinks.push({
                        Reference: o.DocumentReference,
                        URL: eviivoSuiteApp + "/diary/invoice?businessId=" + b.BusinessId + "&businessCultureCode=" + n + "&bookingId=" + a.BookingId + "&documentId=" + o.DocumentId + "&showTransactionsDetails=" + b.showTransactionsDetails()
                    })
                }),
                null != a.DocumentId && a.PriorDocumentLinks.push({
                    Reference: a.DocumentReference,
                    URL: eviivoSuiteApp + "/diary/invoice?businessId=" + b.BusinessId + "&businessCultureCode=" + n + "&bookingId=" + a.BookingId + "&documentId=" + a.DocumentId + "&showTransactionsDetails=" + b.showTransactionsDetails()
                }),
                a.IsCheckboxHidden() || a.IsIncludedOnStatement.subscribe(function(t) {
                    var e = b.transactions().filter(function(e) {
                        return null != e.BookingItemPromoParentId && e.BookingItemPromoParentId === a.BookingItemId && (a.LedgerTypeCode === N.Entry && (e.LedgerTypeCode === N.Entry || e.LedgerTypeCode === N.Food) || a.LedgerTypeCode === N.Reversal && (e.LedgerTypeCode === N.Reversal || e.LedgerTypeCode === N.FoodReversal))
                    })
                      , e = ($.each(e, function(e, o) {
                        o.IsIncludedOnStatement(t)
                    }),
                    b.transactions().filter(function(e) {
                        return !b.showTransactionsDetails() && null != e.GroupId && e.GroupId === a.GroupId && !e.IsGroupHeader
                    }));
                    $.each(e, function(e, o) {
                        o.IsIncludedOnStatement(t)
                    })
                }),
                a.IsDeleted() && a.IsIncludedOnStatement(!1),
                a.IsDeleted() && (t = !0,
                i ? a.IsRowHidden(!1) : a.IsRowHidden(!0)),
                !a.IsDeleted() && i && a.IsRowHidden(!0)
            }),
            t ? $('.view-booking-transactions .mod-tab-toggle[data-tab="2"]').show() : $('.view-booking-transactions .mod-tab-toggle[data-tab="2"]').hide(),
            b.transactions(e)
        }
        function t() {
            var e = b.transactions();
            b.transactions([]),
            b.transactionsExist(!1),
            e && 0 < e.length && (b.transactionsExist(!0),
            q(e))
        }
        function J() {
            b.showTransactionsDetails(o.Summary),
            localStorage.setItem("transactionViewType", o.Summary),
            t()
        }
        function W() {
            b.showTransactionsDetails(o.Details),
            localStorage.setItem("transactionViewType", o.Details),
            t()
        }
        function z() {
            b.showTransactionsDetails(o.Void),
            localStorage.setItem("transactionViewType", o.Void),
            t()
        }
        function X() {
            var e, o;
            eviivo.component.flyout.showFlyout(Uo),
            Ao.Title(P.resources.transferBookingPopupTitle.replace("{BookingReference}", b.BookingReferenceNumber)),
            Ao.Body(P.resources.transferBookingPopupBody.replace("{BookingReference}", b.BookingReferenceNumber).replace("{RoomName}", we(b.Id)).replace("{GuestName}", b.GuestModel.FullName).replace("{OrderLeadGuestName}", b.Order.LeadGuest.FullName)),
            $("#popup-transfer-booking-cancel").on("click", Y),
            $("#popup-transfer-booking-accept").on("click", K),
            document.querySelector(qo).innerHTML = P.resources.transferBookingPopupTitle.replace("{BookingReference}", b.BookingReferenceNumber),
            ut && (e = document.getElementById("transferBooking-flyout-footer"),
            (o = document.querySelector(Jo)).innerHTML = "",
            o.appendChild(e)),
            ut = !1
        }
        function Y() {
            eviivo.component.flyout.hideFlyout(Uo)
        }
        function K() {
            O = null != eviivo.webcore.ajaxHelper.executeAjax({
                actionId: "DiaryTransferBooking",
                url: "".concat(eviivoSuiteApp, "/diary/transferBooking"),
                data: {
                    BookingIds: [b.Id],
                    RefreshOrderId: b.OrderId,
                    DiaryViewTypeForPostBack: P.diaryViewType,
                    SelectedDate: eviivo.webcore.calendar.getSelectedDate()
                },
                method: eviivo.webcore.ajaxHelper.methods.POST,
                contentType: eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                callback: function(e) {
                    eviivo.eagle.gridBlock.removeDiaryBlock(b.Id);
                    var o = eviivo.util.safeFunction("eviivo.pms.diary.dataLoader.refreshDataAndUi");
                    null != o && o("b_" + b.Id),
                    o = e,
                    !0 === O && (eviivo.eagle.gridBlock.updateDiaryBlock(o),
                    O = !1,
                    null != P.actions) && "function" == typeof P.actions.refreshDiaryCallback && P.actions.refreshDiaryCallback(o),
                    eviivo.component.flyout.hideFlyout(Uo),
                    eviivo.component.flyout.hideFlyout(D),
                    eviivo.webcore.notifier.show({
                        type: eviivo.webcore.notifier.types.success,
                        style: eviivo.webcore.notifier.styles.withTwoActions,
                        message: P.resources.DetachBookingSuccessMessage.format(h.BookingReferenceNumber),
                        autoHideDelay: eviivo.webcore.notifier.delays.medium,
                        buttonOne: "<button class='btn btn-secondary' id='show-booking-transfer'> " + P.resources.ClickHereToView + "</button>",
                        position: eviivo.webcore.notifier.positions.bottomRight
                    }),
                    jQuery("#show-booking-transfer").on("click", function() {
                        n(b.Id, null, b.BusinessId)
                    })
                }
            })
        }
        function Z() {
            setTimeout(ee, 25)
        }
        function d() {
            Do.disable()
        }
        function ee() {
            var e, o, t, a, i, n, s, r, l;
            d(),
            h && !eviivo.eagle.occupancy.isAvailabilitySearchCurrentlyHappening() && (s = eviivo.eagle.occupancy.getPricesForModifyBooking(),
            e = null != b.children() && 0 < b.children() && b.children() != h.NumberOfChildren,
            o = null != b.adults() && 0 < b.adults() && b.adults() != h.NumberOfAdults,
            t = null != b.roomType() && 0 < b.roomType() && b.roomType() != h.RoomTypeId,
            a = null != b.roomId() && 0 < b.roomId() && b.roomId() != h.RoomId,
            i = null != b.ratePlan() && 0 < b.ratePlan() && b.ratePlan() != h.RatePlanId,
            n = null != b.roomBedConfig() && 0 <= b.roomBedConfig() && b.roomBedConfig() != h.RoomTypeBedConfigId,
            s = 0 == eviivo.eagle.promotion.selectList.areEqual(h.Promotions, s.promotion),
            r = oe(b.startDate(), h.StartDate, h.StartDateInIsoFormat),
            l = oe(b.endDate(), h.EndDate, h.EndDateInIsoFormat),
            e || o || t || a || i || n || s || r || l || eviivo.eagle.occupancy.isPriceUnlocked()) && Do.enable()
        }
        function oe(e, o, t) {
            var e = null != e ? eviivo.webcore.datetime.parse.shortDateString(e, "-") : null
              , a = null;
            return null != o && o instanceof Date ? a = eviivo.webcore.datetime.parse.shortDateString(o, "-") : null != t && (a = eviivo.webcore.datetime.parse.shortDateString(eviivo.webcore.datetime.parse.parseDate(t), "-")),
            e != a
        }
        function te() {
            mo.removeHideClass(),
            fo.addClass("hide").removeClass("active"),
            v.addHideClass()
        }
        function ae() {
            var e, o;
            (function() {
                var e = jQuery(".modify-booking-occupancy #availability-amount-input").valid()
                  , o = jQuery(".modify-booking-occupancy #val-remaining-nights-price");
                0 < o.length && eviivo.eagle.occupancy.isSemiPriceUnlocked() && (e = e && o.valid());
                return e
            }
            )() && (b.isInCancellationWindowModifyFailed(!1),
            1) && (e = eviivo.eagle.occupancy.getPricesForModifyBooking(),
            o = parseInt($("#view-booking-wrap .s-d-bus").val()) || eviivo.eagle.basePageModelState.businessId,
            h.StartDate = b.startDate().evStandardIso8601DateExtended(),
            h.EndDate = b.endDate().evStandardIso8601DateExtended(),
            h.NumberOfAdults = b.adults(),
            h.NumberOfChildren = b.children(),
            h.BusinessId = o,
            h.RoomId = b.roomId(),
            h.RoomTypeId = b.roomType(),
            h.RoomName = b.RoomName,
            h.RatePlanId = b.ratePlan(),
            h.RoomTypeBedConfigId = b.roomBedConfig(),
            h.RateTypeCode = b.rateTypeCode(),
            h.Promotions = e.promotion,
            h.Cost = e.cost,
            h.CostLocked = e.isCostLocked,
            h.PastNightsCost = e.pastNightsCost,
            h.PreservePastNights = null != e.preservePastNights && e.preservePastNights,
            h.FutureNightsCost = e.futureNightsCost,
            h.IsAvailabilityIgnored = b.isAvailabilityIgnored(),
            h.IsMultiRoomBooking = b.IsMultiRoomBooking,
            h.GuestStayTooltipText = b.GuestStayTooltipText,
            h.DiaryViewTypeForPostBack = P.diaryViewType,
            h.SelectedDate = P.diaryStart,
            h.BusinessUsesSemiLockedMidstayModifications = y.BusinessUsesSemiLockedMidstayModifications,
            h.ModifyBookingAllowFullUnlock = y.ModifyBookingAllowFullUnlock,
            d(),
            ho.removeClass("spinner-container").addClass("spinner-container-absolute"),
            lo(),
            O = null != eviivo.webcore.ajaxHelper.executeAjax({
                actionId: "DiaryModifyBooking_".concat(h.Id),
                url: "".concat(eviivoSuiteApp, "/diary/modifyBooking"),
                data: h,
                method: eviivo.webcore.ajaxHelper.methods.POST,
                contentType: eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                callback: function(e) {
                    var o = eviivo.util.safeFunction("eviivo.pms.diary.dataLoader.refreshDataAndUi");
                    null != o && o("b_" + h.Id),
                    eviivo.component.flyout.hideFlyout(D),
                    eviivo.webcore.notifier.show({
                        type: eviivo.webcore.notifier.types.success,
                        style: eviivo.webcore.notifier.styles.withTwoActions,
                        message: P.resources.ModifyBookingSuccessMessage.format(h.BookingReferenceNumber),
                        autoHideDelay: eviivo.webcore.notifier.delays.medium,
                        buttonOne: "<button class='btn btn-secondary' id='show-booking-modify'> " + P.resources.ClickHereToView + "</button>",
                        position: eviivo.webcore.notifier.positions.bottomRight
                    }),
                    jQuery("#show-booking-modify").on("click", function() {
                        eviivo.eagle.basePageModelState.businessId = e.BusinessId,
                        n(e.BookingId, null, e.BusinessId)
                    }),
                    te(),
                    ho.removeClass("spinner-container-absolute").addClass("spinner-container")
                },
                failCallback: function() {
                    eviivo.webcore.notifier.show({
                        type: eviivo.webcore.notifier.types.error,
                        message: "Failed modifying booking"
                    }),
                    eviivo.component.flyout.hideFlyout(D),
                    te(),
                    ho.removeClass("spinner-container-absolute").addClass("spinner-container")
                }
            }))
        }
        function ie(e) {
            $(this).data("value") == $(this).val() ? w.prop("disabled", !0) : w.prop("disabled", !1)
        }
        function ne(e) {
            $(this).data("value") == $(this).val() ? I.attr("disabled", "disabled") : I.removeAttr("disabled")
        }
        function se(e) {
            $(this).data("value") == $(this).val() ? m.prop("disabled", !0) : m.prop("disabled", !1)
        }
        function re(e) {
            $(this).data("value") == $(this).val() ? T.prop("disabled", !0) : T.prop("disabled", !1)
        }
        function le() {
            $(this).notify({
                text: waiveCancellationFeesButton.attr("title"),
                icon: "&#xe952;",
                buttonOne: "<button class='btn btn-cancel btn-secondary mr10 s-cancel-waive' type='button'>" + P.resources.CancelButton + "</button>",
                buttonTwo: "<button class='btn btn-right s-process-waive' type='button'>" + P.resources.labelOk + "</button>"
            }, {
                style: "withTwoActions",
                className: "warn v-2",
                position: "left center",
                autoHideDelay: "100000",
                clickToHide: !0
            });
            var e = $(".s-process-waive")
              , o = $(".s-cancel-waive");
            e.on("click", de),
            o.on("click", function() {
                $(this).trigger("notify-hide")
            })
        }
        function de() {
            var e = eviivo.webcore.datetime.utils.addDaysToDate(b.startDate(), -1)
              , o = eviivo.webcore.datetime.utils.addDaysToDate(b.endDate(), -1)
              , e = {
                BusinessId: h.BusinessId,
                BookingId: h.Id,
                DiaryViewTypeForPostBack: P.diaryViewType,
                SelectedDate: eviivo.webcore.calendar.getSelectedDate(),
                RefreshRoomId: b.RoomId,
                RefreshStartDate: e,
                RefreshEndDate: o
            };
            b.isMultiRoomBooking() && (e.RefreshOrderId = h.OrderId,
            e.RefreshRoomId = null),
            waiveCancellationFeesButton.addClass("btn-saving").prop("disabled", !0),
            O = null != eviivo.webcore.ajaxHelper.executeAjax({
                actionId: "DiaryWaiveCancellationFees_".concat(h.Id),
                url: "".concat(eviivoSuiteApp, "/api/diary/requestwaivecancellationfees"),
                data: e,
                method: eviivo.webcore.ajaxHelper.methods.POST,
                contentType: eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                callback: function() {
                    eviivo.eagle.popup.hide(),
                    waiveCancellationFeesButton.removeClass("btn-saving").prop("disabled", !1),
                    n(h.Id, null, h.BusinessId)
                },
                failCallback: function() {
                    waiveCancellationFeesButton.removeClass("btn-saving").prop("disabled", !1),
                    eviivo.webcore.notifier.show({
                        type: eviivo.webcore.notifier.types.error,
                        message: P.resources.ModifyBookingFeesWaivedFailedMessage
                    })
                }
            })
        }
        function ce() {
            var t = x.val()
              , e = eviivo.webcore.datetime.utils.addDaysToDate(b.startDate(), -1)
              , o = eviivo.webcore.datetime.utils.addDaysToDate(b.endDate(), -1)
              , a = {
                BusinessId: h.BusinessId,
                BookingId: h.Id,
                Note: t,
                DiaryViewTypeForPostBack: P.diaryViewType,
                RefreshRoomId: b.RoomId,
                RefreshStartDate: e,
                RefreshEndDate: o
            };
            b.isMultiRoomBooking() && (a.RefreshOrderId = h.OrderId,
            a.RefreshRoomId = null),
            w.addClass("btn-saving").prop("disabled", !0),
            O = null != eviivo.webcore.ajaxHelper.executeAjax({
                actionId: "DiaryModifyBookingNote_".concat(h.Id),
                url: "".concat(eviivoSuiteApp, "/api/diary/modifyBookingNote"),
                data: a,
                method: eviivo.webcore.ajaxHelper.methods.POST,
                contentType: eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                callback: function(e) {
                    w.removeClass("btn-saving"),
                    x.data("value", t),
                    x[0].value = t,
                    h.Notes = t,
                    b.notes(t),
                    $.isFunction(P.onActionCallback) ? P.onActionCallback() : eviivo.eagle.gridBlock.postGetWithData(a),
                    null != y && $.each(y.Bookings, function(e, o) {
                        o.Id == h.Id && (o.Notes = t)
                    })
                },
                failCallback: function() {
                    alert(P.resources.ModifyNoteError)
                }
            })
        }
        function ue() {
            var t = B.val();
            O = null != eviivo.webcore.ajaxHelper.executeAjax({
                actionId: "DiaryModifyordernote",
                url: eviivoSuiteApp + "/api/order/modifyordernote",
                data: {
                    BusinessId: h.BusinessId,
                    OrderId: h.Order.Id,
                    Text: t
                },
                method: eviivo.webcore.ajaxHelper.methods.POST,
                contentType: eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                callback: function(e) {
                    I.attr("disabled", "disabled"),
                    B.data("value", t),
                    B[0].value = t,
                    $.each(y.Bookings, function(e, o) {
                        o.Order.Notes = t
                    })
                },
                failCallback: function() {
                    alert(P.resources.ModifyNoteError)
                }
            })
        }
        function ve() {
            var t = S.val();
            m.addClass("btn-saving").prop("disabled", !0),
            O = null != eviivo.webcore.ajaxHelper.executeAjax({
                actionId: "UpdateCleaningNoteFromBooking",
                url: eviivoSuiteApp + "/api/Cleaning/UpdateCleaningNoteFromBooking",
                data: {
                    NoteId: h.CleaningInfoId,
                    BookingId: h.Id,
                    Note: t
                },
                method: eviivo.webcore.ajaxHelper.methods.POST,
                contentType: eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                callback: function(e) {
                    m.removeClass("btn-saving"),
                    eviivo.webcore.notifier.show({
                        type: eviivo.webcore.notifier.types.success,
                        message: P.resources.guestSavedChanges
                    });
                    var o = y.Bookings.filter(function(e) {
                        return e.Id == h.Id
                    });
                    null != o && 1 == o.length && (o[0].CleaningInfoId = e,
                    o[0].CleaningInstructions = t),
                    S.data("value", t),
                    S[0].value = t,
                    null != y && $.each(y.Bookings, function(e, o) {
                        o.Id == h.Id && (o.RoutineInstructions = t)
                    })
                },
                failCallback: function() {
                    alert(P.resources.ModifyNoteError)
                }
            })
        }
        function pe() {
            var t = To.val()
              , a = xo.val();
            T.addClass("btn-saving").prop("disabled", !0),
            eviivo.webcore.ajaxHelper.executeAjax({
                actionId: "UpdateBookingCodesFromBooking_".concat(h.Id),
                url: "".concat(eviivoSuiteApp, "/api/diary/ModifyBookingDoorLockCodes"),
                data: {
                    BusinessId: h.BusinessId,
                    BookingId: h.Id,
                    DoorLockCode: t,
                    BuildingLockCode: a
                },
                method: eviivo.webcore.ajaxHelper.methods.POST,
                contentType: eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                callback: function(e) {
                    T.removeClass("btn-saving"),
                    null != e && null != e.StatusCode && "OK" === e.StatusCode.toUpperCase() ? (eviivo.webcore.notifier.show({
                        type: eviivo.webcore.notifier.types.success,
                        message: P.resources.guestSavedChanges
                    }),
                    null != (e = y.Bookings.filter(function(e) {
                        return e.Id == h.Id
                    })) && 1 == e.length && (e[0].DoorCode = t,
                    e[0].BuildingCode = a),
                    null != y && $.each(y.Bookings, function(e, o) {
                        o.Id == h.Id && (o.BuildingLockCode = a,
                        o.DoorLockCode = t)
                    }),
                    O = !0) : eviivo.webcore.notifier.show({
                        type: eviivo.webcore.notifier.types.error,
                        message: P.resources.ModifyBookingDoorCodesFailedMessage
                    })
                },
                failCallback: function() {
                    eviivo.webcore.notifier.show({
                        type: eviivo.webcore.notifier.types.error,
                        message: P.resources.ModifyBookingDoorCodesFailedMessage
                    })
                }
            })
        }
        function ge() {
            var e, o, t, a;
            null != b.startDate() && null != b.endDate() && (e = null != b.startDate() ? b.startDate().evStandardIso8601DateExtended() : null,
            e = "" === (o = po.val()) ? null : e + " " + o,
            b.arrivalTime(o),
            o = eviivo.webcore.datetime.utils.addDaysToDate(b.startDate(), -1),
            t = eviivo.webcore.datetime.utils.addDaysToDate(b.endDate(), -1),
            a = {
                BusinessId: h.BusinessId,
                BookingId: h.Id,
                DiaryViewTypeForPostBack: P.diaryViewType,
                SelectedDate: eviivo.webcore.calendar.getSelectedDate(),
                RefreshRoomId: b.RoomId,
                RefreshStartDate: o,
                RefreshEndDate: t
            },
            eviivo.webcore.ajaxHelper.executeAjax({
                actionId: "modifyArrivalTime",
                url: P.modifyArrivalTimeUrl,
                traditional: !0,
                method: eviivo.webcore.ajaxHelper.methods.POST,
                contentType: eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                data: {
                    businessId: h.BusinessId,
                    bookingId: h.Id,
                    arrivalTime: e
                },
                callback: function() {
                    $.isFunction(P.onActionCallback) ? P.onActionCallback() : eviivo.eagle.gridBlock.postGetWithData(a),
                    null != y && $.each(y.Bookings, function(e, o) {
                        o.Id == h.Id && (o.ArrivalTime = po.val())
                    })
                }
            }))
        }
        function me(t, e) {
            var i, n, s, o, a;
            null == t && (t = !1),
            b.IsMultiRoomBooking ? (i = b.startDate(),
            n = b.endDate(),
            s = null,
            $.each(y.Bookings, function(e, o) {
                var t = new Date(o.StartDateInIsoFormat)
                  , a = new Date(o.EndDateInIsoFormat);
                t.getTime() < i.getTime() && (i = t),
                a.getTime() > n.getTime() && (n = a),
                null == s && (s = o.BusinessId)
            }),
            o = eviivo.webcore.datetime.utils.addDaysToDate(i, -1),
            a = eviivo.webcore.datetime.utils.addDaysToDate(n, -1),
            data = {
                RefreshOrderId: b.OrderId,
                DiaryViewTypeForPostBack: P.diaryViewType,
                SelectedDate: eviivo.webcore.calendar.getSelectedDate(),
                RefreshStartDate: o,
                RefreshEndDate: a,
                BusinessId: s
            },
            b.isMultiRoomBooking() && (data.RefreshOrderId = h.OrderId,
            data.RefreshRoomId = null),
            eviivo.webcore.ajaxHelper.executeAjax({
                actionId: "DiaryRetrieveOrder_".concat(b.OrderId),
                url: "".concat(eviivoSuiteApp, "/api/diary/retrieveOrder"),
                data: data,
                method: eviivo.webcore.ajaxHelper.methods.POST,
                contentType: eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                callback: function(e) {
                    y = $.extend(new G, e.OrderForViewUpdate),
                    $.each(e.OrderForViewUpdate.Bookings, function(e, o) {
                        t || o.Id != b.Id || Te(o)
                    })
                }
            }),
            eviivo.eagle.gridBlock.postGetWithData(data)) : b.IsCancelled || u(b.Id, t || !1, e ? null : b.viewType(), !1, null, null, b.startDate(), b.endDate(), b.room(), b.BusinessId),
            $.isFunction(P.onActionCallback) && P.onActionCallback(),
            !0 === P.permissionsForUser.ViewTransactions && to()
        }
        function fe(e, o) {
            $("#nav-view-booking").controlgroup(),
            $("#nav-view-booking").find("label").removeClass("ui-state-active"),
            "string" == typeof e ? (n = e,
            e = getBookingViewTypes()[e]) : n = getBookingViewTypes()[e],
            e !== getBookingViewTypes().Summary && e !== getBookingViewTypes().Modify && b.isBookingLocked() && (e = getBookingViewTypes().Summary,
            n = getBookingViewTypes()[e]);
            var t, a, i, n, s, r = $(".view-booking");
            if (r[0].className = "view-booking",
            e === getBookingViewTypes().Cards || e === getBookingViewTypes().PaymentMultiCard || e === getBookingViewTypes().Emails || e === getBookingViewTypes().Charges || e === getBookingViewTypes().Owner) {
                lo(),
                l = void 0 !== $("#orderSelect :selected").val() && b.isMultiRoomBooking() ? $("#orderSelect :selected").val() : b.bookingId();
                var l, d = {
                    businessId: b.BusinessId,
                    id: b.OrderId,
                    bookingId: l,
                    orderReference: b.Order.OrderReference,
                    currency: b.Order.Currency,
                    container: v,
                    isGuestCharges: !0
                };
                switch (e) {
                case getBookingViewTypes().Owner:
                    d.checkInDate = b.startDate(),
                    d.checkOutDate = b.endDate(),
                    d.ratePlanId = b.RatePlanId,
                    d.isGuestCharges = !1,
                    eviivo.eagle.viewBookingCharges.open(d),
                    $("#lblOwner").addClass("ui-state-active");
                    break;
                case getBookingViewTypes().Cards:
                    d.cardTokenId = o,
                    d.hideCardsTab = b.Order.HideCardsTab,
                    d.paymentsCallback = function(e) {
                        document.getElementById("nav-payment-multicard").checked = !0,
                        $("#nav-view-booking").controlgroup("refresh"),
                        fe(getBookingViewTypes().PaymentMultiCard, e)
                    }
                    ,
                    d.cancellCallback = _,
                    d.resources = {
                        cardDeleteSuccess: P.resources.CardDeleteSuccess,
                        cardSaveSuccessful: P.resources.CardSaveSuccessful,
                        cardsDisabledInfoMessage: P.resources.CardsDisabledInfoMessage,
                        cardsUnsavedChanges: P.resources.CardsUnsavedChanges,
                        cardNotAccepted: P.resources.CardNotAccepted,
                        deletePaymentCard: P.resources.DeletePaymentCard,
                        cancelButton: P.resources.CancelButton,
                        deleteButton: P.resources.DeleteButton,
                        savedMessage: P.resources.SavedMessage,
                        StandardLoaderMessage: P.resources.StandardLoaderMessage,
                        SendEmailSuccess: P.resources.SendEmailSuccess,
                        SendEmailFailure: P.resources.SendEmailFailure,
                        EmailGuestNotFound: P.resources.EmailGuestNotFound
                    },
                    eviivo.eagle.viewBookingCards.init(d),
                    $("#lblCards").addClass("ui-state-active");
                    break;
                case getBookingViewTypes().PaymentMultiCard:
                    d.cardTokenId = o,
                    d.isBookingCancelled = b.isCancelled(),
                    d.selectCardsTabCallback = function(e) {
                        document.getElementById("nav-cards").checked = !0,
                        $("#nav-view-booking").controlgroup("refresh"),
                        fe(getBookingViewTypes().Cards, e)
                    }
                    ,
                    d.resources = {
                        StandardLoaderMessage: P.resources.StandardLoaderMessage,
                        SendEmailSuccess: P.resources.SendEmailSuccess,
                        SendEmailFailure: P.resources.SendEmailFailure,
                        EmailGuestNotFound: P.resources.EmailGuestNotFound
                    },
                    eviivo.eagle.paymentMultiCard.open(d),
                    $("#lblPaymentMulitcard").addClass("ui-state-active");
                    break;
                case getBookingViewTypes().Emails:
                    a = o,
                    (t = void 0) === t && (t = b.OrderId),
                    i = {
                        cultureCode: i = void 0 !== (i = b.GuestModel.DefaultCultureCode) && null != i ? i : eviivo.eagle.basePageModelState.businessCultureCode,
                        businessId: b.BusinessId,
                        bookingId: b.Id,
                        isCancelled: b.IsCancelled,
                        orderId: t,
                        guestEmail: h.GuestModel.Email,
                        billingEmail: h.Order.LeadGuest.Email,
                        container: v
                    },
                    a && (i.selectedEmailId = a),
                    i.resources = {
                        StandardLoaderMessage: P.resources.StandardLoaderMessage,
                        SendEmailSuccess: P.resources.SendEmailSuccess,
                        SendEmailFailure: P.resources.SendEmailFailure,
                        EmailsNoGuestsWithEmail: P.resources.EmailsNoGuestsWithEmail,
                        EmailsSentViaGuestMessaging: P.resources.EmailsSentViaGuestMessaging,
                        CopyMessageSuccess: P.resources.CopyMessageSuccess,
                        CopyMessageFailure: P.resources.CopyMessageFailure,
                        LaunchWhatsAppSuccess: P.resources.LaunchWhatsAppSuccess,
                        LaunchWhatsAppFailure: P.resources.LaunchWhatsAppFailure,
                        EmailGuestNotFound: P.resources.EmailGuestNotFound,
                        EmailCustomAmountLabel: P.resources.EmailCustomAmountLabel,
                        validation: P.resources.validation,
                        DeleteConfirmationMsg: P.resources.DeleteConfirmationMsg,
                        DeleteConfirmationYes: P.resources.DeleteConfirmationYes,
                        DeleteConfirmationNo: P.resources.DeleteConfirmationNo
                    },
                    eviivo.eagle.email.listing.init(i),
                    $("#lblEmails").addClass("ui-state-active");
                    break;
                case getBookingViewTypes().Charges:
                    d.checkInDate = b.startDate(),
                    d.checkOutDate = b.endDate(),
                    d.ratePlanId = b.RatePlanId,
                    eviivo.eagle.viewBookingCharges.open(d),
                    d.isGuestCharges = !0,
                    $("#lblCharges").addClass("ui-state-active")
                }
            } else
                switch (te(),
                e) {
                case getBookingViewTypes().Summary:
                    at || Ae($(".booking-summary")),
                    at = !1;
                    var c = jQuery("#lnk-see-other-bookings")
                      , u = U(null, !0);
                    "" != u ? (c.html(u),
                    c.show()) : (c.html(""),
                    c.hide()),
                    $("#lblSummary").addClass("ui-state-active");
                    break;
                case getBookingViewTypes().Transactions:
                    to(),
                    Ae($(".view-booking-transactions")),
                    $("#lblBill").addClass("ui-state-active")
                }
            null != n && r.addClass("tab-" + n.toLowerCase()),
            b.viewType(e),
            e === getBookingViewTypes().GuestInfo && (eviivo.eagle.guest.loadGuestTabContainer(null, {
                Id: b.GuestModel.Id,
                orderId: b.OrderId,
                bookingId: b.Id,
                businessId: b.BusinessId
            }, f, function() {
                eviivo.eagle.guest.multiguests.refreshDropDown(b.Order.Id, b.Id)
            }),
            $("#lblGuest").addClass("ui-state-active")),
            b.isBookingLocked() || (l = tt[getBookingViewTypes()[b.viewType()]],
            $(l).attr("checked", "checked").button("enable").button("refresh")),
            e === getBookingViewTypes().Modify ? (Po = !0,
            Ye(),
            r = jQuery(".view-booking .s-d-bus"),
            n = jQuery(".view-booking .guest-details .s-prop"),
            null != P.businessId ? r.val(P.businessId) : r.val(eviivo.eagle.basePageModelState.businessId),
            null != h && null != h.ModificationSettings || logSentryException("view booking popup - modify booking or booking.order equals null updateDiaryOnly value = ".concat(st, ", stacktrace for true ").concat(rt), "bookingNull"),
            !0 !== h.ModificationSettings.IsAvailableForMultiPropertyModify ? n.hide() : !0 === h.IsOwnMerchant ? "function" == typeof E && (r.find("option").each(function(e, o) {
                var o = jQuery(o)
                  , t = E(parseInt(o.val()));
                o.show().prop("disabled", !1),
                null != t && "M" === t.MerchantStatus || o.hide().prop("disabled", !0)
            }),
            n.show()) : h.Order.IsOffline ? (s = eviivo.util.safeFunction("eviivo.pms.businessSettingsAndDefaultMessages.getBusinessesAvailableForModify")(eviivo.eagle.basePageModelState.businessId),
            r.find("option").each(function(e, o) {
                -1 === s.indexOf(parseInt(o.value)) ? $(o).hide().prop("disabled", !0) : $(o).show().prop("disabled", !1)
            }),
            n.show()) : n.hide(),
            l = {
                viewType: eviivo.eagle.occupancy.viewPanel.Booking,
                BusinessId: parseInt($(".s-d-bus").val()) || P.businessId,
                useSemiLockedMidstayModifications: y.BusinessUsesSemiLockedMidstayModifications,
                modifyBookingAllowFullUnlock: y.ModifyBookingAllowFullUnlock,
                bookingId: h.Id,
                roomId: h.RoomId,
                roomTypeId: h.RoomTypeId,
                ratePlanId: h.RatePlanId,
                rateTypeCode: h.RateTypeCode,
                startDate: b.startDate()instanceof Date ? b.startDate() : new Date(eviivo.webcore.datetime.parse.parseDate(h.StartDateInIsoFormat)),
                endDate: b.endDate()instanceof Date ? b.endDate() : new Date(eviivo.webcore.datetime.parse.parseDate(h.EndDateInIsoFormat)),
                nights: b.nights,
                adults: h.NumberOfAdults,
                children: h.NumberOfChildren,
                resetRoomSelection: !0,
                isOtaBooking: h.Order.IsOTA,
                canDateBeChanged: h.ModificationSettings.CanDateBeChanged,
                isMidStay: h.ModificationSettings.IsMidStay,
                priceSettings: {
                    bookingOriginalCost: (null != h.OriginalBookingCostInWorkingCurrency && 0 < h.OriginalBookingCostInWorkingCurrency.Amount ? h.OriginalBookingCostInWorkingCurrency : h.OriginalBookingCost).Amount,
                    bookingAutoChargeAmountDisplay: h.AutoChargeAmountDisplay,
                    bookingPreCancellationCost: h.PreCancellationCost,
                    bookingPromotion: null != h.Promotions && 0 < h.Promotions.length ? h.Promotions[0] : null
                },
                isModifyBookingFlow: !0,
                afterOccupancyInit: Ue
            },
            r = $.extend({}, P, l),
            eviivo.eagle.occupancy.show(r, g)) : e !== getBookingViewTypes().Transactions && (Ke(),
            null != h && null != h.Order || logSentryException("view booking popup - booking or booking.order equals null updateDiaryOnly value = ".concat(st, ", stacktrace for true ").concat(rt), "bookingNull"),
            g.isOta(h.Order.IsOTA)),
            Oe(),
            e === getBookingViewTypes().Summary && g.canBeModified(!0),
            p.hasClass("ui-controlgroup") && (e === getBookingViewTypes().Modify ? (p.controlgroup("disable"),
            p.addClass("ui-state-disabled")) : (p.controlgroup("enable"),
            p.removeClass("ui-state-disabled"))),
            $(".amounts input.input.amount").removeClass("error"),
            $("#nav-view-booking").find("label").hasClass("ui-state-active") || $("#lblSummary").addClass("ui-state-active")
        }
        function he() {
            var t = 0
              , a = 0;
            null != y && ($.each(y.Bookings, function(e, o) {
                a += o.Cost,
                t = o.AmountPaid
            }),
            b.total(a),
            b.updateTotals(t),
            b.cancellationCharge(y.CurrentCancelValue))
        }
        function be(e, o, t, a, i, n, s, r, l, d) {
            $("body").data("visiblePopup", "viewBookingPopup"),
            null != e && ((h = null) != o && o != getBookingViewTypes().Unknown || (o = getBookingViewTypes().Summary),
            t && (P.onActionCallback = t),
            a && (P.onCloseCallback = a),
            u(e, !(at = !0), o, !1, i, n, s, r, l, d),
            go) && go.hide()
        }
        function n(e, o, t) {
            be(e, o, null, null, null, null, null, null, null, t)
        }
        function ye(e) {
            b.Order = e,
            null == y && (y = new G),
            y = $.extend(y, b.Order),
            b.group(b.Order.GroupReference),
            b.orderReference(b.Order.OrderReference),
            function() {
                {
                    var i;
                    k.html(""),
                    k.off("change"),
                    void 0 !== y && (i = 0,
                    $.each(y.Bookings, function(e, o) {
                        var t = ""
                          , a = (o.IsCancelled && (t = " class='strikethrough'"),
                        o.IsTransferrable && i++,
                        "");
                        o.Id === b.Id && (a = "selected"),
                        k.append("<option " + a + " value=" + o.Id + t + ">" + o.BookingReferenceNumber + " - " + o.Guest.Surname + "</option>"),
                        $("#transfer-booking").css("visibility", "visible")
                    }),
                    i < 2 || y.IsOTA) && ($.each(y.Bookings, function(e, o) {
                        o.IsTransferrable = !1
                    }),
                    b.IsTransferrable = !1,
                    b.isTransferrable(!1),
                    $("#transfer-booking").css("visibility", "hidden"))
                }
                this.viewType === getBookingViewTypes().Modify ? k.disable() : k.enable(),
                k.on("change", Ce)
            }(),
            he(),
            !1 === P.isCurrentlyShowing && Pe()
        }
        function Ce(e) {
            var o;
            e = e.currentTarget[e.currentTarget.selectedIndex],
            o = e.value,
            y.Bookings.map(function(e) {
                e.Id == o && Te(e)
            }),
            b.viewType() === getBookingViewTypes().Charges && (lo(),
            e = {
                id: b.OrderId,
                bookingId: o,
                orderReference: b.Order.OrderReference,
                currency: b.Order.Currency,
                container: v,
                checkInDate: b.startDate(),
                checkOutDate: b.endDate(),
                ratePlanId: b.RatePlanId,
                isGuestCharges: !0
            },
            eviivo.eagle.viewBookingCharges.open(e)),
            vo.hide(),
            eviivo.component.flyout.updateTitleLeft(D, document.getElementsByClassName("s-heading-left")[0].innerHTML),
            ke(b.IsCancelled)
        }
        function ke(e) {
            e ? document.querySelector($o).classList.add("heading-cancelled") : document.querySelector($o).classList.contains("heading-cancelled") && document.querySelector($o).classList.remove("heading-cancelled"),
            $(".s-heading-title-right .s-group-cancel-text").html($(".s-heading-right .s-group-cancel-text").html())
        }
        function we(o) {
            var t = null;
            return null != y && null !== o ? y.Bookings.map(function(e) {
                e.Id === o && (t = e.RoomName)
            }) : (t = b.RoomName,
            null == o && (t = null)),
            t
        }
        function u(n, s, r, l, d, c, e, o, t, a) {
            if (0 == s) {
                if (dt == n)
                    return;
                if (dt = n,
                null != R && Ie(),
                0 < (R = $("#element-".concat(n))).length && (R.addClass("s-open-processing spinner-container-absolute"),
                jQ('<span class="spinner light-background active small-spinner" id="open-processing-spinner"><span class="position-spinner"><span class="spin"></span></span></span>').appendTo(R)),
                !eviivo.pms.businessSettingsAndDefaultMessages.lazyLoadCheckDataValid({
                    businessId: a,
                    callBack: function() {
                        eviivo.eagle.viewBookingPopup.getBooking(n, s, r, l, d, c, e, o, t, a)
                    }
                }))
                    return
            }
            var i;
            !1 === bookingModelInitialised ? (null != M && (clearTimeout(M),
            M = null),
            M = setTimeout(function() {
                u(n, s, r, l, d, c, e, o, t, a)
            }, 300)) : ((st = s) && (rt = (new Error).stack),
            i = {
                BookingIds: [n],
                DiaryViewTypeForPostBack: P.diaryViewType,
                RefreshRoomId: t,
                RefreshStartDate: e,
                RefreshEndDate: o,
                BusinessId: a
            },
            null != lt && eviivo.webcore.ajaxHelper.abortAjax(ct),
            ct = "DiaryGetBookingForView-".concat(n),
            lt = eviivo.webcore.ajaxHelper.executeAjax({
                actionId: ct,
                url: "".concat(eviivoSuiteApp, "/api/diary/getBookingForView"),
                data: i,
                method: eviivo.webcore.ajaxHelper.methods.POST,
                contentType: eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                callback: function(e) {
                    var o, t, a, i;
                    lt = M = null,
                    n == e.OrderForViewUpdate.Bookings[0].Id && (null != e.OrderForViewUpdate ? (o = e.OrderForViewUpdate.Bookings[0],
                    y = $.extend(new G, e.OrderForViewUpdate),
                    at && (Ae($(".booking-summary"), o.OrderId, o.BusinessId),
                    $("#nav-cards").toggle(!y.HideCardsTab),
                    $("#lblCards").toggle(!y.HideCardsTab)),
                    t = null,
                    t = o.StartDate instanceof Date ? o.StartDate : eviivo.webcore.datetime.parse.parseDate(o.StartDateInIsoFormat),
                    i = null,
                    i = o.EndDate instanceof Date ? o.EndDate : eviivo.webcore.datetime.parse.parseDate(o.EndDateInIsoFormat),
                    o.StartDate = t,
                    o.EndDate = i,
                    o.RefreshStartDate = o.StartDate,
                    o.RefreshEndDate = o.EndDate,
                    o.RefreshRoomId = o.RoomId,
                    0 == s && (a = null != h,
                    h = o,
                    a || (b.bookingId(n),
                    b.isBookingLocked(!1),
                    b.isOverBooking(!1),
                    b.isSplitAvailibility(!1),
                    $(".guest-info").removeClass("locked"),
                    De(),
                    w.prop("disabled", !0),
                    I.removeAttr("disabled"),
                    T.prop("disabled", !0),
                    m.prop("disabled", !0),
                    null != h && ($("#modify-message").html(P.resources.ModifyMessage.format(h.Order.ChannelName)),
                    h.Order.ChannelName),
                    P.isCurrentlyShowing = !1),
                    o.IsSplitAvailibility = e.OrderForViewUpdate.IsSwissCheese,
                    Te(o),
                    null != d && null != c ? (b.isAvailabilityIgnored(!0),
                    h.ModificationSettings.CanDateBeChanged ? (a = eviivo.webcore.datetime.utils.addDaysToDate(d, b.nights),
                    0 == b.isOtaBooking() ? b.startDate(d) : (b.startDate(t),
                    t <= d && (a = d,
                    b.nights = eviivo.webcore.datetime.utils.getDaysBetween(b.startDate(), a) + 1)),
                    b.endDate(a)) : (b.endDate(i),
                    b.startDate(t)),
                    h.RoomTypeId = null,
                    h.RoomId = c,
                    b.room(c)) : (b.isAvailabilityIgnored(!1),
                    b.endDate(i),
                    b.startDate(t)),
                    g.startDate(b.startDate()),
                    g.endDate(b.endDate()),
                    g.room(b.room()),
                    null != r) && (fe(r),
                    l) && b.isInCancellationWindowModifyFailed(!0),
                    "function" == typeof nt && (b = $.extend(b, o),
                    nt(),
                    nt = null)) : alert("You do not have access to this booking"),
                    Ie(),
                    dt = null)
                }
            }),
            1 == O && eviivo.eagle.gridBlock.postGetWithData(i))
        }
        function Ie() {
            null != R && 0 < R.length && (R.removeClass("s-open-processing spinner-container-absolute"),
            R.find("#open-processing-spinner").remove(),
            R = null)
        }
        function Te(e) {
            h = e,
            b.isIcalBooking(h.Order.SourceTypeCode === et.ical),
            b.isOtaBooking(h.Order.IsOTA);
            var t, o, a = b.viewType(), n = ((b = $.extend(b, h)).viewType(a),
            b.isMultiRoomBooking(h.IsMultiRoomBooking),
            b.guestStayTooltipText(h.GuestStayTooltipText),
            b.nights = h.NumberOfNights,
            h.IsMultiRoomBooking ? null == y || y.Id !== h.OrderId ? (l = h.OrderId,
            eviivo.webcore.ajaxHelper.executeAjax({
                actionId: "DiaryGetOrder",
                url: eviivoSuiteApp + "/api/order/get?orderId=" + l,
                method: eviivo.webcore.ajaxHelper.methods.GET,
                contentType: eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                callback: ye
            })) : (k.val(h.Id),
            null != (t = h) && null != y && $.each(y.Bookings, function(e, o) {
                o.Id === t.Id && (y.Bookings[e] = t)
            })) : (Oe(),
            b.group(b.Order.GroupReference),
            b.orderReference(b.Order.OrderReference)),
            $("#agoda-tax-warning")), s = $("#expedia-tax-warning");
            if (s.hide(),
            n.hide(),
            !h.Order.PricedTaxInclusive)
                switch (h.Order.DistributorShortName) {
                case "Expedia":
                    s.show();
                    break;
                case "Agoda":
                    n.show()
                }
            b.costDisplayWithCurrency(e.PreCancellationCostDisplayWithCurrency),
            b.cancellationTooltipText(e.CancellationPolicyText),
            null !== e.Order.SourceToolTipText ? (b.sourceTooltipText(e.Order.SourceToolTipText),
            $(".sourceToolTip").removeClass("hide")) : $(".sourceToolTip").addClass("hide"),
            b.costDisplayWithOriginalCurrency(e.PreCancellationCostDisplayWithOriginalCurrency),
            b.checkInScenario(h.CheckInScenario),
            b.CheckinStatusCode = e.CheckinStatusCode,
            Ze(h),
            b.isBookingLocked(h.IsLocked),
            !0 === b.isBookingLocked() ? ($(".guest-info").addClass("locked"),
            Ye()) : (De(),
            Ke(),
            $(".guest-info").removeClass("locked")),
            h.IsSplitAvailibility ? (b.isOverBooking(!1),
            b.isSplitAvailibility(h.IsSplitAvailibility)) : (b.isOverBooking(h.IsOverBooking),
            b.isSplitAvailibility(!1)),
            b.isCancelled(h.IsCancelled),
            b.canWaiveCancellationFees(h.CanWaiveCancellationFees),
            b.isTransferred(h.IsTransferred),
            b.isTransferrable(h.IsTransferrable),
            b.bookingReference(h.BookingReferenceNumber),
            b.transferCancelText(h.IsTransferred ? " " + P.resources.TransferredLabel : h.IsCancelled ? " " + P.resources.CancelledLabel : "");
            var r = e.Deposits
              , l = e.FlexibleDeposit
              , e = b.IsCancelled
              , d = C.find(".deposit");
            if (void 0 === r || r.length <= 0 || e)
                d.hide();
            else {
                var c = P.resources.DepositPolicy + "<br/>"
                  , u = [];
                for (i = 0; i < r.length; i++) {
                    var v = r[i]
                      , v = eviivo.webcore.datetime.parse.parseDate(v.Date)
                      , p = Globalize.formatCurrency(r[i].Amount, Be(h.BusinessId));
                    u.push(Se(!1, v, p)),
                    depositText = Se(!0, v, p),
                    c = c + depositText + "</br>"
                }
                e = u.join(", ");
                P.popupBox.find(".occupancy-details .source .deposit span").html(e),
                Io.html(c),
                b.depositTooltipText(Io.html()),
                b.isFlexibleDeposit(l),
                d.show()
            }
            P.popupBox.find(".room-name").html(h.RoomName),
            P.popupBox.find(".guest-name").html(b.GuestModel.FullName),
            P.popupBox.find("#guest-culture-code").val(b.GuestModel.DefaultCultureCode),
            g = void 0 === h.ArrivalTime ? null != (g = eviivo.webcore.datetime.parse.parseDate(h.EstimatedTimeOfArrival)) ? g.evStandard24HourTime() : Wo : h.ArrivalTime,
            b.arrivalTime(g),
            _e(b.GuestModel.PhoneNumber, b.GuestModel.Email);
            var g = null
              , m = (g = h.StartDate instanceof Date ? h.StartDate : eviivo.webcore.datetime.parse.parseDate(h.StartDateInIsoFormat),
            P.popupBox.find(".occupancy-details .nights .checkin span").html(g.evDisplayLongDate(eviivo.eagle.basePageModelState.userCultureCode)),
            g = null,
            g = h.EndDate instanceof Date ? h.EndDate : eviivo.webcore.datetime.parse.parseDate(h.EndDateInIsoFormat),
            P.popupBox.find(".occupancy-details .nights .checkout span").html(g.evDisplayLongDate(eviivo.eagle.basePageModelState.userCultureCode)),
            g = P.resources.nightPrice.replace("{0}", h.NumberOfNights),
            P.popupBox.find(".occupancy-details .nights .nights-number span").html(h.NumberOfNights),
            P.popupBox.find(".room-details span.night-count").html(g),
            P.popupBox.find(".occupancy-details .occupancy .adults").html(h.NumberOfAdults),
            P.popupBox.find(".occupancy-details .occupancy .children").html(h.NumberOfChildren),
            P.popupBox.find(".occupancy-details .nights .source-location span").html(h.UiBookingSourceName),
            h.Order.IsOTA && !y.IsOtaAutoConnected && P.popupBox.find(".occupancy-details .nights .source-location span").append(" *"),
            null != h.Order.ChannelReference && 0 < h.Order.ChannelReference.length ? (g = 17 < h.Order.ChannelReference.length,
            m = g ? h.Order.ChannelReference.substring(0, 17) + "..." : h.Order.ChannelReference,
            (o = P.popupBox.find(".occupancy-details .source .source-channel-reference span")).html(m),
            o.removeAttr("data-tooltip", "title"),
            o.removeAttr("data-tooltip-pos", "top"),
            o.removeAttr("data-tooltip-title"),
            o.removeAttr("title"),
            g && (o.attr("data-tooltip", "title"),
            o.attr("data-tooltip-pos", "top"),
            o.attr("data-tooltip-title", h.Order.ChannelReference),
            o.attr("title", h.Order.ChannelReference)),
            P.popupBox.find(".occupancy-details .source .source-channel-reference").show()) : P.popupBox.find(".occupancy-details .source .source-channel-reference").hide(),
            h.Order && h.Order.GroupReference ? (P.popupBox.find(".occupancy-details .source .group-reference span").html(h.Order.GroupReference),
            P.popupBox.find(".occupancy-details .source .group-reference").show()) : P.popupBox.find(".occupancy-details .source .group-reference").hide(),
            eviivo.webcore.datetime.parse.parseDate(h.Order.OrderDateTime))
              , e = (P.popupBox.find(".occupancy-details .source .received span").html(m.evDisplayExtraLongDateTime(eviivo.eagle.basePageModelState.userCultureCode)),
            P.popupBox.find(".occupancy-details .source .order-reference span").html(b.Order.OrderReference),
            P.popupBox.find("#isIcal").attr("value", b.Order.SourceTypeCode),
            P.popupBox.find(".room-details .currency").html(h.Order.CurrencySymbol),
            P.popupBox.find(".room-details .room").html(h.RoomName),
            P.popupBox.find(".room-details .type").html(h.RoomTypeDescription),
            P.popupBox.find(".room-details .rate-plan").html(h.RatePlanName),
            P.popupBox.find("#propertyNameValue").length && (P.popupBox.find("#propertyNameValue").html(h.BusinessName),
            Ve(!0)),
            g = h.HumanReadableBedTypes,
            null !== h.BedTypesTooltip && (g = "<span>" + h.HumanReadableBedTypes + '</span><i class="icon-font icon-font-help more-info" data-tooltip="title" data-tooltip-pos="top"data-tooltip-title=" ' + h.BedTypesTooltip + '" title=" ' + h.BedTypesTooltip + ' "></i>'),
            P.popupBox.find(".room-details .bed-types").html(g),
            h.Notes = eviivo.util.decodedHtml(h.Notes),
            x.val(h.Notes),
            To.val(h.DoorLockCode),
            xo.val(h.BuildingLockCode),
            S.val(h.RoutineInstructions),
            x.data("value", x.val()),
            h.Order.Notes = eviivo.util.decodedHtml(h.Order.Notes),
            B.val(h.Order.Notes),
            B.data("value", B.val()),
            h.IsCancelled && (w.prop("disabled", !0),
            I.removeAttr("disabled"),
            null != (o = eviivo.webcore.datetime.parse.parseDate(h.CancellationDate))) && P.popupBox.find(".occupancy-details .source .cancelled span").html(o.evDisplayExtraLongDateTime(eviivo.eagle.basePageModelState.userCultureCode)),
            P.popupBox.find(".occupancy-details .cancellation .currentCancellationCharge"));
            0 < h.FinalCancellationChargeValue ? e.html(Globalize.formatCurrency(h.FinalCancellationChargeValue, Be(h.BusinessId))) : h.WereCancellationFeesWaived ? e.html(P.resources.WaivedCancellation) : e.html(P.resources.FreeCancellation),
            b.isOfflineBooking(h.Order.IsOffline),
            b.isInCancellationWindow(h.IsInCancellationWindow),
            b.isInCancellationWindowModifyFailed(!1),
            "function" == typeof zo && (zo(),
            zo = null),
            !1 === P.isCurrentlyShowing && (!1 === b.isMultiRoomBooking() || y && y.Id == h.OrderId) && Pe(),
            b.appliedPromotions(h.Promotions),
            a === getBookingViewTypes().GuestInfo && eviivo.eagle.guest.loadGuestTabContainer(null, {
                Id: b.GuestModel.Id,
                orderId: b.OrderId,
                bookingId: b.Id,
                businessId: b.BusinessId
            }, f, function() {
                eviivo.eagle.guest.multiguests.refreshDropDown(b.Order.Id, b.Id)
            })
        }
        function xe(e) {
            return "function" == typeof E ? E(e).DefaultCultureCode : ""
        }
        function Be(e) {
            return "function" == typeof E ? E(e).WorkingCurrencyCode : ""
        }
        function Se(e, o, t) {
            t = "<span class='depamount'>" + t + "</span>";
            return e && (t += "&nbsp;<span class='depdate'>" + P.resources.DepositOn + " " + o.evDisplayLongDate(eviivo.eagle.basePageModelState.userCultureCode) + "</span>"),
            t
        }
        function De() {
            x.removeAttr("disabled"),
            w.prop("disabled", !1),
            B.removeAttr("disabled"),
            I.removeAttr("disabled")
        }
        function Pe() {
            if (eviivo.component.flyout.showFlyout(D),
            eviivo.component.flyout.updateTitleLeft(D, document.getElementsByClassName("s-heading-left")[0].innerHTML),
            eviivo.component.flyout.updateTitleRight(D, document.getElementsByClassName("s-heading-right")[0].innerHTML),
            1 < document.querySelectorAll(".order-drop-select").length && $("#orderSelect").on("change", Ce),
            ke(document.querySelector(Fo).classList.contains("heading-cancelled")),
            vt) {
                document.getElementById(D).setAttribute("data-bind", "attr: { 'class': viewState() }");
                var e = document.querySelectorAll(_o)
                  , o = document.querySelector(Go)
                  , t = document.querySelector(Qo);
                t.innerHTML = "";
                for (var a = 0; a < e.length; a++)
                    t.appendChild(e[a]);
                t.appendChild(o)
            } else
                je();
            vt = !1
        }
        function je(e) {
            document.getElementById("manage-guest-buttons").classList.add("hide");
            var o = document.querySelector(Go);
            null != o && o.classList.add("hide"),
            e == getBookingViewTypes().GuestInfo && document.getElementById("manage-guest-buttons").classList.remove("hide"),
            e == getBookingViewTypes().GuestInfo && null != e || null != (o = document.querySelector(Vo)) && o.remove(),
            e == getBookingViewTypes().Emails && null != e || null != (o = document.querySelector(Lo)) && o.remove()
        }
        function Ne() {
            null != eviivo.pms.diary.gridNavigation && eviivo.pms.diary.gridNavigation.resetHandlers()
        }
        function Ae(e, o, t) {
            void 0 === o && (o = b.OrderId),
            eviivo.eagle.financialSummary.init({
                orderId: o,
                container: e,
                calculateMaxPayment: !1,
                businessId: t,
                onSuccessCallback: null,
                guestCultureCode: eviivo.eagle.basePageModelState.businessCultureCode,
                resources: {
                    StandardLoaderMessage: P.resources.StandardLoaderMessage,
                    SendEmailSuccess: P.resources.SendEmailSuccess,
                    SendEmailFailure: P.resources.SendEmailFailure,
                    EmailGuestNotFound: P.resources.EmailGuestNotFound
                }
            })
        }
        function Oe() {
            void 0 !== h && h.IsMultiRoomBooking ? he() : void 0 !== h && (b.total(h.Cost),
            b.updateTotals(h.AmountPaid),
            b.cancellationCharge(h.FinalCancellationChargeValue))
        }
        function Me(e) {
            e.preventDefault();
            e = so() + eviivoSuiteApp + "/diary/guestRegistration?businessId=" + b.BusinessId + "&businessCultureCode=" + xe(b.BusinessId) + "&bookingId=" + b.Id;
            window.open(e)
        }
        function f(e) {
            var o = jQuery("div[id^=guest-section-container]")
              , t = o.find("#telephone").val()
              , a = o.find("#email").val()
              , i = o.find("#forename").val()
              , n = o.find("#surname").val()
              , s = o.find("#title > option:selected").text()
              , r = o.find("#communicatein").val()
              , o = o.find("#companyorgroup").val()
              , l = $("#GuestId").val()
              , d = "";
            null != s && 0 === s.indexOf("-----") && (d = s + " "),
            null != i && (d += i + " "),
            d += n,
            _e(t, a),
            jQuery("span.guest-name").html(d),
            null != o && "" != o ? (jQuery(".group-reference span").text(o),
            jQuery(".group-reference").show()) : jQuery(".group-reference").hide(),
            b.GuestModel.Email = a,
            b.GuestModel.DefaultCultureCode = r,
            b.GuestModel.Id = l,
            b.selectedGuestId = l,
            0 < $("#room-list.cp-diary-sidebar-list li.p-row").length && eviivo.eagle.gridBlock.updateBookingElement(b.Id, b.Order.Id, b.viewType, eviivo.webcore.calendar.getSelectedDate()),
            eviivo.eagle.guest.multiguests.refreshDropDown(b.Order.Id, b.Id)
        }
        function Re(e) {
            var o = jQuery(this).val();
            b.GuestModel.Id = o,
            b.selectedGuestId = o,
            eviivo.eagle.guest.loadGuestTabContainer(null, {
                Id: o,
                businessId: b.BusinessId,
                orderId: b.OrderId,
                bookingId: b.Id
            }, f, eviivo.eagle.guest.multiguests.manageBookingGuestStatus)
        }
        function Ee(e) {
            eviivo.eagle.additional.guest.loadContainer(e, b.BusinessId, b.OrderId, b.Id, f),
            $("#divContent").addClass("showing-add-guest")
        }
        function He(e) {
            var o = jQuery(this)
              , t = o.parents(".cp-custom-input")
              , o = o.is(":checked");
            return t.notify({
                text: P.resources.changeBillingGuestNotificationMessage,
                icon: "&#xe93a;",
                buttonOne: "<button class='btn btn-secondary' type='button'>" + P.resources.labelCancel + "</button>",
                buttonTwo: "<button class='btn btn-right' id='s-billing-status' type='button' data-status='" + o + "'>" + P.resources.labelOk + "</button>"
            }, {
                style: "withTwoActions",
                className: "action v-2",
                position: "bottom left",
                autoHideDelay: "100000",
                clickToHide: !0
            }),
            jQuery("#s-billing-status").on("click", Fe),
            !1
        }
        function Fe() {
            var e, o = Mo;
            jQuery(this).data("status") && !o.is(":disabled") && (e = parseInt(Oo.val()),
            eviivo.webcore.ajaxHelper.executeAjax({
                actionId: H.updateBillingGuest.actionId,
                url: H.updateBillingGuest.url,
                method: eviivo.webcore.ajaxHelper.methods.POST,
                contentType: eviivo.webcore.ajaxHelper.contentTypes.JSON,
                data: {
                    businessId: b.BusinessId,
                    orderId: b.OrderId,
                    guestId: e
                },
                callback: function(e) {
                    o.prop("disabled", !0),
                    o.prop("checked", !0),
                    eviivo.eagle.guest.multiguests.refreshDropDown(b.Order.Id, b.Id)
                }
            }))
        }
        function Ge(e) {
            var o = jQuery(this)
              , t = o.parents(".cp-custom-input")
              , o = o.is(":checked");
            return t.notify({
                text: P.resources.changePrimaryGuestNotificationMessage,
                icon: "&#xe93a;",
                buttonOne: "<button class='btn btn-secondary' type='button'>" + P.resources.labelCancel + "</button>",
                buttonTwo: "<button class='btn btn-right' id='s-primary-guest' type='button' data-status='" + o + "'>" + P.resources.labelOk + "</button>"
            }, {
                style: "withTwoActions",
                className: "action v-2",
                position: "bottom left",
                autoHideDelay: "100000",
                clickToHide: !0
            }),
            jQuery("#s-primary-guest").on("click", $e),
            !1
        }
        function $e() {
            var e, o = Ro;
            jQuery(this).data("status") && !o.is(":disabled") && (e = parseInt(Oo.val()),
            eviivo.webcore.ajaxHelper.executeAjax({
                actionId: H.updatePrimaryGuest.actionId,
                url: H.updatePrimaryGuest.url,
                method: eviivo.webcore.ajaxHelper.methods.POST,
                contentType: eviivo.webcore.ajaxHelper.contentTypes.JSON,
                data: {
                    businessId: b.BusinessId,
                    orderId: b.OrderId,
                    bookingId: b.Id,
                    guestId: e
                },
                callback: function(e) {
                    o.prop("disabled", !0),
                    o.prop("checked", !0),
                    eviivo.eagle.guest.multiguests.refreshDropDown(b.Order.Id, b.Id)
                }
            }))
        }
        function Qe(e) {
            var o = jQuery(this)
              , t = o.parents(".cp-custom-input")
              , o = o.is(":checked");
            if (!Mo.is(":checked"))
                return t.notify({
                    text: P.resources.removeGuestFromRoomNotificationMessage,
                    icon: "&#xe961;",
                    buttonOne: "<button class='btn btn-secondary' type='button'>" + P.resources.labelCancel + "</button>",
                    buttonTwo: "<button class='btn btn-right' id='s-stay-status' type='button' data-status='" + o + "'>" + P.resources.labelOk + "</button>"
                }, {
                    style: "withTwoActions",
                    className: "warn",
                    position: "bottom left",
                    autoHideDelay: "100000",
                    clickToHide: !0
                }),
                jQuery("#s-stay-status").on("click", Le),
                !1;
            Le()
        }
        function Le() {
            var e, o, t = jQuery(this), a = Eo.is(":disabled"), t = t.data("status"), i = Mo.is(":checked");
            null == t && (t = Eo.is(":checked")),
            a || (a = parseInt(Oo.val()),
            e = {
                businessId: b.BusinessId,
                bookingId: b.Id,
                guestId: a,
                isGuestStaying: JSON.parse(t)
            },
            o = t && !i ? b.GuestModel.Id : parseInt(Oo.find("[data-primary='true']").val()),
            eviivo.webcore.ajaxHelper.executeAjax({
                actionId: H.updateGuestStaySatus.actionId + a,
                url: H.updateGuestStaySatus.url,
                method: eviivo.webcore.ajaxHelper.methods.POST,
                contentType: eviivo.webcore.ajaxHelper.contentTypes.JSON,
                data: e,
                callback: function(e) {
                    eviivo.eagle.guest.loadGuestTabContainer(null, {
                        Id: o,
                        orderId: b.OrderId,
                        bookingId: b.Id,
                        businessId: b.BusinessId
                    }, f, function() {
                        eviivo.eagle.guest.multiguests.refreshDropDown(b.Order.Id, b.Id)
                    })
                }
            }))
        }
        function Ve(e) {
            $(".diary-container").length && (e ? ($(".cp-diary-bookings-grid").addClass("active"),
            $(".cp-diary-sidebar").addClass("active"),
            $("#room-list li.p-row[data-id=" + h.BusinessId + "]").first().addClass("active"),
            $("#room-list li.r-row[data-id=" + h.RoomId + "]").addClass("active"),
            $("#grid-body tr.dia-tbl_row[data-id=" + h.RoomId + "]").addClass("active")) : ($(".cp-diary-bookings-grid").removeClass("active"),
            $(".cp-diary-sidebar").removeClass("active"),
            $("#room-list li.p-row[data-id=" + h.BusinessId + "]").first().removeClass("active"),
            $("#room-list li.r-row[data-id=" + h.RoomId + "]").removeClass("active"),
            $("#grid-body tr.dia-tbl_row[data-id=" + h.RoomId + "]").removeClass("active")))
        }
        function _e(e, o) {
            var t = C.find("#guest-info-telephone")
              , a = C.find("#guest-info-email");
            e ? (t.find("span").html(e),
            t.removeClass("hide")) : (t.find("span").html(""),
            t.addClass("hide")),
            o ? (a.find("a").html(o).attr({
                href: "mailto:" + o,
                "data-tooltip": "title",
                title: o,
                "data-tooltip-title": o,
                "data-tooltip-pos": "top"
            }),
            a.removeClass("hide")) : (a.find("a").html("").attr("href", ""),
            a.addClass("hide"))
        }
        function Ue() {
            null != h.RoomTypeId && b.roomType(h.RoomTypeId),
            null != h.RoomId && b.room(h.RoomId),
            null != h.RatePlanId && b.ratePlanSelect(h.RatePlanId),
            g.canBeModified(h.ModificationSettings.CanDateBeChanged),
            g.isOta(h.Order.IsOTA)
        }
        function qe() {
            var e;
            switch (b.CheckinStatusCode) {
            case j.checkedIn:
                e = P.resources.CheckinBookingError;
                break;
            case j.checkedOut:
                e = P.resources.CheckoutBookingError;
                break;
            case j.notCheckedIn:
                e = P.resources.CheckinBookingError;
                break;
            default:
                return void Ze()
            }
            O = null != eviivo.webcore.ajaxHelper.executeAjax({
                actionId: "DiaryCheckInOut",
                url: eviivoSuiteApp + "/api/bookings/checkinout?bookingId=" + b.Id + "&checkinStatusCode=" + b.CheckinStatusCode,
                method: eviivo.webcore.ajaxHelper.methods.GET,
                contentType: eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                callback: Je,
                failCallback: function() {
                    alert(e)
                }
            })
        }
        function Je(e) {
            h = e,
            $.isFunction(P.onActionCallback) && P.onActionCallback(),
            (b = $.extend(b, h)).checkInScenario(h.CheckInScenario);
            var e = eviivo.webcore.datetime.utils.addDaysToDate(b.startDate(), -1)
              , o = eviivo.webcore.datetime.utils.addDaysToDate(b.endDate(), -1)
              , e = {
                DiaryViewTypeForPostBack: P.diaryViewType,
                SelectedDate: eviivo.webcore.calendar.getSelectedDate(),
                RefreshRoomId: b.RoomId,
                RefreshStartDate: e,
                RefreshEndDate: o
            };
            b.isMultiRoomBooking() && (e.RefreshOrderId = h.OrderId,
            (e.RefreshRoomId = null) != y) && $.each(y.Bookings, function(e, o) {
                o.Id == h.Id && (o.CheckinStatusCode = h.CheckinStatusCode)
            }),
            eviivo.eagle.gridBlock.postGetWithData(e),
            Ze(h)
        }
        function We() {
            Xe(),
            b.CheckinStatusCode = r.val(),
            qe()
        }
        function ze() {
            Xe(),
            b.CheckinStatusCode = a.val(),
            qe()
        }
        function Xe() {
            it && (a.hide(),
            it = !1)
        }
        function Ye() {
            r && r.addClass("hide"),
            l && l.addClass("hide"),
            uo && uo.addClass("hide")
        }
        function Ke() {
            null != r && (r.removeClass("hide"),
            l.removeClass("hide"),
            uo.removeClass("hide"),
            l.removeClass("ui-button-disabled"),
            l.removeClass("ui-state-disabled"),
            l.removeAttr("aria-disabled"),
            l.removeAttr("disabled"))
        }
        function Ze(e) {
            var o, t, a, i;
            null != r && (o = C.find(".s-checkedInOutTime"),
            t = C.find("#arrival-time"),
            a = C.find(".s-arrival-text"),
            i = C.find(".s-checkedInOutStatus"),
            b.CheckinStatusCode == j.checkedIn ? (r.text(P.resources.CheckOutAction),
            r.val(j.checkedOut),
            i.html(P.resources.CheckedIn + ": "),
            t.addClass("hide"),
            a.addClass("hide"),
            o.html(b.CheckInDateString)) : b.CheckinStatusCode == j.checkedOut ? (r.text(P.resources.CheckInAction),
            r.val(j.checkedIn),
            i.html(P.resources.CheckedOut + ": "),
            t.addClass("hide"),
            a.addClass("hide"),
            o.html(b.CheckOutDateString)) : (r.html(P.resources.CheckInAction),
            r.val(j.checkedIn),
            a.removeClass("hide"),
            t.removeClass("hide"),
            null != e && b.checkInScenario(e.CheckInScenario)))
        }
        function eo() {
            var e, o, t;
            return it && null != a ? Xe() : (e = null == a ? !1 : !0,
            it = !0,
            a = l.parent().next(),
            o = '<a href="#">',
            t = "</a>",
            b.CheckinStatusCode == j.checkedIn || b.CheckinStatusCode == j.checkedOut ? a.html(o + P.resources.NotCheckedIn + t).val(j.notCheckedIn) : a.html(o + P.resources.CheckOutAction + t).val(j.checkedOut),
            a.show().position({
                my: "right top",
                at: "right bottom",
                of: l
            }),
            !1 === e && a.on("click", ze)),
            !1
        }
        function oo() {
            r = $("#checkinButton"),
            l = $("#checkinSelect"),
            uo = $("#checkInSection"),
            l.on("click", eo),
            r.on("click", We),
            Ze(),
            r.button().next().button({
                text: !1,
                icons: {
                    primary: "ui-icon-triangle-1-s"
                }
            }).parent().controlgroup().next().hide().menu()
        }
        function to() {
            b.transactions([]),
            b.transactionsExist(!1),
            null == h && logSentryException("view booking popup - getTransaction booking equals null updateDiaryOnly value = ".concat(st, ", stacktrace for true ").concat(rt), "bookingNull");
            var t = h.BusinessId;
            eviivo.webcore.ajaxHelper.executeAjax({
                actionId: "DiaryGetTransactionsByOrder",
                url: eviivoSuiteApp + "/api/bookings/getTransactionsByOrder?businessId=" + t + "&orderId=" + h.OrderId,
                method: eviivo.webcore.ajaxHelper.methods.GET,
                contentType: eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                callback: function(e) {
                    var o;
                    e && (e.Transactions && 0 < e.Transactions.length && (b.transactionsExist(!0),
                    q(e.Transactions)),
                    b.hasNonRefundableCharges(e.HasNonRefundableCharges),
                    null != (o = eviivo.util.safeFunction("eviivo.pms.businessSettingsAndDefaultMessages.setDefaultTextOnElement")) && o(t, "GuestMessage.".concat(t, ".Invoice"), b.GuestModel.DefaultCultureCode, c),
                    b.guestCultureCode(e.GuestCultureCode && e.GuestCultureCode.length ? e.GuestCultureCode : ""))
                }
            })
        }
        function ao() {
            jo.on("click", io),
            No.on("click", ro),
            c = C.find("#guest-message"),
            C.find("#guestCulture"),
            c.attr("placeholder", P.resources.GuestMessagePlace)
        }
        function io() {
            $(this).notify({
                text: P.resources.GenerateInvoiceConfirmation,
                icon: "&#xe952;",
                buttonOne: "<button class='btn btn-cancel btn-secondary mr10 s-cancel-generate-invoice' type='button'>" + P.resources.generateInvoiceCancel + "</button>",
                buttonTwo: "<button class='btn btn-right s-generate-invoice-submit' type='button'>" + P.resources.generateInvoiceOk + "</button>"
            }, {
                style: "withTwoActions",
                className: "warn v-2",
                position: "top right",
                autoHideDelay: "100000",
                clickToHide: !0
            });
            var e = $(".s-generate-invoice-submit")
              , o = $(".s-cancel-generate-invoice");
            e.on("click", no),
            o.on("click", function() {
                $(this).trigger("notify-hide")
            })
        }
        function no() {
            var o = []
              , t = (b.transactions().forEach(function(e) {
                e.IsIncludedOnStatement() && e.TypeCode == Yo.ledger && o.push(e.Id)
            }),
            "")
              , e = (o.forEach(function(e) {
                t = t + e + ","
            }),
            c.val());
            null == e && (e = ""),
            eviivo.webcore.ajaxHelper.executeAjax({
                actionId: "DiaryGenerateDocument",
                url: eviivoSuiteApp + "/api/bookings/generateDocument",
                data: {
                    businessId: h.BusinessId,
                    id: h.Id,
                    guestMessage: e,
                    itemIds: t,
                    showTransactionsDetails: b.showTransactionsDetails()
                },
                method: eviivo.webcore.ajaxHelper.methods.POST,
                contentType: eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                callback: function(e) {
                    null != e && to()
                }
            })
        }
        function so() {
            var e = location.href.split("/");
            return e[0] + "//" + e[2]
        }
        function ro() {
            var e = encodeURIComponent(c.val())
              , o = b.GuestModel.DefaultCultureCode
              , t = (void 0 !== o && null != o || (o = eviivo.eagle.basePageModelState.businessCultureCode),
            [])
              , a = []
              , i = []
              , e = (b.transactions().forEach(function(e) {
                null != e.BookingId && i.indexOf(e.BookingId) < 0 && i.push(e.BookingId),
                e.IsIncludedOnStatement() || (e.TypeCode == Yo.ledger ? t : a).push(e.Id)
            }),
            {
                businessId: b.BusinessId,
                selectedBookingId: b.Id,
                bookingIds: i,
                excludedLedgersIds: t,
                excludedPaymentsIds: a,
                message: e,
                guestCultureCode: o,
                showTransactionsDetails: b.showTransactionsDetails()
            })
              , o = ("function" == typeof E && (o = E(b.BusinessId),
            e.businessCultureCode = o.DefaultCultureCode,
            e.businessWorkingCurrencyCode = o.WorkingCurrencyCode),
            so() + eviivoSuiteApp + "/diary/statement");
            eviivo.webcore.navigatorHelper.redirectTo(o, e, eviivo.webcore.navigatorHelper.options.target.newWindow, eviivo.webcore.navigatorHelper.options.method.post)
        }
        function lo() {
            mo.addHideClass(),
            fo.removeClass("hide").addClass("active"),
            v.removeHideClass(),
            v.html("")
        }
        var s, co, a, r, l, uo, vo, po, go, mo, v, fo, ho, bo, yo, Co, wo, Io, p, h, b, y, g, C, k, w, I, m, T, x, B, S, To, xo, Bo, So, Do, Po, jo, No, Ao, c, Oo, Mo, Ro, Eo, Ho, D, Fo, Go, $o, Qo, Lo, Vo, _o, Uo, qo, Jo, Wo, zo, P, Xo, j, Yo, Ko, N, A, Zo, et, e, o, ot, tt, at, it, O, nt, st, rt, M, lt, R, dt, ct, E, H, ut, vt;
        window.eviivo = window.eviivo || {},
        window.eviivo.eagle = window.eviivo.eagle || {},
        window.eviivo.eagle.viewBookingPopup = window.eviivo.eagle.viewBookingPopup || {},
        window.eviivo.eagle.viewBookingPopup = (D = "view-booking-flyout",
        Fo = "#view-booking-flyout .mod-popup-header",
        Go = "#view-booking-flyout #financial-footer-buttons",
        $o = "#view-booking-flyout .cp-flyout_header",
        Qo = "#view-booking-flyout .cp-flyout_footer",
        Lo = "#view-booking-flyout #comms-footer-buttons",
        Vo = "#view-booking-flyout #add-guests-buttons",
        _o = "#view-booking-flyout .s-footer-buttons",
        Uo = "transfer-booking-flyout",
        Wo = "",
        P = {
            top: 100,
            diaryStart: zo = null,
            startDate: null,
            resources: null,
            isCurrentlyShowing: !(Jo = "#transfer-booking-flyout .cp-flyout_footer"),
            isLoading: !(qo = "#transfer-booking-flyout .s-heading-title"),
            onActionCallback: null,
            diaryViewType: null,
            transactionViewType: null,
            initGuestSearchCallback: null
        },
        Xo = {
            Unknown: 0,
            Summary: 1,
            Payment: 2,
            Modify: 3,
            GuestInfo: 4,
            Transactions: 5,
            Charges: 6,
            Emails: 7,
            Cards: 8,
            PaymentMultiCard: 9,
            Owner: 10
        },
        j = {
            checkedIn: "I",
            checkedOut: "O",
            notCheckedIn: "N"
        },
        Yo = {
            payment: "P",
            ledger: "L"
        },
        Ko = {
            Locked: "L",
            Pending: "P",
            Inactive: "X"
        },
        N = {
            Entry: "E",
            Food: "F",
            Reversal: "R",
            FoodReversal: "S"
        },
        A = {
            Deleted: "Z",
            Cancelled: "X",
            Transferred: "T"
        },
        Zo = {
            AdvancedDeposit: "ATP",
            PrepaidServices: "PPS",
            PrepaidServicesTPD: "TPD"
        },
        et = {
            agent: "A",
            online: "D",
            pms: "O",
            ical: "I"
        },
        e = {
            None: 0,
            StayConfirmed: 1,
            StayAtRisk: 2,
            OnlineCheckInStarted: 3,
            OnlineCheckInComplete: 4,
            CheckedIn: 5,
            CheckedOut: 6
        },
        o = {
            Summary: 0,
            Details: 1,
            Void: 2
        },
        ot = function() {
            var e = localStorage.getItem("transactionViewType");
            null == e && (e = o.Summary);
            return e
        }(),
        tt = {
            Summary: "#nav-summary",
            PaymentMulticard: "#nav-payment-multicard",
            Modify: "#nav-modify",
            GuestInfo: "#nav-guestinfo",
            Transactions: "#nav-transactions",
            Charges: "#nav-charges",
            Emails: "#nav-emails",
            Cards: "#nav-cards"
        },
        st = O = it = !(at = !0),
        ct = dt = R = lt = M = rt = nt = null,
        H = {
            updateBillingGuest: {
                actionId: "UpdateBillingGuest",
                url: eviivoSuiteApp + "/guest/update-billing-guest"
            },
            updatePrimaryGuest: {
                actionId: "UpdatePrimaryGuest",
                url: eviivoSuiteApp + "/guest/update-primary-guest"
            },
            updateGuestStaySatus: {
                actionId: "UpdateGuestStayStatus",
                url: eviivoSuiteApp + "/guest/update-guest-stay-status"
            }
        },
        vt = ut = !0,
        getBookingViewTypes = function() {
            return Xo
        }
        ,
        getBookingViewModel = function() {
            return b
        }
        ,
        {
            init: function(e) {
                E = eviivo.util.safeFunction("eviivo.pms.businessSettingsAndDefaultMessages.getValue"),
                $(".popup-footer-buttons").tip(),
                Io = jQuery("#tooltip-currency-formatter-container"),
                p = $("#nav-view-booking"),
                (P = $.extend(P, e)).beforeAjaxRequest = ee,
                P.afterAjaxRequest = function() {
                    1 == Po && (Ue(),
                    Po = !1),
                    ee()
                }
                ,
                P.validationFailCallback = d,
                P.priceInputValueSetCallback = ee,
                P.ajaxRequestNoResults = d,
                g = eviivo.eagle.occupancy.init(P),
                b = new F,
                (b = $.extend(b, g)).infoMessageText = ko.observable(""),
                ko.applyBindings(b, document.getElementById("view-booking-wrap")),
                C = $("#view-booking-wrap"),
                Do = $("#submit-modify-booking"),
                Ho = $("#btnAddBookingToGroup"),
                $("#popup-transfer-booking-wrap"),
                k = C.find("#orderSelect"),
                w = C.find("#modify-booking-note"),
                waiveCancellationFeesButton = C.find("#waive-cancellation-fees"),
                I = C.find("#modify-lead-note"),
                m = C.find("#modify-cleaning-note"),
                T = C.find("#modify-door-codes"),
                x = C.find("#booking-notes"),
                B = C.find("#lead-notes"),
                S = C.find("#cleaning-notes"),
                To = C.find("#door-code"),
                xo = C.find("#building-code"),
                Bo = C.find("#cancel-booking"),
                So = C.find("#transfer-booking"),
                jo = C.find("#generate-invoice"),
                No = C.find("#generate-bill"),
                sendBookingCancellationConfirmationEmail = C.find("#btnSendBookingCancellationConfirmationEmail"),
                bo = C.find("#transactions-summary"),
                yo = C.find("#transactions-details"),
                Co = C.find("#transactions-void"),
                po = C.find("#arrival-time"),
                Ao = new Q,
                ko.applyBindings(Ao, document.getElementById("popup-transfer-booking-wrap")),
                vo = $("#unsavedWarning"),
                mo = C.find("#divContent"),
                v = C.find("#divDetails"),
                fo = C.find(".spinner"),
                ho = C.find("#modify-spinner"),
                $("#add-booking").tip({
                    tipDelay: 0
                }),
                wo = C.find("#notes-tabs li a"),
                jQuery("#guest-registration").on("click", Me),
                (Oo = jQuery("#booking-guests")).on("change", Re),
                jQuery("#GuestTab-AddGuest").on("click", Ee),
                Mo = jQuery("#BillingGuest"),
                Ro = jQuery("#PrimaryGuest"),
                Eo = jQuery("#StayingInRoom"),
                Mo.on("click", He),
                Ro.on("click", Ge),
                Eo.on("click", Qe),
                wo.on("click", L);
                var o, t = getBookingViewTypes();
                for (o in t) {
                    var a = t[o];
                    t[a] = o
                }
                setTimeout(oo, 1500),
                setTimeout(V, 2e3),
                setTimeout(ao, 2500),
                $("#add-booking").draggable({
                    handle: ".s-drag-handle",
                    height: "auto",
                    cancel: ".s-cancel"
                }),
                jQuery(P.popupBox).tip(),
                jQuery(document).on("click", "#lnk-see-other-bookings a, a.s-transaction-link-other-booking", function(e) {
                    e.preventDefault(),
                    e.stopPropagation();
                    var e = jQuery(this)
                      , o = e.attr("data-bookingId")
                      , t = e.attr("data-businessId")
                      , e = e.attr("data-booking-popup-view");
                    null != e && "" != e && (e = parseInt(e)),
                    eviivo.component.flyout.hideAllFlyouts(),
                    n(o, e, t)
                })
            },
            showViewBookingPopup: be,
            showModifyBookingPopup: function(e) {
                be(e.modifyItemId, getBookingViewTypes().Modify, null, e.onCloseCallback, e.startDateOverride, e.roomIdOverride, e.refreshStartDate, e.refreshEndDate, e.refreshRoomId)
            },
            setDiaryGridSettings: function(e) {
                P = $.extend(P, e)
            },
            updateOrderBookings: me,
            getBookingViewTypes: getBookingViewTypes,
            showViewBookingPopupByBusinessId: n,
            showViewBookingPopupByBusinessIdWithOnCloseCallback: function(e, o, t, a) {
                be(e, o, null, a, null, null, null, null, null, t)
            },
            onShow: function() {
                P.isCurrentlyShowing = !0,
                So.on("click", X),
                w.prop("disabled", !0),
                I.attr("disabled", "disabled")
            },
            onClose: function() {
                !0 === b.isMultiRoomBooking() && So.off("click"),
                P.isCurrentlyShowing = !1,
                1 == O && me(!0),
                "function" == typeof P.onCloseCallback && P.onCloseCallback(),
                O = !1,
                vo.hide(),
                e = $(".s-financial"),
                t = [P.resources.labelTotal, P.resources.labelPaid, P.resources.labelBalance, P.resources.labelDueNow, P.resources.labelTotal, P.resources.labelPaid, P.resources.labelBalance, P.resources.labelDueNow],
                e.html(""),
                $("<div />", {
                    class: "financial-summary"
                }).appendTo(e).append($("<div />", {
                    class: "amounts temp-height"
                }).append($("<span /> <span /> <span /> <span />"))),
                e.find(".amounts > span").each(function(e) {
                    var o = $(this)
                      , e = t[e];
                    o.addClass("spinner-container"),
                    $("<span />", {
                        class: "spinner small-spinner no-background light-spinner active"
                    }).appendTo(o).append($("<span />", {
                        class: "position-spinner temp-inline",
                        html: "<label>" + e + ':</label> <span class="spin"></span>'
                    }))
                });
                var t, e = eviivo.util.safeFunction("eviivo.pms.diary.gridNavigation.resetHandlers");
                null != e && e(),
                Ne(),
                P.popupBox.find("#propertyNameValue").length && Ve(!1),
                0 < $(".s-info-container").length && eviivo.pms.conversations.info.load(!0)
            },
            onShowTransferBooking: function() {
                P.isCurrentlyShowing = !0
            },
            onCloseTransferBooking: function() {
                $("#popup-transfer-booking-cancel").off("click"),
                $("#popup-transfer-booking-accept").off("click"),
                P.isCurrentlyShowing = !1,
                $.isFunction(P.onActionCallback) && P.onActionCallback(b.startDate());
                var e = eviivo.util.safeFunction("eviivo.pms.diary.gridNavigation.resetHandlers");
                null != e && e()
            },
            getBookingViewModel: getBookingViewModel,
            getBookingDataOnly: function(e, o, t) {
                "function" == typeof t && (nt = t),
                u(e, !0, null, null, null, null, null, null, null, o)
            },
            getBooking: u,
            resetGridHandlers: Ne
        })
    },
    3611: function() {
        function e(e, o) {
            e.html(o).val(e.data("selectedvalue"))
        }
        function o(e) {
            var o = d.find("select");
            o.val(o.find("option:first-child").val()),
            v.newBookingContainer.find(":input").val(""),
            v.lockables.prop("disabled", !1),
            v.updateContactButton.prop("checked", !1).prop("disabled", !1),
            s(),
            v.bookingNotes.val(""),
            v.guestNotes.val(""),
            v.guestAllowMarketing.val(!1),
            l(u.surname).removeClass("input-validation-error")
        }
        function t(e) {
            var o = l(this);
            l(o.data("target")).val(o.is(":checked"))
        }
        function a(e) {
            i(l(this))
        }
        function i(e) {
            v.confirmEmail.is(":disabled") && 0 < e.val().length && v.confirmEmail.prop("disabled", !1),
            0 === e.val().length && (v.confirmEmail.prop("disabled", !0),
            v.confirmEmail.prop("checked", !1))
        }
        function n(e) {
            var o = l(this);
            0 < v.guestId.val() && v.lockables.prop("disabled", !1),
            o.attr("readOnly", "readOnly")
        }
        function s(e) {
            v.updateContactButton.is(":checked") ? (v.isInContactList.val(!0),
            v.resetButton.removeAttr("disabled"),
            0 < v.guestId.val() && v.unlockButton.removeAttr("disabled")) : (v.isInContactList.val(!1),
            v.resetButton.attr("disabled", "disabled"),
            v.unlockButton.attr("disabled", "disabled"))
        }
        var r, l, d, c, u, v, p, g;
        window.eviivo = window.eviivo || {},
        window.eviivo.eagle = window.eviivo.eagle || {},
        window.eviivo.eagle.booking = window.eviivo.eagle.booking || {},
        window.eviivo.eagle.booking.guest = window.eviivo.eagle.booking.guest || {},
        window.eviivo.eagle.booking.guest = (c = {
            resources: {
                EmailConfirmationError: "You have to provide an email address if you want to send a confirmation email",
                AddToContactText: null,
                AddedToContactText: null
            }
        },
        u = {
            titleId: "#Booking-Guest-TitleId",
            languageList: "#Booking-Guest-Language",
            guestMessage: "#Booking-Guest-Message",
            email: "#Booking-Guest-Email",
            confirmEmail: "#Booking-Guest-Confirm-Email",
            form: "#guest-new-booking-form",
            surname: "#Booking-Guest-Surname",
            forename: "#Booking-Guest-Forename",
            telephone: "#Booking-Guest-Phone",
            guestId: "#Booking-Guest-Id",
            isInContactList: "#Booking-Guest-IsInContactList",
            lockables: ".s-lock",
            unlockButton: "#btnUnlockGuest",
            resetButton: "#btnClearGuest",
            updateContactButton: "#cbIsInContactList",
            contactLabel: "#s-contact-label",
            bookingNotes: "#add-booking-note",
            newBookingContainer: "#new-booking-container",
            guestNotes: "#guest-notes",
            guestAllowMarketing: "#guest-allow-marketing",
            businessSelector: "#add-booking .s-d-bus"
        },
        v = {
            titleId: null,
            languageList: null,
            guestMessage: null,
            email: null,
            confirmEmail: null,
            surname: null,
            forename: null,
            telephone: null,
            lockables: null,
            guestId: null,
            isInContactList: null,
            unlockButton: null,
            resetButton: null,
            updateContactButton: null,
            contactLabel: null,
            bookingNotes: null,
            newBookingContainer: null,
            searchBar: null,
            comboBox: null,
            guestNotes: null,
            guestAllowMarketing: null,
            businessSelector: null
        },
        p = null,
        g = "eviivo.eagle.booking.guest",
        {
            init: function(e) {
                if ("function" != typeof window.jQuery)
                    throw "eviivo.eagle.booking.guest: module depends on jQuery";
                if ("undefined" == typeof eviivo || void 0 === eviivo.webcore || void 0 === eviivo.util)
                    throw "eviivo.eagle.booking.guest: module depends on eviivo.util";
                l = window.jQuery,
                r = l.extend(c, e),
                p = {
                    click: eviivo.util.namespacedEvent("click", g),
                    change: eviivo.util.namespacedEvent("change", g),
                    keyup: eviivo.util.namespacedEvent("keyup", g)
                }
            },
            formData: function() {
                v.lockables.prop("disabled", !1);
                var e = eviivo.util.serializeAsJson(d)
                  , o = eviivo.webcore.summernote.extractEditorContent(v.guestMessage);
                return e["Booking-Guest-Message"] = o,
                e
            },
            isValid: function() {
                return eviivo.eagle.booking.guest.validation.isFormValid()
            },
            initForm: function() {
                if ("undefined" == typeof eviivo || void 0 === eviivo.pms || void 0 === eviivo.pms.businessSettingsAndDefaultMessages)
                    throw "eviivo.eagle.booking.guest: module depends on window.eviivo.pms.businessSettingsAndDefaultMessages";
                if (void 0 === eviivo.eagle.booking.guest.validation)
                    throw "eviivo.eagle.booking.guest: module depends on eviivo.eagle.booking.guest.validation";
                d = l(u.form),
                v.titleId = l(u.titleId),
                v.languageList = l(u.languageList),
                v.guestMessage = l(u.guestMessage),
                v.confirmEmail = l(u.confirmEmail),
                v.email = l(u.email),
                v.guestId = l(u.guestId),
                v.isInContactList = l(u.isInContactList),
                v.lockables = l(u.lockables),
                v.unlockButton = l(u.unlockButton),
                v.resetButton = l(u.resetButton),
                v.updateContactButton = l(u.updateContactButton),
                v.contactLabel = l(u.contactLabel),
                v.bookingNotes = l(u.bookingNotes),
                v.newBookingContainer = l(u.newBookingContainer),
                v.guestNotes = l(u.guestNotes),
                v.guestAllowMarketing = l(u.guestAllowMarketing),
                v.businessSelector = l(u.businessSelector),
                null == v.searchBar && (v.searchBar = eviivo.webcore.autocomplete.initSearchBar({
                    id: "AddBookingContactsSearch",
                    actions: {
                        extraFormData: eviivo.eagle.basePageModelState.dataExtractor.languageBusiness,
                        onSelectItem: eviivo.eagle.booking.guest.populateGuestDetails
                    }
                })),
                null == v.comboBox && (v.comboBox = eviivo.webcore.ajaxCombobox.initSearchBar({
                    id: "Booking-Guest-Group",
                    url: eviivo.eagle.urls.guests.groupReferenceSearch,
                    requestData: {
                        businessId: 0 !== v.businessSelector.length ? parseInt(v.businessSelector.val()) : eviivo.eagle.basePageModelState.businessId
                    }
                })),
                v.languageList.off(p.change),
                e(v.titleId, eviivo.webcore.staticData.htmlOptions.titles),
                e(v.languageList, eviivo.webcore.staticData.htmlOptions.availableGuestLanguages),
                v.confirmEmail.on(p.change, t),
                v.email.on(p.keyup, a),
                v.resetButton.on(p.click, o),
                v.unlockButton.on(p.click, n),
                v.updateContactButton.on(p.change, s),
                v.languageList.on(p.change, function(e) {
                    eviivo.eagle.booking.guestMessage.setConfirmationMessage(e, v.guestMessage)
                }),
                eviivo.eagle.booking.guest.validation.init({
                    form: u.form,
                    resources: {
                        EmailConfirmationError: r.resources.EmailConfirmationError
                    }
                }),
                null != v.searchBar && v.searchBar.elements.searchInput.val(""),
                v.confirmEmail.prop("checked", !1),
                v.confirmEmail.prop("disabled", !0),
                v.confirmEmail.trigger("change"),
                o()
            },
            populateGuestDetails: function(e, o) {
                null != v.forename && null != v.surname && !v.telephone || (v.forename = l(u.forename),
                v.surname = l(u.surname),
                v.telephone = l(u.telephone)),
                null != o.TitleId && v.titleId.val(o.TitleId),
                null != o.LanguageCultureCode && v.languageList.val(o.LanguageCultureCode),
                v.forename.val(o.FirstName),
                v.surname.val(o.LastName),
                v.telephone.val(o.Phone),
                eviivo.component.form.telephone.setValue("#tel-mask_PhoneNumber", "#guest-new-booking-form", o.Phone),
                v.email.val(o.Email),
                null != o.Email && i(v.email),
                v.guestId.val(o.Id),
                v.guestNotes.val(o.Notes),
                v.guestAllowMarketing.val(o.AllowMarketingComms),
                v.comboBox.elements.searchInput.val(o.CompanyOrGroup),
                v.isInContactList.val(!0),
                v.updateContactButton.prop("checked", !0),
                v.updateContactButton.prop("disabled", !0),
                v.lockables.prop("disabled", !0),
                s(),
                eviivo.eagle.booking.guestMessage.setConfirmationMessage(e, v.guestMessage, o.LanguageCultureCode)
            }
        })
    },
    4817: function() {
        function a() {
            0 === l.surname.val().length ? (l.addToContacts.prop("disabled", !0),
            l.addToContacts.parent().addClass("disabled")) : (l.addToContacts.prop("disabled", !1),
            l.addToContacts.parent().removeClass("disabled"))
        }
        var i, n, s, r, l, d, c;
        window.eviivo = window.eviivo || {},
        window.eviivo.eagle = window.eviivo.eagle || {},
        window.eviivo.eagle.booking = window.eviivo.eagle.booking || {},
        window.eviivo.eagle.booking.guest = window.eviivo.eagle.booking.guest || {},
        window.eviivo.eagle.booking.guest.validation = window.eviivo.eagle.booking.guest.validation || {},
        window.eviivo.eagle.booking.guest.validation = (s = {
            form: null,
            resources: {
                EmailConfirmationError: null
            }
        },
        r = {
            email: 150,
            name: 150,
            surname: 150,
            phone: 40
        },
        l = {
            name: null,
            surname: null,
            email: null,
            phoneNumber: null,
            emailToBeSent: null,
            form: null,
            addToContacts: null
        },
        d = {
            name: "#Booking-Guest-Forenamee",
            surname: "#Booking-Guest-Surname",
            email: "#Booking-Guest-Email",
            phoneNumber: "#Booking-Guest-Phone",
            emailToBeSent: "#Booking-Guest-Confirm-Email",
            addToContacts: "#cbIsInContactList"
        },
        c = "error",
        {
            init: function(e) {
                if ("function" != typeof window.jQuery)
                    throw "eviivo.eagle.booking.guest.validation: module depends on jQuery";
                if (n = window.jQuery,
                i = n.extend(s, e),
                l.form = n(i.form),
                null === l.form)
                    throw "eviivo.eagle.booking.guest.validation: module depends on form id";
                var o;
                function t() {
                    a()
                }
                l.name = n(d.name),
                l.surname = n(d.surname),
                l.email = n(d.email),
                l.phoneNumber = n(d.phoneNumber),
                l.emailToBeSent = n(d.emailToBeSent),
                l.addToContacts = n(d.addToContacts),
                l.name.attr("maxLength", r.name),
                l.surname.attr("maxLength", r.surname),
                l.email.attr("maxLength", r.email),
                l.phoneNumber.attr("maxLength", r.phone),
                jQuery.validator.addMethod("phoneNumber", function(e, o) {
                    return this.optional(o) || eviivo.eagle.constants.regEx.phoneNumber.test(e)
                }),
                jQuery.validator.addMethod("email", function(e, o) {
                    return this.optional(o) || eviivo.eagle.constants.regEx.email.test(e)
                }),
                l.form.validate({
                    ignore: "",
                    errorPlacement: function() {
                        return !0
                    },
                    errorClass: c,
                    onfocusout: !1
                }),
                l.surname.rules("add", {
                    required: !0
                }),
                l.phoneNumber.rules("add", {
                    phoneNumber: !0
                }),
                l.email.rules("add", {
                    email: !0,
                    required: {
                        param: !0,
                        depends: function() {
                            return n(d.emailToBeSent).is(":checked")
                        }
                    }
                }),
                a(),
                l.surname.on("keyup change", function() {
                    clearTimeout(o),
                    l.surname.val() ? o = setTimeout(t, 400) : a()
                })
            },
            isFormValid: function() {
                return l.emailToBeSent.is(":checked") && !l.email.valid() && eviivo.webcore.notifier.show({
                    type: eviivo.webcore.notifier.types.warn,
                    message: i.resources.EmailConfirmationError,
                    autoHide: !1
                }),
                l.form.valid()
            }
        })
    },
    8869: function() {
        var i, n, s, r, l;
        window.eviivo = window.eviivo || {},
        window.eviivo.eagle = window.eviivo.eagle || {},
        window.eviivo.eagle.booking = window.eviivo.eagle.booking || {},
        window.eviivo.eagle.booking.guestMessage = window.eviivo.eagle.booking.guestMessage || {},
        window.eviivo.eagle.booking.guestMessage = (s = {
            businessSelector: ".s-d-bus",
            guestMessage: "#Booking-Guest-Message"
        },
        l = !(r = {
            businessSelector: null,
            guestMessage: null
        }),
        {
            setConfirmationMessage: function(e, o, t) {
                var a;
                null == i && (i = window.jQuery),
                null == n && (n = eviivo.util.safeFunction("eviivo.pms.businessSettingsAndDefaultMessages.getConfirmationGuestMessage")),
                null == r.guestMessage && (r.guestMessage = i(s.guestMessage)),
                null == r.businessSelector && (r.businessSelector = i(s.businessSelector)),
                null == o && (o = r.guestMessage),
                null != n && (a = 0 !== r.businessSelector.length ? parseInt(r.businessSelector.val()) : eviivo.eagle.basePageModelState.businessId,
                e = function(e, o) {
                    if (null == e && null == o)
                        return eviivo.eagle.basePageModelState.userCultureCode;
                    var t = null;
                    null != e && null == o && void 0 === (t = i(e.target).val()) && (t = null);
                    null != o && null == t && (t = o);
                    null == t && (t = eviivo.eagle.basePageModelState.userCultureCode);
                    return t
                }(e, t),
                t = eviivo.util.decodedHtml(n(a, e)),
                0 == l ? (o.val(t),
                a = o,
                eviivo.webcore.summernote.create({
                    container: a,
                    displayMode: eviivo.webcore.summernote.displayModes.toolbarWithVariables,
                    text: a.val()
                }),
                l = !0) : eviivo.webcore.summernote.setEditorContent(o, t))
            }
        })
    },
    5847: function() {
        function H(e) {
            if (v.removeClass("hide"),
            u.addClass("hide").removeClass("active"),
            v.html(e),
            (C = jQuery("#copy-message-btn")).on("click", X),
            (k = jQuery("#launch-whatsapp-btn")).on("click", Y),
            (sendEmailBtn = jQuery("#send-email-btn")).on("click", r),
            p = jQuery("#guest-email-message"),
            g = jQuery("#comms-guest-message"),
            h = jQuery("#email-template-select"),
            m = jQuery("#template-recipient-select"),
            f = jQuery("#guest-id-select"),
            ne = jQuery("#guest-contact-details"),
            j = JSON.parse(jQuery("#EmailGuestMessageDictionary").val()),
            N = JSON.parse(jQuery("#TextGuestMessageDictionary").val()),
            A = JSON.parse(jQuery("#GuestPhoneMappings").val()),
            O = JSON.parse(jQuery("#GuestEmailMappings").val()),
            b = jQuery("#email-guest-message-container"),
            y = jQuery("#comms-guest-message-container"),
            se = jQuery("#sent-emails-container"),
            T = jQuery("#adhoc-description"),
            I = jQuery("#custom-amount-input"),
            re = jQuery("#converted-amount"),
            x = jQuery("#payments-validation-summary"),
            le = $("#adhoc-div"),
            de = $("#adhoc-div .input-attachment"),
            i(),
            m.on("change", function(e) {
                i()
            }),
            f.on("change", function(e) {
                i();
                var o = h.val();
                n(N[o])
            }),
            null != ce && h.val(ce),
            j[h.val()] ? (e = J(h.val()),
            p.val(e),
            b.removeClass("hidden")) : b.addClass("hidden"),
            eviivo.webcore.summernote.create({
                container: p,
                displayMode: eviivo.webcore.summernote.displayModes.toolbarWithVariables,
                placeholderText: B.resources.EmailConfirmationPlaceHolder,
                text: p.val()
            }),
            eviivo.webcore.summernote.create({
                container: g,
                displayMode: eviivo.webcore.summernote.displayModes.toolbarOnlyVariables,
                placeholderText: B.resources.EmailConfirmationPlaceHolder,
                text: g.val(),
                placeholderRestrictionFunc: F
            }),
            h.on("change", function(e) {
                var o, t, a = h.val();
                N[a] ? (W(a, g, y),
                n(!0)) : (W(a, p, b),
                n(!1)),
                i(),
                a = a,
                o = JSON.parse($("#AdhocTemplateEmailIds").val()),
                t = $(".s-converted-amount"),
                I.val(""),
                T.val(""),
                o.includes(a) ? (le.removeClass("hide"),
                o = $("#custom-amount-label"),
                a = B.resources.EmailCustomAmountLabel,
                o.text(a),
                s(c) ? t.addClass("hide") : t.removeClass("hide")) : le.addClass("hide")
            }),
            I.on("keyup", U),
            (sendEmailBtn = jQuery("#send-email-btn")).on("click", r),
            0 == document.querySelectorAll("#view-booking-flyout .cp-flyout_footer #comms-footer-buttons").length)
                for (var o = document.querySelectorAll("#view-booking-flyout #comms-footer-buttons"), t = document.querySelector("#view-booking-flyout .cp-flyout_footer"), a = 0; a < o.length; a++)
                    t.appendChild(o[a]);
            else
                $("#list-table-emails #comms-footer-buttons").remove(),
                (C = jQuery("#copy-message-btn")).off().on("click", X),
                (k = jQuery("#launch-whatsapp-btn")).off().on("click", Y),
                (sendEmailBtn = jQuery("#send-email-btn")).off().on("click", r),
                C.addClass("hidden"),
                k.addClass("hidden"),
                sendEmailBtn.removeClass("hidden");
            e = eviivo.eagle.viewBookingPopup.getBookingViewModel();
            eviivo.component.handlers.isFunction("eviivo.pms.conversations.commsTab.load") && eviivo.pms.conversations.commsTab.load({
                businessId: D,
                orderId: P,
                bookingId: bookingId,
                bookingReference: e.BookingReferenceNumber,
                orderReference: e.Order.OrderReference,
                isOta: e.Order.IsOTA,
                propertyShortName: e.BusinessShortName,
                propertyName: e.BusinessName,
                distributorShortName: e.Order.DistributorShortName,
                source: e.Order.Source,
                roomId: e.RoomId,
                roomTypeId: e.RoomTypeId,
                guestId: e.Guest.Id,
                channelReference: e.Order.ChannelReference,
                orderSourceCode: e.Order.SourceTypeCode,
                externalReferenceId: e.Order.ChannelReference
            }),
            G()
        }
        function F(e) {
            return null != e && e.forEach(function(e) {
                e.Items = e.Items.filter(function(e, o, t) {
                    return "onlinecheckinurl" == e.Key
                })
            }),
            e
        }
        function G() {
            var e = $(R.emailTable);
            function o() {
                return null != E ? JSON.parse(E) : [[3, "desc"]]
            }
            e.on("click", R.deleteScheduledEmail, V),
            e.on("click", R.pause, Q),
            e.on("click", R.resume, L),
            e.on("click", R.view, eviivo.pms.email.flyout.load),
            e.hasClass("dataTable") ? e.dataTable({
                order: o()
            }) : e.DataTable({
                order: o(),
                paging: !1,
                info: !1,
                bAutoWidth: !1,
                searching: !1,
                columnDefs: [{
                    targets: 4,
                    orderable: !1
                }],
                stateSave: !0,
                stateSaveCallback: function(e, o) {
                    E = JSON.stringify(o.order)
                }
            })
        }
        function Q() {
            var e = t($(this));
            "" != e.Id && eviivo.webcore.ajaxHelper.executeAjax({
                actionId: "pause-scheduled-email-".concat(e.Id),
                url: "".concat(eviivoSuiteApp, "/api/emails/pause-schedule-email"),
                method: eviivo.webcore.ajaxHelper.methods.POST,
                data: e,
                contentType: eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                callback: function(e) {
                    e && a()
                }
            })
        }
        function L() {
            var e = t($(this));
            "" != e.Id && eviivo.webcore.ajaxHelper.executeAjax({
                actionId: "resume-scheduled-email-".concat(e.Id),
                url: "".concat(eviivoSuiteApp, "/api/emails/resume-schedule-email"),
                method: eviivo.webcore.ajaxHelper.methods.POST,
                data: e,
                contentType: eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                callback: function(e) {
                    e && a()
                }
            })
        }
        function V() {
            var e, o;
            e = $(this),
            o = B.resources.DeleteConfirmationMsg,
            eviivo.webcore.notifier.show({
                type: eviivo.webcore.notifier.types.info,
                style: eviivo.webcore.notifier.styles.withTwoActions,
                message: o,
                autoHide: eviivo.webcore.notifier.delays.long,
                buttonTwo: B.resources.DeleteConfirmationYes,
                buttonOne: B.resources.DeleteConfirmationNo,
                selector: e,
                position: eviivo.webcore.notifier.positions.bottomLeft
            }),
            $(R.confirmationNotifierBtnOne).addClass("btn btn-secondary"),
            $(R.confirmationNotifierBtnTwo).addClass("btn btn-right s-delete"),
            $(R.deleteConfirmed).on("click", _)
        }
        function t(e) {
            var e = e.parents("tr").attr("data-id")
              , o = eviivo.eagle.viewBookingPopup.getBookingViewModel()
              , t = o.BusinessShortName
              , o = o.Order.OrderReference;
            return {
                Id: e,
                BusinessId: D,
                BusinessShortname: t,
                OrderReference: o
            }
        }
        function _() {
            var o = $(this)
              , e = t(o);
            "" != e.Id && eviivo.webcore.ajaxHelper.executeAjax({
                actionId: "delete-scheduled-email-".concat(e.Id),
                url: "".concat(eviivoSuiteApp, "/api/emails/delete-schedule-email"),
                method: eviivo.webcore.ajaxHelper.methods.POST,
                data: e,
                contentType: eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                callback: function(e) {
                    e ? $("#".concat(o.parents(".email-list-table").attr("id"))).DataTable().row(o.parents("tr")).remove().draw() : (a(),
                    eviivo.webcore.notifier.show({
                        type: eviivo.webcore.notifier.types.error,
                        message: eviivo.eagle.translations.resources.notify.genericErrorMessage
                    }))
                },
                failCallback: function() {
                    eviivo.webcore.notifier.show({
                        type: eviivo.webcore.notifier.types.error,
                        message: eviivo.eagle.translations.resources.notify.genericErrorMessage
                    })
                }
            })
        }
        function U() {
            re.val(function(e) {
                {
                    var o, t;
                    return s(c) || 0 === e.trim().length ? "" : (e = Globalize.parseNumber(e),
                    o = c.ConversionRate,
                    t = c.QuoteCurrency.ISOCode,
                    e = eviivo.webcore.decimals.precisionPointMultiplication(e, o),
                    Globalize.formatCurrency(e, t))
                }
            }($(this).val()));
            var e = jQuery.extend(!0, {}, B.resources.validation)
              , o = (e["amount-input"].max = e["amount-input"].max.format(de.text() + M),
            !1)
              , t = I.val().trim();
            "" === t && (o = !0),
            (isNaN(M) || M <= 0) && (hasErrors = !0),
            !1 === o && (t = Globalize.parseNumber(t),
            !1 === (o = isNaN(t) || t <= 0 ? !0 : o) && M < t ? ((t = x.empty().append("<ul></ul>").find("ul")).append("<li>" + e["amount-input"].max + "</li>"),
            x.html(t),
            o = !0,
            x.toggle(!0)) : x.toggle(!1)),
            o ? $(I).addClass("input-validation-error").removeClass("input-validation-valid") : (x.empty(),
            $(I).addClass("input-validation-valid").removeClass("input-validation-error"))
        }
        function i() {
            jQuery("#comms-footer-buttons #send-email-btn").removeAttr("disabled");
            var e, o, t, a = "", i = jQuery("#send-new-email-order-source"), i = 0 < i.length && i.val() == ue;
            a = N[h.val()] ? 0 == f.find("option").length ? "" : (o = f.find(":selected").val(),
            t = O[o],
            e = A[o],
            s(t) ? q(i) : s(e) ? t : z(e) ? "".concat(t, ", ").concat(e) : eviivo.component.form.telephone.getValidationError(e)) : (o = m.find(":selected").val(),
            s(t = O[o]) ? q(i) : t),
            ne.text(a)
        }
        function q(e) {
            var o = B.resources.EmailsNoGuestsWithEmail;
            return e ? o = "".concat(o, " ").concat(B.resources.EmailsSentViaGuestMessaging) : jQuery("#comms-footer-buttons #send-email-btn").attr("disabled", "disabled"),
            o
        }
        function a() {
            u.removeClass("hide").addClass("active"),
            eviivo.webcore.ajaxHelper.executeAjax({
                actionId: "viewEmails.RefreshEmails",
                url: eviivo.eagle.urls.emails.RefreshEmails,
                method: eviivo.webcore.ajaxHelper.methods.GET,
                data: {
                    cultureCode: S,
                    businessId: D,
                    orderId: P
                },
                contentType: eviivo.webcore.ajaxHelper.contentTypes.TEXT_HTML,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.HTML,
                callback: e
            })
        }
        function e(e) {
            u.addClass("hide").removeClass("active"),
            se.html(e),
            G()
        }
        function J(e) {
            return eviivo.util.safeFunction("eviivo.pms.businessSettingsAndDefaultMessages.getGuestMessageById")(D, S, e)
        }
        function W(e, o, t) {
            j[e] ? (e = eviivo.webcore.summernote.customTagsCodeToDisplayText(J(e)),
            eviivo.webcore.summernote.setHTMLContents(o, e),
            o.val(e),
            t.removeClass("hidden")) : t.addClass("hidden")
        }
        function n(e) {
            e ? (b.addClass("hidden"),
            sendEmailBtn.addClass("hidden"),
            m.addClass("hidden"),
            C.removeClass("hidden"),
            k.removeClass("hidden"),
            f.removeClass("hidden"),
            y.removeClass("hidden"),
            e = f.find(":selected").val(),
            z(A[e]) ? k.removeAttr("disabled") : k.attr("disabled", !0)) : (C.addClass("hidden"),
            k.addClass("hidden"),
            f.addClass("hidden"),
            y.addClass("hidden"),
            j[h.val()] && b.removeClass("hidden"),
            sendEmailBtn.removeClass("hidden"),
            m.removeClass("hidden"))
        }
        function s(e) {
            return null == e || "" == e || null == e
        }
        function z(e) {
            return !s(e) && eviivo.component.form.telephone.validateNumber(e)
        }
        function r() {
            var e, o, t, a;
            0 == 0 < $("#list-table-emails").find(".input-validation-error").length && (e = h.val(),
            a = m.find(":selected").val(),
            o = m.find(":selected").text(),
            t = s(t = O[a]) ? null : t,
            sendEmailBtn.removeClass().addClass("btn btn-right btn-save-widget btn-saving"),
            eviivo.webcore.ajaxHelper.executeAjax({
                actionId: "emails.SendEmail",
                url: eviivo.eagle.urls.emails.SendEmail,
                method: eviivo.webcore.ajaxHelper.methods.POST,
                data: {
                    BusinessId: D,
                    OrderId: P,
                    GuestMessage: eviivo.webcore.summernote.customTagsDisplayTextToCode(p.val()),
                    EmailId: e,
                    CultureCode: S,
                    GuestId: a,
                    GuestEmailAddress: t,
                    GuestName: o,
                    EmailType: (a = e,
                    eviivo.util.safeFunction("eviivo.pms.businessSettingsAndDefaultMessages.getEmailType")(D, a)),
                    CustomDescription: T.val(),
                    CustomAmountValue: Globalize.parseNumber(I.val())
                },
                contentType: eviivo.webcore.ajaxHelper.contentTypes.URL_ENCODED_UTF8,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                callback: K,
                failCallback: Z
            }))
        }
        function X() {
            C.removeClass().addClass("btn btn-left btn-save-widget btn-saving"),
            w = "#",
            eviivo.webcore.ajaxHelper.executeAjax({
                actionId: "guest.GetShortenedOnlineCheckInUrl",
                url: eviivo.eagle.urls.guests.getShortenedOnlineCheckInUrl,
                method: eviivo.webcore.ajaxHelper.methods.POST,
                data: {
                    OrderId: P,
                    GuestId: f.find(":selected").val(),
                    BusinessId: D
                },
                contentType: eviivo.webcore.ajaxHelper.contentTypes.URL_ENCODED_UTF8,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                callback: ee,
                failCallback: oe
            })
        }
        function Y() {
            var e = f.find(":selected").val()
              , o = A[e];
            k.removeClass().addClass("btn btn-right btn-save-widget btn-saving"),
            w = "#",
            eviivo.webcore.ajaxHelper.executeAjax({
                actionId: "guest.GetShortenedOnlineCheckInUrl",
                url: eviivo.eagle.urls.guests.getShortenedOnlineCheckInUrl,
                method: eviivo.webcore.ajaxHelper.methods.POST,
                data: {
                    OrderId: P,
                    GuestId: e,
                    GuestPhoneNumber: o,
                    BusinessId: D
                },
                contentType: eviivo.webcore.ajaxHelper.contentTypes.URL_ENCODED_UTF8,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                callback: te,
                failCallback: ae
            })
        }
        function K(e) {
            a(),
            null == e || 0 != e ? l(sendEmailBtn, "btn btn-right btn-save-widget", B.resources.SendEmailSuccess) : d(sendEmailBtn, "btn btn-right btn-save-widget", B.resources.SendEmailFailure)
        }
        function Z() {
            a(),
            d(sendEmailBtn, "btn btn-right btn-save-widget", B.resources.SendEmailFailure)
        }
        function ee(e) {
            var o;
            null == e || 0 != e ? (w = e,
            e = ie(!1),
            e = e,
            o = document.createElement("input"),
            document.body.appendChild(o),
            o.setAttribute("id", "copyToClip"),
            document.getElementById("copyToClip").value = e,
            o.select(),
            o.setSelectionRange(0, e.length),
            document.execCommand("copy"),
            document.body.removeChild(o),
            l(C, "btn btn-left btn-save-widget", B.resources.CopyMessageSuccess)) : d(C, "btn btn-left btn-save-widget", B.resources.CopyMessageFailure)
        }
        function oe() {
            d(C, "btn btn-left btn-save-widget", B.resources.SendEmailFailure)
        }
        function te(e) {
            var o, t;
            null == e || 0 != e ? (w = e,
            e = f.find(":selected").val(),
            o = "+" == (o = A[e].replace(/\s/g, "")).charAt(0) ? o : "+" + o,
            t = ie(!0),
            eviivo.webcore.ajaxHelper.executeAjax({
                actionId: "guest.registerOnlineCheckInOrderEvent",
                url: eviivo.eagle.urls.guests.registerOnlineCheckInOrderEvent,
                method: eviivo.webcore.ajaxHelper.methods.POST,
                data: {
                    OrderId: P,
                    GuestId: e,
                    GuestPhoneNumber: o,
                    BusinessId: D,
                    GuestMessage: t
                },
                contentType: eviivo.webcore.ajaxHelper.contentTypes.URL_ENCODED_UTF8,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                callback: function(e) {}
            }),
            e = encodeURIComponent(t),
            t = k.attr("data-url") + o + "?text=" + e,
            window.open(t, "_blank"),
            a(),
            l(k, "btn btn-right btn-save-widget", B.resources.LaunchWhatsAppSuccess)) : d(k, "btn btn-right btn-save-widget", B.resources.LaunchWhatsAppFailure)
        }
        function ae() {
            a(),
            d(k, "btn btn-right btn-save-widget", B.resources.SendEmailFailure)
        }
        function ie(e) {
            var o = eviivo.webcore.summernote.customTagsDisplayTextToCode(g.val()).replace(/\[\(\bonlinecheckinurl\b\)\]/g, w);
            return e ? o.replace(/<p>|<\/p>|<br>|<br\/>/g, "\r\n") : o.replace(/<p>|<\/p>|<br>|<br\/>/g, "\n")
        }
        function l(e, o, t) {
            e.removeClass().addClass(o),
            e.prop("disabled", !1),
            eviivo.webcore.notifier.show({
                type: eviivo.webcore.notifier.types.success,
                message: t
            })
        }
        function d(e, o, t) {
            e.removeClass().addClass(o),
            e.prop("disabled", !1),
            eviivo.webcore.notifier.show({
                type: eviivo.webcore.notifier.types.error,
                message: t
            })
        }
        var c, u, v, p, g, m, f, ne, h, b, y, se, C, k, w, I, re, T, x, le, de, B, S, D, P, ce, j, N, A, O, o, M, ue, R, E;
        window.eviivo = window.eviivo || {},
        window.eviivo.eagle = window.eviivo.eagle || {},
        window.eviivo.eagle.email = window.eviivo.eagle.email || {},
        window.eviivo.eagle.email.listing = window.eviivo.eagle.email ? window.eviivo.eagle.email.listing : {},
        window.eviivo.eagle.email.listing = (ue = "airbnb",
        R = {
            emailTable: ".email-list-table",
            deleteScheduledEmail: ".s-delete-scheduled-email",
            deleteConfirmed: ".s-delete",
            confirmationNotifierBtnOne: ".btn-one",
            confirmationNotifierBtnTwo: ".btn-two",
            resume: ".s-resume-schedule",
            pause: ".s-pause-schedule",
            view: ".s-view-email"
        },
        E = null,
        {
            init: function(e) {
                B = e,
                u = jQuery("#booking-popup-spinner"),
                jQuery("#booking-popup-spinner .spinner-message").html(B.resources.StandardLoaderMessage),
                v = B.container,
                S = B.cultureCode,
                D = B.businessId,
                P = B.orderId,
                bookingId = B.bookingId,
                ce = B.selectedEmailId,
                u.removeClass("hide").addClass("active"),
                eviivo.webcore.ajaxHelper.executeAjax({
                    actionId: "viewEmails.GetEmails",
                    url: eviivo.eagle.urls.emails.Emails,
                    method: eviivo.webcore.ajaxHelper.methods.GET,
                    data: {
                        cultureCode: S,
                        businessId: D,
                        orderId: P
                    },
                    contentType: eviivo.webcore.ajaxHelper.contentTypes.TEXT_HTML,
                    dataType: eviivo.webcore.ajaxHelper.dataTypes.HTML,
                    callback: H
                })
            },
            setExchangeRate: function(e) {
                null != (o = eviivo.eagle.viewBookingPopup.getBookingViewModel().Order) ? (M = o.AmountOutstanding,
                o.Currency,
                s(e.exchangeRates) || (c = e.exchangeRates.find(function(e) {
                    return e.BaseCurrency.ISOCode == o.Currency
                }))) : console.error("eviivo.eagle.email.listing.setExchangeRate ERROR: bookingCurrency is null")
            },
            refreshEmails: a
        })
    },
    5421: function() {
        function t() {
            o()
        }
        function o() {
            0 < u.length && u.addClass("hide")
        }
        function a(e) {
            n(),
            0 == $(r.$flyout).length && ((0 < v.length ? v : $("body")).append(e),
            eviivo.webcore.ajaxHelper.executeAjax({
                actionId: "get-email-".concat(l),
                url: "".concat(eviivoSuiteApp, "/emails/getEmailDetailsByEmailId/email"),
                method: eviivo.webcore.ajaxHelper.methods.GET,
                data: {
                    emailId: l,
                    orderId: d,
                    businessId: c
                },
                contentType: eviivo.webcore.ajaxHelper.contentTypes.TEXT_HTML,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.HTML,
                callback: i,
                failCallback: t
            }))
        }
        function i(e) {
            $("".concat(r.$flyout, " ").concat(r.flyoutBody)).append(e),
            $("#email-container").find("a").attr("target", "_blank"),
            eviivo.component.flyout.updateTitle(r.flyout, ".s-heading-title", p),
            loadEmailDetailsJS(),
            o(),
            eviivo.component.flyout.showFlyout(r.flyout)
        }
        function n() {
            0 < $(r.$flyout).length && $(r.$flyout).remove()
        }
        var s, r, l, d, c, u, v, p;
        window.eviivo = window.eviivo || {},
        window.eviivo.pms = window.eviivo.pms || {},
        window.eviivo.pms.email = window.eviivo.pms.email || {},
        window.eviivo.pms.email.flyout = window.eviivo.pms.email.flyout || {},
        window.eviivo.pms.email.flyout = (s = {},
        r = {
            messagesList: "#eviivo-list-messages",
            open: ".s-open-email",
            $flyout: "#view-email",
            flyout: "view-email",
            flyoutBody: ".pms-fly-out-body",
            flyoutStack: ".cp-flyout_stacks"
        },
        p = v = u = c = d = l = null,
        {
            init: function(e) {
                s = eviivo.util.extend(s, e)
            },
            load: function() {
                var e = $(this)
                  , o = (l = e.attr("data-id"),
                c = e.attr("data-pid"),
                d = e.attr("data-orderid"),
                e.parents("tr"));
                p = "".concat(o.find("td:eq(0)").text(), " - ").concat(o.find("td:eq(1)").text()),
                v = e.closest(r.flyoutStack),
                "" != l && ((u = e.find(".s-spinner")).removeClass("hide"),
                eviivo.webcore.ajaxHelper.executeAjax({
                    actionId: "get-email-flyout-".concat(l),
                    url: "".concat(eviivoSuiteApp, "/conversations/email?emailId=").concat(l),
                    method: eviivo.webcore.ajaxHelper.methods.GET,
                    contentType: eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_HTML_UTF8,
                    dataType: eviivo.webcore.ajaxHelper.dataTypes.HTML,
                    callback: a,
                    failCallback: t
                }))
            },
            close: function() {
                p = u = c = d = null,
                setTimeout(function() {
                    n()
                }, 1e3)
            },
            resendCallback: function() {
                $(".mod-popup-close.s-close").click()
            }
        })
    },
    5511: function() {
        function _() {
            var e = $(V);
            eviivo.component.flyout.hideFlyout(e.attr("id"))
        }
        function U() {
            var e, t = jQuery("#channel-fee-percentage-reduced"), d = 0, c = 0, u = 0, v = 0, p = !1;
            function o(e) {
                var o;
                o = t,
                e ? o.show() : o.hide()
            }
            k.each(function(e, o) {
                var t, a, i, n, s, r, l, o = jQuery(o);
                !0 === o.prop("checked") && (t = null !== o.data("original-value") ? parseFloat(o.data("original-value")) : 0,
                a = null !== o.data("value") ? parseFloat(o.data("value")) : 0,
                i = null !== o.data("charges-value") ? parseFloat(o.data("charges-value")) : 0,
                n = null !== o.data("charge") ? parseFloat(o.data("charge")) / 100 : 0,
                s = null !== o.data("promotion-commission") ? parseFloat(o.data("promotion-commission")) : null,
                r = null !== o.data("commission") ? parseFloat(o.data("commission")) : 0,
                l = null !== o.data("channel-rebate") ? parseFloat(o.data("channel-rebate")) : 0,
                o = null !== o.data("charge-type") && "fx" === o.data("charge-type").toString().toLowerCase() ? null !== (o = null !== o.data("original-charge") ? parseFloat(o.data("original-charge")) / 100 : null) ? o : n : n / ((a - i) / (t - i)),
                v += o,
                d += a,
                u += n,
                s) && null !== s && 0 !== s && (c += l,
                p = !0)
            }),
            e = v < c / 100,
            o(p),
            ao.html(y.resources.ChannelCommission),
            p && (ao.html(y.resources.ReducedChannelCommission),
            e) && o(!1),
            Me.html(h(d / 100)),
            P.html(h(u)),
            D.html(h(parseFloat(D.data("paid")) / 100)),
            nonRefundableChargesTaxAmount.html(h(parseFloat(nonRefundableChargesTaxAmount.data("paid")) / 100)),
            f(u)
        }
        function m(e) {
            Ne.off(p),
            Ne.on(p, e)
        }
        function q() {
            var e;
            m(o),
            De(!1),
            Se(!1),
            d.each(function(e, o) {
                o = jQuery(o);
                o.hasClass("state-disabled") || o.hasClass("state-active") || (o.data("was-active", !0),
                o.removeClass("state-default").addClass("state-disabled"))
            }),
            xo = w.find("#step-cancellation-charge-form-display input:checked").val(),
            w.find(".cancellation-step").addClass("hide"),
            "" !== R && null !== R && (w.find(R).removeClass("hide"),
            w.find("div[id^='cancellation-charge-warning-']").addClass("hide"),
            w.find(R).find("input[type='radio']:enabled").prop("checked", !1),
            0 < (e = w.find("#cancellation-message-to-ota")).length) && e.val(H ? fo : ho),
            jQuery(".note-editable").css("height", 60),
            B.addClass("hide"),
            I.removeClass("hide"),
            i = !1,
            "function" == typeof A && (A(),
            i = !0)
        }
        function o() {
            m(_),
            De(!0),
            d.each(function(e, o) {
                o = jQuery(o);
                !0 === o.data("was-active") && (o.data("was-active", null),
                o.removeClass("state-disabled").addClass("state-default"))
            }),
            Se(!0),
            I.html(y.resources.Button_ConfirmCancellation),
            w.find(".cancellation-step").addClass("hide"),
            "" !== E && null !== E && (w.find(E).removeClass("hide"),
            w.find(E).find("input[type='radio']:enabled").prop("checked", !1),
            w.find(E).find("select,input[type='text']").val("")),
            B.removeClass("hide"),
            I.addClass("hide"),
            w.find(R).find("input[type='radio']").prop("checked", !1),
            w.find(R).find("select,input[type='text']").val(""),
            l(null, !(G = i = !1), !1, !0),
            f(null),
            "function" == typeof N ? (N(),
            i = !0) : I.removeAttr("disabled")
        }
        function J() {
            var e = $(this).data("subreason")
              , o = $(this).data("owe")
              , t = $(this).data("refund");
            if (G = !1,
            void 0 !== e)
                if (w.find("div[id^='cancellation-charge-warning-']").addClass("hide"),
                w.find("#cancellation-refund-method").attr("disabled", "disabled"),
                2 === e && w.find("#cancellation-refund-method").removeAttr("disabled"),
                w.find("#cancellation-charge-method").attr("disabled", "disabled"),
                6 === e && w.find("#cancellation-charge-method").removeAttr("disabled"),
                3 === e)
                    xo = w.find("#step-cancellation-charge-form-display input:checked").val(),
                    Ve.prop("checked", !0),
                    G = !!o,
                    l(0, !0, !1, !1),
                    f(0),
                    o ? w.find("#cancellation-charge-warning-owe-" + e).removeClass("hide") : t && w.find("#cancellation-charge-warning-refund-" + e).removeClass("hide");
                else
                    switch (o ? w.find("#step-cancellation-owe-display").removeClass("hide") : t && w.find("#step2-cancellation-refund-display").removeClass("hide"),
                    w.find("#cancellation-charge-warning-" + e).removeClass("hide"),
                    xo) {
                    case "0":
                        Le.prop("checked", !0),
                        l(x, !0, !1, !1),
                        f(x);
                        break;
                    case "2":
                        g.prop("checked", !0),
                        l(S.val(), !0, !1, !0),
                        f(S.val())
                    }
            "function" == typeof A && A()
        }
        function W() {
            e(R, t)
        }
        function z() {
            e(E, a)
        }
        function X() {
            e(R, n)
        }
        function Y() {
            e(R, s)
        }
        function K() {
            e(E, null) && r()
        }
        function e(e, o) {
            var t = !0
              , a = w.find(e).find("input[type='radio'][data-permanent-disabled!='True']").parent()
              , e = w.find(e).find("input[type='radio']:checked")
              , t = (t = 0 !== a.length && (a.removeClass("error"),
            a.find("label").removeClass("error"),
            0 === e.length && (t = !1,
            i) && (a.addClass("error"),
            a.find("label").addClass("error")),
            t) && "function" == typeof o ? o() : t) && r();
            return _e.removeAttr("disabled"),
            t || _e.attr("disabled", "disabled"),
            t
        }
        function t() {
            return "" !== Qe.val()
        }
        function a() {
            var e, o = !0;
            return S.parent().removeClass("error"),
            !0 === g.prop("checked") && (e = Globalize.parseNumber(S.val()),
            Re.removeClass("hide").addClass("hide"),
            S.trigger("focus"),
            "" === S.val() || !1 === eviivo.eagle.constants.regEx.amount.test(S.val()) || x < e || e < 0) && (o = !1,
            i) && (Re.removeClass("hide"),
            S.parent().addClass("error")),
            o
        }
        function n() {
            var e = !0
              , o = w.find("#charge-refund-2");
            return o.parent().removeClass("error"),
            !0 === o.prop("checked") && "" === w.find("#cancellation-refund-method").val() && (e = !1,
            i) && o.parent().addClass("error"),
            e
        }
        function s() {
            var e = !0
              , o = w.find("#charge-owe-6");
            return o.parent().removeClass("error"),
            !0 === o.prop("checked") && "" === w.find("#cancellation-charge-method").val() && (e = !1,
            i) && o.parent().addClass("error"),
            e
        }
        function r() {
            var e = w.find("#cancellation-reason").val();
            return null !== e && "" !== e
        }
        function Z() {
            T = !0,
            l(S.val(), !0, !0, !1),
            eviivo.webcore.decimals.fixDecimalSymbolDisplay(S[0], y.decimalSymbol)
        }
        function ee() {
            T = i = !0,
            S.trigger("focus"),
            B.attr("disabled", "disabled")
        }
        function oe() {
            T = !0;
            var e = h(0);
            P.html(e),
            O.html(e),
            M.html(e),
            $("#total-fee").text(e),
            $("#CancellationCharge").val(0),
            B.removeAttr("disabled")
        }
        function te() {
            Ce(),
            B.removeAttr("disabled")
        }
        function ae() {
            Re.removeClass("hide").addClass("hide"),
            ze.removeClass("hide").addClass("hide"),
            l(0, T = !0, !0, !1),
            f(0),
            B.removeAttr("disabled"),
            S.val("")
        }
        function ie() {
            Re.removeClass("hide").addClass("hide"),
            ze.removeClass("hide").addClass("hide"),
            Ce(),
            B.removeAttr("disabled"),
            S.val("")
        }
        function ne() {
            d.removeClass("state-active"),
            w.find("#cancellation-reason").val("")
        }
        function se() {
            i = !1;
            var e = jQuery(this);
            if (e.hasClass("state-disabled"))
                return !1;
            ne();
            e = e.data("reason");
            return Te(e, "active"),
            w.find("#cancellation-reason").val(e),
            c.addClass("hide"),
            u.removeClass("hide"),
            He.removeClass("hide"),
            ce(),
            l(null, !0, !0, !0),
            f(null),
            Ce(),
            !0
        }
        function re() {
            w.find("input[type='checkbox']").each(function(e, o) {
                o.checked && "" === jQuery(o).val() && jQuery(o).val("true")
            });
            var e = w.find("input,textarea,select").serializeObject()
              , i = (e.Notes = eviivo.webcore.summernote.customTagsDisplayTextToCode(e.Notes),
            e.OTAEmergencyCancellationMessage = {
                IsHtmlContentAllowed: !0,
                Content: e.OTAEmergencyCancellationMessage
            },
            e.CardDeclinedNotes && (e.CardDeclinedNotes = eviivo.webcore.summernote.customTagsDisplayTextToCode(e.CardDeclinedNotes)),
            w.find("#BusinessId").val());
            eviivo.webcore.popup.submitForm({
                innerContainer: So,
                actionId: "cancellation",
                url: "".concat(eviivoSuiteApp, "/").concat(eviivo.eagle.basePageModelState.userCultureCode, "/popups/SubmitCancellation"),
                data: e,
                actionSubmitFormCompleteCallback: function(e) {
                    var o = i;
                    {
                        var t, a;
                        (0 < w.find("#cancellation-reason").length && "" !== w.find("#cancellation-reason").val() ? parseInt(w.find("#cancellation-reason").val()) : L.Unknown) !== L.ForceMajeure && lo && !bo && !Co || (a = o,
                        null === (t = e)) || null === t.Data || null === t.Data.notificationMessage || "" === t.Data.notificationMessage || eviivo.eagle.floatingNotification.showGenericNotification({
                            message: t.Data.notificationMessage.Message,
                            messageType: t.Data.notificationMessage.Type,
                            actionTrigger: "#cancellation-floating-notification",
                            customAction: function() {
                                eviivo.eagle.viewBookingPopup.showViewBookingPopupByBusinessId(t.Data.selectedBookings[0], null, a)
                            },
                            resources: {
                                ClickHereToView: y.resources.ClickHereToView
                            }
                        })
                    }
                    -1 < window.location.href.indexOf("ListBookings") ? (eviivo.component.flyout.hideAllFlyouts(),
                    e.Data.refreshDiary && eviivo.eagle.diaryList.getListDetails()) : (eviivo.component.flyout.hideAllFlyouts(),
                    e.Data.refreshDiary && eviivo.eagle.gridBlock.cancelBookingElement(e.Data.selectedBookings),
                    null !== y.actions && "function" == typeof y.actions.refreshDiaryCallback && y.actions.refreshDiaryCallback(e)),
                    $(".cp-diary-bookings-grid, .cp-diary-sidebar").removeClass("active"),
                    $("#room-list li.p-row[data-id=" + i + "]").first().removeClass("active"),
                    $("#room-list li.r-row .active").removeClass("active"),
                    $("#grid-body tr.dia-tbl_row .active").removeClass("active")
                }
            })
        }
        function le() {
            "clear" === jQuery(this).data("state") ? (k.prop("checked", !1),
            de(null),
            P.html(h(0)),
            jQuery("#cancellation-refund").html(h(0)),
            f(0)) : (k.prop("checked", !0),
            de("clear")),
            ve()
        }
        function de(e) {
            var o = "clear" === e;
            Pe.data("state", e),
            Pe.prop("checked", o)
        }
        function ce() {
            o = C.find("input:checked").length,
            w.find(".selected-options").html(o),
            (e = 0 === (e = u.find("input[type='radio'][data-permanent-disabled!='True']")).length ? He.find("input[type='radio'][data-permanent-disabled!='True']") : e).removeAttr("disabled"),
            0 === o ? (_e.attr("disabled", "disabled"),
            e.attr("disabled", "disabled").prop("checked", !1),
            S.val(""),
            $e.val("")) : "function" == typeof N && N();
            var e, o = C.find("input:checked").length;
            de(k.length === o ? "clear" : null)
        }
        function ue(e) {
            c.addClass("hide"),
            c = w.find(e)
        }
        function ve() {
            var a = 0
              , i = !1
              , e = (U(),
            k.each(function(e, o) {
                a += xe(o);
                var t = jQuery(o).parents(".customer-details");
                !0 === o.checked ? (jQuery(o).data("precheckin") || (i = !0),
                t.addClass("selected")) : t.removeClass("selected")
            }),
            x = a,
            ne(),
            C.find("input:checked").length);
            0 === e ? (ue("#step-cancellation-select-booking-display"),
            w.find(".cancellation-step").addClass("hide"),
            He.addClass("hide"),
            u.addClass("hide"),
            c.removeClass("hide"),
            d.addClass("state-disabled")) : (ue("#cancellation-step-0"),
            Te(2, "default"),
            Te(3, i || 0 === e ? "disabled" : "default"),
            Te(1, F && 0 !== e ? "default" : "disabled"),
            e = d.length - w.find("div.mod-tabs li.state-disabled").length,
            He.removeClass("hide"),
            u.removeClass("hide"),
            c.addClass("hide"),
            1 < e ? (w.find(".cancellation-step").addClass("hide"),
            He.addClass("hide"),
            u.addClass("hide"),
            c.removeClass("hide")) : (1 == e && w.find("div.mod-tabs li:not(.state-disabled)").trigger(p),
            l(a, !1, !0, !1),
            f(a),
            Ce())),
            ce()
        }
        function pe(e, o, t, a) {
            return e += 0 === o && 0 === t ? a ? ("" !== e ? "," : "") + "#step-cancellation-charge-no-refund-display" : ("" !== e ? "," : "") + "#step-cancellation-charge-no-refund-display-not-final-booking" : 0 < o && 0 === t && !1 === G ? ("" !== e ? "," : "") + "#step2-cancellation-refund-display" : ("" !== e ? "," : "") + "#step-cancellation-owe-display"
        }
        function ge() {
            var e, t;
            t = !1,
            k.each(function(e, o) {
                !0 !== o.checked || jQuery(o).data("precheckin") || (t = !0)
            }),
            t ? ko ? (w.find("#step-cancellation-ota-card-declined-display").addClass("hide"),
            w.find("#cancellation-card-decline-api-enabled").addClass("hide"),
            w.find(".cancellation-card-decline-alternative-option").addClass("hide"),
            w.find(".cancellation-card-decline-no-alternative-option").addClass("hide"),
            w.find("#cancellation-card-decline-no-alternative-extranet-warning").addClass("hide"),
            w.find("#cancellation-card-decline-no-alternative-eviivo-online-poa-warning").addClass("hide"),
            w.find("#cancellation-card-decline-no-alternative-extranet-warning").addClass("hide"),
            w.find("#cancellation-card-decline-ota-warnings").addClass("hide"),
            I.addClass("hide"),
            w.find("#step-cancellation-ota-card-declined-display-post-checkin").addClass("hide"),
            w.find("#step-cancellation-ota-card-declined-display-pre-checkin-virtual-card").removeClass("hide")) : (bo && (w.find("#cancellation-card-decline-custom-message").removeClass("hide"),
            w.find("#cancellation-card-decline-guest-message").addClass("hide"),
            w.find("#cancellation-card-decline-ota-message").addClass("hide"),
            w.find("#cancellation-card-declined-notes").attr("placeholder", y.resources.Labeling_CardDecline_CardDeclineApiEnabledWatermark),
            w.find("#cancellation-card-decline-ota-warnings").removeClass("hide"),
            be(),
            I.html(y.resources.Button_Send)),
            yo && To && I.html(y.resources.Button_ConfirmCancellation),
            w.find("#cancellation-card-decline-alternative-option").is(":enabled") && w.find("#cancellation-card-decline-no-alternative-option").is(":enabled") || w.find("#cancellation-card-decline-alternative-option").is(":disabled") ? w.find("#cancellation-card-decline-no-alternative-option").attr("checked", "checked") : w.find("#cancellation-card-decline-no-alternative-option").is(":disabled") && w.find("#cancellation-card-decline-alternative-option").attr("checked", "checked"),
            e = w.find("#cancellation-card-decline-no-alternative-extranet-warning"),
            w.find("#cancellation-card-decline-alternative-option").is(":checked") && (w.find("#cancellation-card-decline-custom-message").removeClass("hide"),
            w.find("#cancellation-card-decline-ota-warnings").removeClass("hide"),
            w.find("#cancellation-card-decline-guest-message").removeClass("hide"),
            w.find("#cancellation-card-decline-ota-message").addClass("hide"),
            w.find("#cancellation-card-decline-no-alternative-eviivo-online-poa-warning").addClass("hide"),
            w.find("#cancellation-card-declined-notes").attr("placeholder", y.resources.Labeling_AlternatePayment_CustomerMessageWatermark),
            w.find("#cancellation-card-declined-notes").html(fo),
            I.html(y.resources.Button_Send),
            0 < e.length ? (e.addClass("hide"),
            I.html(y.resources.Button_Send)) : H && F && w.find("#cancellation-card-decline-ota-warnings").addClass("hide")),
            w.find("#cancellation-card-decline-no-alternative-option").is(":checked") && (w.find("#cancellation-card-decline-guest-message").addClass("hide"),
            w.find("#cancellation-card-declined-notes").html(H ? mo : ho),
            0 < e.length ? (w.find("#cancellation-card-decline-custom-message").addClass("hide"),
            w.find("#cancellation-card-decline-ota-warnings").addClass("hide"),
            e.removeClass("hide"),
            I.html(y.resources.Button_Ok)) : H && F ? (w.find("#cancellation-card-decline-guest-message").removeClass("hide"),
            w.find("#cancellation-card-declined-notes").attr("placeholder", y.resources.Labeling_CancelBooking_FormGuestNotesWatermark),
            w.find("#cancellation-card-decline-custom-message").removeClass("hide"),
            w.find("#cancellation-card-decline-no-alternative-eviivo-online-poa-warning").removeClass("hide"),
            w.find("#cancellation-card-decline-ota-warnings").addClass("hide"),
            I.html(y.resources.Button_ConfirmCancellation)) : (I.html(y.resources.Button_RequestCancellation),
            w.find("#cancellation-card-declined-notes").attr("placeholder", y.resources.Labeling_AlternatePayment_OtaMessageWatermark),
            w.find("#cancellation-card-decline-custom-message").removeClass("hide"),
            w.find("#cancellation-card-decline-ota-warnings").removeClass("hide"),
            w.find("#cancellation-card-decline-ota-message").removeClass("hide"),
            w.find("#cancellation-card-decline-no-alternative-eviivo-online-poa-warning").addClass("hide")))) : (w.find("#step-cancellation-ota-card-declined-display").addClass("hide"),
            w.find("#cancellation-card-decline-api-enabled").addClass("hide"),
            w.find(".cancellation-card-decline-alternative-option").addClass("hide"),
            w.find(".cancellation-card-decline-no-alternative-option").addClass("hide"),
            w.find("#cancellation-card-decline-no-alternative-extranet-warning").addClass("hide"),
            w.find("#cancellation-card-decline-no-alternative-eviivo-online-poa-warning").addClass("hide"),
            w.find("#cancellation-card-decline-no-alternative-extranet-warning").addClass("hide"),
            w.find("#cancellation-request-api-enabled-ota-notification-warning").addClass("hide"),
            w.find("#cancellation-request-api-enabled-ota-notification-error").addClass("hide"),
            w.find("#card-decline-api-enabled-ota-notification-error").addClass("hide"),
            I.addClass("hide"),
            w.find("#step-cancellation-ota-card-declined-display-pre-checkin-virtual-card").addClass("hide"),
            w.find("#step-cancellation-ota-card-declined-display-post-checkin").removeClass("hide"))
        }
        function me(e) {
            jQuery("#total-fee").html(h(he(e)))
        }
        function fe(e) {
            var o = parseFloat(jQuery("#pms-Fees").data("value"));
            jQuery("#total-fee").html(h(he(e) + o))
        }
        function he(e) {
            var o = parseFloat(M.data("value")) / 100
              , t = 0 === parseFloat(O.data("value")) ? parseFloat(O.data("value")) : parseFloat(O.data("value")) / 100;
            return channelFeeValue = o * e / 100,
            M.html(h(channelFeeValue)),
            channelFeeValue + t
        }
        function be() {
            w.find("#cancellation-card-declined-notes").html("")
        }
        function ye(e, o, t, a) {
            R += pe(R, e, o, t),
            A = 0 < e && 0 === o ? (R += ("" !== R ? "," : "") + "#step2-cancellation-charge-refund-display",
            a < e && (R += ("" !== R ? "," : "") + "#step2-cancellation-refund-display-correct-amount"),
            X) : 0 === e && 0 === o ? (R += ("" !== R ? "," : "") + "#step2-cancellation-ota-message-display",
            X) : (R += ("" !== R ? "," : "") + "#step2-cancellation-charge-owe-display",
            Y)
        }
        function Ce() {
            var t = 0
              , a = (k.each(function(e, o) {
                t += xe(o)
            }),
            0)
              , e = (k.each(function(e, o) {
                a += function(e) {
                    var o = xe(e)
                      , e = jQuery(e)
                      , e = parseFloat(e.data("charge-tax"));
                    isNaN(e) || (o += e / 100);
                    return o
                }(o)
            }),
            P.html(h(t)).addClass("strong"),
            Ae.addClass("strong"),
            f(t),
            j.html(h(a)),
            y.resources.cancellationChargeLabel.replace("{0}", j.html()));
            j.html(e),
            0 < Ee.length && Ee.html(b(a * Q)),
            l(a, !1, !1, !1),
            updateRefund = !0,
            jQuery("#CancellationCharge").val(parseFloat(t))
        }
        function l(t, e, o, a) {
            var i, n, s, r, l = k.length === C.find("input:checked").length, d = 0 < w.find("#cancellation-reason").length && "" !== w.find("#cancellation-reason").val() ? parseInt(w.find("#cancellation-reason").val()) : L.Unknown, a = (!0 === a && (t = 0,
            k.each(function(e, o) {
                t += xe(o)
            }),
            x = t,
            d === L.ForceMajeure || d === L.NoShow ? !0 === Ve.prop("checked") ? t = 0 : "" !== S.val() && (t = S.val()) : d === L.CardDecline && 0 < (a = w.find("#cancellation-card-decline-no-alternative-option")).length && !0 === a[0].checked && (t = 0)),
            t = function(e) {
                e = "" === e || null == e ? 0 : e,
                isNaN(e) && (e.lastIndexOf(",") === e.length - 1 || e.lastIndexOf(".") === e.length - 1 ? e = e.replace(/\D/g, "") : 0 <= e.indexOf(",") && (e = e.replace(",", ".")),
                e = parseFloat(e));
                return e
            }(t),
            !1), e = (!0 === T && (!0 === e ? (P.html(h(t)),
            a = !0,
            jQuery("#CancellationCharge").val(parseFloat(t)),
            me(t),
            f) : (j.html(h(t)),
            e = y.resources.cancellationChargeLabel.replace("{0}", j.html()),
            j.html(e),
            0 < Ee.length && Ee.html(b(t * Q)),
            me))(t),
            0), c = parseFloat(P.data("paid")) / 100 - t - so - Ye - parseFloat(D.data("paid")) / 100 - parseFloat(nonRefundableChargesTaxAmount.data("paid")) / 100, u = ((c = Math.round(100 * c) / 100) < 0 && (e = c,
            c = 0),
            0 < c && !1 == l && (c = 0),
            a && (w.find("#cancellation-refund").html(h(c)),
            0 <= c && (w.find("span.cancellation-refund-amount").html(h(c)),
            0 < (a = w.find("span.cancellation-refund-amount-merchant")).length && a.html(b(c * Q)),
            a = po - (t < go ? 0 : t - go),
            jQuery("#correct-cancellation-refund-amount").text(h(a))),
            e < 0) && (e = -e,
            0 < (a = w.find("#cancellation-owe-amount-merchant")).length && a.html(b(e * Q)),
            jQuery("#cancellation-owe-amount").html(h(e))),
            ""), a = (R = "",
            x <= 0 && (!ro && !H || d !== L.ForceMajeure) && d !== L.CardDecline && (R = u = "#step-cancellation-no-charge-display"),
            C.find("input:checkbox").length), v = C.find("input:checked").length, p = null, g = null;
            if (ro || H && d === L.CardDecline ? d === L.NoShow ? co && wo === L.NoShow ? (p = 10,
            R = "") : Io ? (p = 6,
            R = "") : 0 === x && 0 === c && 0 === e ? (p = 9,
            u += (i = u,
            s = e,
            i += 0 === (n = c) && 0 === s ? r ? ("" !== i ? "," : "") + "#step1-cancellation-refund-display-not-all-cancelled" : ("" !== i ? "," : "") + "#step-cancellation-charge-no-refund-display" : 0 < n && 0 === s ? ("" !== i ? "," : "") + "#step1-cancellation-refund-display" : ("" !== i ? "," : "") + "#step-cancellation-owe-display"),
            R = "") : lo && !Co ? (p = 6,
            R = "") : Co ? to || v == a ? (p = 5,
            ye(c, e, l, po)) : (p = 6,
            R = "") : F ? (p = 5,
            ye(c, e, l, po)) : (p = 6,
            R = "") : d === L.CardDecline ? bo || yo ? yo && To ? R = (p = co && vo ? 10 : 8,
            "") : bo && (R = (p = uo && vo ? 10 : 8,
            "")) : R = (p = co && wo === L.CardDecline ? 10 : 8,
            "") : je ? (p = (g = ke(t, c, e, l, u)).displayMode,
            u = g.step1Selector,
            A = g.validationActionStep2) : co ? (p = 10,
            R = "") : (p = 4,
            R += ("" !== R ? "," : "") + "#step2-cancellation-ota-request-display") : (p = (g = ke(t, c, e, l, u)).displayMode,
            u = g.step1Selector,
            A = g.validationActionStep2),
            !0 === o) {
                switch (p) {
                case 9:
                    u += ("" !== u ? "," : "") + "#step2-cancellation-ota-message-display",
                    Ie(!(N = null), !1),
                    m(eviivo.component.flyout.hideAllFlyouts);
                    break;
                case 1:
                    u += ("" !== u ? "," : "") + "#step2-cancellation-guest-message-display",
                    Ie(!(N = null), !1),
                    m(eviivo.component.flyout.hideAllFlyouts);
                    break;
                case 2:
                case 3:
                case 5:
                case 7:
                    u += ("" !== u ? "," : "") + "#step-cancellation-charge-form-display",
                    N = G ? null : z,
                    B.removeClass("hide"),
                    I.addClass("hide");
                    break;
                case 4:
                    u += ("" !== u ? "," : "") + "#step1-cancellation-ota-request-display",
                    N = W,
                    we();
                    break;
                case 10:
                    u += ("" !== u ? "," : "") + "#step1-cancellation-ota-request-exists-display",
                    N = null,
                    we();
                    break;
                case 6:
                    u += ("" !== u ? "," : "") + "#step1-cancellation-ota-no-show-poa-display",
                    Ie(!(N = null), lo && !Co),
                    be(),
                    m(eviivo.component.flyout.hideAllFlyouts);
                    break;
                case 8:
                    u += ("" !== u ? "," : "") + "#step-cancellation-ota-card-declined-display",
                    N = K,
                    Ie(!1, !1),
                    ge(),
                    m(eviivo.component.flyout.hideAllFlyouts)
                }
                u = "" === u || null === u ? "#step-cancellation-missing-scenario-display" : u,
                w.find(".cancellation-step").addClass("hide"),
                "" !== (E = u) && null !== u && w.find(u).removeClass("hide")
            }
            "function" == typeof N && N()
        }
        function ke(e, o, t, a, i) {
            R += ("" !== R ? "," : "") + "#step2-cancellation-guest-message-display";
            var n = {
                displayMode: null,
                step1Selector: null,
                validationActionStep2: null
            };
            return e <= 0 && x <= 0 ? (i = pe(i, o, t, a),
            i += ("" !== R ? "," : "") + "#step-cancellation-no-charge-display,#step2-cancellation-refund-display-correct-amount",
            0 < o ? i += ("" !== R ? "," : "") + "#step2-cancellation-charge-refund-display" : t < 0 && (i += ("" !== R ? "," : "") + "#step2-cancellation-charge-owe-display"),
            displayMode = 1,
            n.step1Selector = i,
            n.displayMode = displayMode) : (R += pe(R, o, t, a),
            0 === o && 0 === t ? n.displayMode = 2 : 0 < o && 0 === t && !1 === G ? (R += ("" !== R ? "," : "") + "#step2-cancellation-charge-refund-display,#step2-cancellation-refund-display-correct-amount",
            n.validationActionStep2 = X,
            n.displayMode = 3) : (R += ("" !== R ? "," : "") + "#step2-cancellation-charge-owe-display",
            A = Y,
            n.displayMode = 7,
            n.validationActionStep2 = A)),
            n
        }
        function f(a) {
            var i;
            null === a ? jQuery("#pms-Fees").html(h(0)) : (i = "",
            jQuery(".SelectedBookings").each(function(e, o) {
                !0 === o.checked && (0 < i.length && (i += ","),
                i += o.defaultValue)
            }),
            eviivo.webcore.ajaxHelper.executeAjax({
                url: eviivoSuiteApp + "/" + eviivo.eagle.basePageModelState.userCultureCode + "/popups/RecalculateFee",
                data: {
                    bookingIds: i,
                    businessId: Ke,
                    channelId: Bo,
                    isOffline: Ze,
                    currencyCode: eo,
                    cancellationCharge: a || 0,
                    feeTypeIds: oo
                },
                actionId: "cancellation-recalculateFee",
                method: eviivo.webcore.ajaxHelper.methods.POST,
                contentType: eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                callback: function(e) {
                    {
                        var o;
                        n = a,
                        t = i,
                        null !== (e = e) && (jQuery("#pms-Fees").html(h(e)),
                        jQuery("#pms-Fees").data("value", e),
                        fe(n),
                        e = n,
                        o = function(e) {
                            var o, t, a, i;
                            null !== e && (Oe.html(h(e)),
                            Je.is(":visible") && Je.html(h(e)),
                            so = e,
                            qe.toggle(0 < so),
                            g.is(":checked") && ze.toggle(0 < so),
                            fe((o = "string" == typeof (o = n) && 0 < n.length && "" !== n ? Globalize.parseNumber(n) : o) + e),
                            We.html(h(parseFloat(n) + parseFloat(e))),
                            l(n, T = !1, !1, !1)),
                            o = n,
                            a = t = !(e = 0),
                            (i = parseFloat(P.data("paid")) / 100 - Ye - parseFloat(so) - o - parseFloat(D.data("paid")) / 100 - parseFloat(nonRefundableChargesTaxAmount.data("paid")) / 100) < 0 && (e = i,
                            i = 0),
                            0 < i && !1 === t && (i = 0),
                            a && (w.find("#cancellation-refund").html(h(i)),
                            0 <= i && (w.find("span.cancellation-refund-amount").html(h(i)),
                            0 < (t = w.find("span.cancellation-refund-amount-merchant")).length && t.html(b(i * Q)),
                            a = po - (o < go ? 0 : o - go),
                            jQuery("#correct-cancellation-refund-amount").text(h(a))),
                            e < 0) && (e = -e,
                            0 < (t = w.find("#cancellation-owe-amount-merchant")).length && t.html(b(e * Q)),
                            jQuery("#cancellation-owe-amount").html(h(e)))
                        }
                        ,
                        eviivo.webcore.ajaxHelper.executeAjax({
                            url: eviivoSuiteApp + "/" + eviivo.eagle.basePageModelState.userCultureCode + "/popups/recalculateCancellationTax",
                            data: {
                                bookingIds: t,
                                businessId: Ke,
                                currencyCode: eo,
                                cancellationCharge: e || 0,
                                isCustomCharge: g.prop("checked")
                            },
                            actionId: "cancellation-recalculateTaxFee",
                            method: eviivo.webcore.ajaxHelper.methods.POST,
                            contentType: eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,
                            dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                            callback: o
                        }))
                    }
                    var n, t
                }
            }))
        }
        function we() {
            I.addClass("hide"),
            B.addClass("hide")
        }
        function Ie(e, o) {
            !0 === e && I.removeAttr("disabled"),
            o && I.html(y.resources.Button_Ok),
            I.removeClass("hide"),
            B.addClass("hide")
        }
        function Te(e, o) {
            w.find(".mod-tab-toggle[data-reason=" + e + "]").removeClass("state-disabled").removeClass("state-default").removeClass("state-disabled").addClass("state-" + o)
        }
        function xe(e) {
            var o = jQuery(e);
            return e.checked ? parseFloat(o.data("charge")) / 100 : 0
        }
        function h(e) {
            var o = w.find("#BusinessId").val();
            return "string" == typeof e && (e = Globalize.parseNumber(e)),
            Globalize.formatCurrency(e, Be(o))
        }
        function Be(e) {
            return null === Po && "function" == typeof io && (e = io(parseInt(e)),
            Po = e.WorkingCurrencyCode),
            Po
        }
        function b(e) {
            var o = w.find("#BusinessId").val();
            return "string" == typeof e && (e = Globalize.parseNumber(e)),
            Globalize.formatCurrency(e, (e = o,
            null === jo && "function" == typeof io && (e = io(parseInt(e)),
            jo = e.MerchantCurrencyCode),
            jo))
        }
        function Se(e) {
            e && C.hasClass("hide") ? C.removeClass("hide") : C.addClass("hide")
        }
        function De(e) {
            var o = $("#tabs")
              , t = $("#noTabs");
            e && o.hasClass("hide") ? (o.removeClass("hide"),
            t.addClass("hide"),
            $(".s-hide-on-step-two").removeClass("hide"),
            $("#flowForm").appendTo(o)) : (o.addClass("hide"),
            t.removeClass("hide"),
            $(".s-hide-on-step-two").addClass("hide"),
            $("#flowForm").appendTo(t))
        }
        var y, C, k, Pe, w, I, je, T, x, B, Ne, d, S, D, P, Ae, Oe, Me, Re, j, Ee, c, u, He, v, p, Fe, Ge, $e, Qe, Le, Ve, g, N, A, _e, Ue, qe, Je, We, ze, Xe, O, M, i, R, E, Ye, Ke, Ze, eo, oo, to, ao, io, no, so, ro, H, F, lo, co, uo, vo, G, po, go, Q, mo, fo, ho, bo, yo, Co, ko, wo, Io, To, xo, Bo, L, V, So, Do, Po, jo;
        window.eviivo = window.eviivo || {},
        window.eviivo.eagle = window.eviivo.eagle || {},
        window.eviivo.eagle.cancellation = window.eviivo.eagle.cancellation || {},
        window.eviivo.eagle.cancellation = (To = Io = ko = Co = yo = bo = G = vo = uo = co = lo = F = H = ro = !(no = {
            resources: {
                clearAll: "unselect all",
                selectAll: "select all"
            }
        }),
        Bo = xo = Q = null,
        L = {
            ForceMajeure: 2,
            NoShow: 3,
            CardDecline: 1,
            Unknown: wo = go = po = so = 0
        },
        V = "#cancellation-booking-flyout",
        So = (ho = fo = mo = "").concat(V, " div.cp-flyout_container"),
        Do = "eviivo_eagle_cancellation",
        jo = Po = null,
        {
            init: function(e) {
                if ("function" != typeof jQuery)
                    throw "eviivo.eagle.cancellation: module depends on jQuery";
                if ("undefined" == typeof eviivo || void 0 === eviivo.webcore || void 0 === eviivo.util)
                    throw "eviivo.eagle.cancellation: module depends on eviivo.util";
                if ("undefined" == typeof eviivo || void 0 === eviivo.webcore || void 0 === eviivo.webcore.popup)
                    throw "eviivo.eagle.cancellation: module depends on eviivo.webcore.popup";
                if ("undefined" == typeof eviivo || void 0 === eviivo.webcore || void 0 === eviivo.webcore.ajaxHelper)
                    throw "eviivo.eagle.cancellation: module depends on eviivo.webcore.ajaxHelper";
                io = eviivo.util.safeFunction("eviivo.pms.businessSettingsAndDefaultMessages.getValue"),
                y = jQuery.extend(no, e),
                null !== Globalize && null !== Globalize.cldr && (y.decimalSymbol = Globalize._numberSymbol("decimal", Globalize.cldr))
            },
            open: function(e) {
                eviivo.util.addHotjarRecordingTags(["Cancellation"]),
                y = jQuery.extend(!0, {}, y, e),
                T = !1,
                x = 0,
                e = $(V),
                cancellationAjaxUrl = e.data("ajaxurl"),
                newAjaxUrl = cancellationAjaxUrl.format(y.businessId, y.bookingId, y.orderId),
                e.attr("data-ajaxurl", newAjaxUrl),
                eviivo.component.flyout.showFlyout(e.attr("id"))
            },
            onFlyoutDataLoad: function(e) {
                (w = jQuery(V)).tip();
                var o = $(V)
                  , t = "".concat(V, " .mod-popup-header .mod-column")
                  , a = (eviivo.component.flyout.updateTitleLeft(o.attr("id"), document.querySelector("".concat(t, " h3")).innerHTML),
                eviivo.component.flyout.updateTitleRight(o.attr("id"), document.querySelector("".concat(t, " h4")).innerHTML),
                document.querySelector("".concat(V, " .mod-popup-header")).remove(),
                document.querySelectorAll("".concat(V, " .mod-popup-footer button")))
                  , i = document.querySelector("".concat(V, " .cp-flyout_footer"));
                i.innerHTML = "";
                for (var n, s, r = 0; r < a.length; r++)
                    i.appendChild(a[r]);
                null === (o = e) || null === o.Data ? console.log("eviivo.eagle.cancellation: could not return popup content data.") : (t = w.find("#AllowDiaryCancellation"),
                o.Data.currencySymbol,
                Ye = null === o.Data.PreviousCancellationCharge || isNaN(o.Data.PreviousCancellationCharge) ? 0 : o.Data.PreviousCancellationCharge,
                0 < t.length && "" !== t.val() && (je = "true" === t.val().toLowerCase()),
                0 < w.find("#IsOtaRequest").length && "" !== w.find("#IsOtaRequest").val() && (ro = "true" === w.find("#IsOtaRequest").val().toLowerCase()),
                0 < w.find("#IsEviivoOnline").length && "" !== w.find("#IsEviivoOnline").val() && (H = "true" === w.find("#IsEviivoOnline").val().toLowerCase()),
                0 < w.find("#IsPoa").length && "" !== w.find("#IsPoa").val() && (F = "true" === w.find("#IsPoa").val().toLowerCase()),
                0 < w.find("#IsChannelExtranetAvailable").length && "" !== w.find("#IsChannelExtranetAvailable").val() && (lo = "true" === w.find("#IsChannelExtranetAvailable").val().toLowerCase()),
                0 < w.find("#HasCancellationRequests").length && "" !== w.find("#HasCancellationRequests").val() && (co = "true" === w.find("#HasCancellationRequests").val().toLowerCase()),
                0 < w.find("#HasGuestAlternatePaymentRequests").length && "" !== w.find("#HasGuestAlternatePaymentRequests").val() && (uo = "true" === w.find("#HasGuestAlternatePaymentRequests").val().toLowerCase()),
                0 < w.find("#ShowCancellationRequestOtaNotificationStatus").length && "" !== w.find("#ShowCancellationRequestOtaNotificationStatus").val() && (vo = "true" === w.find("#ShowCancellationRequestOtaNotificationStatus").val().toLowerCase()),
                0 < w.find("#OnlinePaidValue").length && "" !== w.find("#OnlinePaidValue").val() && (po = parseFloat(w.find("#OnlinePaidValue").val())),
                0 < w.find("#OfflinePaidValue").length && "" !== w.find("#OfflinePaidValue").val() && (go = parseFloat(w.find("#OfflinePaidValue").val())),
                o = eviivo.util.safeFunction("eviivo.pms.businessSettingsAndDefaultMessages.extractDefaultText"),
                t = eviivo.util.safeFunction("eviivo.pms.businessSettingsAndDefaultMessages.getCancellationGuestMessage"),
                e = eviivo.util.safeFunction("eviivo.pms.businessSettingsAndDefaultMessages.getCardDeclinedGuestMessage"),
                n = w.find("#DefaultMessagesLanguageCultureCode").val(),
                mo = t(y.businessId, n),
                fo = e(y.businessId, n),
                ho = o(y.businessId, "GuestMessage." + y.businessId + ".OtaCardDecline", n),
                0 < w.find("#IsCardDeclineApiEnabled").length && "" !== w.find("#IsCardDeclineApiEnabled").val() && (bo = "true" === w.find("#IsCardDeclineApiEnabled").val().toLowerCase()),
                0 < w.find("#IsNoShowApiEnabled").length && "" !== w.find("#IsNoShowApiEnabled").val() && (Co = "true" === w.find("#IsNoShowApiEnabled").val().toLowerCase()),
                0 < w.find("#IsRequestCancellationApiEnabled").length && "" !== w.find("#IsRequestCancellationApiEnabled").val() && (yo = "true" === w.find("#IsRequestCancellationApiEnabled").val().toLowerCase()),
                0 < w.find("#IsOtaCancellationRequestAvailable").length && "" !== w.find("#IsOtaCancellationRequestAvailable").val() && (To = "true" === w.find("#IsOtaCancellationRequestAvailable").val().toLowerCase()),
                0 < w.find("#CancellationRequestReason").length && "" !== w.find("#CancellationRequestReason").val() && (wo = parseInt(w.find("#CancellationRequestReason").val())),
                0 < w.find("#ConversionRate").length && "" !== w.find("#ConversionRate").val() && (Q = Globalize.parseNumber(w.find("#ConversionRate").val())),
                0 < w.find("#MerchantCurrencySymbol").length && w.find("#MerchantCurrencySymbol").val(),
                0 < w.find("#HasVirtualCardToken").length && "" !== w.find("#HasVirtualCardToken").val() && (ko = "true" === w.find("#HasVirtualCardToken").val().toLowerCase()),
                0 < w.find("#BusinessId").length && (Ke = w.find("#BusinessId").val()),
                0 < w.find("#ChannelId").length && (Bo = w.find("#ChannelId").val()),
                0 < w.find("#IsOffline").length && (Ze = w.find("#IsOffline").val()),
                0 < w.find("#CustomerCurrencyCode").length && (eo = w.find("#CustomerCurrencyCode").val()),
                0 < w.find("#pms-Fees-feeTypes").length && (oo = w.find("#pms-Fees-feeTypes").data("value")),
                0 < w.find("#ReportNoShowFromOtaExtranet").length && "" !== w.find("#ReportNoShowFromOtaExtranet").val() && (Io = "true" === w.find("#ReportNoShowFromOtaExtranet").val().toLowerCase()),
                0 < w.find("#IsBookingComSource").length && (to = w.find("#IsBookingComSource").val()),
                C = w.find("#cancellation-booking-list"),
                k = C.find("input"),
                Pe = w.find("#cancellation-select-all"),
                I = w.find("#submit"),
                Ne = w.find("#return"),
                B = w.find("#next"),
                Me = jQuery("#cancellation-order-value"),
                P = w.find("#cancellation-charge"),
                Ae = w.find("#cancellation-charge-label"),
                Oe = w.find("#cancellation-charge-tax"),
                cancellationChannelRebateCharge = jQuery("#cancellation-channel-rebate-charge"),
                ao = jQuery("#label-channel-commission"),
                D = w.find("#non-refundable-charge"),
                nonRefundableChargesTaxAmount = w.find("#non-refundable-charge-tax"),
                nonRefundableChargesAmountRow = w.find("#non-refundable-charge-row"),
                nonRefundableChargesTaxAmountRow = w.find("#non-refundable-charge-tax-row"),
                0 === parseInt(D.data("paid")) && nonRefundableChargesAmountRow.hide(),
                0 === parseInt(nonRefundableChargesTaxAmount.data("paid")) && nonRefundableChargesTaxAmountRow.hide(),
                d = w.find("div.mod-tabs li.mod-tab-toggle"),
                c = w.find("#cancellation-step-0"),
                u = w.find("#cancellation-step-1"),
                He = w.find("#cancellation-step-2"),
                j = w.find("#cancellation-charge-amount"),
                Ee = w.find("#cancellation-charge-merchant-amount"),
                Re = w.find("#cancellation-charge-messaging"),
                Fe = w.find("#cancellation-do-not-apply-charges"),
                Ge = w.find("#cancellation-apply-charges"),
                Qe = w.find("#cancellation-guest-contacted"),
                Le = w.find("#apply-cancellation-charge"),
                Ve = w.find("#do-not-apply-cancellation"),
                g = w.find("#apply-different-cancellation"),
                S = w.find("#cancellation-custom-charge"),
                qe = w.find("#cancellation-charge-tax-row"),
                Je = w.find("#cancellation-custom-tax-display"),
                We = w.find("#cancellation-custom-tax-base-sum"),
                ze = w.find("#cancellation-custom-string"),
                Xe = w.find("#cancellation-paid"),
                O = w.find("#merchant-fee"),
                M = w.find("#channel-fee"),
                eviivo.webcore.decimals.restrictFieldsForDecimals(S, {
                    decimalPlaces: 2
                }),
                t = Be(Ke),
                "undefined" !== Xe.data("paid-value") && Xe.html(Globalize.formatCurrency(parseFloat(Xe.data("paid-value")) / 100, t)),
                "undefined" !== O.data("value") && O.html(Globalize.formatCurrency(parseFloat(O.data("value")) / 100, t)),
                "undefined" !== M.data("value") && M.html(Globalize.formatCurrency(parseFloat(M.data("value")) / 100, t)),
                $e = w.find("#cancellation-notes"),
                ro || H || $e.html(mo),
                eviivo.webcore.summernote.create({
                    container: jQuery("#cancellation-notes"),
                    displayMode: eviivo.webcore.summernote.displayModes.toolbarWithVariables,
                    placeholderText: y.resources.CancellationPlaceholder,
                    text: mo
                }),
                eviivo.webcore.summernote.create({
                    container: jQuery("#cancellation-card-declined-notes"),
                    displayMode: eviivo.webcore.summernote.displayModes.toolbarWithVariables,
                    placeholderText: y.resources.Labeling_AlternatePayment_CustomerMessageWatermark,
                    text: fo
                }),
                _e = w.find("#submit,#next"),
                Xe = w.find("#cancellation-charge-method"),
                Ue = w.find("#cancellation-refund-method"),
                O = w.find("#merchant-fee"),
                v = eviivo.util.namespacedEvent("change", Do),
                p = eviivo.util.namespacedEvent("click", Do),
                e = C.find("input:checked").parents(".customer-details"),
                C.prepend(e),
                o = w.find(".cancelled"),
                C.append(o),
                w.find("input[id^='charge-refund-'],input[id^='charge-owe-']").on(p, J),
                Xe.on(v, Y),
                Ue.on(v, X),
                s = w.find("#cancellation-card-decline-no-alternative-extranet-warning"),
                w.find("#cancellation-card-decline-alternative-option").on(v, function() {
                    w.find("#cancellation-card-decline-custom-message").removeClass("hide"),
                    w.find("#cancellation-card-decline-ota-warnings").removeClass("hide"),
                    w.find("#cancellation-card-decline-guest-message").removeClass("hide"),
                    w.find("#cancellation-card-decline-ota-message").addClass("hide"),
                    w.find("#cancellation-card-decline-no-alternative-eviivo-online-poa-warning").addClass("hide"),
                    w.find("#cancellation-card-declined-notes").attr("placeholder", y.resources.Labeling_AlternatePayment_CustomerMessageWatermark),
                    w.find("#cancellation-card-declined-notes").html(fo),
                    l(x, !0, !1, !1),
                    f(x),
                    I.html(y.resources.Button_Send),
                    K(),
                    0 < s.length ? (s.addClass("hide"),
                    I.html(y.resources.Button_Send)) : H && F && w.find("#cancellation-card-decline-ota-warnings").addClass("hide")
                }),
                w.find("#cancellation-card-decline-no-alternative-option").on(v, function() {
                    w.find("#cancellation-card-decline-guest-message").addClass("hide"),
                    K(),
                    w.find("#cancellation-card-declined-notes").html(H ? mo : ho),
                    l(0, !0, !0, !1),
                    f(0),
                    0 < s.length ? (w.find("#cancellation-card-decline-custom-message").addClass("hide"),
                    w.find("#cancellation-card-decline-ota-warnings").addClass("hide"),
                    s.removeClass("hide"),
                    I.html(y.resources.Button_Ok)) : H && F ? (w.find("#cancellation-card-decline-guest-message").removeClass("hide"),
                    w.find("#cancellation-card-declined-notes").attr("placeholder", y.resources.Labeling_CancelBooking_FormGuestNotesWatermark),
                    w.find("#cancellation-card-decline-custom-message").removeClass("hide"),
                    w.find("#cancellation-card-decline-no-alternative-eviivo-online-poa-warning").removeClass("hide"),
                    w.find("#cancellation-card-decline-ota-warnings").addClass("hide"),
                    I.html(y.resources.Button_ConfirmCancellation)) : (I.html(y.resources.Button_RequestCancellation),
                    w.find("#cancellation-card-declined-notes").attr("placeholder", y.resources.Labeling_AlternatePayment_OtaMessageWatermark),
                    w.find("#cancellation-card-decline-custom-message").removeClass("hide"),
                    w.find("#cancellation-card-decline-ota-warnings").removeClass("hide"),
                    w.find("#cancellation-card-decline-ota-message").removeClass("hide"),
                    w.find("#cancellation-card-decline-no-alternative-eviivo-online-poa-warning").addClass("hide"))
                }),
                S.on(p, function() {
                    g.prop("checked", !0)
                }),
                w.find("#cancellation-request-ota-cancellation").on(p, function() {
                    I.html(y.resources.Button_RequestCancellation),
                    w.find("#cancellation-notes").summernote("code", ""),
                    q()
                }),
                Fe.on(v, W),
                Fe.on(v, oe),
                Ge.on(v, W),
                Ge.on(v, te),
                $e.on(eviivo.util.namespacedEvent("keyup", Do), W),
                Qe.on(v, W),
                Le.on(v, ie),
                Ve.on(v, ae),
                g.on(v, ee),
                S.on(eviivo.util.namespacedEvent("keyup", Do), Z),
                d.on(p, se),
                Ne.on(p, _),
                B.on(p, q),
                I.on(p, re),
                Te(2, "default"),
                ve(),
                k.on(v, ve),
                2 < k.length && C.removeClass("multiple").addClass("multiple"),
                1 === k.length && (w.find(".select-all").hide(),
                C.removeClass("single").addClass("single")),
                Pe.on(v, le),
                w.find(".total-options").html(k.length),
                ce(),
                y.showCardDeclineStep && w.find(".mod-tab-toggle.state-default[data-reason=1]").trigger("click"),
                U())
            }
        })
    },
    2019: function() {
        function o(e) {
            t.html(e),
            "function" == typeof a.onSuccessCallback && a.onSuccessCallback()
        }
        var t, a;
        window.eviivo = window.eviivo || {},
        window.eviivo.eagle = window.eviivo.eagle || {},
        window.eviivo.eagle.financialSummary = window.eviivo.eagle.financialSummary || {},
        window.eviivo.eagle.financialSummary = {
            init: function(e) {
                a = jQuery.extend(e),
                t = a.container.find("#divFinancialInfo"),
                null != a.orderId && eviivo.webcore.ajaxHelper.executeAjax({
                    actionId: "financialSummary.GetOrderFinancialInfo",
                    url: eviivo.eagle.urls.orders.FinancialInfo,
                    method: eviivo.webcore.ajaxHelper.methods.POST,
                    data: {
                        orderId: a.orderId,
                        calculateMaxPayment: a.calculateMaxPayment,
                        requestBusinessId: parseInt(a.businessId)
                    },
                    contentType: eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,
                    dataType: eviivo.webcore.ajaxHelper.dataTypes.HTML,
                    callback: o
                })
            }
        }
    },
    3202: function() {
        function t(e, o, t) {
            if (null == e || null == e.messageType)
                return {
                    className: t
                };
            switch (e.messageType) {
            case 0:
                return {
                    className: eviivo.webcore.notifier.types.warn
                };
            case 1:
                break;
            case 2:
                return {
                    className: eviivo.webcore.notifier.types.warn
                };
            default:
            case 3:
                return {
                    className: eviivo.webcore.notifier.types.warn
                };
            case 4:
                return {
                    className: eviivo.webcore.notifier.types.success
                }
            }
            return {}
        }
        var o, a;
        window.eviivo = window.eviivo || {},
        window.eviivo.eagle = window.eviivo.eagle || {},
        window.eviivo.eagle.floatingNotification = window.eviivo.eagle.floatingNotification || {},
        window.eviivo.eagle.floatingNotification = (a = {},
        {
            showAddBookingNotification: function(e) {
                var o = t(e, 0, eviivo.webcore.notifier.types.success);
                eviivo.webcore.notifier.show({
                    message: e.messageFormat.format(e.ref, e.guestName),
                    buttonOne: "<button class='btn btn-secondary' id='show-booking'>" + e.resources.BookingCreatedMessage1 + "</button>",
                    style: eviivo.webcore.notifier.styles.withTwoActions,
                    type: o.className,
                    position: "bottom right",
                    autoHide: !0
                }),
                jQuery("#show-booking").on("click", function() {
                    "function" == typeof e.customAction && (eviivo.eagle.basePageModelState.businessId = e.businessId,
                    e.customAction(e.bookingId, null, null, null, null, null, null, null, null, e.businessId))
                })
            },
            showGenericNotification: function(e) {
                var o = t(e);
                eviivo.webcore.notifier.show({
                    message: e.message,
                    buttonOne: "<button class='btn btn-secondary' id='show-booking'>" + e.resources.ClickHereToView + "</button>",
                    style: eviivo.webcore.notifier.styles.withTwoActions,
                    type: o.className,
                    position: "bottom right",
                    autoHide: !0
                }),
                jQuery("#show-booking").on("click", function() {
                    "function" == typeof e.customAction && e.customAction(e.bookingId, null, null, null, null, null, null, null, null)
                })
            },
            init: function(e) {
                if ("function" != typeof jQuery)
                    throw "eviivo.eagle.floatingNotification: module depends on jQuery";
                if ("undefined" == typeof eviivo || void 0 === eviivo.webcore || void 0 === eviivo.webcore.notifier)
                    throw "eviivo.eagle.floatingNotification: module depends on eviivo.webcore.notifier";
                if (null == (o = jQuery.extend(a, e)).container || "" == o.container || null == o.container)
                    throw "eviivo.eagle.floatingNotification: module requires the container to initialize properly"
            }
        })
    },
    3867: function() {
        function o(e) {
            window.eviivo.eagle.viewBookingCards.loadPaymentCardDetails(e)
        }
        var t;
        window.eviivo = window.eviivo || {},
        window.eviivo.eagle = window.eviivo.eagle || {},
        window.eviivo.eagle.grechaptcha = window.eviivo.eagle.grechaptcha || {},
        window.eviivo.eagle.grechaptcha = {
            init: function(e) {
                t = jQuery.extend(t, e)
            },
            onCaptchaLoaded: function() {
                var e;
                e = t.siteKey,
                e = grecaptcha.render("grecaptchaId", {
                    sitekey: e,
                    callback: o
                }),
                grecaptcha.reset(e)
            }
        }
    },
    8047: function() {
        function r(e) {
            return (r = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                return typeof e
            }
            : function(e) {
                return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
            }
            )(e)
        }
        function t(e) {
            var o = null
              , t = null
              , o = (h.val() === H.CardReader && (ie() && 0 < b.find("option").length ? (o = k.val(),
            t = Ze.val(),
            "" === o && (o = jQuery("#card-select :selected").data("lastcarddigits"),
            t = jQuery("#card-select :selected").data("cardtypecode"))) : (o = k.val(),
            t = Ze.val())),
            {
                OrderId: u,
                OrderReference: v,
                Amount: y.val(),
                Currency: B,
                OrderCardTokenId: h.val() === H.EviivoSuite ? b.val() : null,
                Notes: w.val(),
                PaymentMethodCode: h.val(),
                CardLast4Digits: o,
                CardTypeCode: t,
                ConfirmationEmail: (h.val() === H.EviivoSuite || le(h.val())) && D.prop("checked") ? C.val() : null,
                BusinessId: c,
                ChargeItemIds: Eo.toString()
            });
            return e && jQuery.extend(!0, o, {
                ReceivedDate: io.datepicker("getDate").evStandardIso8601DateTimeUtcExtended()
            }),
            o
        }
        function G() {
            Bo = xo = To = N = null
        }
        function Q() {
            Io = wo = j = P = null
        }
        function o(o, t, e, a, i, n) {
            var s;
            d(r(S)) || jQuery(S).prop("disabled", !0),
            d(r(n)) || (s = n,
            jQuery.extend(!0, f.validate().settings.rules, s),
            jQuery.extend(f.validate().settings.messages, Ae(s["amount-input"].eMax))),
            (s = S).id.includes("chargePreAuth") || s.id.includes("deletePreAuth") || s.id.includes("reconciliation-btn") || f.valid() ? (m.html(i),
            g.removeClass("hide").addClass("active"),
            eviivo.webcore.ajaxHelper.executeAjax({
                actionId: o,
                url: e,
                method: eviivo.webcore.ajaxHelper.methods.GET,
                data: a,
                contentType: eviivo.webcore.ajaxHelper.contentTypes.TEXT_HTML,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.HTML,
                callback: function(e) {
                    "function" == typeof t && t(e, o),
                    void 0 !== S && jQuery(S).prop("disabled", !1)
                },
                failCallback: l
            })) : d(r(S)) || jQuery(S).prop("disabled", !1),
            d(r(n)) || Ie()
        }
        function L(e) {
            eviivo.eagle.financialSummary.init({
                orderId: u,
                container: jQuery("#payments-tab-form"),
                onSuccessCallback: e,
                calculateMaxPayment: !0
            })
        }
        function e() {
            jQuery("#lblPaymentMulitcard").removeClass("ui-state-active"),
            jQuery("#lblEmails").addClass("ui-state-active"),
            m.text(p.resources.StandardLoaderMessage),
            g.removeClass("hide").addClass("active"),
            ze = p.container,
            eviivo.util.safeFunction("eviivo.eagle.email.listing.init")({
                cultureCode: $("#guest-culture-code").val(),
                businessId: c,
                orderId: u,
                selectedEmailId: eviivo.util.safeFunction("eviivo.pms.businessSettingsAndDefaultMessages.getPaymentRequestEmailId")(c),
                container: ze,
                resources: {
                    StandardLoaderMessage: p.resources.StandardLoaderMessage,
                    SendEmailSuccess: p.resources.SendEmailSuccess,
                    SendEmailFailure: p.resources.SendEmailFailure,
                    EmailGuestNotFound: p.resources.EmailGuestNotFound
                }
            })
        }
        function a() {
            eviivo.webcore.ajaxHelper.executeAjax({
                actionId: "paymentMultiCard.getPreAuths",
                url: eviivo.eagle.urls.paymentMultiCard.PreAuths,
                method: eviivo.webcore.ajaxHelper.methods.GET,
                data: {
                    orderReference: v,
                    businessId: c
                },
                contentType: eviivo.webcore.ajaxHelper.contentTypes.TEXT_HTML,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.HTML,
                callback: function(e) {
                    ne(Ye, e),
                    Q(),
                    po = jQuery("#HasOutstandingPreAuth"),
                    Ce(),
                    ue()
                },
                failCallback: l
            })
        }
        function V(e) {
            m.html(p.resources.loadingMessages.refundProcessing),
            g.removeClass("hide").addClass("active");
            var o, n, t = parseInt(jQuery(this).data("item-id"));
            eviivo.webcore.parsers.stringToBool(jQuery(this).data("item-online-voucher")) && Je ? (o = {
                orderReference: v,
                businessId: c,
                paymentId: t
            },
            n = jQuery("".concat(Ko).concat(t)).text(),
            eviivo.webcore.ajaxHelper.executeAjax({
                actionId: "online-voucher-undo-redemption",
                url: eviivo.eagle.urls.onlineVouchers.UndoRedemption,
                method: eviivo.webcore.ajaxHelper.methods.POST,
                data: o,
                contentType: eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                callback: function(e) {
                    var o, t, a, i;
                    t = n,
                    (o = e).Success ? (e = Y(o.RemainingAmount),
                    a = e.amountForText,
                    i = e.amountForInput,
                    eviivo.webcore.notifier.show({
                        type: eviivo.webcore.notifier.types.success,
                        message: p.resources.notifyMessages.onlineVoucherUndoRedemptionSuccessMessage.format(t, a)
                    }),
                    L(function() {
                        Be(!1),
                        Le(),
                        s(!1, null, null, !1),
                        d(o.RemainingAmount) || d(i) || ee(o.RemainingAmount, i)
                    })) : eviivo.webcore.notifier.show({
                        type: eviivo.webcore.notifier.types.error,
                        message: o.ErrorMessage
                    }),
                    g.removeClass("active").addClass("hide")
                },
                failCallback: function() {
                    eviivo.webcore.notifier.show({
                        type: eviivo.webcore.notifier.types.error,
                        message: p.resources.notifyMessages.onlineVoucherRedeemErrorMessage
                    }),
                    g.removeClass("active").addClass("hide"),
                    G()
                }
            })) : eviivo.webcore.ajaxHelper.executeAjax({
                actionId: E.voidPayment,
                url: eviivo.eagle.urls.paymentMultiCard.VoidPayment,
                method: eviivo.webcore.ajaxHelper.methods.GET,
                data: {
                    paymentId: t,
                    orderId: u,
                    businessId: c
                },
                contentType: eviivo.webcore.ajaxHelper.contentTypes.TEXT_HTML,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.HTML,
                callback: function(e) {
                    s(),
                    L(function() {
                        g.removeClass("active").addClass("hide"),
                        Be(!d(N) && "true" === N.toLowerCase())
                    })
                },
                failCallback: l
            }),
            jQuery(this).trigger("notify-hide")
        }
        function _() {
            S = this,
            _e && ko && delete f.validate().settings.rules["amount-input"].eMax,
            o(E.charge, s, eviivo.eagle.urls.paymentMultiCard.ChargeCard, t(!0), p.resources.loadingMessages.paymentProcessing),
            _e && ko && Ie()
        }
        function U() {
            S = this,
            o(E.refund, s, eviivo.eagle.urls.paymentMultiCard.RefundCard, t(!0), p.resources.loadingMessages.refundProcessing, {
                "amount-input": {
                    eMax: go.val().toLowerCase() === et.EviivoMerchant && n === H.EviivoSuite ? Globalize.parseNumber(co.val()) : Globalize.parseNumber(ro.val())
                }
            })
        }
        function q() {
            S = this,
            o(E.preauth, se, eviivo.eagle.urls.paymentMultiCard.PreAuthCard, t(!1), p.resources.loadingMessages.preAuthProcessing, {
                "amount-input": {
                    eMax: Globalize.parseNumber(uo.val())
                }
            })
        }
        function J() {
            S = this;
            var e = t(!1);
            e.PreAuthId = parseInt(jQuery(this).data("item-id")),
            o(E.releasePreauth, se, eviivo.eagle.urls.paymentMultiCard.ReleasePreAuth, e, p.resources.loadingMessages.preAuthReleaseProcessing)
        }
        function W() {
            S = this;
            var e = t(!1);
            e.PreAuthId = parseInt(jQuery(this).data("item-id")),
            e.Amount = jQuery("#chargePreAuthAmount_" + e.PreAuthId).val(),
            o(E.chargePreauth, se, eviivo.eagle.urls.paymentMultiCard.ChargePreAuth, e, p.resources.loadingMessages.paymentProcessing)
        }
        function z() {
            S = this;
            var e = {
                orderId: parseInt(jQuery(this).data("oid")),
                date: A.datepicker("getDate").evStandardIso8601DateTimeUtcExtended(),
                amount: Mo.val(),
                currencyCode: jQuery(this).data("wcc")
            };
            o(E.reconsiliation, X, eviivo.eagle.urls.paymentMultiCard.ReconiliationPayment, e, p.resources.loadingMessages.paymentProcessing)
        }
        function X(e) {
            g.removeClass("active").addClass("hide"),
            void 0 !== S && jQuery(S).prop("disabled", !1),
            xe(E.reconsiliation, e)
        }
        function Y(e) {
            return {
                amountForText: Globalize.formatCurrency(e.Amount, B),
                amountForInput: Globalize.formatNumber(e.Amount, {
                    minimumFractionDigits: e.Currency.Accuracy,
                    maximumFractionDigits: e.Currency.Accuracy
                })
            }
        }
        function K() {
            S = this,
            M.prop("disabled", !0),
            g.removeClass("hide").addClass("active"),
            m.html(p.resources.loadingMessages.onlineVoucherVerificationLoadingMessage);
            var e = {
                voucher: {
                    code: Yo.val().trim(),
                    voucherPartnerShortName: qe
                },
                orderReference: v,
                businessId: c,
                currencyCode: B
            };
            eviivo.webcore.ajaxHelper.executeAjax({
                actionId: "online-voucher-verification",
                url: eviivo.eagle.urls.onlineVouchers.Verify,
                method: eviivo.webcore.ajaxHelper.methods.POST,
                data: e,
                contentType: eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                callback: function(e) {
                    var o = function(e) {
                        var o, t = {
                            type: eviivo.webcore.notifier.types.error,
                            message: p.resources.notifyMessages.onlineVoucherVerifyFailureMessage,
                            amountFormatted: null
                        };
                        return e.Success ? !0 !== e.CanBeRedeemed || d(e.Amount) ? !0 === e.HasCurrencyMismatch ? {
                            type: eviivo.webcore.notifier.types.error,
                            message: p.resources.notifyMessages.onlineVoucherVerifyVoucherCurrencyMismatch,
                            amountFormatted: null
                        } : !0 === e.HasExpired ? {
                            type: eviivo.webcore.notifier.types.error,
                            message: p.resources.notifyMessages.onlineVoucherVerifyHasExpiredMessage,
                            amountFormatted: null
                        } : !0 === e.IsVoided || !0 === e.DoesNotExist ? {
                            type: eviivo.webcore.notifier.types.error,
                            message: p.resources.notifyMessages.onlineVoucherVerifyCannotBeRedeemedMessage,
                            amountFormatted: null
                        } : t : (o = (e = Y(e.Amount)).amountForText,
                        e = e.amountForInput,
                        {
                            type: eviivo.webcore.notifier.types.success,
                            message: p.resources.notifyMessages.onlineVoucherVerifySuccessMessage.format(o),
                            amountFormatted: e
                        }) : t
                    }(e)
                      , t = Globalize.parseNumber(so.val());
                    d(e.Amount) || d(o.amountFormatted) || ee(e.Amount, o.amountFormatted),
                    eviivo.webcore.notifier.show({
                        type: o.type,
                        message: o.message
                    }),
                    g.removeClass("active").addClass("hide"),
                    M.prop("disabled", !1),
                    R.prop("disabled", o.type === eviivo.webcore.notifier.types.error || t <= 0)
                },
                failCallback: function() {
                    eviivo.webcore.notifier.show({
                        type: eviivo.webcore.notifier.types.error,
                        message: p.resources.notifyMessages.onlineVoucherVerifyFailureMessage
                    }),
                    g.removeClass("active").addClass("hide"),
                    M.prop("disabled", !1)
                }
            })
        }
        function Z() {
            var n;
            S = this,
            f.valid() && (R.prop("disabled", !0),
            g.removeClass("hide").addClass("active"),
            m.html(p.resources.loadingMessages.onlineVoucherRedeemLoadingMessage),
            n = {
                orderReference: v,
                amount: y.val(),
                currencyCode: B,
                note: w.val(),
                businessId: c,
                voucher: {
                    code: Yo.val().trim(),
                    voucherPartnerShortName: qe
                },
                chargeItemIds: Eo
            },
            eviivo.webcore.ajaxHelper.executeAjax({
                actionId: "online-voucher-redeem",
                url: eviivo.eagle.urls.onlineVouchers.Redeem,
                method: eviivo.webcore.ajaxHelper.methods.POST,
                data: n,
                contentType: eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                callback: function(e) {
                    var o, t, a, i;
                    o = e,
                    e = n.amount,
                    o.Success ? (t = Y(o.RemainingAmount),
                    a = t.amountForText,
                    i = t.amountForInput,
                    eviivo.webcore.notifier.show({
                        type: eviivo.webcore.notifier.types.success,
                        message: p.resources.notifyMessages.onlineVoucherRedeemSuccessMessage.format(Globalize.formatCurrency(Globalize.parseNumber(e), B), a)
                    }),
                    L(function() {
                        Be(!1),
                        Le(),
                        s(!1, null, null, !1),
                        d(o.RemainingAmount) || d(i) || ee(o.RemainingAmount, i)
                    }),
                    g.removeClass("active").addClass("hide")) : (eviivo.webcore.notifier.show({
                        type: eviivo.webcore.notifier.types.error,
                        message: o.ErrorMessage
                    }),
                    g.removeClass("active").addClass("hide"),
                    R.prop("disabled", !1))
                },
                failCallback: function() {
                    eviivo.webcore.notifier.show({
                        type: eviivo.webcore.notifier.types.error,
                        message: p.resources.notifyMessages.onlineVoucherRedeemErrorMessage
                    }),
                    g.removeClass("active").addClass("hide"),
                    R.prop("disabled", !1)
                }
            }))
        }
        function ee(e, o) {
            var t, a, i = Globalize.parseNumber(so.val());
            t = i,
            a = e.Amount,
            t < a || t === a ? He(Globalize.formatNumber(i, {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            })) : He(o, e.Currency.Accuracy, e.Currency.Accuracy)
        }
        function oe() {
            R.prop("disabled", !0),
            Yo.val().trim() ? M.prop("disabled", !1) : M.prop("disabled", !0)
        }
        function te() {
            e()
        }
        function l(e, o, t, a) {
            g.removeClass("active").addClass("hide"),
            void 0 !== S && jQuery(S).prop("disabled", !1),
            xe(e, "false"),
            (e === E.charge || e === E.refund || e === E.voidPayment ? G : Q)()
        }
        function ae() {
            var e = eviivo.util.safeFunction("eviivo.pms.businessSettingsAndDefaultMessages.getValue");
            if (!d(e))
                return e = e(c),
                mo = d(e) ? null : e.MerchantCurrencyCode,
                !d(mo) && 3 === mo.length
        }
        function ie() {
            var e = eviivo.util.safeFunction("eviivo.pms.businessSettingsAndDefaultMessages.getValue");
            return !d(e) && e(c).MerchantStatus.toLowerCase() === et.NoMerchant
        }
        function ne(e, o) {
            var t, a;
            return g.removeClass("active").addClass("hide"),
            e.html(o),
            "string" == typeof To && (xo && se(N, To, !0),
            t = "boolean" == typeof N ? N : !d(N) && "true" === N.toLowerCase(),
            L(function() {
                Be(t)
            }),
            xe(To, N)),
            "string" == typeof j && (j === E.chargePreauth.toString() ? wo || s(P, j, !0) : (eviivo.eagle.gridBlock.updateBookingElement(null, u),
            wo || (g.removeClass("active").addClass("hide"),
            xe(j, P))),
            a = "boolean" == typeof P ? P : !d(P) && "true" === P.toLowerCase(),
            L(function() {
                Be(a)
            })),
            1
        }
        function s(e, o, t) {
            var a, i = !(3 < arguments.length && void 0 !== arguments[3]) || arguments[3];
            Re(e) ? (a = JSON.parse(e),
            N = a.Success,
            Bo = a.ErrorMessage) : N = e,
            To = o,
            xo = "undefined" !== t && t,
            eviivo.eagle.viewBookingPopup.updateOrderBookings(!1, !0),
            eviivo.eagle.gridBlock.updateBookingElement(null, u),
            eviivo.webcore.ajaxHelper.executeAjax({
                actionId: "paymentMultiCard.getPayments",
                url: eviivo.eagle.urls.paymentMultiCard.Payments,
                method: eviivo.webcore.ajaxHelper.methods.GET,
                data: {
                    orderReference: v,
                    businessId: c,
                    isGiftVoucherIntegrationEnabled: Je
                },
                contentType: eviivo.webcore.ajaxHelper.contentTypes.TEXT_HTML,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.HTML,
                callback: function(e) {
                    xo = !0,
                    ne(Xe, e),
                    G(),
                    $("#payments-refunds-collapse").prop("checked") && $('label[for="payments-refunds-collapse"]').click()
                },
                failCallback: l
            }),
            function(e) {
                var o = !(0 < arguments.length && void 0 !== e) || e;
                eviivo.webcore.ajaxHelper.executeAjax({
                    actionId: "paymentMultiCard.getOrderBookingCharges",
                    url: eviivo.eagle.urls.paymentMultiCard.OrderBookingCharges,
                    method: eviivo.webcore.ajaxHelper.methods.GET,
                    data: {
                        orderReference: v,
                        businessId: c
                    },
                    contentType: eviivo.webcore.ajaxHelper.contentTypes.TEXT_HTML,
                    dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                    callback: function(e) {
                        ne(Ke, e.HtmlPayload),
                        $e(),
                        Ee(o)
                    },
                    failCallback: l
                })
            }(i)
        }
        function se() {
            var e;
            Re(arguments[0]) ? (e = JSON.parse(arguments[0]),
            P = e.Success,
            Io = e.ErrorMessage) : P = arguments[0],
            j = arguments[1],
            wo = !d(arguments[2]) && arguments[2],
            j === E.preauth.toString() && w.val(""),
            a()
        }
        function re(e) {
            if ((n = h.val()) !== H.EviivoSuite || ae()) {
                switch (we(e),
                So.hide(),
                n) {
                case H.AccountTransfer:
                    paymentProcessContainer.attr("data-layout", "account");
                    break;
                case H.BankTransfer:
                    paymentProcessContainer.attr("data-layout", "bank-transfer");
                    break;
                case H.CardReader:
                    paymentProcessContainer.attr("data-layout", "card-reader");
                    break;
                case H.Cash:
                    paymentProcessContainer.attr("data-layout", "cash");
                    break;
                case H.Cheque:
                    paymentProcessContainer.attr("data-layout", "cheque");
                    break;
                case H.EviivoSuite:
                    paymentProcessContainer.attr("data-layout", "via-system");
                    break;
                case H.GiftCertificate:
                    paymentProcessContainer.attr("data-layout", "gift-certificate");
                    break;
                case H.OtaVirtualCard:
                    paymentProcessContainer.attr("data-layout", "virtual-card");
                    break;
                case H.PayPal:
                    paymentProcessContainer.attr("data-layout", "paypal");
                    break;
                case H.TravellersCheque:
                    paymentProcessContainer.attr("data-layout", "travellers-cheque");
                    break;
                default:
                    paymentProcessContainer.removeAttr("data-layout")
                }
                "-" === n ? (ve(!1),
                pe(!1),
                ge(!1),
                fe(!1),
                he(!1),
                be(!1),
                Co.hide(),
                C.disable(),
                D.disable(),
                me(!1),
                Me(!1),
                jo.hide(),
                No.hide(),
                Ao.hide()) : (I.show(),
                eviivo.webcore.parsers.stringToBool(ho.val()) && n === H.EviivoSuite && I.hide(),
                ve(!1),
                ge(!1),
                me(!1),
                pe(!1),
                y.enable(),
                C.disable(),
                Me(!1),
                Co.hide(),
                jo.show(),
                jQuery(".ui-datepicker-trigger").removeAttr("disabled"),
                No.hide(),
                Ao.hide(),
                le(n) && (e = n,
                he(!1),
                e = $("#PaymentMethod-" + e),
                isNaN(e.val()) && be(0 !== Globalize.parseNumber(ro.val())),
                be(0 !== Globalize.parseNumber(ro.val()) && 0 < e.val()),
                Me(!0),
                ge(!0),
                jo.hide(),
                Ao.show()),
                n === H.EviivoSuite && (Do.show(),
                Po.show(),
                jo.hide(),
                No.show(),
                Oo.hide(),
                Ao.show(),
                Me(!0),
                ve(!0),
                ge(!0),
                me(!1),
                Co.show(),
                ce(!1)),
                n === H.CardReader && (Do.show(),
                Po.show(),
                jo.show(),
                No.hide(),
                Oo.show(),
                Ao.hide(),
                me(!0),
                ie()) && 0 < b.find("option").length && b.prop("disabled", !1),
                n == H.Voucher && Je && (pe(!0),
                eviivo.webcore.ajaxHelper.executeAjax({
                    actionId: "online-voucher-latest-guest-voucher",
                    url: eviivo.eagle.urls.onlineVouchers.GetLatestGuestVoucherByBookingId.format(We),
                    method: eviivo.webcore.ajaxHelper.methods.GET,
                    contentType: eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,
                    dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                    callback: function(e) {
                        var o;
                        d(e = e) || d(e.GuestVoucher) || (o = Y(e.GuestVoucher.RemainingBalance).amountForInput,
                        Yo.val(e.GuestVoucher.ExternalVoucherCode),
                        y.val(o),
                        M.prop("disabled", !1))
                    }
                })))
            } else
                xe(E.changePaymentMethod, "false")
        }
        function le(e) {
            for (var o in ot)
                if (ot[o] === e)
                    return 1
        }
        function de() {
            var e = jQuery("#card-select :selected").data("isccvirtual");
            _e = !d(e) && "true" === e.toLowerCase(),
            we(!0),
            vo.hide(),
            k.val(""),
            Ze.prop("disabled", !0),
            k.disable(),
            ao.show(),
            h.val() === H.EviivoSuite && Me(!0),
            "false" === po.val().toLowerCase() && 0 !== i() && x.toggleEnable(h.val() === H.EviivoSuite),
            ce(!0)
        }
        function ce(e) {
            _e ? (D.prop("checked", !1),
            D.disable(),
            C.disable(),
            x.disable(),
            n = h.val(),
            ko && !le(n) && I.enable(),
            eviivo.webcore.parsers.stringToBool(isOtaOrWlsVccOrder.val()) && !e && (O = outstandingVccValue.val(),
            y.val(O)),
            So.show()) : So.hide()
        }
        function ue() {
            y.enable(),
            T.removeClass("hide"),
            I.removeClass("hide"),
            n === H.EviivoSuite && fe(0 !== Globalize.parseNumber(uo.val())),
            w.enable(),
            w.enable(),
            b.prop("disabled", !1),
            w.enable(),
            eo = $("#preauth-table-container").find(".s-delete-preauth"),
            oo = $("#preauth-table-container").find(Lo),
            ke(),
            eo.on(F, J),
            oo.on(F, W),
            Jo.on("click", De),
            Qo.on("keyup", Qe)
        }
        function ve(e) {
            e ? (vo.show(),
            to.show(),
            ao.show(),
            b.prop("disabled", !1)) : (vo.hide(),
            to.hide(),
            ao.hide(),
            x.disable(),
            T.removeClass("hide"),
            I.removeClass("hide"),
            y.enable(),
            w.enable(),
            b.prop("disabled", !0)),
            ue()
        }
        function pe(e) {
            !0 === e ? (Wo.is(":hidden") && zo.show(),
            Xo.show(),
            M.show(),
            R.show(),
            T.hide(),
            x.hide(),
            requestPaymentButton.hide(),
            I.hide()) : (Wo.is(":visible") && zo.hide(),
            Xo.hide(),
            M.hide(),
            R.hide(),
            T.show(),
            x.show(),
            requestPaymentButton.show(),
            I.show())
        }
        function ge(e) {
            e ? (Oe(I, p.resources.labels.charge),
            Oe(T, p.resources.labels.refund)) : (Oe(I, p.resources.labels.recordCharge),
            Oe(T, p.resources.labels.recordRefund))
        }
        function me(e) {
            e ? (vo.show(),
            k.val(""),
            k.enable(),
            Ze.prop("disabled", !1)) : (vo.hide(),
            k.disable(),
            Ze.prop("disabled", !0))
        }
        function fe(e) {
            e ? x.enable() : x.disable()
        }
        function he(e) {
            e ? I.enable() : I.disable()
        }
        function be(e) {
            e ? T.enable() : T.disable()
        }
        function ye(e, o) {
            return e.find("option[value='" + o + "']").index()
        }
        function Ce() {
            p.isBookingCancelled && jQuery("#divPreauthWarning").hide()
        }
        function ke() {
            Go = $(".s-chargepreauth-validation-message"),
            Qo = $("input[id^='chargePreAuthAmount']"),
            $o = $(".charge-container"),
            Lo = ".s-charge-preauth",
            _o = $("input[id^='hdChargePreAuthAmount']"),
            qo = $(".s-preauth-charge-currency-value-display"),
            Vo = "input[id^='chargePreAuthAmount_']",
            Jo = $(".s-charge-preauth-modal-btn"),
            chargePreauthModal = $(".s-charge-preauth-modal")
        }
        function i() {
            var e;
            return go.val().toLowerCase() !== et.EviivoMerchant && go.val().toLowerCase() !== et.OwnMerchant || n !== H.EviivoSuite ? (e = Globalize.parseNumber(so.val())) < 0 ? 0 : e : Globalize.parseNumber(lo.val())
        }
        function we(e) {
            var o = i();
            tt.eMax = o,
            fe(n === H.EviivoSuite && 0 !== Globalize.parseNumber(uo.val())),
            le(n = h.val()) || he(0 !== o || _e && ko),
            be(0 !== Globalize.parseNumber(ro.val())),
            y.rules("remove"),
            y.rules("add", tt),
            jQuery.extend(f.validate().settings.messages, Ae(o)),
            e && (f.validate().resetForm(),
            no.empty().hide())
        }
        function Ie() {
            y.rules("remove"),
            y.rules("add", tt),
            Ae(i())
        }
        function Te() {
            var e = jQuery.extend(!0, {}, p.resources.labels).chargeUpToLabel.format(Globalize.formatCurrency(i(), B))
              , o = bo.attr("data-tooltip-base");
            bo.attr("data-tooltip-title", o + "<br/>" + e),
            yo.attr("data-tooltip-title", o + "<br/>" + e)
        }
        function xe(e, o) {
            var t = ""
              , a = "boolean" == typeof o ? o : !d(o) && "true" === o.toLowerCase();
            switch (e) {
            case E.charge.toString():
                t = n === H.EviivoSuite || le(n) ? a ? p.resources.notifyMessages.chargeSuccessMessage : d(Bo) || "" === Bo ? p.resources.notifyMessages.chargeFailureMessage : Bo : p.resources.notifyMessages.recordChargeSuccessMessage;
                break;
            case E.refund.toString():
                t = n === H.EviivoSuite || le(n) ? a ? p.resources.notifyMessages.refundSuccessMessage : p.resources.notifyMessages.refundFailureMessage : p.resources.notifyMessages.recordRefundSuccessMessage;
                break;
            case E.chargePreauth.toString():
                t = a ? p.resources.notifyMessages.preauthChargeSuccessMessage : p.resources.notifyMessages.preauthChargeFailureMessage;
                break;
            case E.releasePreauth.toString():
                t = a ? p.resources.notifyMessages.preauthCancelSuccessMessage : p.resources.notifyMessages.preauthCancelFailureMessage;
                break;
            case E.preauth.toString():
                t = a ? p.resources.notifyMessages.preauthSuccessMessage : d(Io) || "" === Io ? p.resources.notifyMessages.preauthFailureMessage : Io;
                break;
            case E.changePaymentMethod.toString():
                t = p.resources.notifyMessages.missingMerchantCurrency;
                break;
            case E.reconsiliation.toString():
                t = a ? eviivo.webcore.notifier.types.success : eviivo.webcore.notifier.types.error
            }
            d(t) || "" === t || eviivo.webcore.notifier.show({
                type: a ? eviivo.webcore.notifier.types.success : eviivo.webcore.notifier.types.error,
                message: t
            })
        }
        function Be(e) {
            Se(),
            Te(),
            we(!1),
            e && (e = Globalize.formatNumber(i(), {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }),
            O = e < 0 ? 0 : e,
            y.val(O),
            Uo.html(Ne(y)))
        }
        function Se() {
            jQuery("#divDetails #DueNowValue"),
            so = jQuery("#divDetails #balanceValue"),
            ro = jQuery("#divDetails #paidValue"),
            lo = jQuery("#divDetails #hdnMaxOnlinePayment"),
            co = jQuery("#divDetails #hdnMaxOnlineRefund"),
            uo = jQuery("#divDetails #hdnMaxPreauthAmount");
            var e = jQuery("#divDetails #hdnOverrideMaxOnlinePaymentVirtualCard").val();
            ko = !d(e) && "true" === e.toLowerCase()
        }
        function De() {
            var e = $(this).siblings(chargePreauthModal)
              , o = e.find(Vo);
            e.find(qo).html(Ne($(o)))
        }
        function Pe() {
            Uo.html(Ne($(this)))
        }
        function je(e) {
            e.preventDefault(),
            jQuery("#payment-table-container button.s-void-payment-cancel").trigger("notify-hide"),
            S = this;
            var e = jQuery(this)
              , o = e.data("item-id")
              , t = eviivo.webcore.parsers.stringToBool(e.data("item-online-voucher"));
            e.notify({
                text: p.resources.notifyMessages.voidMessage,
                icon: "&#xe93a;",
                buttonOne: "<button class='btn btn-cancel btn-secondary mr10 s-void-payment-cancel' type='button'> ".concat(p.resources.labels.no, " </button>"),
                buttonTwo: "<button class='btn btn-right s-void-payment-submit' type='button' data-item-id='".concat(o, "' data-item-online-voucher='").concat(t, "'> ").concat(p.resources.labels.yes, " </button>")
            }, {
                style: "withTwoActions",
                className: "action v-2",
                position: "top right",
                autoHideDelay: "100000",
                clickToHide: !0
            })
        }
        function Ne(e) {
            if (ae())
                return "" == (e = e.prop("value")) || null === Ue || isNaN(e) ? "" : (e = eviivo.webcore.decimals.precisionPointMultiplication(Globalize.parseNumber(e), Ue),
                Globalize.formatCurrency(e, mo))
        }
        function Ae(e) {
            var o = jQuery.extend(!0, {}, p.resources.validation);
            return o["amount-input"].max = o["amount-input"].max.format(Globalize.formatCurrency(e, B)),
            Te(),
            o
        }
        function Oe(e, o) {
            e.html("<span>" + o + "</span>")
        }
        function Me(e) {
            e ? (D.prop("checked", !0),
            C.removeAttr("style"),
            D.prop("checked") && C.enable(),
            go.val().toLowerCase() === et.EviivoMerchant ? D.disable() : D.enable()) : (D.prop("checked", !1),
            C.css("text-indent", "-9999em"))
        }
        function d(e) {
            return null == e || "undefined" === e
        }
        function Re(e) {
            var o;
            try {
                o = JSON.parse(e)
            } catch (e) {
                return
            }
            return "object" === r(o) && null !== o
        }
        function Ee() {
            var e = !(0 < arguments.length && void 0 !== arguments[0]) || arguments[0]
              , o = $(Fo).length;
            0 == o ? $(".s-charge-title").text(p.resources.labels.pleaseSelect) : $(".s-charge-title").text(p.resources.labels.selectedLabel.format(o)),
            e && He(),
            Eo = [],
            Ge().forEach(function(e, o) {
                Fe(e).ChargeIds.forEach(function(e) {
                    return Eo.push(e)
                })
            })
        }
        function He(e, o, t, a) {
            var i = 0 < arguments.length && void 0 !== e ? e : null
              , n = 1 < arguments.length && void 0 !== o ? o : 2
              , s = 2 < arguments.length && void 0 !== t ? t : 2
              , r = 3 < arguments.length && void 0 !== a && a
              , i = d(i) ? function() {
                var e = Ge();
                {
                    var t;
                    return 0 < e.length ? (t = [],
                    e.forEach(function(e, o) {
                        e = Fe(e);
                        t.push(e.Amount)
                    }),
                    function(e) {
                        var o = 0;
                        0 < e.length && (o = e.reduce(function(e, o) {
                            return (1e3 * e + 1e3 * o) / 1e3
                        }));
                        return o
                    }(t)) : O
                }
            }() : i;
            y.val(i, {
                minimumFractionDigits: n,
                maximumFractionDigits: s,
                useGrouping: r
            }),
            eviivo.webcore.decimals.fixDecimalSymbolDisplay(y[0], Globalize._numberSymbol("decimal", Globalize.cldr)),
            Uo.html(Ne(y))
        }
        function Fe(o) {
            var t;
            return Ho.forEach(function(e) {
                e = e.Charges.find(function(e) {
                    return e.Key == o
                });
                void 0 !== e && (t = e)
            }),
            t
        }
        function Ge() {
            return $(Fo).map(function(e, o) {
                return o.value
            }).get()
        }
        function $e() {
            $(".s-charges-list input").on("click", Ee)
        }
        function Qe() {
            var e = $(this).closest($o)
              , o = Globalize.parseNumber($(this).val())
              , t = $(e).find(_o).val()
              , a = $(e).find(Lo)
              , i = $(e).siblings(Go)
              , t = Globalize.parseNumber(t);
            $(i).addClass("error-asterix"),
            $(a).prop("disabled", !0),
            isNaN(o) ? ($(i).html(p.resources.labels.notANumber),
            e.find(qo).html("")) : (o <= 0 ? $(i).html(p.resources.labels.valueCantBeZeroOrLess) : t < o ? $(i).html(p.resources.labels.valueCantBeMoreThan) : ($(i).removeClass("error-asterix"),
            $(i).html(p.resources.labels.releaseRemainingPreauth),
            chargePreAuthAmountInputIsValid = !0,
            $(a).prop("disabled", !1)),
            e.find(qo).html(Ne($(this))))
        }
        function Le() {
            var e = Globalize.formatNumber(i(), {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
            O = e < 0 ? 0 : e
        }
        var c, u, v, p, Ve, _e, Ue, qe, Je, We, n, ze, g, m, f, Xe, Ye, Ke, h, b, y, C, Ze, k, w, I, T, x, eo, oo, to, ao, io, no, so, ro, lo, co, uo, vo, po, go, mo, B, fo, ho, S, D, bo, yo, Co, ko, P, j, wo, Io, N, To, xo, Bo, So, Do, Po, jo, No, Ao, Oo, A, Mo, Ro, Eo, Ho, Fo, O, Go, $o, Qo, Lo, Vo, _o, Uo, qo, Jo, Wo, zo, Xo, M, R, Yo, Ko, Zo, et, E, H, ot, tt, at, F, it, nt;
        window.eviivo = window.eviivo || {},
        window.eviivo.eagle = window.eviivo.eagle || {},
        window.eviivo.eagle.paymentMultiCard = window.eviivo.eagle.paymentMultiCard || {},
        window.eviivo.eagle.paymentMultiCard = (Zo = {},
        et = {
            EviivoMerchant: "e",
            OwnMerchant: "m",
            NoMerchant: "n"
        },
        E = {
            charge: "paymentMultiCard.Charge",
            refund: "paymentMultiCard.Refund",
            preauth: "paymentMultiCard.PreAuth",
            chargePreauth: "paymentMultiCard.ChargePreAuth",
            releasePreauth: "paymentMultiCard.ReleasePreAuth",
            voidPayment: "paymentMultiCard.VoidPayment",
            loadTab: "loadTab",
            changePaymentMethod: "paymentMultiCard.ChangePaymentMethod",
            reconsiliation: "paymentMultiCard.Reconciliation"
        },
        H = {
            NotProvided: "-",
            EviivoSuite: "ES",
            CardReader: "CR",
            OtaVirtualCard: "OV",
            Cash: "CH",
            AccountTransfer: "AC",
            Cheque: "CQ",
            BankTransfer: "BK",
            TravellersCheque: "TC",
            GiftCertificate: "GC",
            Voucher: "GV"
        },
        ot = {
            Bancontact: "BC",
            Epsuberweisung: "EP",
            GiroPay: "GP",
            iDeal: "ID",
            Paylib: "PL",
            Przelewy24: "PZ",
            SofortDE: "SD",
            PayPal: "PP"
        },
        tt = {
            eRequired: !0,
            eNumber: !0,
            eDisallowGroupingSeparator: !0,
            eTwoDecimalPlaces: !0,
            eMin: .01
        },
        at = "eviivo_eagle_viewPayments",
        F = eviivo.util.namespacedEvent("click", at),
        it = eviivo.util.namespacedEvent("change", at),
        nt = null,
        {
            init: function(e) {
                p = jQuery.extend(Zo, e),
                eviivo.util.addHotjarRecordingTags(["ViewPayments"])
            },
            open: function(e) {
                p = jQuery.extend(!0, {}, p, e),
                ze = p.container,
                g = jQuery("#booking-popup-spinner"),
                m = jQuery("#booking-popup-spinner .spinner-message"),
                We = p.bookingId,
                c = p.businessId,
                u = p.id,
                v = p.orderReference,
                Ve = p.cardTokenId,
                m.html(p.resources.loadingMessages.loadTab),
                g.removeClass("hide").addClass("active"),
                eviivo.webcore.ajaxHelper.executeAjax({
                    actionId: "paymentMultiCard.loadPaymentTab",
                    url: eviivo.eagle.urls.paymentMultiCard.PaymentMultiCardTab,
                    method: eviivo.webcore.ajaxHelper.methods.GET,
                    data: {
                        orderId: u,
                        orderReference: v,
                        businessId: c
                    },
                    contentType: eviivo.webcore.ajaxHelper.contentTypes.TEXT_HTML,
                    dataType: eviivo.webcore.ajaxHelper.dataTypes.HTML,
                    callback: function(e) {
                        function o() {
                            f.valid()
                        }
                        var t, a;
                        ne(t = ze, e = e) ? (f = jQuery("#payments-tab-form"),
                        g = jQuery("#booking-popup-spinner"),
                        Xe = jQuery("#payment-table-container"),
                        Ye = jQuery("#preauth-table-container"),
                        Ke = jQuery("#charges-container"),
                        h = jQuery("#payment-method-select"),
                        b = jQuery("#card-select"),
                        Ze = jQuery("#card-type-select"),
                        k = jQuery("#card-ending-input"),
                        y = jQuery("#amount-input"),
                        C = jQuery("#email-confirmation-input"),
                        D = jQuery("#confirm-by-email-check"),
                        w = jQuery("#description-input"),
                        I = jQuery("#charge-btn"),
                        T = jQuery("#refund-btn"),
                        x = jQuery("#preauth-btn"),
                        requestPaymentButton = jQuery("#request-payment-btn"),
                        to = jQuery("#manage-cards-add"),
                        ao = jQuery("#manage-cards-edit"),
                        io = jQuery("#payment-processed-date"),
                        no = jQuery("#payments-validation-summary"),
                        paymentProcessContainer = jQuery("#payment-process"),
                        po = jQuery("#HasOutstandingPreAuth"),
                        go = jQuery("#merchantStatusCode"),
                        B = jQuery("#workingCurrency").val(),
                        fo = jQuery("#merchantCurrencyConversionRate"),
                        ho = jQuery("#CardChargingDisabled"),
                        bo = jQuery("#chargeUpToTooltipDynamic"),
                        yo = jQuery("#preauthChargeUpToTooltipDynamic"),
                        jQuery("#chargeUpToTooltip"),
                        Co = jQuery("#chargeUpToPanel"),
                        Se(),
                        Do = jQuery("#description-input-container"),
                        Po = jQuery("#amount-input-container"),
                        jo = jQuery("#date-processed-input-container"),
                        No = jQuery("#card-selection-container"),
                        vo = jQuery(".s-card-type-and-ending-panel"),
                        Ao = jQuery("#email-input-container"),
                        Oo = jQuery("#card-ending-input-container"),
                        So = jQuery("#virtual-card-warning"),
                        Ro = jQuery("#reconciliation-btn"),
                        A = jQuery("#reconciliation-date"),
                        Mo = jQuery("#reconciliationAmount-input"),
                        isOtaOrWlsVccOrder = jQuery("#isOtaOrWlsVccOrder"),
                        outstandingVccValue = jQuery("#outstandingVccValue"),
                        securedChargesSelector = "label[id^='chargeIsSecured-item']",
                        Fo = ".s-charges-list .cp-custom-input input:checked",
                        chargeIdInputSelector = "input[id^='chargeId-item']",
                        Uo = $("#merchant-currency-value-display"),
                        ke(),
                        Ko = "#paymentAmount_",
                        Wo = jQuery("#relating-to-container"),
                        zo = jQuery("#voucher-placeholder-panel"),
                        Xo = jQuery("#voucher-code-input-container"),
                        M = jQuery("#verify-voucher-btn"),
                        R = jQuery("#redeem-voucher-btn"),
                        Yo = jQuery("#voucher-code-input"),
                        O = y.val(),
                        e = "option[value='" + H.EviivoSuite + "']",
                        d(nt) && h.find(e).clone(),
                        ae() ? 0 !== h.find(e).length || d(nt) || nt.insertAfter(h.find("option:first-child")) : (Ve = null,
                        h.find(e).remove(),
                        h.val(H.Cash),
                        ie() || (b.find("option").remove(),
                        jQuery("#preauth-table-container").hide())),
                        Ee(),
                        x.on(F, q),
                        I.on(F, _),
                        T.on(F, U),
                        requestPaymentButton.on(F, te),
                        jQuery("#payment-table-container").on("click", "button.s-void-payment", je),
                        jQuery("#payment-table-container").on("click", "button.s-void-payment-cancel", function() {
                            jQuery(this).trigger("notify-hide")
                        }),
                        jQuery("#payment-table-container").on("click", "button.s-void-payment-submit", V),
                        to.on(F, function() {
                            p.selectCardsTabCallback(0)
                        }),
                        ao.on(F, function() {
                            var e = parseInt(b.val());
                            isNaN(e) || p.selectCardsTabCallback(e)
                        }),
                        h.on("change", function() {
                            re(!0)
                        }),
                        b.on("change", de),
                        "" !== fo.val() && y.on("keyup", Pe),
                        D.on(it, function() {
                            C.toggleEnable(D.prop("checked"))
                        }),
                        Ro.on(F, z),
                        function() {
                            var e = !(0 < arguments.length && void 0 !== arguments[0]) || arguments[0];
                            $(".s-select-all").on("click", function() {
                                $(this).toggleClass("active"),
                                $(this).hasClass("active") ? ($(".s-charges-list input").prop("checked", !0),
                                $(this).text(p.resources.labels.unselectAllLabel)) : ($(".s-charges-list input").prop("checked", !1),
                                $(this).text(p.resources.labels.selectAllLabel)),
                                Ee(e)
                            }),
                            $("#apply").on("click", function() {
                                $(".md-dd.active").removeClass("active")
                            }),
                            $e()
                        }(),
                        Qo.on("keyup", Qe),
                        Jo.on("click", De),
                        Je && (Yo.on("input", oe),
                        M.on(F, K),
                        R.on(F, Z)),
                        e = i(),
                        tt.eMax = e,
                        f.validate({
                            errorPlacement: function() {
                                return !0
                            },
                            onfocusout: !1,
                            onkeyup: !1,
                            onsubmit: !0,
                            errorClass: "error",
                            rules: {
                                "card-ending-input": {
                                    minlength: 4,
                                    maxlength: 4,
                                    digits: !0
                                },
                                "email-confirmation-input": {
                                    email: !0
                                }
                            },
                            messages: Ae(e)
                        }),
                        y.rules("remove"),
                        y.rules("add", tt),
                        f.addTriggersToJqueryValidate().triggerElementValidationsOnFormValidation(),
                        f.formValidation(function(e, o) {
                            var t, e = jQuery(e).validate().errorList;
                            e && e.length && (t = no.empty().append("<ul></ul>").find("ul"),
                            jQuery.each(e, function(e, o) {
                                t.append("<li>" + o.message + "</li>")
                            }),
                            no.html(t)),
                            no.toggle(!o)
                        }),
                        y.elementValidation(o),
                        k.elementValidation(o),
                        C.elementValidation(o),
                        e = (new Date).evStandardFirstDayCalendarOffset(eviivo.eagle.basePageModelState.userCultureCode),
                        io = eviivo.webcore.calendar.init(eviivo.webcore.calendar.CALENDAR_TYPE.initCalendar, {
                            defaultCultureCode: eviivo.eagle.basePageModelState.userCultureCode,
                            calendar: io,
                            buttonImage: eviivoSuiteApp + "/content/images/svg-individual-icons/date_range.svg",
                            showOn: "both",
                            dateFormat: eviivo.eagle.dateFormat.getDateFormat("LONG_DATE_FORMAT"),
                            firstDay: e,
                            maxDate: "0",
                            setInitialDate: Date.now().toString()
                        }),
                        a = "" != A.val() ? new Date(A.val()) : Date.now().toString(),
                        "" !== (A = eviivo.webcore.calendar.init(eviivo.webcore.calendar.CALENDAR_TYPE.initCalendar, {
                            defaultCultureCode: eviivo.eagle.basePageModelState.userCultureCode,
                            calendar: A,
                            buttonImage: eviivoSuiteApp + "/content/images/svg-individual-icons/date_range.svg",
                            showOn: "both",
                            dateFormat: eviivo.eagle.dateFormat.getDateFormat("LONG_DATE_FORMAT"),
                            firstDay: e,
                            maxDate: "0",
                            setDate: a
                        })).val() ? A.datepicker("setDate", A.val()) : A.datepicker("setDate", null),
                        de(),
                        d(Ve) && 0 < b.find("option").length && 0 < jQuery("#divPreauthWarning.hide").length && (e = ye(h, "-"),
                        h.prop("selectedIndex", e)),
                        "true" === po.val().toLowerCase() ? (w.disable(),
                        b.prop("disabled", !0)) : Ve && (a = ye(b, Ve.toString()),
                        b.prop("selectedIndex", a)),
                        re(!1),
                        Ce(),
                        Uo.html(Ne(y)),
                        e = "#divDetails",
                        Modernizr.localstorage && $(e + " .mod-collapsable").each(function() {
                            var e = $(this).find("input[type='checkbox']")
                              , o = e.attr("id")
                              , o = localStorage.getItem(o);
                            void 0 !== o && "checked" === o && e.prop("checked", !0)
                        }),
                        Modernizr.localstorage && $("body").on("click", ".mod-collapsable_title", function() {
                            var e = $(this).prev()
                              , o = e.attr("id");
                            e.is(":checked") ? localStorage.setItem(o, "") : localStorage.setItem(o, "checked")
                        }),
                        p.cardTokenId = null) : (t.html(""),
                        xe(E.loadTab, "false"))
                    },
                    failCallback: l
                })
            },
            initializeOrderBookingCharges: function(e) {
                Ho = e.orderBookingCharges
            },
            setConversionRate: function(e) {
                Ue = e.ConversionRate
            },
            setBusinessOnlineVoucherInformation: function(e) {
                qe = e.paymentGatewayCode,
                Je = e.showOnlineVoucherFields
            }
        })
    },
    2402: function() {
        function i() {
            A.hideCardsTab || (S.removeClass("hide").addClass("active"),
            eviivo.webcore.ajaxHelper.executeAjax({
                actionId: "viewBookingCards.GetPaymentCards",
                url: eviivo.eagle.urls.cards.Cards,
                method: eviivo.webcore.ajaxHelper.methods.GET,
                data: {
                    orderId: v,
                    businessId: p
                },
                contentType: eviivo.webcore.ajaxHelper.contentTypes.TEXT_HTML,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.HTML,
                callback: E,
                failCallback: a
            }))
        }
        function E(e) {
            c.html(e),
            S.removeClass("active").addClass("hide"),
            u = jQuery("#divCardDetails"),
            g = jQuery("#cardList li"),
            b = jQuery("#btnAddCard"),
            jQuery("#divCardDeleteSuccess"),
            guestCardsContainer = $("#guest-cards"),
            b.on(j, o),
            g.on(j, F);
            e = y;
            void 0 === (e = void 0 === e && 0 !== y ? g.first().attr("data-id") : e) || 0 === y ? o() : s(e),
            M && (r(eviivo.webcore.notifier.types.success, A.resources.cardDeleteSuccess),
            M = !1)
        }
        function t(e, o) {
            S.removeClass("hide").addClass("active"),
            eviivo.webcore.ajaxHelper.executeAjax({
                actionId: "viewBookingCards.GetPaymentCardDetails",
                url: eviivo.eagle.urls.cards.CardDetails,
                method: eviivo.webcore.ajaxHelper.methods.GET,
                data: {
                    cardTokenId: e,
                    orderId: v,
                    captchaResponse: o,
                    businessId: p
                },
                contentType: eviivo.webcore.ajaxHelper.contentTypes.TEXT_HTML,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.HTML,
                callback: H,
                failCallback: a
            })
        }
        function H(e) {
            u.html(e),
            n(),
            S.removeClass("active").addClass("hide"),
            O && (r(eviivo.webcore.notifier.types.success, A.resources.cardSaveSuccessful),
            O = !1)
        }
        function a() {
            S.removeClass("active").addClass("hide")
        }
        function n() {
            jQuery("#grecaptchaId").length ? eviivo.eagle.grechaptcha.onCaptchaLoaded() : (m = jQuery("#txtCardNumber"),
            f = jQuery("#ddlMonths"),
            h = jQuery("#ddlYears"),
            jQuery("#unsavedWarning"),
            jQuery("#divCardSuccess"),
            w = jQuery("#btnSaveAndUse"),
            x = jQuery("#btnSave"),
            B = jQuery("#cvc"),
            T = jQuery("#btnDelete"),
            I = jQuery("#btnViewCvc"),
            Y = jQuery("#lnkCancelBooking"),
            requestPaymentButton = jQuery("#request-payment-btn"),
            C = u.find("input"),
            k = u.find("select"),
            P = jQuery("#txtCardNumber, #cvc"),
            requestGuestPaymentEmailCode = jQuery("#request-guest-payment-email-code"),
            D = "True" == jQuery("#hdnCanEdit").val(),
            d(),
            m.on(K, J),
            C.on(Z, e),
            k.on(N, e),
            h.on(N, G),
            w.on(j, Q),
            I.on(j, V),
            T.on(j, U),
            eviivo.webcore.decimals.restrictFieldsForNumbers(P),
            Y.on(j, A.cancellCallback),
            0 < (P = jQuery("input:radio[name='paymentoption']:checked")).length && "true" === P.data("isccvirtual").toLowerCase() && T.disable(),
            m.trigger("focus"))
        }
        function o() {
            guestCardsContainer.addClass("adding-card"),
            b.prop("disabled", !0),
            s(ee);
            for (var e = 0; e < g.length; e++)
                g[e].getElementsByTagName("input")[0].checked = !1
        }
        function F(e) {
            e.preventDefault(),
            e.stopPropagation();
            e = jQuery(e.currentTarget).attr("data-id");
            guestCardsContainer.removeClass("adding-card"),
            b.prop("disabled", !1),
            s(e)
        }
        function G() {
            f.find("option").prop("disabled", !1);
            var e = (new Date).getFullYear().toString().substr(2, 2);
            h.val() == e && (e = (new Date).getMonth() + 1,
            f.find("option:lt(" + e + ")").prop("disabled", !0),
            f.find(":selected", !0).prop("disabled")) && f.find("option:nth-child(" + (e += 1) + ")").prop("selected", !0)
        }
        function Q() {
            var e;
            D ? (l(),
            X = jQuery("#saveCardForm"),
            jQuery(".notifyjs-wrapper").remove(),
            (e = X.serialize()).businessId = p,
            eviivo.webcore.ajaxHelper.executeAjax({
                actionId: "viewBookingCards.SaveAndUse",
                url: eviivo.eagle.urls.cards.PreAuthOrChargeCard,
                method: eviivo.webcore.ajaxHelper.methods.POST,
                data: e,
                contentType: eviivo.webcore.ajaxHelper.contentTypes.URL_ENCODED_UTF8,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.HTML,
                callback: L,
                failCallback: a
            })) : (e = parseInt(y),
            A.paymentsCallback(NaN !== e && 0 !== e ? e : void 0))
        }
        function L(e) {
            d(),
            u.html(e),
            y = y || jQuery("#Id").val();
            var e = u.find("#validationSummary");
            0 < e.length && "none" != e.css("display") ? n() : (e = parseInt(y),
            A.paymentsCallback(NaN !== e && 0 !== e ? e : void 0))
        }
        function V() {
            var e = jQuery("#Id").val()
              , o = jQuery("#CCTokenId").val();
            I.addClass("btn-saving").prop("disabled", !0),
            eviivo.webcore.ajaxHelper.executeAjax({
                actionId: "viewBookingCards.ViewCvc",
                url: eviivo.eagle.urls.cards.ViewCvc,
                method: eviivo.webcore.ajaxHelper.methods.GET,
                data: {
                    cardTokenId: e,
                    ccTokenId: o,
                    orderId: v,
                    businessId: p
                },
                contentType: eviivo.webcore.ajaxHelper.contentTypes.TEXT_HTML,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.HTML,
                callback: _,
                failCallback: a
            })
        }
        function _(e) {
            B.val(e),
            I.addClass("hide"),
            B.removeClass("hide"),
            w.attr("disabled", "disabled"),
            x.attr("disabled", "disabled"),
            C.attr("readonly", "readonly"),
            k.attr("disabled", "disabled"),
            I.removeClass("btn-saving").prop("disabled", !1)
        }
        function U() {
            l(),
            jQuery("#btnDelete").notify({
                text: A.resources.deletePaymentCard,
                icon: "&#xe961;",
                buttonOne: "<button class='btn btn-cancel btn-secondary' id='btn-cancel'>" + A.resources.cancelButton + "</button>",
                buttonTwo: "<button class='btn btn-right' id='btn-delete'>" + A.resources.deleteButton + "</button>"
            }, {
                style: "withTwoActions",
                className: "warn v-2",
                position: "bottom",
                autoHideDelay: "100000",
                clickToHide: !1
            }),
            jQuery(".mod-close-notice").on("click", function() {
                jQuery(".notifyjs-wrapper").remove(),
                d()
            }),
            jQuery("#btn-cancel").on("click", function() {
                jQuery(".notifyjs-wrapper").remove(),
                d()
            }),
            jQuery("#btn-delete").on("click", function() {
                var e;
                e = jQuery("#Id").val(),
                T.addClass("loading"),
                d(),
                eviivo.webcore.ajaxHelper.executeAjax({
                    actionId: "viewBookingCards.DeleteCard",
                    url: eviivo.eagle.urls.cards.DeleteCard,
                    method: eviivo.webcore.ajaxHelper.methods.GET,
                    data: {
                        cardTokenId: e,
                        orderId: v,
                        businessId: p
                    },
                    contentType: eviivo.webcore.ajaxHelper.contentTypes.TEXT_HTML,
                    dataType: eviivo.webcore.ajaxHelper.dataTypes.HTML,
                    callback: q,
                    failCallback: a
                }),
                jQuery(".notifyjs-wrapper").remove()
            })
        }
        function q() {
            M = !0,
            y = void 0,
            i(),
            T.removeClass("loading"),
            d()
        }
        function J() {
            m.validateCreditCard(W)
        }
        function W(e) {
            e.length_valid && e.luhn_valid ? m.parent().removeClass("cp-cc-valid").addClass("cp-cc-valid") : m.parent().removeClass("cp-cc-valid");
            var o = m.hasClass("input-validation-error");
            null != e.card_type ? m.attr("class", "").addClass("cp-cc-input stretch-input cp-cc-" + e.card_type.name) : m.attr("class", "").addClass("cp-cc-input stretch-input cp-cc-empty"),
            o && m.addClass("input-validation-error")
        }
        function s(e) {
            var o = jQuery("#card_" + e);
            0 < o.length && (o[0].checked = !0),
            y = e,
            t(parseInt(e, 10))
        }
        function z(e) {
            S.removeClass("active").addClass("hide"),
            e ? t(parseInt(y, 10)) : $("#passwordValidationSection").removeClass("hide")
        }
        function r(e, o) {
            jQuery(".notifyjs-wrapper").is(":visible") && $(".notifyjs-wrapper").remove(),
            eviivo.webcore.notifier.show({
                type: e,
                message: o
            })
        }
        function e() {
            D && 0 < y && r(eviivo.webcore.notifier.types.warn, A.resources.cardsUnsavedChanges)
        }
        function l() {
            x.prop("disabled", !0),
            w.prop("disabled", !0),
            b.prop("disabled", !0),
            T.prop("disabled", !0)
        }
        function d() {
            x.prop("disabled", !1),
            w.prop("disabled", !1),
            T.prop("disabled", !1)
        }
        var c, u, v, p, g, m, f, h, b, y, C, k, w, X, I, T, x, B, S, Y, D, P, j, K, Z, N, A, O, M, ee, R;
        window.eviivo = window.eviivo || {},
        window.eviivo.eagle = window.eviivo.eagle || {},
        window.eviivo.eagle.viewBookingCards = window.eviivo.eagle.viewBookingCards || {},
        window.eviivo.eagle.viewBookingCards = (M = O = !1,
        ee = 0,
        R = "eviivo_eagle_viewBookingCards",
        {
            init: function(e) {
                eviivo.util.addHotjarRecordingTags(["ViewCards"]),
                A = e,
                S = jQuery("#booking-popup-spinner"),
                jQuery("#booking-popup-spinner .spinner-message").html(A.resources.StandardLoaderMessage),
                c = A.container,
                v = A.id,
                p = A.businessId,
                y = A.cardTokenId,
                j = eviivo.util.namespacedEvent("click", R),
                K = eviivo.util.namespacedEvent("focus", R),
                Z = eviivo.util.namespacedEvent("keyup", R),
                N = eviivo.util.namespacedEvent("change", R),
                i()
            },
            initCardDetails: n,
            getPaymentCards: i,
            loadPaymentCardDetails: function(e) {
                e ? t(parseInt(y, 10), e) : s(y)
            },
            onAddPaymentCardSuccess: function() {
                var e = jQuery(".mod-cardDetails input").hasClass("input-validation-error")
                  , o = jQuery(".mod-cardDetails select").hasClass("input-validation-error")
                  , t = jQuery("#upsertOrderCardTokenError")
                  , a = 0 < t.length && 0 < t.val().length;
                e || o || a ? (n(),
                a && r(eviivo.webcore.notifier.types.error, t.val())) : (y = jQuery("#Id").val(),
                n(),
                O = !0,
                i())
            },
            disableButtons: l,
            singleSignOnUserGrantFullRights: function() {
                S.removeClass("hide").addClass("active"),
                eviivo.webcore.ajaxHelper.executeAjax({
                    actionId: "viewBookingCards.SingleSignOnUserGrantFullRights",
                    url: eviivo.eagle.urls.cards.SingleSignOnUserGrantFullRights,
                    method: eviivo.webcore.ajaxHelper.methods.POST,
                    data: {
                        password: $("#txtPassword").val()
                    },
                    contentType: eviivo.webcore.ajaxHelper.contentTypes.TEXT_JSON,
                    dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                    callback: z,
                    failCallback: a
                })
            }
        })
    },
    9976: function() {
        function o(e, o, t) {
            X(e, o, t),
            Ie = jQuery("#chargeCategoryJson"),
            i = jQuery("#chargeTemplateJson"),
            ve = jQuery("#baseTemplatesJson"),
            Ne = jQuery("#applicableTaxRatesJson"),
            y = JSON.parse(Ie.val()),
            C = JSON.parse(i.val()),
            be = JSON.parse(ve.val()),
            Ae = JSON.parse(Ne.val()),
            ue = jQuery("#charge-table-container"),
            Ie = jQuery("#AddButton"),
            T = jQuery("#category"),
            x = jQuery("#template"),
            Oe = jQuery("#reference"),
            Me = jQuery("#distributorReference"),
            B = jQuery("#billDesc"),
            I = jQuery("#quantity"),
            S = jQuery("#txtAdultAmount"),
            D = jQuery("#txtChildAmount"),
            P = jQuery("#txtTaxAmount"),
            Re = jQuery("#txtTaxRate"),
            j = jQuery("#chargeDateInput"),
            N = jQuery("#charge-tab-item"),
            A = jQuery("#deduction-tab-item"),
            i = jQuery("#charge-table-container"),
            pe = jQuery("#editTemplate"),
            ge = jQuery("#ruleTypeName"),
            O = jQuery("#singleCharge"),
            M = jQuery("#dailyCharge"),
            R = jQuery("#singleDeduction"),
            Ee = jQuery("#dailyDeduction"),
            He = jQuery("#specifiedWeekDays"),
            f = jQuery("#warningSectionContainer"),
            me = jQuery("#templateChargeSection"),
            Fe = jQuery("#specifiedWeekDaysContainer"),
            he = jQuery("#taxRebateMessage"),
            Te = jQuery("#templateContainer"),
            xe = jQuery("#taxRateContainer"),
            Be = jQuery("#taxAmountContainer"),
            Ge = jQuery("#adultAmountContainer"),
            $e = jQuery("#childAmountContainer"),
            Se = jQuery(".s-quantity"),
            De = jQuery("#descQtyContainer"),
            Pe = jQuery("#applicableTaxesContainer"),
            je = jQuery("#applicableTax"),
            ye = jQuery("#isTaxInclusive"),
            Ce = jQuery("#isTaxRegistered"),
            we = jQuery("#chargeCategoryLabel"),
            ke = jQuery("#deductionCategoryLabel"),
            e = (new Date).evStandardFirstDayCalendarOffset(eviivo.eagle.basePageModelState.userCultureCode),
            j = eviivo.webcore.calendar.init(eviivo.webcore.calendar.CALENDAR_TYPE.initCalendar, {
                defaultCultureCode: eviivo.eagle.basePageModelState.userCultureCode,
                calendar: j,
                buttonImage: eviivoSuiteApp + "/content/images/svg-individual-icons/date_range.svg",
                showOn: "both",
                dateFormat: eviivo.eagle.dateFormat.getDateFormat("LONG_DATE_FORMAT"),
                firstDay: e,
                onSelect: function() {
                    var o;
                    f.html(""),
                    "" !== x.val() && (o = s(),
                    z(jQuery.grep(C, function(e) {
                        return e.Id == o
                    })[0]))
                }
            }),
            q(),
            Ie.on(E, oe),
            N.on(E, J),
            A.on(E, W),
            i.on(E, "button.s-delete-charge", Y),
            i.on(E, "button.s-delete-charge-cancel", function() {
                jQuery(this).trigger("notify-hide")
            }),
            i.on(E, "button.s-delete-charge-submit", K),
            T.on("change", L),
            x.on("change", V),
            I.on("change", Z),
            jQuery("#charges-tab-form").validate({
                ignore: "#chargeDateInput",
                errorPlacement: function() {
                    return !0
                },
                errorLabelContainer: "#charge-validation-summary",
                errorContainer: "#charge-validation-summary ul",
                wrapper: "li",
                onfocusout: !1,
                errorClass: "error"
            }),
            jQuery("#reference").rules("add", {
                eAntiXssRegEx: !0
            }),
            jQuery("#billDesc").rules("add", {
                eAntiXssRegEx: !0
            }),
            jQuery("#txtAdultAmount").rules("add", {
                eNumber: !0,
                eRequired: !0,
                eMin: 0,
                eTwoDecimalPlaces: !0,
                eDisallowGroupingSeparator: !0
            }),
            jQuery("#txtChildAmount").rules("add", {
                eNumber: !0,
                eRequired: !0,
                eMin: 0,
                eTwoDecimalPlaces: !0,
                eDisallowGroupingSeparator: !0
            }),
            jQuery("#taxRate").rules("add", {
                eNumber: !0,
                eRequired: !0,
                eMin: 0,
                eDisallowGroupingSeparator: !0
            }),
            jQuery("#txtTaxAmount").rules("add", {
                eNumber: !0,
                eRequired: !0,
                eMin: 0,
                eTwoDecimalPlaces: !0,
                eDisallowGroupingSeparator: !0
            }),
            eviivo.webcore.decimals.restrictFieldsForDecimals(Re, {
                decimalPlaces: 3
            }),
            eviivo.webcore.decimals.restrictFieldsForDecimals(S, {
                decimalPlaces: 2
            }),
            H = N.hasClass("s-selectedTab"),
            Q(),
            G()
        }
        function G() {
            T.val(T.find("option:first").val()).trigger("change")
        }
        function $(e, o) {
            return e.Name < o.Name ? -1 : e.Name > o.Name ? 1 : 0
        }
        function t(e) {
            if (null != e) {
                e.sort($);
                for (var o = 0; o < e.length; o++) {
                    var t = !H && e[o].Code == _e
                      , a = function(o) {
                        var t = !1;
                        return null !== C && C.forEach(function(e) {
                            e.ChargeCategory.Id === o && (H && "C" === e.ChargeTypeCode || !H && "D" === e.ChargeTypeCode) && (t = !0)
                        }),
                        t
                    }(e[o].Id);
                    (t || a) && T.append("<option value='" + e[o].Id + "'>" + e[o].Name + "</option>")
                }
            }
        }
        function Q() {
            var e, o;
            null == Ue && (Ue = T.find("option[value='0']")),
            T.find("option").remove(),
            T.append(Ue),
            null == Je && (Je = "<option value='-2'>" + ke.val() + "</option>"),
            null == qe && (qe = "<option value='-2'>" + we.val() + "</option>"),
            T.append(H ? qe : Je),
            null !== y && (e = y.filter(function(e) {
                return !0 === e.IsSystem && !1 === e.IsHidden && !0 === e.IsActive
            }),
            o = y.filter(function(e) {
                return !1 === e.IsSystem && !1 === e.IsHidden && !0 === e.IsActive
            }),
            t(e),
            T.append("<option disabled>---</option>"),
            t(o))
        }
        function L(e) {
            x.find("option").remove();
            var o = se()
              , t = re()
              , a = le()
              , i = ne()
              , n = 1 < T.val();
            if ((i || t || a || o || n) && !function(e, o) {
                if (null != be)
                    for (var t = 0; t < be.length; t++) {
                        if ((!H || e || o) && 0 < t)
                            return;
                        x.append("<option value='-" + (t + 1) + "'>" + be[t].Name + "</option>")
                    }
            }(i, n),
            null !== C) {
                var t = T.val()
                  , s = null != t && "" != t ? parseInt(T.val()) : null
                  , r = C.filter(function(e) {
                    return (a || e.ChargeCategory.Id === s) && (H && "C" === e.ChargeTypeCode && (g.isGuestCharges && "MCH" == e.ItemTypeCode || !g.isGuestCharges && "OWN" == e.ItemTypeCode) || !H && "D" === e.ChargeTypeCode && (g.isGuestCharges && "MCH" == e.ItemTypeCode || !g.isGuestCharges && "OWN" == e.ItemTypeCode))
                });
                if (null != r)
                    for (var l = 0; l < r.length; l++)
                        x.append("<option value='" + r[l].Id + "'>" + r[l].Name + "</option>")
            }
            U()
        }
        function V(e) {
            U()
        }
        function s() {
            var e = x.val();
            return null != e && "" != e ? parseInt(e) : null
        }
        function _() {
            var e = T.val();
            return null != e && "" != e ? parseInt(e) : null
        }
        function U() {
            _();
            if (se())
                d(),
                Be.removeClass("hide"),
                P.enable(),
                jQuery(".s-rebate-tax-amount-label").show(),
                l(),
                S.val(r()),
                he.removeClass("hide"),
                j.enable(),
                v(!0, !1);
            else {
                var e = s()
                  , o = le()
                  , t = re()
                  , a = "-1" === x.val();
                if (t && -2 != e || o && -1 == e)
                    d(),
                    c(),
                    l(),
                    S.val(r()),
                    Pe.removeClass("hide"),
                    j.enable(),
                    ge.text(g.resources.labels.perItemChargeInformationLabel),
                    v(!1, !0);
                else if (a)
                    d(),
                    c(),
                    l(),
                    S.val(r()),
                    j.enable(),
                    ge.text(g.resources.labels.perItemChargeInformationLabel),
                    v(!1, !0);
                else if (ne() && e < 1 || -2 == e)
                    d(),
                    Be.removeClass("hide"),
                    P.enable(),
                    jQuery(".s-tax-amount-label").show(),
                    l(),
                    P.val(r()),
                    j.enable(),
                    v(!1, !0);
                else {
                    var i = e
                      , t = (d(),
                    me.removeClass("hide"),
                    f.html(""),
                    l(),
                    B.val(""),
                    Me.val(""),
                    jQuery.grep(C, function(e) {
                        return e.Id == i
                    })[0]);
                    if (null != t) {
                        switch (jQuery(".s-currencySymbol").text(t.Currency.Symbol),
                        B.val(null !== t.RootOnlineNameDisplay ? t.RootOnlineNameDisplay : jQuery("#template :selected").text()),
                        g.isGuestCharges ? pe.attr("href", eviivo.eagle.urls.charges.EditChargeTemplate + "/" + i) : pe.attr("href", eviivo.eagle.urls.charges.EditOwnerChargeTemplate + "/" + i),
                        Me.val(t.DistributorReference),
                        B.val(t.RootOnlineNameDisplay),
                        ge.text(t.ChargeRulesTypeName),
                        t.ChargeFrequencyTypeCode) {
                        case "CKI":
                            j.enable(),
                            j.datepicker("setDate", k),
                            u(!0);
                            break;
                        case "CKO":
                            j.enable(),
                            j.datepicker("setDate", w),
                            u(!0);
                            break;
                        case "SPN":
                            j.enable(),
                            j.datepicker("setDate", Date.now().toString()),
                            u(!0);
                            break;
                        case "ALN":
                            j.datepicker("setDate", ""),
                            j.attr("readonly", !1),
                            u(!1)
                        }
                        var n = t
                          , o = n.ChargeRulesTypeCode;
                        switch (n.IsTax || null == n.TaxAmount || (xe.removeClass("hide"),
                        P.val(Globalize.formatNumber(n.TaxRate, {
                            minimumFractionDigits: 2,
                            maximumFractionDigits: 2,
                            useGrouping: !1
                        }))),
                        o) {
                        case "ALL":
                        case "EBL":
                        case "RRP":
                        case "RRT":
                            c(),
                            S.disable(),
                            !function() {
                                var e = s();
                                e = e < 0 ? null : e,
                                eviivo.webcore.ajaxHelper.executeAjax({
                                    actionId: F.calculateChargeAmounts,
                                    url: eviivo.eagle.urls.charges.CalculateChargeAmounts,
                                    method: eviivo.webcore.ajaxHelper.methods.GET,
                                    contentType: eviivo.webcore.ajaxHelper.contentTypes.URL_ENCODED_UTF8,
                                    dataType: eviivo.webcore.ajaxHelper.dataTypes.JSON,
                                    data: {
                                        chargeTemplateId: e,
                                        bookingId: b,
                                        chargeDate: te(),
                                        businessId: h
                                    },
                                    callback: function(e) {
                                        S.val(Globalize.formatNumber(e.Amount, {
                                            minimumFractionDigits: 2,
                                            maximumFractionDigits: 2,
                                            useGrouping: !1
                                        }))
                                    },
                                    failCallback: p
                                })
                            }();
                            break;
                        case "PIT":
                            c(),
                            Se.removeClass("hide"),
                            De.addClass("cp-icon-input").addClass("before"),
                            I.val(1),
                            S.val(Globalize.formatNumber(n.Amount, {
                                minimumFractionDigits: 2,
                                maximumFractionDigits: 2,
                                useGrouping: !1
                            })),
                            jQuery("#descQty").text(I.val() + "x");
                            break;
                        case "PGT":
                            Ge.removeClass("hide"),
                            $e.removeClass("hide"),
                            S.enable(),
                            D.enable(),
                            jQuery(".s-adult-amount-label").show(),
                            S.val(Globalize.formatNumber(n.Amount, {
                                minimumFractionDigits: 2,
                                maximumFractionDigits: 2,
                                useGrouping: !1
                            })),
                            D.val(Globalize.formatNumber(n.ChildAmount, {
                                minimumFractionDigits: 2,
                                maximumFractionDigits: 2,
                                useGrouping: !1
                            }))
                        }
                        Oe.val(t.Reference);
                        o = t;
                        Fe.hide(),
                        null != o.SpecifiedWeekDaysDisplay && (He.text(o.SpecifiedWeekDaysDisplay),
                        0 < He.text().length) && Fe.show(),
                        z(t)
                    }
                    v(!1, !1)
                }
            }
        }
        function r() {
            return We = null == We ? Globalize.formatNumber(0, {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2,
                useGrouping: !1
            }) : We
        }
        function l() {
            Oe.val("")
        }
        function d() {
            f.html(""),
            Te.removeClass("hide"),
            me.removeClass("hide").addClass("hide"),
            Ge.removeClass("hide").addClass("hide"),
            $e.removeClass("hide").addClass("hide"),
            Se.removeClass("hide").addClass("hide"),
            Be.removeClass("hide").addClass("hide"),
            xe.removeClass("hide").addClass("hide"),
            Pe.removeClass("hide").addClass("hide"),
            he.removeClass("hide").addClass("hide"),
            jQuery(".s-adult-amount-label,.s-rebate-tax-amount-label,.s-amount-label,.s-tax-amount-label").hide(),
            q(),
            j.disable(),
            S.disable(),
            D.disable(),
            P.disable(),
            jQuery("#descQty").text(""),
            S.val(""),
            D.val(""),
            P.val(""),
            De.removeClass("cp-icon-input").removeClass("before"),
            B.text("")
        }
        function c() {
            Ge.removeClass("hide"),
            S.enable(),
            jQuery(".s-amount-label").show()
        }
        function q() {
            w.isPast() ? j.datepicker("setDate", w) : k.isFuture() ? j.datepicker("setDate", k) : j.datepicker("setDate", Date.now().toString())
        }
        function J() {
            N.hasClass("s-selectedTab") || (A.removeClass("md-tabs-selected s-selectedTab"),
            N.addClass("md-tabs-selected s-selectedTab"),
            H = N.hasClass("s-selectedTab"),
            e(),
            Q(),
            G())
        }
        function W() {
            A.hasClass("s-selectedTab") || (N.removeClass("md-tabs-selected s-selectedTab"),
            A.addClass("md-tabs-selected s-selectedTab"),
            H = N.hasClass("s-selectedTab"),
            e(),
            Q(),
            G())
        }
        function e() {
            var e = jQuery(".s-currency .input-attachment");
            H ? e.find("i").remove() : e.prepend("<i>-</i>")
        }
        function z(e) {
            var t, o = j.datepicker("getDate");
            if (null != e) {
                null !== e.BookLeadTimeDays && ("ALN" == e.ChargeFrequencyTypeCode && (o = k),
                (s = new Date).setDate(s.getDate() + e.BookLeadTimeDays),
                o.getTime() < s.getTime()) && (s = g.resources.validation.leadTimeWarning.format(e.BookLeadTimeDays),
                s = Le.format(s),
                f.append(s));
                for (var a = e.RatePlanOccupancyMappings.map(function(e) {
                    return e.RatePlanId
                }), i = 0 === (a = (t = a).filter(function(e, o) {
                    return t.indexOf(e) === o
                })).length, n = 0; n < a.length; n++)
                    a[n] == g.ratePlanId && (i = !0);
                i || (s = Le.format(g.resources.validation.ratePlanWarning),
                f.append(s));
                var s, r = !1;
                switch (e.ChargeFrequencyTypeCode) {
                case "CKI":
                case "CKO":
                case "SPN":
                    "0" === e.ApplicableDays[o.getUTCDay()] && (r = !0);
                    break;
                case "ALN":
                    for (var l = new Date(k), d = new Date(w); l.getTime() < d.getTime(); )
                        "0" === e.ApplicableDays[l.getUTCDay()] && (r = !0),
                        l.setDate(l.getDate() + 1)
                }
                r && (s = Le.format(g.resources.validation.excludedDayWarning),
                f.append(s))
            }
        }
        function u(e) {
            e ? (H ? (O.show(),
            M.hide(),
            R.hide()) : (O.hide(),
            M.hide(),
            R.show()),
            Ee.hide()) : H ? (O.hide(),
            M.show(),
            R.hide(),
            Ee.hide()) : (O.hide(),
            M.hide(),
            R.hide(),
            Ee.show())
        }
        function v(e, o) {
            var t = g.resources.defaults.adhocChargeDescription;
            H || (t = g.resources.defaults.adhocDeductionDescription),
            e && (t = T.find("option:selected").text()),
            (t = e || o ? t : x.find("option:selected").text()).lastIndexOf("*") == t.length - 1 && (t = t.substr(0, t.length - 1)),
            B.val(t)
        }
        function X(e, o, t) {
            a.removeClass("active").addClass("hide"),
            e.html(o),
            n(t, "true")
        }
        function p(e, o, t) {
            a.removeClass("active").addClass("hide"),
            void 0 !== m && jQuery(m).prop("disabled", !1),
            n(e, "false")
        }
        function n(e, o) {
            var t = "";
            switch (e) {
            case F.addCharge.toString():
                t = o ? g.resources.notifyMessages.addChargeSuccessMessage : g.resources.notifyMessages.addChargeFailureMessage;
                break;
            case F.deleteCharge.toString():
                t = o ? g.resources.notifyMessages.deleteChargeSuccessMessage : g.resources.notifyMessages.deleteChargeFailureMessage
            }
            null != t && "undefined" !== t && "" !== t && eviivo.webcore.notifier.show({
                type: o ? eviivo.webcore.notifier.types.success : eviivo.webcore.notifier.types.error,
                message: t
            })
        }
        function Y(e) {
            e.stopImmediatePropagation(),
            e.preventDefault(),
            jQuery("#charge-table-container button.s-delete-charge-cancel").trigger("notify-hide"),
            m = this;
            var e = jQuery(this)
              , o = ""
              , t = e.hasClass("padlock")
              , o = t ? g.resources.notifyMessages.deleteLockedMessage : g.resources.notifyMessages.deleteMessage
              , a = e.data("item-id");
            e.notify({
                text: o,
                icon: "&#xe93a;",
                buttonOne: "<button class='btn btn-cancel btn-secondary mr10 s-delete-charge-cancel' type='button'>" + g.resources.labels.no + "</button>",
                buttonTwo: "<button class='btn btn-right s-delete-charge-submit' type='button' data-is-invoiced='" + t + "' data-item-id='" + a + "'>" + g.resources.labels.yes + "</button>"
            }, {
                style: "withTwoActions",
                className: "action v-2",
                position: "top right",
                autoHideDelay: "100000",
                clickToHide: !0
            })
        }
        function K(e) {
            a.removeClass("hide").addClass("active");
            var o = parseInt(jQuery(this).data("item-id"))
              , t = jQuery(this).data("is-invoiced");
            eviivo.webcore.ajaxHelper.executeAjax({
                actionId: F.deleteCharge,
                url: eviivo.eagle.urls.charges.DeleteCharge,
                method: eviivo.webcore.ajaxHelper.methods.GET,
                contentType: eviivo.webcore.ajaxHelper.contentTypes.URL_ENCODED_UTF8,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.HTML,
                data: {
                    chargeId: o,
                    bookingId: b,
                    isInvoiced: t,
                    businessId: h
                },
                callback: function(e) {
                    ae(F.deleteCharge),
                    n(F.deleteCharge, e)
                },
                failCallback: p
            }),
            jQuery(this).trigger("notify-hide")
        }
        function Z(e) {
            jQuery("#descQty").text(I.val() + "x");
            var o = s()
              , t = jQuery.grep(C, function(e) {
                return e.Id == o
            })[0];
            S.val(Globalize.formatNumber(t.Amount * I.val(), {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2,
                useGrouping: !1
            }))
        }
        function ee() {
            eviivo.webcore.ajaxHelper.executeAjax({
                actionId: F.getCharges,
                url: eviivo.eagle.urls.charges.GetCharges,
                method: eviivo.webcore.ajaxHelper.methods.GET,
                contentType: eviivo.webcore.ajaxHelper.contentTypes.URL_ENCODED_UTF8,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.HTML,
                data: {
                    bookingId: b,
                    businessId: h,
                    isGuestCharges: g.isGuestCharges
                },
                callback: function(e) {
                    X(ue, e, F.getCharges)
                },
                failCallback: p
            })
        }
        function oe(e) {
            var o, t, a, i;
            e.preventDefault(),
            jQuery("#charges-tab-form").valid() && (void 0 !== (m = this) && jQuery(m).prop("disabled", !0),
            e = (e = s()) < 0 ? null : e,
            ie(),
            o = "-2" === x.val() || ne() || se() || function(o) {
                var t = !1;
                null != o && null !== C && C.forEach(function(e) {
                    e.Id === o && (t = e.IsTax)
                });
                return t
            }(e),
            t = 0,
            null != (t = "True" != Ce.val() || o ? t : 0 != (i = jQuery("#templateContainer").find("option:selected")).length && (null == a ? i.prop("selected") : (i.prop("selected", a),
            a)) ? jQuery.grep(Ae, function(e) {
                return e.Code == je.val()
            })[0].Rate : Re.val()) && 0 != t && 0 <= t.toString().indexOf(",") && (t = t.toString().replace(",", ".")),
            eviivo.webcore.ajaxHelper.executeAjax({
                actionId: F.addCharge,
                url: eviivo.eagle.urls.charges.AddCharge,
                method: eviivo.webcore.ajaxHelper.methods.GET,
                contentType: eviivo.webcore.ajaxHelper.contentTypes.URL_ENCODED_UTF8,
                dataType: eviivo.webcore.ajaxHelper.dataTypes.HTML,
                data: {
                    Id: e,
                    CategoryId: _(),
                    TemplateId: e,
                    Quantity: I.val(),
                    Reference: Oe.val(),
                    DistributorReference: Me.val(),
                    Description: B.val(),
                    ChargeDate: te(),
                    Adult: S.val(),
                    Child: D.val(),
                    TaxAmount: P.val(),
                    TaxRate: t,
                    BookingId: b,
                    IsCharge: H,
                    businessId: h,
                    ApplicableTaxId: je.val(),
                    IsTax: o,
                    IsBusinessPricedTaxInclusive: ye.val(),
                    IsGuestCharges: g.isGuestCharges
                },
                callback: function(e) {
                    ae(F.addCharge),
                    n(F.addCharge, e)
                },
                failCallback: p
            }))
        }
        function te() {
            var e = j.datepicker("getDate");
            return null != e ? e.evStandardIso8601DateExtended() : e
        }
        function ae() {
            void 0 !== m && jQuery(m).prop("disabled", !1),
            ee(),
            eviivo.eagle.viewBookingPopup.updateOrderBookings(!1, !0),
            eviivo.eagle.gridBlock.updateBookingElement(null, fe)
        }
        function ie() {
            var e = jQuery.grep(y, function(e) {
                return e.Code === Ve
            });
            return null != e && 0 < e.length ? e[0].Id : null
        }
        function ne() {
            var e = T.val()
              , e = null != e && "" != e ? parseInt(e) : null
              , o = ie();
            return null != e && "" != e && null != o && o === e
        }
        function se() {
            var e = T.val()
              , e = null != e && "" != e ? parseInt(e) : null
              , o = null != (o = jQuery.grep(y, function(e) {
                return e.Code === _e
            })) && 0 < o.length ? o[0].Id : null;
            return null != e && "" != e && null != o && o === e
        }
        function re() {
            return "0" === T.val()
        }
        function le() {
            return "-2" === T.val()
        }
        var g, de, a, ce, m, ue, i, ve, pe, ge, f, me, fe, h, b, y, C, he, be, ye, Ce, ke, we, Ie, Te, xe, Be, k, w, I, Se, De, Pe, je, Ne, Ae, T, x, Oe, Me, B, S, D, Re, P, j, N, A, O, M, R, Ee, He, Fe, Ge, $e, Qe, E, Le, Ve, _e, Ue, qe, Je, H, F, We;
        window.eviivo = window.eviivo || {},
        window.eviivo.eagle = window.eviivo.eagle || {},
        window.eviivo.eagle.viewBookingCharges = window.eviivo.eagle.viewBookingCharges || {},
        window.eviivo.eagle.viewBookingCharges = (Qe = {
            isGuestCharges: !0
        },
        Le = "<div class='mod-notice mod-notice-small alert'>{0}</div>",
        Ve = "TAX",
        _e = "TXRBT",
        F = {
            loadOwnerTab: "viewBookingCharges.loadOwnerTab",
            loadChargeTab: "viewBookingCharges.loadChargesTab",
            getCharges: "viewBookingCharges.getCharges",
            addCharge: "viewBookingCharges.addCharge",
            deleteCharge: "viewBookingCharges.deleteCharge",
            calculateChargeAmounts: "viewBookingCharges.calculateChargeAmounts"
        },
        We = H = Je = qe = Ue = E = null,
        {
            init: function(e) {
                g = jQuery.extend(Qe, e),
                E = eviivo.util.namespacedEvent("click", "eviivo_eagle_viewCharges"),
                eviivo.util.addHotjarRecordingTags(["ViewCharges"])
            },
            open: function(e) {
                g = jQuery.extend(!0, {}, g, e),
                de = g.container,
                a = jQuery("#booking-popup-spinner"),
                ce = jQuery("#booking-popup-spinner .spinner-message"),
                fe = g.id,
                b = g.bookingId,
                k = g.checkInDate,
                w = g.checkOutDate,
                h = g.businessId,
                g.isGuestCharges ? (ce.html(g.resources.loadingMessages.loadTab),
                a.removeClass("hide").addClass("active"),
                eviivo.webcore.ajaxHelper.executeAjax({
                    actionId: F.loadChargeTab,
                    url: eviivo.eagle.urls.charges.ChargesTab,
                    method: eviivo.webcore.ajaxHelper.methods.GET,
                    contentType: eviivo.webcore.ajaxHelper.contentTypes.URL_ENCODED_UTF8,
                    dataType: eviivo.webcore.ajaxHelper.dataTypes.HTML,
                    data: {
                        orderId: fe,
                        bookingId: b,
                        businessId: h
                    },
                    callback: function(e) {
                        o(de, e)
                    },
                    failCallback: p
                })) : (ce.html(g.resources.loadingMessages.loadOwnerTab),
                a.removeClass("hide").addClass("active"),
                eviivo.webcore.ajaxHelper.executeAjax({
                    actionId: F.loadOwnerTab,
                    url: eviivo.eagle.urls.charges.OwnersTab,
                    method: eviivo.webcore.ajaxHelper.methods.GET,
                    contentType: eviivo.webcore.ajaxHelper.contentTypes.URL_ENCODED_UTF8,
                    dataType: eviivo.webcore.ajaxHelper.dataTypes.HTML,
                    data: {
                        orderId: fe,
                        bookingId: b,
                        businessId: h
                    },
                    callback: function(e) {
                        o(de, e)
                    },
                    failCallback: p
                }))
            }
        })
    },
    8377: function() {
        function n(e, o) {
            b.title = p(y.title),
            b.guestMainContainer = p(y.guestMainContainer),
            b.guestSearchContainer = p(y.guestSearchContainer),
            b.guestButtonsContainer = p(y.guestButtonsContainer),
            b.editGuestBtn = p(y.editGuestBtn),
            b.addMoreGuestBtn = p(y.addMoreGuestBtn),
            b.form = p(y.form),
            b.saveButton = p(y.saveButton),
            b.bookingId = p(y.bookingId),
            b.deleteButtons = p(y.deleteButtons),
            b.surname = p(y.surname),
            b.backButton = p(y.backButton),
            b.primaryGuestId = p(y.primaryGuestId),
            t = b.title,
            a = eviivo.webcore.staticData.htmlOptions.titles,
            t.html(a).val(t.data("selectedvalue")),
            eviivo.webcore.staticDataLoader.populateDataSource(eviivo.pms.businessSettingsAndDefaultMessages.getGuestFieldsDataSource(o), {
                selector: "select[name='Guests[{0}].Type']",
                key: "#type"
            }),
            b.additionalGuestHtmlTemplate = p(y.additionalGuestHtmlTemplate).html(),
            b.form.validate({
                ignore: "",
                errorPlacement: function() {
                    return !0
                },
                errorClass: f,
                onfocusout: !1
            }),
            p.validator.addMethod("surname", function(e, o) {
                return this.optional(o) || /([^\s])/.test(e)
            }),
            l(),
            b.guestMainContainer.html(""),
            b.guestSearchContainer.addClass("hide"),
            b.guestButtonsContainer.addClass("hide"),
            b.deleteButtons.off(m.click),
            b.editGuestBtn.on(m.click, r),
            b.addMoreGuestBtn.on(m.click, l),
            b.saveButton.on(m.click, d),
            b.deleteButtons.on(m.click, c),
            b.backButton.on(m.click, r);
            var t, a, i = document.querySelectorAll(y.footerButtons), n = document.querySelector(y.flyoutFooter);
            if (i.length < 2)
                for (var s = 0; s < i.length; s++)
                    n.appendChild(i[s]);
            $("#divContent").find("#add-guests-buttons").remove()
        }
        function o(e, o, t, a, i) {
            h = t;
            a = {
                location: eviivoSuiteApp + "/guest/additional-guestForm",
                requestData: {
                    businessId: o,
                    bookingId: a,
                    orderId: t
                },
                placeholder: "#additionalguest-container",
                id: "add-guests-form",
                spinnerSettings: v.spinnerSettings,
                notificationSettings: {
                    submitSuccess: {
                        enabled: !0
                    }
                },
                actions: {
                    onLoadSuccess: function(e) {
                        n(0, o)
                    },
                    onValidate: u,
                    onSubmitSuccess: s
                }
            };
            null != i && "function" == typeof i && (C = i),
            eviivo.webcore.forms.loadAjax(a)
        }
        function r(e) {
            var t = p(this).data("target");
            eviivo.eagle.guest.loadGuestTabContainer(null, {
                Id: t,
                businessId: eviivo.eagle.basePageModelState.businessId
            }, C, function() {
                var e, o;
                e = t,
                null !== (o = p(y.bookingGuestDropdown)) && o.val(e)
            }),
            $("#divContent").removeClass("showing-add-guest"),
            a()
        }
        function a() {
            document.querySelector(y.footerButtons).remove(),
            document.getElementById("manage-guest-buttons").classList.remove("hide")
        }
        function l(e) {
            var o = p("#add-guests-form > .s-guest-tab-fields").length
              , t = b.additionalGuestHtmlTemplate.format(o);
            b.form.append(t),
            p("input[name='Guests[" + o + "].Surname']").rules("add", {
                required: !0,
                surname: !0
            })
        }
        function d(e) {
            b.form.submit(),
            0 == $(".s-guest-tab-fields .error").length && a()
        }
        function s(e) {
            $("#divContent").removeClass("showing-add-guest");
            var o = parseInt(b.primaryGuestId.val())
              , t = parseInt(p(y.bookingId).val());
            eviivo.eagle.guest.loadGuestTabContainer(null, {
                Id: o,
                businessId: eviivo.eagle.basePageModelState.businessId,
                orderId: h,
                bookingId: t
            }, C, C)
        }
        function c(e) {
            var o = p(this)
              , o = parseInt(o.data("target"))
              , t = parseInt(p(y.bookingId).val());
            eviivo.webcore.ajaxHelper.executeAjax({
                actionId: "RemoveAdditionalGuest-" + o,
                url: eviivoSuiteApp + "/guest/remove-additional-guest",
                method: eviivo.webcore.ajaxHelper.methods.POST,
                contentType: eviivo.webcore.ajaxHelper.contentTypes.JSON,
                data: {
                    businessId: eviivo.eagle.basePageModelState.businessId,
                    guestId: o,
                    bookingId: t
                },
                callback: i
            })
        }
        function i(e) {
            !0 === e.DataPayload && (e = parseInt(p(y.bookingId).val()),
            o(0, eviivo.eagle.basePageModelState.businessId, h, e, C))
        }
        function u() {
            return b.form.valid()
        }
        var v, p, t, g, m, f, h, b, y, C;
        window.eviivo = window.eviivo || {},
        window.eviivo.eagle = window.eviivo.eagle || {},
        window.eviivo.eagle.additional = window.eviivo.eagle.additional || {},
        window.eviivo.eagle.additional.guest = window.eviivo.eagle.additional.guest || {},
        window.eviivo.eagle.additional.guest = (t = {
            resources: {
                submitSuccessMessage: null,
                onChageMessage: null
            }
        },
        g = "eviivo.eagle.additional.guest",
        f = "error",
        b = {
            form: h = m = null,
            guestMainContainer: null,
            guestSearchContainer: null,
            additionalGuestSection: null,
            guestButtonsContainer: null,
            editGuestBtn: null,
            additionalGuestHtmlTemplate: null,
            addMoreGuestBtn: null,
            title: null,
            saveButton: null,
            deleteButtons: null,
            bookingId: null,
            bookigGuestDropdown: null,
            surname: null,
            backButton: null,
            primaryGuestId: null
        },
        y = {
            form: "#add-guests-form",
            guestMainContainer: ".guest-main-container",
            guestSearchContainer: ".guest-search",
            additionalGuestSection: "#guest-section-container-addGuestToRoom",
            guestButtonsContainer: "#manage-guest-buttons",
            editGuestBtn: ".s-guest-edit",
            additionalGuestHtmlTemplate: "#additional-guest-template",
            addMoreGuestBtn: "#add-more-guest",
            title: "select[name='Guests[{0}].TitleId']",
            saveButton: "#save-guests",
            deleteButtons: ".s-guest-delete",
            bookingId: "#BookingId",
            surname: ".surname",
            backButton: "#back-btn",
            primaryGuestId: "#PrimaryGuestId",
            bookingGuestDropdown: "#booking-guests",
            footerButtons: "#view-booking-flyout #add-guests-buttons",
            flyoutFooter: "#view-booking-flyout .cp-flyout_footer"
        },
        C = null,
        {
            init: function(e) {
                if ("function" != typeof window.jQuery)
                    throw "eviivo.eagle.additional.guest: module depends on jQuery";
                if ("undefined" == typeof eviivo || void 0 === eviivo.webcore || void 0 === eviivo.webcore.forms)
                    throw "eviivo.eagle.additional.guest: module depends on eviivo.webcore.forms";
                if ("undefined" == typeof eviivo || void 0 === eviivo.webcore || void 0 === eviivo.util)
                    throw "eviivo.eagle.additional.guest: module depends on eviivo.util";
                p = window.jQuery,
                v = p.extend(t, e),
                m = {
                    click: eviivo.util.namespacedEvent("click", g),
                    change: eviivo.util.namespacedEvent("change", g)
                }
            },
            loadContainer: o
        })
    },
    7766: function() {
        window.eviivo = window.eviivo || {},
        window.eviivo.eagle = window.eviivo.eagle || {},
        window.eviivo.eagle.guest = window.eviivo.eagle.guest || {};
        t = {
            hideMemberId: !1,
            resources: {
                submitSuccessMessage: null,
                onChageMessage: null,
                guestAlreadyExistInBooking: null
            }
        },
        c = {
            title: "#title",
            communicatein: "#communicatein",
            country: "#country",
            stateprovince: "#stateprovince",
            countryofbirth: "#countryofbirth",
            nationality: "#nationality",
            datePickers: ".guest-field.datepicker",
            datePicker: ".cp-input-datepicker",
            dateClearButton: ".btn-clear-date",
            tabs: ".mod-tabs ul li",
            tabContainer: ".guest-section-level-1",
            guestCheckBoxes: ".s-guest-checkbox",
            memberIdContainer: ".field-memberid",
            guestId: "#GuestId",
            showCalendar: ".s-show-button",
            additionalGuestContainer: "#additionalguest-container",
            guestButtonsContainer: "#manage-guest-buttons",
            searchBarContainer: ".guest-search",
            lockables: ".s-lock-guest-field",
            resetButton: "#btnClearGuestTab",
            isInContactList: "#IsInContactList",
            form: "#frmGuestSaveDetailed",
            updateBookingGuest: "#UpdateBookingGuest",
            bookingGuestDropdown: "#booking-guests",
            guestType: "#GuestType",
            additionalGuestId: "#AdditionalGuestId",
            createNewContactButton: "#btnCreateNewContact",
            updateExistingContactButton: "#btnUpdateExistingContact",
            addToContactClicked: "#AddToContactClicked",
            saveGuestContactButton: "#btnSaveGuestContact",
            guestVoucherSectionInputs: "#guest-section-container-guest-voucher input[type=text]"
        },
        a = {
            guestVoucher: "guest-voucher"
        },
        i = "eviivo.eagle.guest",
        h = {
            title: f = m = g = p = v = u = null,
            communicatein: null,
            country: null,
            stateprovince: null,
            countryofbirth: null,
            nationality: null,
            datePickers: null,
            dateClearButton: null,
            tabs: null,
            tabContainer: null,
            guestCheckBoxes: null,
            form: null,
            guestId: null,
            memberIdContainer: null,
            showCalendarButtons: null,
            additionalGuestContainer: null,
            guestButtonsContainer: null,
            searchBarContainer: null,
            lockables: null,
            resetButton: null,
            isInContactList: null,
            updateBookingGuest: null,
            guestType: null,
            additionalGuestId: null,
            createNewContactButton: null,
            updateExistingContactButton: null,
            addToContactClicked: null,
            searchBar: null,
            guestVoucherSectionInputs: null
        },
        b = !(n = "state-active");
        var l, d, o, t, c, a, u, v, p, i, g, m, f, h, n, b, e = {
            init: function(e) {
                if ("function" != typeof window.jQuery)
                    throw "eviivo.eagle.guest: module depends on jQuery";
                if (d = window.jQuery,
                "undefined" == typeof eviivo || void 0 === eviivo.webcore || void 0 === eviivo.webcore.forms)
                    throw "eviivo.eagle.guest: module depends on eviivo.webcore.forms";
                if ("undefined" == typeof eviivo || void 0 === eviivo.webcore || void 0 === eviivo.util)
                    throw "eviivo.eagle.guest: module depends on eviivo.util";
                l = d.extend(t, e),
                p = {
                    click: eviivo.util.namespacedEvent("click", i),
                    change: eviivo.util.namespacedEvent("change", i)
                },
                0 < (o = d(l.containerLoadTriggerElement)).length && o.on(p.click, y),
                d(c.guestButtonsContainer).on(p.click, c.saveGuestContactButton, C),
                d(c.createNewContactButton).on(p.click, C),
                d(c.updateExistingContactButton).on(p.click, s)
            },
            loadGuestTabContainer: y
        };
        function s() {
            r(),
            h.addToContactClicked.val(!0)
        }
        function r() {
            h.lockables.prop("disabled", !1)
        }
        function y(e, o, t, a) {
            var i = null
              , n = null
              , s = "frmGuestSaveDetailed"
              , r = "";
            if (c.form = "#frmGuestSaveDetailed",
            g = b = !1,
            (v = null) != o && null != o.Id && (i = o.Id,
            void 0 !== o.orderId && (f = o.orderId),
            void 0 !== o.bookingId && (m = o.bookingId),
            void 0 !== o.orderId && (g = !0),
            null != o.businessId && (n = o.businessId),
            null != o.formId) && (s = o.formId,
            c.form = "#".concat(o.formId),
            r = o.containerId),
            null != e && e === h.searchBar.selectors.searchInput) {
                if (0 < d(c.bookingGuestDropdown + ' option[value="' + i + '"]').length)
                    return void eviivo.webcore.notifier.show({
                        type: eviivo.webcore.notifier.types.warn,
                        message: l.resources.guestAlreadyExistInBooking
                    });
                b = !0
            } else
                u = null;
            null == n && (n = eviivo.eagle.basePageModelState.businessId);
            o = {
                location: eviivoSuiteApp + "/guest/guestForm",
                actionId: i,
                requestData: {
                    businessId: n,
                    id: i,
                    orderId: f,
                    bookingId: m,
                    formId: s
                },
                placeholder: "".concat(r, " .guest-main-container"),
                id: s,
                spinnerSettings: l.spinnerSettings,
                notificationSettings: {
                    submitSuccess: {
                        enabled: !0
                    }
                },
                actions: {
                    onLoadSuccess: function(e) {
                        var o = n
                          , a = (h.form = e,
                        h.title = d(c.title),
                        h.communicatein = d(c.communicatein),
                        h.country = d(c.country),
                        h.stateprovince = d(c.stateprovince),
                        h.countryofbirth = d(c.countryofbirth),
                        h.nationality = d(c.nationality),
                        h.guestCheckBoxes = d(c.guestCheckBoxes),
                        h.memberIdContainer = d(c.memberIdContainer),
                        h.dateClearButton = d(c.dateClearButton),
                        h.guestId = d(c.guestId),
                        h.showCalendarButtons = d(c.showCalendar),
                        h.additionalGuestContainer = d(c.additionalGuestContainer),
                        h.guestButtonsContainer = d(c.guestButtonsContainer),
                        h.searchBarContainer = d(c.searchBarContainer),
                        h.lockables = d(c.lockables),
                        h.resetButton = d(c.resetButton),
                        h.isInContactList = d(c.isInContactList),
                        h.updateBookingGuest = d(c.updateBookingGuest),
                        h.guestType = d(c.guestType),
                        h.additionalGuestId = d(c.additionalGuestId),
                        h.createNewContactButton = d(c.createNewContactButton),
                        h.updateExistingContactButton = d(c.updateExistingContactButton),
                        h.addToContactClicked = d(c.addToContactClicked),
                        h.guestVoucherSectionInputs = d(c.guestVoucherSectionInputs),
                        h.resetButton.on(p.click, D),
                        j(h.stateprovince.prop("disabled", !0), null),
                        h.country.on(p.change, N),
                        j(h.country, eviivo.webcore.staticData.htmlOptions.countries),
                        h.country.trigger("change"),
                        h.dateClearButton.on(p.click, T),
                        j(h.title, eviivo.webcore.staticData.htmlOptions.titles),
                        j(h.communicatein, eviivo.webcore.staticData.htmlOptions.availableGuestLanguages),
                        j(h.countryofbirth, eviivo.webcore.staticData.htmlOptions.countries),
                        j(h.nationality, eviivo.webcore.staticData.htmlOptions.nationalities),
                        h.tabs = d(c.tabs),
                        h.tabContainer = d(c.tabContainer),
                        h.tabContainer.not("#" + h.tabContainer.first().attr("id")).addClass("hide"),
                        $("#Profile").addClass("state-active"),
                        h.tabs.on(p.click, B),
                        eviivo.webcore.staticDataLoader.populateDataSource(eviivo.pms.businessSettingsAndDefaultMessages.getGuestFieldsDataSource(o)),
                        eviivo.eagle.guest.validation.init({
                            form: c.form,
                            validateMemberId: !l.hideMemberId
                        }),
                        h.datePickers = d(c.datePickers),
                        h.datePickers.on(p.change, x),
                        (new Date).evStandardFirstDayCalendarOffset(eviivo.eagle.basePageModelState.userCultureCode))
                          , t = (h.datePickers.each(function(e, o) {
                            var o = d(o)
                              , t = d("#" + o.data("target"))
                              , o = eviivo.webcore.calendar.init(eviivo.webcore.calendar.CALENDAR_TYPE.initCalendar, {
                                defaultCultureCode: eviivo.eagle.basePageModelState.userCultureCode,
                                calendar: o,
                                yearRange: "-100:+50",
                                changeMonth: !0,
                                changeYear: !0,
                                dateFormat: eviivo.eagle.dateFormat.getDateFormat("MEDIUM_DATE_FORMAT"),
                                firstDay: a,
                                onSelect: k,
                                doNotSetInitialDate: !0
                            });
                            t && t.val() && (t = eviivo.webcore.datetime.parse.parseDate(t.val()),
                            o.datepicker("setDate", t))
                        }),
                        h.showCalendarButtons.on(p.click, P),
                        !0 === l.hideMemberId && h.memberIdContainer.css("display", "none"),
                        null != h.guestCheckBoxes && (h.guestCheckBoxes.on(p.change, A),
                        h.guestCheckBoxes.trigger("change")),
                        0 < h.additionalGuestContainer.length && (h.additionalGuestContainer.html(""),
                        h.searchBarContainer.removeClass("hide")),
                        null != v && "function" == typeof v && v(),
                        !0 === g && "True" === h.isInContactList.val() ? (h.lockables.prop("disabled", !0),
                        h.createNewContactButton.prop("disabled", !0),
                        h.updateExistingContactButton.prop("disabled", !1)) : (h.lockables.prop("disabled", !1),
                        h.createNewContactButton.prop("disabled", !1),
                        h.updateExistingContactButton.prop("disabled", !0)),
                        null != b && b && h.updateBookingGuest.val(!0),
                        null != l.comboboxSettings && null == h.searchBar && eviivo.webcore.ajaxCombobox.initSearchBar(l.comboboxSettings),
                        null != l.autocompleteSettings && null == h.searchBar && (h.searchBar = eviivo.webcore.autocomplete.initSearchBar(l.autocompleteSettings)),
                        jQuery("#howdidyouhearaboutusid"));
                        null != t && t.on(p.change, function() {
                            "OTH" == t.val() ? jQuery(".field-howdidyouhearaboutus").removeClass("hide") : jQuery(".field-howdidyouhearaboutus").addClass("hide")
                        }),
                        eviivo.component.form.telephone.reset(),
                        eviivo.component.form.telephone.init(c.form),
                        jQuery("input[name='tel-mask_FieldValues[FieldValues[telephone]]']").attr("name", "FieldValues[telephone]"),
                        jQuery("input[name='tel-mask_FieldValues[FieldValues[otherphone]]']").attr("name", "FieldValues[otherphone]")
                    },
                    onValidate: eviivo.eagle.guest.validation.isFormValid,
                    onSubmitSuccess: w,
                    onFormDataChange: I
                }
            };
            null != t && "function" == typeof t && (u = t),
            null != a && "function" == typeof a && (v = a),
            eviivo.webcore.forms.loadAjax(o)
        }
        function C(e) {
            h.form.valid() && 0 == eviivo.component.form.telephone.validate(c.form) && ("btnCreateNewContact" === e.target.id && (h.isInContactList.val("True"),
            h.addToContactClicked.val(!0)),
            r(),
            e = d(c.bookingGuestDropdown).find(":selected"),
            h.guestType.val(e.data("type")),
            0 == e.data("primary") && 1 == e.data("staying") && h.additionalGuestId.val(e.val()),
            h.form.submit(),
            h.addToContactClicked.val(!1),
            "True" === h.isInContactList.val()) && g && (h.lockables.prop("disabled", !0),
            h.createNewContactButton.prop("disabled", !0),
            h.updateExistingContactButton.prop("disabled", !1))
        }
        function k(e, o) {
            var t = o.input.datepicker("getDate");
            jQuery("input#" + o.input.data("target")).val(t.evStandardIso8601DateTimeUtcExtended()),
            o.input.parents(c.datePicker).find("a").removeClass("btn-disabled")
        }
        function w(e) {
            h.guestId.val(e.DataPayload),
            null != u && "function" == typeof u && u()
        }
        function I(e) {
            eviivo.webcore.notifier.show({
                type: eviivo.webcore.notifier.types.warn,
                message: l.resources.onChageMessage
            })
        }
        function T(e) {
            var o = d(this).parents(c.datePicker);
            o.find("input").val(""),
            o.find("a").addClass("btn-disabled")
        }
        function x(e) {
            var o = jQuery(this)
              , t = d("#" + o.data("target"));
            "" === o.val() && t && t.val("")
        }
        function B(e) {
            var o = d(this)
              , t = o.prop("id");
            o.hasClass(n) || (h.tabs.removeClass(n),
            o.addClass(n),
            h.tabContainer.removeClass("hide"),
            h.tabContainer.not("#guest-section-container-" + e.currentTarget.id).addClass("hide")),
            t === a.guestVoucher && h.guestVoucherSectionInputs.prop("disabled", !0)
        }
        function S() {
            var e = h.form.find("select");
            e.val(e.find("option:first-child").val()),
            h.form.find("input.guest-field, textarea").val("")
        }
        function D(e) {
            ("False" === h.isInContactList.val() ? S : (h.isInContactList.val("False"),
            h.guestId.val(0),
            h.updateBookingGuest.val(!0),
            h.createNewContactButton.prop("disabled", !1),
            h.updateExistingContactButton.prop("disabled", !0),
            S(),
            r))()
        }
        function P(e) {
            d(this).siblings(c.datePickers).datepicker("show")
        }
        function j(e, o) {
            e.html(o).val(e.data("selectedvalue"))
        }
        function N(e) {
            var o, t = d(this).val();
            "" !== t && ((o = h.stateprovince).html(""),
            null != (t = eviivo.webcore.staticData.htmlOptions.counties[t]) ? (o.prop("disabled", !1),
            o.html(t.html),
            null != (t = o.data("selectedvalue")) && (o.val(t),
            o.data("selectedvalue", ""))) : o.prop("disabled", !0))
        }
        function A(e) {
            var o = d(this)
              , t = o.data("target")
              , o = o.is(":checked");
            d("#" + t).val(o)
        }
        window.eviivo.eagle.guest.init = e.init,
        window.eviivo.eagle.guest.loadGuestTabContainer = e.loadGuestTabContainer
    },
    9357: function() {
        function t(e) {
            null == r && (r = s.guestId.val());
            var t = "";
            jQuery.each(e, function(e, o) {
                t += "<option data-primary='" + o.IsPrimaryGuest + "'  data-billing='" + o.IsBillingGuest + "' data-staying='" + o.IsGuestStaying + "' data-type='" + o.GuestType + "'  value='" + o.GuestId + "'>" + o.FullName + " " + o.UserFriendlyGuestType + " </option>"
            }),
            s.bookigGuestDropdown.html(t),
            s.bookigGuestDropdown.val(r),
            r = null,
            o()
        }
        function o() {
            var e = s.bookigGuestDropdown.find(":selected")
              , o = e.data("billing")
              , t = e.data("staying")
              , e = e.data("primary");
            a(s.billingGuestCheckBox, o, o),
            a(s.primaryGuestCheckBox, e, e),
            a(s.stayingInTheRoomCheckBox, t, e)
        }
        function a(e, o, t) {
            e.prop("disabled", t),
            e.prop("checked", o)
        }
        var i, n, s, r, l, d;
        window.eviivo = window.eviivo || {},
        window.eviivo.eagle = window.eviivo.eagle || {},
        window.eviivo.eagle.guest = window.eviivo.eagle.guest || {},
        window.eviivo.eagle.guest.multiguests = window.eviivo.eagle.guest.multiguests || {},
        window.eviivo.eagle.guest.multiguests = (n = {
            resources: {
                submitSuccessMessage: null,
                onChageMessage: null
            }
        },
        s = {
            bookigGuestDropdown: null,
            guestId: null,
            billingGuestCheckBox: null,
            primaryGuestCheckBox: null,
            stayingInTheRoomCheckBox: null
        },
        r = null,
        l = {
            getGuestForDropdown: {
                actionId: "BookingGuestsForDropdown",
                url: eviivoSuiteApp + "/guest/booking-guests"
            }
        },
        d = {
            bookingGuestDropdown: "#booking-guests",
            guestId: "#GuestId",
            billingGuestCheckBox: "#BillingGuest",
            primaryGuestCheckBox: "#PrimaryGuest",
            stayingInTheRoomCheckBox: "#StayingInRoom"
        },
        {
            init: function(e) {
                if ("function" != typeof window.jQuery)
                    throw "eviivo.eagle.guest.multiguests: module depends on jQuery";
                i = window.jQuery,
                i.extend(n, e)
            },
            manageBookingGuestStatus: o,
            refreshDropDown: function(e, o) {
                s.bookigGuestDropdown = i(d.bookingGuestDropdown),
                s.guestId = i(d.guestId),
                s.billingGuestCheckBox = i(d.billingGuestCheckBox),
                s.primaryGuestCheckBox = i(d.primaryGuestCheckBox),
                s.stayingInTheRoomCheckBox = i(d.stayingInTheRoomCheckBox),
                eviivo.webcore.ajaxHelper.executeAjax({
                    actionId: l.getGuestForDropdown.actionId,
                    url: l.getGuestForDropdown.url,
                    method: eviivo.webcore.ajaxHelper.methods.POST,
                    contentType: eviivo.webcore.ajaxHelper.contentTypes.JSON,
                    data: {
                        businessId: eviivo.eagle.basePageModelState.businessId,
                        orderId: e,
                        bookingId: o
                    },
                    callback: t
                })
            }
        })
    },
    1899: function() {
        var o, t, a, i, n, s, r;
        window.eviivo = window.eviivo || {},
        window.eviivo.eagle = window.eviivo.eagle || {},
        window.eviivo.eagle.guest = window.eviivo.eagle.guest || {},
        window.eviivo.eagle.guest.validation = window.eviivo.eagle.guest.validation || {},
        window.eviivo.eagle.guest.validation = (a = {
            form: null,
            validateMemberId: !1,
            resources: {
                memberIdValidationMessage: null
            }
        },
        i = {
            email: 150,
            name: 150,
            surname: 150,
            postcode: 20,
            phone: 40,
            address: 500
        },
        n = {
            name: null,
            surname: null,
            postcode: null,
            email: null,
            phoneNumber: null,
            otherPhoneNumber: null,
            memberId: null,
            form: null,
            address1: null,
            address2: null,
            address3: null
        },
        s = {
            name: "#forename",
            postcode: "#postcode",
            surname: "#surname",
            email: "#email",
            phoneNumber: "#telephone",
            otherPhoneNumber: "#otherphone",
            memberId: "#memberid",
            address1: "#address1",
            address2: "#address2",
            address3: "#address3"
        },
        r = "error",
        {
            init: function(e) {
                if ("function" != typeof window.jQuery)
                    throw "eviivo.eagle.guest.validation: module depends on jQuery";
                if (t = window.jQuery,
                "undefined" == typeof eviivo || void 0 === eviivo.eagle || void 0 === eviivo.eagle.guest)
                    throw "eviivo.eagle.guest.validation: module depends on eviivo.eagle.guest";
                if (o = t.extend(a, e),
                n.form = t(o.form),
                null === n.form)
                    throw "Please specify form id";
                n.name = n.form.find(s.name),
                n.surname = n.form.find(s.surname),
                n.email = n.form.find(s.email),
                n.phoneNumber = n.form.find(s.phoneNumber),
                n.otherPhoneNumber = n.form.find(s.otherPhoneNumber),
                n.postcode = n.form.find(s.postcode),
                n.address1 = n.form.find(s.address1),
                n.address2 = n.form.find(s.address2),
                n.address3 = n.form.find(s.address3),
                n.name.attr("maxLength", i.name),
                n.surname.attr("maxLength", i.surname),
                n.email.attr("maxLength", i.email),
                n.postcode.attr("maxLength", i.postcode),
                n.phoneNumber.attr("maxLength", i.phone),
                n.otherPhoneNumber.attr("maxLength", i.phone),
                n.address1.attr("maxLength", i.address),
                n.address2.attr("maxLength", i.address),
                n.address3.attr("maxLength", i.address),
                !0 === o.validateMemberId && (n.memberId = t(s.memberId)),
                jQuery.validator.addMethod("phoneNumber", function(e, o) {
                    return this.optional(o) || eviivo.eagle.constants.regEx.phoneNumber.test(e)
                }),
                jQuery.validator.addMethod("email", function(e, o) {
                    return this.optional(o) || eviivo.eagle.constants.regEx.email.test(e)
                }),
                jQuery.validator.addMethod("memberId", function(e, o) {
                    return this.optional(o) || eviivo.eagle.constants.regEx.memberid.test(e)
                }),
                n.form.validate({
                    ignore: "",
                    errorPlacement: function() {
                        return !0
                    },
                    errorClass: r,
                    onfocusout: !1
                }),
                n.surname.rules("add", {
                    required: !0
                }),
                n.phoneNumber.rules("add", {
                    phoneNumber: !0
                }),
                n.otherPhoneNumber.rules("add", {
                    phoneNumber: !0
                }),
                n.email.rules("add", {
                    email: !0
                }),
                o.validateMemberId && n.memberId.rules("add", {
                    memberId: !0
                })
            },
            isFormValid: function() {
                return n.form.valid()
            }
        })
    },
    6360: function() {
        function t(e) {
            return {
                ExternalReference: r,
                Description: e
            }
        }
        function a(e, t) {
            return n(e) || n(e = jQuery.grep(e, function(e, o) {
                return e.ExternalReference === t
            })) ? [] : e
        }
        function i(e) {
            return n(e) ? [] : e.sort(function(e, o) {
                return e.PromotionalRateValue - o.PromotionalRateValue
            })
        }
        function n(e) {
            return "undefined" === e || null == e || !e.length
        }
        function s(e) {
            return e === r
        }
        var r;
        window.eviivo = window.eviivo || {},
        window.eviivo.eagle = window.eviivo.eagle || {},
        window.eviivo.eagle.promotion = window.eviivo.eagle.promotion || {},
        window.eviivo.eagle.promotion.selectList = window.eviivo.eagle.promotion.selectList || {},
        window.eviivo.eagle.promotion.selectList = (r = "00000000-0000-0000-0000-000000000000",
        {
            isListEmpty: n,
            getOrderedList: function(e, o) {
                return o = [t(o)],
                n(e) ? o : i(o.concat(e))
            },
            getOrderedListByDisplayName: function(e, o) {
                var o = [t(o)];
                return n(e) ? o : n(o = o.concat(e)) ? [] : o.sort(function(e, o) {
                    return e.ExternalReference == r ? -1 : o.ExternalReference != r && (null != e.DisplayName && "" != e.DisplayName || null == o.DisplayName || "" == o.DisplayName) ? null != o.DisplayName && "" != o.DisplayName || null == e.DisplayName || "" == e.DisplayName ? null != e.DisplayName && "" != e.DisplayName || null != o.DisplayName && "" != o.DisplayName ? e.DisplayName < o.DisplayName ? -1 : o.DisplayName < e.DisplayName ? 1 : 0 : 0 : -1 : 1
                })
            },
            isEmptyItem: function(e) {
                return s(e.ExternalReference)
            },
            getByReference: a,
            getCheapestPromoReference: function(e, o) {
                if (n(e))
                    return r;
                if (1 < e.length) {
                    var t = e.filter(function(e) {
                        return ("WXO" === e.TypeCode || "UNV" === e.TypeCode) && e.ExternalReference !== r || null != o && e.ExternalReference === o
                    });
                    if (!n(t))
                        return i(t)[0].ExternalReference
                }
                return e[0].ExternalReference
            },
            getByReferenceExcludeDefault: function(e, o) {
                return s(o) ? [] : a(e, o)
            },
            getOriginalPrice: function(e) {
                return e.OriginalRateValue
            },
            areEqual: function(e, o) {
                return !(null == e && null != o || null != e && null == o || (null != e || null != o) && (void 0 === e || void 0 === o || e.length !== o.length || 0 !== e.length && e[0].ExternalReference !== o[0].ExternalReference))
            },
            getDefaultReference: function() {
                return r
            },
            contains: function(e, o) {
                if (!n(e) && o)
                    for (var t = 0; t < e.length; t++)
                        if (e[t].ExternalReference === o.ExternalReference)
                            return !0;
                return !1
            }
        })
    }
}
  , a = {};
function n(e) {
    var o = a[e];
    return void 0 !== o || (o = a[e] = {
        exports: {}
    },
    t[e](o, o.exports, n)),
    o.exports
}
n.n = function(e) {
    var o = e && e.__esModule ? function() {
        return e.default
    }
    : function() {
        return e
    }
    ;
    return n.d(o, {
        a: o
    }),
    o
}
,
n.d = function(e, o) {
    for (var t in o)
        n.o(o, t) && !n.o(e, t) && Object.defineProperty(e, t, {
            enumerable: !0,
            get: o[t]
        })
}
,
n.o = function(e, o) {
    return Object.prototype.hasOwnProperty.call(e, o)
}
,
function() {
    "use strict";
    n(3611),
    n(4817),
    n(8869),
    n(6360),
    n(5511),
    n(3202),
    n(2935),
    n(3764),
    n(9099),
    n(1746),
    n(2402),
    n(3867),
    n(9976),
    n(8047),
    n(2019),
    n(5785),
    n(8693),
    n(4683),
    n(7766),
    n(1899),
    n(8377),
    n(9357),
    n(5847),
    n(5421)
}();
//# sourceMappingURL=booking.min.js.map
