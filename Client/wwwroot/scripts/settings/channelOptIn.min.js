var t={2925:function(){function o(){var e;g.form=p(m.form),g.buttonConnect=p(m.buttonConnect),g.surname=p(m.surname),g.forename=p(m.forename),g.email=p(m.email),g.phoneNumber=p(m.phoneNumber),g.birthDate=p(m.birthDate),g.birthDatePicker=p(m.birthDatePicker),g.registrationNumber=p(m.registrationNumber),g.taxNumber=p(m.taxNumber),g.airbnbSdkUrl=p(m.airbnbSdkUrl),g.existingAccountSection=p(m.existingAccountSection),g.selectExistingAccountSection=p(m.selectExistingAccountSection),g.connectToExistingAccountRadio=p(m.connectToExistingAccountRadio),g.connectToExistingAccountYes=p(m.connectToExistingAccountYes),g.businessAccountSection=p(m.businessAccountSection),g.registerAsBusinessAccountRadio=p(m.registerAsBusinessAccountRadio),g.registerAsBusinessAccountYes=p(m.registerAsBusinessAccountYes),g.chooseAccountSelect=p(m.chooseAccountSelect),g.connectToExistingAccountRadio.on("change",a),g.registerAsBusinessAccountRadio.on("change",s),g.buttonConnect.on("click",n),p.validator.addMethod("phoneNumber",function(e,n){return this.optional(n)||h.isValidNumber()},b.resources.intlTelErrorMessage),p.validator.addMethod("email",function(e,n){return this.optional(n)||eviivo.eagle.constants.regEx.email.test(e)}),p.validator.addMethod("minAge",function(e,n,t){var o=(new Date).cloneDateOnly(),n=p(n).datepicker("getDate").cloneDateOnly(),n=eviivo.webcore.datetime.utils.addYearsToDate(n,t);return 0<=eviivo.webcore.datetime.utils.getDaysBetween(n,o)},b.resources.AirbnbBirthDateValidationError),g.form.validate({ignore:"",errorClass:C,onfocusout:!1,rules:{phoneNumber:{required:!0,intlTelNumber:!0},email:"required"},messages:{phoneNumber:"PhoneNumber",email:"Email"}}),g.surname.rules("add",{required:!0,minlength:2}),g.forename.rules("add",{required:!0,minlength:2}),g.phoneNumber.rules("add",{phoneNumber:!0,required:!0}),g.email.rules("add",{email:!0,required:!0,messages:{remote:b.resources.AirbnbAccountExistsValidationError}}),g.birthDatePicker.rules("add",{required:!0,minAge:18}),g.taxNumber.rules("add",{required:{depends:function(){return g.registerAsBusinessAccountYes.is(":checked")}}}),g.registrationNumber.rules("add",{required:{depends:function(){return g.registerAsBusinessAccountYes.is(":checked")}}}),h=window.intlTelInput(g.phoneNumber.get(0),{nationalMode:!0,preferredCountries:b.intlTelInputPreferredCountries,placeholder:!0,utilsScript:b.intlTelInputUtilsScriptLink}),e=(new Date).evStandardFirstDayCalendarOffset(eviivo.eagle.basePageModelState.userCultureCode),eviivo.webcore.calendar.init(eviivo.webcore.calendar.CALENDAR_TYPE.initCalendar,{defaultCultureCode:b.cultureCode,calendar:g.birthDatePicker,yearRange:"-100:+0",changeMonth:!0,changeYear:!0,dateFormat:eviivo.eagle.dateFormat.getDateFormat("MEDIUM_DATE_FORMAT"),firstDay:e,doNotSetInitialDate:!0,onSelect:r}),a(),s()}function n(){var e,n=g.airbnbSdkUrl.val();g.connectToExistingAccountYes.is(":checked")?0==g.chooseAccountSelect.length||"0"==(e=g.chooseAccountSelect.val())?window.open(n,"_blank"):(n=eviivoSuiteApp+"/channels/mapAirbnbNewProperty",eviivo.webcore.ajaxHelper.executeAjax({actionId:"MapAirbnbNewProperty",url:n,data:{LegalEntityId:e},method:eviivo.webcore.ajaxHelper.methods.POST,contentType:eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,dataType:eviivo.webcore.ajaxHelper.dataTypes.JSON,callback:function(e){e?(t(),u()):eviivo.webcore.notifier.show({type:eviivo.webcore.notifier.types.error,message:eviivo.eagle.translations.resources.notify.genericErrorMessage,autoHide:!0})}})):i()&&(g.phoneNumber.val(h.getNumber()),l(!1),g.form.submit())}function t(){eviivo.webcore.popup.close()}function i(){return g.form.valid()}function r(e,n){n=n.input.datepicker("getDate");g.birthDate.val(n.evStandardIso8601DateExtended()),g.birthDatePicker.valid()}function a(){g.connectToExistingAccountYes.is(":checked")?(g.selectExistingAccountSection.show(),g.existingAccountSection.hide()):(g.selectExistingAccountSection.hide(),g.existingAccountSection.show())}function s(){g.registerAsBusinessAccountYes.is(":checked")?(g.businessAccountSection.show(),0<g.taxNumber.val().length&&0<g.registrationNumber.val().length?g.buttonConnect.enable():g.buttonConnect.disable()):(g.businessAccountSection.hide(),g.buttonConnect.enable())}function l(e){null!=g.buttonConnect&&(!0===e?(g.buttonConnect.removeClass("btn-saving"),g.buttonConnect.enable()):(g.buttonConnect.addClass("btn-saving"),g.buttonConnect.disable()))}function u(){window.location.reload()}function c(){t(),eviivo.webcore.notifier.show({type:eviivo.webcore.notifier.types.success,message:b.resources.AirbnbAccountSetupSuccessMessage,autoHide:!1}),u()}function d(e){null!=e&&null!=e.Errors&&0<e.Errors.length&&("existing_account"==e.DataPayload?(l(!0),g.email.addClass("error")):t(),eviivo.webcore.notifier.show({type:eviivo.webcore.notifier.types.error,message:e.Errors[0],autoHide:!1}))}var p,b,v,m,g,e,h,C;window.eviivo=window.eviivo||{},window.eviivo.eagle=window.eviivo.eagle||{},window.eviivo.eagle.channels=window.eviivo.eagle.channels||{},window.eviivo.eagle.channels.airbnb=window.eviivo.eagle.channels.airbnb||{},window.eviivo.eagle.channels.airbnb=(p=jQuery,v={resources:{AirbnbPopupTitle:"Connect to Airbnb",ConnectButton:"Connect",genericErrorMessage:""}},m={form:"#formairbnbconnectdetails",formContainer:".airbnb-connect-main-container",buttonConnectId:"btnAirbnbConnect",buttonConnect:"#btnAirbnbConnect",surname:"#Surname",forename:"#Forename",email:"#Email",phoneNumber:"#Telephone",birthDate:"#BirthDate",registrationNumber:"#CompanyRegistrationNumber",taxNumber:"#TaxNumber",airbnbSdkUrl:"#AirbnbSdkUrl",connectToExistingAccountRadio:"#divConnectToExistingAccount input:radio",connectToExistingAccountYes:"#connectToExistingAirbnbAccountYes",registerAsBusinessAccountRadio:"#divRegisterAsBusinessAccount input:radio",registerAsBusinessAccountYes:"#registerAsBusinessAccountYes",existingAccountSection:"#use-existing-account-true",businessAccountSection:"#use-business-account-true",selectExistingAccountSection:"#use-existing-account-false",formId:"formairbnbconnectdetails",formContainerClass:"airbnb-connect-main-container",birthDatePicker:".datepicker",chooseAccountSelect:"#Airbnb_Connect_Account"},g={form:null,buttonConnect:null,surname:null,forename:null,email:null,phoneNumber:null,birthDate:null,birthDatePicker:null,registrationNumber:null,taxNumber:null,airbnbSdkUrl:null,connectToExistingAccountRadio:null,registerAsBusinessAccountRadio:null,connectToExistingAccountYes:null,registerAsBusinessAccountYes:null,existingAccountSection:null,businessAccountSection:null,selectExistingAccountSection:null,distributorShortName:null},h=e=null,C="error",{init:function(e){b=p.extend(v,e)},openPopup:function(t){(e=null)==e&&(e={buttons:"<button id='"+m.buttonConnectId+"' class='btn btn-right btn-save-widget'><span class='btn-text'>"+b.resources.ConnectButton+"</span><span class='btn-spinner'></span><span class='btn-response'></span></button>",header:b.resources.AirbnbPopupTitle,contentHolder:"<div class='"+m.formContainerClass+" mod-form'></div>"}),eviivo.webcore.popup.open({template:e,actionCompleteCallback:function(){var e=m.formId,n=t;n={location:eviivoSuiteApp+"/channels/GetAirbnbConnectPopupForm",requestData:{channelId:t},placeholder:m.formContainer,id:e,spinnerSettings:b.spinnerSettings,notificationSettings:{submitSuccess:{enabled:!1}},shouldAutoValidate:!0,actions:{onLoadSuccess:o,onValidate:i,onSubmitSuccess:c,onSubmitFail:d}},eviivo.webcore.forms.loadAjax(n)}})}})},4655:function(){function r(){eviivo.webcore.loadingSpinner.create(w.spinnerSettings).start()}function a(){eviivo.webcore.loadingSpinner.create(w.spinnerSettings).stop()}function n(){var e=eviivoSuiteApp+"/channels/checkIfBComPropertyExist";eviivo.webcore.ajaxHelper.executeAjax({actionId:"CheckIfBComPropertyExist",url:e,method:eviivo.webcore.ajaxHelper.methods.GET,contentType:eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,dataType:eviivo.webcore.ajaxHelper.dataTypes.JSON,callback:function(e){null!=e.DataPayload&&1==e.DataPayload.Verified?d():o(O.requestPropertyIDScreen)}})}function e(){o(O.gettingInfoLoadingScreen);var e=O.newEmailAddress.val(),n=O.accessGroupTypeCode.val();eviivo.webcore.ajaxHelper.executeAjax({actionId:"GetBookingComLegalEntity",url:eviivoSuiteApp+"/channels/getBookingComLegalEntity",data:{Email:e,AccessGroupTypeCode:n},method:eviivo.webcore.ajaxHelper.methods.POST,contentType:eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON,dataType:eviivo.webcore.ajaxHelper.dataTypes.JSON,callback:function(e){null!==e.DataPayload.LegalEntityId?(o(O.groupDetailsScreen),e=e.DataPayload,O.groupDetailsLegalEntityId=y("#groupDetailsLegalEntityId"),O.groupDetailsCity=y("#groupDetailsCity"),O.groupDetailsPhoneNumber=y("#groupDetailsPhoneNumber"),O.groupDetailsCompanyName=y("#groupDetailsCompanyName"),O.groupDetailsConnectionWarningHeader=y("#groupDetailsConnectionWarningHeader"),O.groupDetailsChangeGroupLink=y("#groupDetailsChangeGroupLink"),O.legalEntityId.val(e.LegalEntityId),O.groupDetailsLegalEntityId.text(w.resources.BookingCom_LEID+e.LegalEntityId),O.groupDetailsCity.text(e.City),O.groupDetailsPhoneNumber.text(e.LegalContactPhoneNumber),O.groupDetailsCompanyName.text(e.CompanyName),O.groupDetailsEmail=y("#groupDetailsEmail"),O.groupDetailsEmail.text(O.newEmailAddress.val()),O.groupDetailsConnectionWarningHeader.text(w.resources.BookingCom_ConnectToGroupPrefix+" "+e.CompanyName),O.groupDetailsChangeGroupLink.on("click",t)):o(O.addNewGroupScreen)},failCallback:function(){return o(O.addNewGroupScreen)}})}function s(e){O.gettingInfoLoadingScreen=y("#GettingInfoLoadingScreen"),O.requestPropertyIDScreen=y("#RequestPropertyIDScreen"),O.requestEmailScreen=y("#RequestEmailScreen"),O.groupDetailsScreen=y("#GroupDetailsScreen"),O.addNewGroupScreen=y("#AddNewGroupScreen"),A=O.gettingInfoLoadingScreen,O.channelId=y("#ChannelId"),O.distributorShortName=y("#DistributorShortName"),O.newEmailAddress=y("#newEmailAddress"),O.defaultEmail=y("#defaultEmail"),O.channelTermsId=y("#ChannelTermsId"),O.legalEntityId=y("#LegalEntityId"),O.accessGroupTypeCode=y("#AccessGroupTypeCode"),O.propertyIdDiv=y("#propertyIdDiv"),O.hasPropertyIdYes=y("#hasPropertyIdYes"),O.hasPropertyIdNo=y("#hasPropertyIdNo"),O.propertyId=y("#propertyId"),O.defaultEmail.text(y("#PrimaryEmail").val()),O.buttonConnect=y("#"+S.buttonConnectId),O.buttonContinue=y("#"+S.buttonContinueId),O.buttonConnect.enable(),O.buttonCancel=y("#"+S.buttonCancelId),n(),O.buttonCancel.on("click",g),O.buttonConnect.on("click",b),O.buttonContinue.on("click",m),O.hasPropertyIdYes.on("click",i),O.hasPropertyIdNo.on("click",i),O.propertyId.on("change",c)}function t(e){e.preventDefault(),o(O.requestEmailScreen)}function o(e){switch(A.addClass("hide"),y(e).removeClass("hide"),A=e){case O.groupDetailsScreen:O.buttonContinue.addClass("hide"),O.buttonConnect.removeClass("hide"),O.buttonConnect.enable();break;case O.requestEmailScreen:O.buttonContinue.removeClass("hide"),O.buttonConnect.addClass("hide");break;case O.addNewGroupScreen:O.buttonContinue.addClass("hide"),O.buttonConnect.removeClass("hide"),O.buttonConnect.enable(),O.form=y("#"+S.formId),O.contactName=y("#ContactName"),O.email=y("#Email"),O.telephone=y("[name=Telephone]"),O.legalName=y("#LegalName"),O.preferredLanguage=y("#PreferredLanguage"),O.companyName=y("#CompanyName"),O.website=y("#Website"),O.numberOfProperties=y("#NumberOfProperties"),O.streetName=y("#StreetName"),O.postCode=y("#PostCode"),O.country=y("#Countries"),O.city=y("#City"),O.contractCountries=y("#ContractCountries"),O.buttonAddContractCountry=y("#btnAddContractCountry"),O.contractCountriesTextContainer=y("#contractCountriesTextContainer"),O.contractCountriesValueContainer=y("#contractCountriesValueContainer"),O.defaultContractCountry=y("#defaultContractCountry"),O.selectedContractCountryValues=y("#SelectedContractCountryValues"),O.buttonAddContractCountry.on("click",l),y(".removeContractCountry").on("click",u),y(O.email).val(y(O.newEmailAddress).val()),y(O.buttonAddContractCountry).click(),eviivo.component.form.telephone.init(S.formId)}}function i(){(y(this).attr("id")==O.hasPropertyIdYes.attr("id")?(y(O.propertyIdDiv).removeClass("hide"),O.hasPropertyIdYes.attr("checked",!0),O.hasPropertyIdNo.removeAttr("checked"),y(O.buttonConnect).removeClass("hide"),y(O.buttonContinue)):(y(O.propertyIdDiv).addClass("hide"),O.hasPropertyIdNo.attr("checked",!0),O.hasPropertyIdYes.removeAttr("checked"),y(O.buttonContinue).removeClass("hide"),y(O.buttonConnect))).addClass("hide")}function l(e){e.preventDefault();var e=y(O.contractCountriesTextContainer),n=y(O.contractCountriesValueContainer),t=y(O.contractCountries).find(":selected"),o=t.val(),t=t.text(),i=y("#defaultContractCountryText"),r=y("#defaultContractCountryValue"),a=e.find("[id^='contractCountryText']").length,s="contractCountryText";""!==o&&(0==e.find(y("a[id^='"+s+"']:contains('"+t+"')")).length&&((r=y(r).clone(!0)).attr("id","contractCountryValue"+a),n.append(r),r.val(o),(n=y(i).clone(!0)).attr("id",s+a),n.attr("data-valueId",r.attr("id")),e.append(n),n.text(t),n.append(i.children(0).clone()),n.removeClass("hide")),v())}function u(e){e.preventDefault();e=y(this).attr("data-valueId");y("#"+e).remove(),y(this).remove(),v()}function c(){var e=y(this),n=parseInt(e.val());Number.isInteger(n)&&0!=n.length?e.removeClass("error"):(eviivo.webcore.notifier.show({type:eviivo.webcore.notifier.types.error,message:w.resources.BookingComPropertyIdErrorMessage,autoHide:!0}),e.addClass("error"))}function d(){var e=O.distributorShortName.val();window.eviivo.eagle.channels.linkDistributorAccount(e),I()}function p(){var e=eviivoSuiteApp+"/channels/createBookingComGroup",n=(r(),{Email:O.email.val(),ContactName:O.contactName.val(),Telephone:y('[name="Telephone"]').val(),LegalName:O.legalName.val(),PreferredLanguage:O.preferredLanguage.val(),CompanyName:O.companyName.val(),Website:O.website.val(),NumberOfProperties:O.numberOfProperties.val(),Countries:O.country.val(),City:O.city.val(),PostCode:O.postCode.val(),StreetName:O.streetName.val(),ContractCountries:O.selectedContractCountryValues.val()});eviivo.webcore.ajaxHelper.executeAjax({actionId:"CreateBookingComGroup",url:e,data:n,method:eviivo.webcore.ajaxHelper.methods.POST,contentType:eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,dataType:eviivo.webcore.ajaxHelper.dataTypes.JSON,callback:function(e){var n,t;null!=e&&null!=e.Errors&&0<e.Errors.length?(t=e,a(),n=t.DataPayload,y.each(y.parseJSON(n),function(){y("#"+this).addClass("error")}),eviivo.webcore.notifier.show({type:eviivo.webcore.notifier.types.error,message:t.Errors[0],autoHide:!0})):(n=e,a(),d(),g(),eviivo.webcore.notifier.show({type:eviivo.webcore.notifier.types.success,message:n.DataPayload,autoHide:!0}),C())}})}function b(){switch(A.attr("id")){case O.requestPropertyIDScreen.attr("id"):y(O.propertyId).trigger("change"),y(O.propertyId).hasClass("error")||(e=eviivoSuiteApp+"/channels/mapNewProperty",n=O.propertyId.val(),i=O.legalEntityId.val(),eviivo.webcore.ajaxHelper.executeAjax({actionId:"MapNewProperty",url:e,data:{DistributorPropertyId:n,LegalEntityId:i},method:eviivo.webcore.ajaxHelper.methods.POST,contentType:eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,dataType:eviivo.webcore.ajaxHelper.dataTypes.JSON,callback:function(e){null!=e&&1==e.DataPayload?d():eviivo.webcore.notifier.show({type:eviivo.webcore.notifier.types.error,message:e.Errors[0],autoHide:!0})}}));break;case O.groupDetailsScreen.attr("id"):e=eviivoSuiteApp+"/channels/connectGroup",n=O.legalEntityId.val(),r(),eviivo.webcore.ajaxHelper.executeAjax({actionId:"ConnectGroup",url:e,data:{LegalEntityId:n},method:eviivo.webcore.ajaxHelper.methods.POST,contentType:eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,dataType:eviivo.webcore.ajaxHelper.dataTypes.JSON,callback:function(e){null!=e&&null!=e.Errors&&0<e.Errors.length?(a(),g(),eviivo.webcore.notifier.show({type:eviivo.webcore.notifier.types.error,message:e.Errors[0],autoHide:!0})):(g(),d())}});break;case O.addNewGroupScreen.attr("id"):eviivo.component.form.init({formId:S.formId}),eviivo.component.validation.init(S.formId),eviivo.component.validation.isValid("#"+S.formId)&&v()&&(i=y(O.contractCountriesValueContainer).find("[id^='contractCountryValue']"),(t=y("#SelectedContractCountryValues")).val(""),o=0,i.each(function(){var e=y(this),n=0<o?",":"";t.val(t.val()+n+e.val()),o++}),p())}var t,o,e,n,i}function v(){if(0!=y(O.contractCountriesValueContainer).find("[id^='contractCountryValue']").length)return O.contractCountries.removeClass("error"),1;O.contractCountries.addClass("error")}function m(){switch(A.attr("id")){case O.requestPropertyIDScreen.attr("id"):o(O.requestEmailScreen);break;case O.requestEmailScreen.attr("id"):eviivo.component.validation.email.init("RequestEmailScreen"),!function(){if(eviivo.component.validation.isValid("#RequestEmailScreen"))return 1;y(O.defaultEmail).text(y(this).val())}()||(y(O.defaultEmail).text(y(O.newEmailAddress).val()),e())}}function g(){eviivo.webcore.popup.close()}function h(){return O.form.valid()}function C(){window.location.reload()}function I(){g(),C()}function f(e){g(),null!=e&&null!=e.Errors&&0<e.Errors.length&&eviivo.webcore.notifier.show({type:eviivo.webcore.notifier.types.error,message:e.Errors[0],autoHide:!0})}var y,w,A,T,S,O,k;window.eviivo=window.eviivo||{},window.eviivo.eagle=window.eviivo.eagle||{},window.eviivo.eagle.channels=window.eviivo.eagle.channels||{},window.eviivo.eagle.channels.bookingcom=window.eviivo.eagle.channels.bookingcom||{},window.eviivo.eagle.channels.bookingcom=(y=jQuery,T={resources:{BookingComPopupTitle:"Connect to booking.com",ConnectButton:"Connect",genericErrorMessage:""}},S={form:"#form-bookingcom-connectdetails",formContainer:".bookingcom-connect-main-container",buttonConnectId:"btnConnect",buttonCancelId:"btnCancel",buttonContinueId:"btnContinue",buttonContinue:"#btnContinue",formId:"formbcomconnectdetails",formContainerClass:"bookingcom-connect-main-container"},O={gettingInfoLoadingScreen:null,requestPropertyIDScreen:null,requestEmailScreen:null,groupDetailsScreen:null,addNewGroupScreen:null,channelId:null,channelTermsId:null,distributorShortName:null,defaultEmail:null,legalEntityId:null,propertyIdDiv:null,hasPropertyIdYes:null,hasPropertyIdNo:null,propertyId:null,newEmailAddress:null,primaryEmail:null,accessGroupTypeCode:null,form:null,buttonConnect:null,buttonCancel:null,buttonContinue:null,buttonAddContractCountry:null,groupDetailsLegalEntityId:null,groupDetailsCity:null,groupDetailsPhoneNumber:null,groupDetailsCompanyName:null,groupDetailsEmail:null,groupDetailsConnectionWarningHeader:null,groupDetailsChangeGroupLink:null,contactName:null,email:null,telephone:null,legalName:null,preferredLanguage:null,companyName:null,website:null,streetName:null,postCode:null,city:null,country:null,contractCountries:null,numberOfProperties:null,contractCountriesTextContainer:null,contractCountriesValueContainer:null,defaultContractCountry:null,selectedContractCountryValues:null},k=null,{init:function(e){w=y.extend(T,e)},checkIfPropertyExist:n,openPopup:function(t,o,i){var e;eviivo.eagle.popup.isActive()&&eviivo.eagle.popup.hide(),(k=null)==k&&(k={buttons:(e="",e=(e=(e+="<button id='"+S.buttonCancelId+"' class='s-close-modal btn btn-secondary'>"+w.resources.CancelButton+"</button>")+"<button id='"+S.buttonContinueId+"'class='btn btn-right btn-save-widget hide'><span class='btn-text'>"+w.resources.ContinueButton+"</span></button>")+"<button id='"+S.buttonConnectId+"' class='btn btn-right btn-save-widget'><span class='btn-text'>"+w.resources.ConnectButton+"</span></button>"),header:w.resources.BookingComPopupTitle,contentHolder:"<div class='"+S.formContainerClass+" mod-form'></div>"}),eviivo.webcore.popup.open({template:k,actionCompleteCallback:function(){var e=S.formId,n=t;n={location:eviivoSuiteApp+"/channels/GetBookingComConnectPopup",requestData:{channelId:t,ChannelTermsId:o,DistributorShortName:i},placeholder:S.formContainer,id:e,spinnerSettings:w.spinnerSettings,notificationSettings:{submitSuccess:{enabled:!1}},shouldAutoValidate:!0,actions:{onLoadSuccess:s,onValidate:h,onSubmitSuccess:I,onSubmitFail:f}},eviivo.webcore.forms.loadAjax(n)}})}})},9863:function(){function n(){var n=this;n.distributorTypes=ko.observableArray(),n.addDistributorType=function(e){e=new t(e);n.distributorTypes.push(e)}}function t(e){var n=this;n.distributors=ko.observableArray([]),n.code=e.Code,n.name=e.Name,n.numberOfChannels=e.NumberOfChannels,n.isPrimary=ko.observable(e.Code==r);for(var t=0;t<e.Distributors.length;t++){var o=new i(e.Distributors[t],e.Code==r);n.distributors.push(o)}}function i(e,n){this.channels=ko.observableArray([]);for(var t=0;t<e.Channels.length;t++){var o=new s(e.Channels[t],n);this.channels.push(o),p++}}function s(r,e){var a=this;a.id=r.Id,a.name=r.Name,a.imageUri=r.ImageUri,a.termsSummary=r.TermsSummary,a.commission=parseInt(r.Commission),a.commissionDisplay=r.CommissionDisplay,a.requestedCommission=ko.observable(r.RequestedCommission),a.requestedCommissionDisplay=ko.observable(r.RequestedCommissionDisplay),a.optOutMessage=r.OptOutMessage,a.marketingText=r.MarketingText,a.preconnectMessage=r.PreconnectMessage,a.numberOfGroupChannels=r.NumberOfGroupChannels,a.integrationType=r.IntegrationTypeCode,a.businessChannelOptIn=ko.observable(r.BusinessChannelOptIn),a.businessChannelLegalOptIn=ko.observable(r.BusinessChannelLegalOptIn),a.isGroup=ko.observable(r.ChannelTypeCode===u.Group),a.hasImage=ko.observable(null!==r.ImageUri),a.hasTerms=ko.observable(null!==r.TermsSummary),a.providerAllowsOptOut=ko.observable(r.AllowProviderOptOut),a.hasType=ko.observable(!1),a.hasChargeType=ko.observable(!1),a.hasChargeValue=ko.observable(!1),a.hasWindowSize=ko.observable(!1),a.termsAgreed=ko.observable(!1),a.OTAInstractionsAgreed=ko.observable(!1),a.toggleSlide=ko.observable(!1),a.canAuthoriseAirbnb=ko.observable(l.canAuthoriseAirbnb),a.groupedChannels=ko.observable(0<r.GroupedChannels.length),a.businessIsOptedIn=ko.observable(null!=a.businessChannelOptIn().ChannelOptInStatusCode),a.techOptInToggleOn=ko.observable(null!=a.businessChannelOptIn().ChannelOptInStatusCode),a.optInStatus=ko.observable(a.businessChannelOptIn().ChannelOptInStatusName),a.optInStatusCode=ko.observable(a.businessChannelOptIn().ChannelOptInStatusCode),a.channelTermsId=ko.observable((a.businessIsOptedIn()?a.businessChannelOptIn():r).ChannelTermsId),a.businessIsLegalOptedIn=ko.observable(0!==a.businessChannelLegalOptIn().Id),a.distributorId=r.DistributorId,a.distributorName=r.DistributorName,a.distributorChecklistPopupTitle=r.DistributorChecklistPopupTitle,a.parentDistributorId=r.DistributorId,a.distributorShortName=ko.observable(r.DistributorShortName),a.isAirBnb=a.distributorShortName()===l.airbnbDistributorShortname,a.isGoogle=a.distributorShortName()===l.googleDistributorShortname,a.isBookingCom=a.distributorShortName()===l.bookingComDistributorShortname,a.isCommissionRequested=ko.computed(function(){return a.isGoogle&&null!=a.requestedCommissionDisplay()&&0<a.requestedCommissionDisplay().length&&a.requestedCommission()!=a.commission},this),a.requiredAirbnbAuthorisation=ko.computed(function(){var e=a.businessIsLegalOptedIn(),n=1==a.businessChannelLegalOptIn().DistributorAccountLinked,t=a.isAirBnb,o=a.optInStatusCode()===d.Live;return t&&e&&!n&&!o},this),a.requiredBookingComAuthorisation=ko.computed(function(){var e=a.businessIsLegalOptedIn(),n=1==a.businessChannelLegalOptIn().DistributorAccountLinked,t=a.isBookingCom,o=a.optInStatusCode()===d.Live;return t&&e&&!n&&!o},this),a.showAirBnbConnectButton=ko.computed(function(){var e=a.requiredAirbnbAuthorisation(),n=a.businessIsLegalOptedIn();return!(1==a.businessChannelLegalOptIn().DistributorAccountLinked)&&e&&n},this),a.showBookingComConnectButton=ko.computed(function(){var e=a.businessIsLegalOptedIn();return!(1==a.businessChannelLegalOptIn().DistributorAccountLinked)&&a.isBookingCom&&e},this),a.hideOptInRequestedComponent=ko.computed(function(){return!(a.businessIsLegalOptedIn()&&!a.businessIsOptedIn()&&!a.showAirBnbConnectButton()&&!a.showBookingComConnectButton())},this),a.showTechOptInButton=ko.computed(function(){var e=a.businessIsLegalOptedIn(),n=a.isAirBnb,t=a.isBookingCom;if(n||t){if(n){n=a.requiredAirbnbAuthorisation();if(e&&!n)return!0}else if(t&&e&&!a.requiredBookingComAuthorisation())return!0}else if(e)return!0;return!1},this),a.isPrimary=ko.observable(e),a.wantsToOptOut=ko.observable(!1),a.channelGroupId=r.ChannelGroupId,a.channelGroupOptin=r.ChannelGroupOptin,a.isMarketing=r.ChannelTypeCode===u.Marketing,a.autoTechOptin=ko.observable(!0===r.AutoTechOptin),a.optInStatusClass=ko.computed(function(){switch(a.optInStatusCode()){case d.Live:return c.Live;case d.InProgress:return c.InProgress;default:return""}},a),a.commisionLabel=ko.computed(function(){return a.integrationType===eviivo.eagle.constants.IntegrationTypeCode.myWeb?l.resources.ServiceFee:l.resources.CommisionFee},a),a.showOptedInLabel=ko.computed(function(){return a.integrationType!==eviivo.eagle.constants.IntegrationTypeCode.myWeb},a),a.channelIndex=p,a.summaryContainer=function(){a.toggleSlide(!a.toggleSlide())},a.agreeToTerms=function(){a.termsAgreed()?a.termsAgreed(!1):a.termsAgreed(!0)},a.authoriseAirbnb=function(){window.eviivo.eagle.channels.airbnb.openPopup(r.Id)},a.optIn=function(){eviivo.webcore.ajaxHelper.executeAjax({actionId:"optInChannel",url:eviivoSuiteApp+"/api/distribution/optin",data:{ChannelId:r.Id,ChannelTermsId:a.channelTermsId()},method:eviivo.webcore.ajaxHelper.methods.POST,contentType:eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,dataType:eviivo.webcore.ajaxHelper.dataTypes.JSON,callback:function(e){eviivo.eagle.popup.isActive()&&eviivo.eagle.popup.hide(),a.businessChannelOptIn(e),a.businessIsOptedIn(null!=e.ChannelOptInStatusCode),a.optInStatus(e.ChannelOptInStatusName),a.optInStatusCode(e.ChannelOptInStatusCode)},failCallback:function(){alert(l.resources.OptInError)}})},a.optOut=function(){eviivo.webcore.ajaxHelper.executeAjax({actionId:"optOutChannel",url:eviivoSuiteApp+"/api/distribution/optout",data:{Id:a.businessChannelOptIn().Id,BusinessId:a.businessChannelOptIn().BusinessId,ChannelId:r.Id},method:eviivo.webcore.ajaxHelper.methods.POST,contentType:eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,dataType:eviivo.webcore.ajaxHelper.dataTypes.JSON,callback:function(e){a.businessIsOptedIn(!1),a.optInStatusCode(null)},failCallback:function(){alert(l.resources.OptOutError)}})},a.stayOptedIn=function(){a.toggleSlide(!a.toggleSlide()),a.wantsToOptOut(!1)},a.showTerms=function(){var e=a.channelTermsId();window.open("TermsAndConditions/"+e,"TermsAndConditions","height=800,width=800")},a.showDistributorChecklist=function(){var e=eviivoSuiteApp+"/channels/getDistributorChecklist",n=a.distributorId;null!=a.parentDistributorId&&(n=a.parentDistributorId),eviivo.webcore.ajaxHelper.executeAjax({actionId:"GetDistributorChecklist",url:e,data:{distributorId:n,channelId:r.Id},method:eviivo.webcore.ajaxHelper.methods.POST,contentType:eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,dataType:eviivo.webcore.ajaxHelper.dataTypes.HTML,callback:function(e){$(".checklist").html(e),0===$(".checklist :checkbox").length&&a.OTAInstractionsAgreed(!0),$(".checklist :checkbox").on("click",function(){$(".checklist :checkbox").length===$(".checklist :checkbox:checked").length?a.OTAInstractionsAgreed(!0):a.OTAInstractionsAgreed(!1)}),eviivo.eagle.popup.show({popupBox:b,fixed:!1,closeButton:$("#popup-distributor-checklist-wrap .s-close"),draggableAnchor:$("#popup-distributor-checklist-wrap .s-drag-handle"),serviceUrl:null,onClose:function(){ko.cleanNode($("#popup-distributor-checklist-wrap")[0]),$("#popup-distributor-checklist-wrap").hide(),a.OTAInstractionsAgreed(!1)}}),ko.applyBindings(a,document.getElementById("popup-distributor-checklist-wrap"))}})},a.bookingComCompleteConnection=function(){window.eviivo.eagle.channels.bookingcom.openPopup(r.Id,a.channelTermsId(),r.DistributorShortName)},a.legalOptIn=function(){var e=0,t=eviivo.webcore.parsers.stringToBool(l.bookingContractingEnabled),o=eviivo.webcore.parsers.stringToBool(l.isBookingComTestProperty),i=a.isBookingCom;!i||t||o||(e=1),eviivo.webcore.ajaxHelper.executeAjax({actionId:"legalOptInChannel",url:eviivoSuiteApp+"/api/distribution/legal-optin",data:{ChannelId:r.Id,ChannelTermsId:a.channelTermsId(),DistributorAccountLinked:e},method:eviivo.webcore.ajaxHelper.methods.POST,contentType:eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,dataType:eviivo.webcore.ajaxHelper.dataTypes.JSON,callback:function(e){eviivo.eagle.popup.isActive()&&eviivo.eagle.popup.hide(),a.businessChannelLegalOptIn(e),a.businessIsLegalOptedIn(null!=e);var n=e.ChannelOptInStatusCode==d.Live;n&&a.businessChannelOptIn(e),a.businessIsOptedIn(n),a.techOptInToggleOn(n),a.optInStatus(e.ChannelOptInStatusName),a.optInStatusCode(e.ChannelOptInStatusCode),a.isAirBnb&&a.businessIsLegalOptedIn()&&window.eviivo.eagle.channels.airbnb.openPopup(r.Id),!i||1!=t&&1!=o||a.businessIsLegalOptedIn()&&window.eviivo.eagle.channels.bookingcom.openPopup(r.Id,a.channelTermsId(),r.DistributorShortName)},failCallback:function(){alert(l.resources.OptInError)}})},a.legalOptOut=function(){a.wantsToOptOut()?eviivo.webcore.ajaxHelper.executeAjax({actionId:"legalOptOutChannel",url:eviivoSuiteApp+"/api/distribution/legal-optout",data:{Id:a.businessChannelLegalOptIn().Id,BusinessId:a.businessChannelLegalOptIn().BusinessId,ChannelId:r.Id},method:eviivo.webcore.ajaxHelper.methods.POST,contentType:eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,dataType:eviivo.webcore.ajaxHelper.dataTypes.JSON,callback:function(e){a.businessIsLegalOptedIn(!1),a.businessIsOptedIn(!1),a.optInStatusCode(null),a.termsAgreed(!1),a.wantsToOptOut(!1),a.toggleSlide(!a.toggleSlide()),a.techOptInToggleOn(!1)},failCallback:function(){alert(l.resources.OptOutError)}}):a.wantsToOptOut(!0)},a.toggleTechOptIn=function(){a.techOptInToggleOn()?(a.techOptInToggleOn(!1),a.optOut()):(a.techOptInToggleOn(!0),a.optIn())},a.showCommissionRequest=function(){var e=g.validate({ignore:"",errorPlacement:function(e,n){e.insertAfter(n.parent("div"))},errorElement:"div",onkeyup:!1,errorClass:v});h.rules("add",{required:!0,number:!0,digits:!0,min:1,max:100,messages:{required:l.resources.RequestCommissionValidationError,number:l.resources.RequestCommissionValidationError,digits:l.resources.RequestCommissionValidationError,min:l.resources.RequestCommissionValidationError,max:l.resources.RequestCommissionValidationError}}),eviivo.eagle.popup.show({popupBox:g,fixed:!1,closeButton:g.find(".s-close"),draggableAnchor:g.find(".s-drag-handle"),serviceUrl:null,onClose:function(){e.reset(),e.resetForm(),h.val(""),h.removeClass(v),h.rules("remove"),ko.cleanNode(g[0])}}),ko.applyBindings(a,document.getElementById(m))},a.createCommissionRequest=function(){var e;h.valid()&&(e=parseInt(h.val(),10),eviivo.webcore.ajaxHelper.executeAjax({actionId:"createCommissionRequest",url:eviivoSuiteApp+"/channels/requestcommission",data:{ChannelId:r.Id,RequestedCommission:e},method:eviivo.webcore.ajaxHelper.methods.POST,contentType:eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,dataType:eviivo.webcore.ajaxHelper.dataTypes.JSON,callback:function(){a.requestedCommission(e),a.requestedCommissionDisplay(e+"%"),eviivo.eagle.popup.isActive()&&eviivo.eagle.popup.hide()},failCallback:function(){eviivo.webcore.notifier.show({type:eviivo.webcore.notifier.types.error,message:l.resources.RequestCommissionError,autoHide:!1})}}))},function e(n,t,o){n.GroupedChannels=ko.observableArray([]);if(null!=t.GroupedChannels)for(var i=0;i<t.GroupedChannels.length;i++){var r=t.GroupedChannels[i],a=new s(r,o);(a.isMarketing||a.channelGroupOptin)&&(a.termsAgreed=n.termsAgreed,a.OTAInstractionsAgreed=n.OTAInstractionsAgreed,a.businessChannelOptIn=n.businessChannelOptIn,a.businessIsOptedIn=n.businessIsOptedIn,a.techOptInToggleOn=n.techOptInToggleOn,a.optInStatus=n.optInStatus,a.optInStatusCode=n.optInStatusCode,a.optInStatusClass=n.optInStatusClass,a.optIn=n.optIn,a.optOut=n.optOut,a.wantsToOptOut=n.wantsToOptOut,a.businessChannelLegalOptIn=n.businessChannelLegalOptIn,a.businessIsLegalOptedIn=n.businessIsLegalOptedIn,a.legalOptIn=n.legalOptIn,a.legalOptOut=n.legalOptOut,a.autoTechOptin=n.autoTechOptin,a.distributorChecklistPopupTitle=n.distributorChecklistPopupTitle,a.parentDistributorId=n.distributorId,a.showTechOptInButton=ko.computed(function(){var e=a.businessIsLegalOptedIn();return!!e},this)),a.isMarketing&&(a.Id=n.Id,a.channelTermsId=n.channelTermsId),e(a,r,o),n.GroupedChannels.push(a)}}(a,r,e)}var o,r,l,u,c,d,p,b,v,m,g,h;window.eviivo=window.eviivo||{},window.eviivo.eagle=window.eviivo.eagle||{},window.eviivo.eagle.channels=window.eviivo.eagle.channels||{},window.eviivo.eagle.channels=(l={airbnbDistributorShortname:null,canAuthoriseAirbnb:null,resources:null,googleDistributorShortname:null,bookingContractingEnabled:null,isBookingComTestProperty:null},u={Channel:"C",Group:"G",LogicalGroup:"L",Marketing:"M"},c={Live:"icon-live",InProgress:"icon-progress"},d={Live:"A",InProgress:r="P"},p=0,b=$("#popup-distributor-checklist-wrap"),v="error field-validation-error",m="popup-commission-request-wrap",g=$("#"+m),h=g.find("#requested-commission-value"),{init:function(e){l=$.extend(l,e),o=new n,ko.applyBindings(o,document.getElementById("distributor-type-wrap")),eviivo.webcore.ajaxHelper.executeAjax({actionId:"getDistributorsAndChannels",url:eviivoSuiteApp+"/api/distribution/get",method:eviivo.webcore.ajaxHelper.methods.GET,contentType:eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,dataType:eviivo.webcore.ajaxHelper.dataTypes.JSON,callback:function(e){if(e){for(var n=0;n<e.length;n++)o.addDistributorType(e[n]);t=$(".s-channel-container"),$(document).scrollTop(),$(document).on("scroll",function(){t.each(function(){var e=$(this),n=e.position();$(document).scrollTop()>n.top?e.addClass("stuck"):e.removeClass("stuck")})})}var t},failCallback:function(){console.log("Error getting distributors and channels.")}})},linkDistributorAccount:function(e){eviivo.webcore.ajaxHelper.executeAjax({actionId:"linkDistributorAccount",url:eviivoSuiteApp+"/channels/linkDistributorAccount",data:{DistributorShortname:e},method:eviivo.webcore.ajaxHelper.methods.POST,contentType:eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,dataType:eviivo.webcore.ajaxHelper.dataTypes.JSON,callback:function(e){eviivo.eagle.popup.isActive()&&eviivo.eagle.popup.hide()},failCallback:function(){alert(l.resources.OptInError)}})}})}},o={};function i(e){var n=o[e];return void 0!==n||(n=o[e]={exports:{}},t[e](n,n.exports,i)),n.exports}i.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(n,{a:n}),n},i.d=function(e,n){for(var t in n)i.o(n,t)&&!i.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},i.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},function(){"use strict";i(9863),i(2925),i(4655)}();
//# sourceMappingURL=channelOptIn.min.js.map