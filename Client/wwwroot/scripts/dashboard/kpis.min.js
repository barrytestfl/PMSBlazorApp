var i={8910:function(){function s(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==c(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==c(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===c(e)?e:String(e)}(n.key),n)}}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function u(i){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=a(i),t=(e=n?(e=a(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===c(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i,p=0;i=setTimeout(function e(){var t,o,n,r,a;clearTimeout(i),"object"===("undefined"==typeof preact?"undefined":c(preact))?(t=preact,o=t.h,n=t.render,r=t.Component,a=function(){var e=a,t=r;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l(e,t);var i,n=u(a);function a(e){var t;if(this instanceof a)return(t=n.call(this,e)).state={requestDataUrl:e.requestDataUrl,responseData:{},chartResources:e.chartResources,componentKey:e.componentKey,containerId:e.containerId,displayNoResults:e.displayNoResults,currencyDisplay:e.currencyDisplay},t;throw new TypeError("Cannot call a class as a function")}return s((e=a).prototype,t=[{key:"componentDidMount",value:function(){var t=this;eviivo.pms.kpis.generateKpis.preactStateChangeHandler(function(e){t.ajaxCallback(t,e)},this.state.requestDataUrl,this.state.componentKey),eviivo.pms.kpis.generateKpis.ajaxCall(this.state.requestDataUrl,this.state.componentKey)}},{key:"ajaxCallback",value:function(e,t){var i={};null!=t&&null!=t.Response&&(i.Response=t.Response,i.IsBooked=t.IsBooked),e.setState({responseData:i})}},{key:"render",value:function(){var e=this.state,t=void 0!==e.responseData.Response?e.responseData.Response:"-",i="",n="",a=e.componentKey+" kpi-item";switch("function"==typeof e.chartResources.valueFormatType&&(t=e.chartResources.valueFormatType(t,e.chartResources.fractionDigits)),"undefined"!==e.chartResources.valuePrefix&&null!=e.chartResources.valuePrefix&&""!=e.chartResources.valuePrefix&&(t=e.chartResources.valuePrefix+" "+t),"undefined"!==e.chartResources.valueSufix&&null!=e.chartResources.valueSufix&&""!=e.chartResources.valueSufix&&(t+=" "+e.chartResources.valueSufix),e.componentKey){case"kpi-sold":i="icon-bg icon-bg-local_hotel",n="#icon-bg-local_hotel";break;case"kpi-unsold":i="icon-bg icon-bg-local_hotel_outline",n="#icon-bg-local_hotel_outline";break;case"kpi-bookingwindow":i="icon-bg icon-bg-average_booking_window",n="#icon-bg-average_booking_window";break;case"kpi-onlinebooking":i="icon-bg icon-bg-devices",n="#icon-bg-devices";break;case"kpi-numberguests":i="icon-bg icon-bg-group_two",n="#icon-bg-group_two";break;case"kpi-international":i="icon-bg icon-bg-language",n="#icon-bg-language";break;case"kpi-occupancy":i="icon-bg-average-occupancy",n="#icon-bg-average-occupancy";break;case"kpi-averageprice":i="icon-bg icon-bg-night",n="#icon-bg-night";break;case"kpi-averagestay":i="icon-bg icon-bg-date_range_two",n="#icon-bg-date_range_two";break;case"kpi-mywebsite":i="icon-bg icon-bg-mouse",n="#icon-bg-mouse";break;case"kpi-totalrevenue":i="icon-bg icon-bg-graph",n="#icon-bg-graph";break;case"kpi-commissioncosts":i="icon-bg icon-bg-percentage_tag",n="#icon-bg-percentage_tag"}return void 0!==e.responseData&&e.responseData.IsBooked&&null!=e.displayNoResults&&(t=e.displayNoResults),e.currencyDisplay&&!eviivo.pms.kpis.generateKpis.getIsSameBusinessCurrency()&&(t="-"),o("div",{id:e.containerId,className:a},o("div",{className:"kpi-icon"},o("svg",{className:i},o("use",{xlinkHref:n}))),o("div",{className:"kpi-item_inner"},o("div",{className:"kpi-result"}," ",t," "),o("div",{className:"kpi-text"}," ",eviivo.util.decodedHtml(e.chartResources.title)," ")))}}]),i&&s(e,i),Object.defineProperty(e,"prototype",{writable:!1}),a}(),window.eviivo=window.eviivo||{},window.eviivo.pms=window.eviivo.pms||{},window.eviivo.pms.kpis=window.eviivo.pms.kpis||{},window.eviivo.pms.kpis.render=window.eviivo.pms.kpis.render||{},window.eviivo.pms.kpis.render.kpicomponent=function(e,t,i){n(o(a,e),t,i)}):p<50&&(p++,i=setTimeout(e,200))},200)},1017:function(){function i(e){var t=null;if("undefined"!=typeof eviivo&&void 0!==eviivo.webcore&&void 0!==eviivo.webcore.queryStringHelper){var i=eviivo.webcore.queryStringHelper.getAllKeys(window.location.href);switch(e){case O.booked:t=null!=i[O.booked]&&""!==i[O.booked]?i[O.booked]:0;break;case O.today:t=null!=i[O.today]&&""!==i[O.today]?new Date(i[O.today]):new Date;break;case O.startDate:t=null!=i[O.startDate]&&""!==i[O.startDate]?new Date(i[O.startDate]):(t=N.cloneDateOnly(),eviivo.webcore.datetime.utils.addDaysToDate(eviivo.webcore.datetime.utils.addMonthsToDate(t,-1),-1));break;case O.endDate:t=null!=i[O.endDate]&&""!==i[O.endDate]?new Date(i[O.endDate]):(t=N.cloneDateOnly(),eviivo.webcore.datetime.utils.addDaysToDate(t,-1))}}return t}function t(e){var t=N.cloneDateOnly().addDays(e),i=N.cloneDateOnly(),n=t;e<0&&(i=t,n=N.cloneDateOnly()),w.datepickerstart.datepicker("setDate",i),w.datepickerend.datepicker("setDate",n)}function n(e){switch(e){case 0:t(0);break;case 1:t(-1);break;case 2:t(1);break;case 3:t(-7);break;case 4:t(7);break;case 5:t(-30);break;case 6:t(30);break;case 7:t(-60);break;case 8:t(60);break;case 9:t(-90);break;case 10:t(90)}w.md.removeClass("active"),r()}function l(){w.datepickerstart.datepicker("getDate");if(eviivo.util.namespaceActionLoader(l,"kpicomponent","eviivo.pms.kpis.render.")){C=[{key:"kpi-sold",type:"kpi",requestDataUrl:D.KpiChart,title:eviivo.eagle.translations.resources.kpis.sold,subtitle:null,valueFormatType:null,valuePrefix:null,valueSufix:eviivo.eagle.translations.resources.kpis.nights},{key:"kpi-occupancy",type:"kpi",requestDataUrl:D.KpiChart,title:eviivo.eagle.translations.resources.kpis.averageOccupancy,subtitle:null,valueFormatType:c,fractionDigits:0,valuePrefix:null,valueSufix:null,displayNoResults:"-"},{key:"kpi-unsold",type:"kpi",requestDataUrl:D.KpiChart,title:eviivo.eagle.translations.resources.kpis.unsold,subtitle:null,valueFormatType:null,valuePrefix:null,valueSufix:eviivo.eagle.translations.resources.kpis.nights,displayNoResults:"-"},{key:"kpi-averageprice",type:"kpi",requestDataUrl:D.KpiChart,title:eviivo.eagle.translations.resources.kpis.averagePrice,subtitle:null,valueFormatType:p,fractionDigits:2,valuePrefix:null,valueSufix:null,currencyDisplay:!0},{key:"kpi-bookingwindow",type:"kpi",requestDataUrl:D.KpiChart,title:eviivo.eagle.translations.resources.kpis.averageBookingWindow,subtitle:null,valueFormatType:null,valuePrefix:null,valueSufix:eviivo.eagle.translations.resources.kpis.days},{key:"kpi-averagestay",type:"kpi",requestDataUrl:D.KpiChart,title:eviivo.eagle.translations.resources.kpis.averageStay,subtitle:null,valueFormatType:u,fractionDigits:1,valuePrefix:null,valueSufix:eviivo.eagle.translations.resources.kpis.nights},{key:"kpi-onlinebooking",type:"kpi",requestDataUrl:D.KpiChart,title:eviivo.eagle.translations.resources.kpis.totalOnline,subtitle:null,valueFormatType:c,fractionDigits:0,valuePrefix:null,valueSufix:null},{key:"kpi-mywebsite",type:"kpi",requestDataUrl:D.KpiChart,title:eviivo.eagle.translations.resources.kpis.myWebsite,subtitle:null,valueFormatType:c,fractionDigits:0,valuePrefix:null,valueSufix:null},{key:"kpi-numberguests",type:"kpi",requestDataUrl:D.KpiChart,title:eviivo.eagle.translations.resources.kpis.numberOfGuests,subtitle:null,valueFormatType:null,valuePrefix:null,valueSufix:null},{key:"kpi-totalrevenue",type:"kpi",requestDataUrl:D.KpiChart,title:eviivo.eagle.translations.resources.kpis.totalRevenue,subtitle:null,valueFormatType:p,fractionDigits:2,valuePrefix:null,valueSufix:null,currencyDisplay:!0},{key:"kpi-international",type:"kpi",requestDataUrl:D.KpiChart,title:eviivo.eagle.translations.resources.kpis.international,subtitle:null,valueFormatType:c,fractionDigits:1,valuePrefix:null,valueSufix:null},{key:"kpi-commissioncosts",type:"kpi",requestDataUrl:D.KpiChart,title:eviivo.eagle.translations.resources.kpis.commissionCosts,subtitle:null,valueFormatType:p,fractionDigits:2,valuePrefix:null,valueSufix:null,currencyDisplay:!0},{key:S,type:"summary",requestDataUrl:D.BookingRevenue}],T={};for(var e=w.kpiHolder1,t=!0,i=0;i<C.length;i++){var n=C[i];"summary"===(T[n.key]=n).type?g(n):(b('<div id="id_container_'+n.key+'" class="spinner-container"><div id="id_'+n.key+'" class="kpi-item"></div></div>').appendTo(e),g(n),t=t?(e=w.kpiHolder2,!1):(e=w.kpiHolder1,!0))}B[D.BookingRevenue+"."+S]=function(e){w.bookingRevenueTable.find("ul.md-list").removeClass("hide"),null!=e&&null!=e.Response&&(e=e.Response,w.roomRevenue.text(p(e.RoomRevenue)),w.noRoomRevenue.text(p(e.NoRoomRevenue)),w.noRoomRevenueNet.text(p(e.NoRoomRevenueNet)),w.cancellationFees.text(p(e.CancellationFees)),w.noShowFees.text(p(e.NoShowFees)),w.totalRevenue.text(p(e.TotalRevenue)),w.netRevenue.text(p(e.NetRevenue)),w.taxes.text(p(e.Taxes)),w.commission.text(p(e.Commission)),w.cardfees.text(p(e.CardFees)),w.advancedDeposits.text(p(e.Deposits)))},y();for(var a,o,r=0;r<C.length;r++){var s=C[r];"summary"===s.type?d(s.requestDataUrl,s.key):(a=o=a=void 0,a="id_"+(s=s).key,o=b("#"+a),a={componentKey:s.key,containerId:a,requestDataUrl:s.requestDataUrl,chartType:s.type,labelFormat:s.labelFormat,chartResources:{title:s.title,subtitle:s.subtitle,valueFormatType:s.valueFormatType,fractionDigits:s.fractionDigits,valuePrefix:s.valuePrefix,valueSufix:s.valueSufix},displayNoResults:s.displayNoResults,currencyDisplay:s.currencyDisplay},eviivo.pms.kpis.render.kpicomponent(a,o.parent()[0],o[0]))}}}function o(e){if(e){q=null;for(var t=0;t<e.length;t++){var i=parseInt(e[t]),i=m(i);if(null==q)q=i.WorkingCurrencyCode;else if(q!==i.WorkingCurrencyCode)return!1}}return!0}function a(e){var t=e(!0);if(t&&t.SelectedBusinesses){for(var i=[],n=0;n<t.SelectedBusinesses.length;n++){var a=t.SelectedBusinesses[n];a.IsChecked&&i.push(a.BusinessId)}return o(i)}return!0}function r(){y(),_={};for(var e=0;e<C.length;e++){var t=C[e];d(t.requestDataUrl,t.key)}}function u(e,t){return isNaN(e)?"-":e.toFixed(t)}function c(e,t){return isNaN(e)?"-":(e=e<0?0:e).toFixed(t=null==t?2:t)+"%"}function p(e,t){return isNaN(e)||!s?"-":(t=null==t?2:t,Globalize.formatCurrency(e,q,{minimumFractionDigits:t,maximumFractionDigits:t}))}function d(a,o){var e,t,r,i,s=a+"."+o;P.length===K?null==_[s]?_[s]={requestDataUrl:a,componentKey:o}:console.warn(x+": "+o+" request already pending"):(t=w.datepickerstart.datepicker("getDate"),e=w.datepickerend.datepicker("getDate"),t={CultureCode:window.eviivo.eagle.basePageModelState.userCultureCode,StartDate:t.dateToYMD(),EndDate:e.dateToYMD(),ComponentKey:o,Booked:w.ddlBooked[0].selectedIndex},r=T[o],null!=r&&(r.debug,t=b.extend(t,r.staticData),null!=r.dynamicData&&"function"==typeof r.dynamicData&&r.dynamicData(r,t),null!=r.spinner)&&r.spinner.start(),i=null!=_[s]?_[s].callback:null,P.push(s),delete _[s],b("#id_container_"+o+" div.s-fail-message-container").remove(),eviivo.webcore.ajaxHelper.executeAjax({unauthorizedCallback:eviivo.eagle.authorization.unauthorizedHandler,forbiddenCallback:eviivo.eagle.authorization.forbiddenHandler,actionId:x+"."+s,url:a,data:t,method:eviivo.webcore.ajaxHelper.methods.POST,contentType:eviivo.webcore.ajaxHelper.contentTypes.APPLICATION_JSON_UTF8,dataType:eviivo.webcore.ajaxHelper.dataTypes.JSON,callback:function(e){k(s),f(),null!=r&&null!=r.spinner&&r.spinner.stop(),null!=i&&"function"==typeof i&&i(e),"function"==typeof B[s]&&B[s](e)},failCallback:function(e,t,i,n){null!=r&&null!=r.spinner&&r.spinner.stop(),k(s),f(),v(504===n?eviivo.eagle.translations.resources.chartsAndKpis.timeout:eviivo.eagle.translations.resources.chartsAndKpis.genericError,a,o)}}))}function v(e,t,i){var e='<div class="s-fail-message-container spinner light-background active"><div class="position-spinner"><span class="spinner-message">'+e+"</span><a href='javascript:void(0);' class='s-close-spinner cp-button'>"+eviivo.eagle.translations.resources.chartsAndKpis.tryAgain+"</a></div></div>",n=b("#id_container_"+i);b(e).appendTo(n),n.find("a.s-close-spinner").on("click",function(){d(t,i)})}function k(e){var t=P.indexOf(e);-1<t&&P.splice(t,1),delete _[e]}function f(){var e=_[Object.keys(_)[0]];null!=e&&d(e.requestDataUrl,e.componentKey)}function y(){var e,t,i;void 0!==history.pushState&&(e={},e=eviivo.webcore.queryStringHelper.getAllKeys(window.location.href,e),t=w.datepickerstart.datepicker("getDate"),i=w.datepickerend.datepicker("getDate"),eviivo.webcore.queryStringHelper.updateKey(e,O.startDate,t.dateToYMD()),eviivo.webcore.queryStringHelper.updateKey(e,O.endDate,i.dateToYMD()),eviivo.webcore.queryStringHelper.updateKey(e,O.today,N.dateToYMD()),eviivo.webcore.queryStringHelper.updateKey(e,O.booked,w.ddlBooked[0].selectedIndex),eviivo.webcore.queryStringHelper.updateHistory(e))}function g(e){e.spinner=eviivo.webcore.loadingSpinner.create({container:"#id_container_"+e.key,theme:eviivo.webcore.loadingSpinner.themes.light,layout:eviivo.webcore.loadingSpinner.layouts.fullWidth,size:eviivo.webcore.loadingSpinner.sizes.medium,timerOverrides:h})}var b,s,m,D,h,w,R,x,S,C,T,F,_,P,K,B,N,O,q;window.eviivo=window.eviivo||{},window.eviivo.pms=window.eviivo.pms||{},eviivo.pms.kpis=eviivo.pms.kpis||{},window.eviivo.pms.kpis.generateKpis=(D={KpiChart:eviivoSuiteApp+"/api/KPI/getKpi",BookingRevenue:eviivoSuiteApp+"/api/KPI/getBookingRevenue"},h={message2Delay:5e3,message3Delay:2e4,failMessageDelay:6e4},w={datepickerstart:null,datepickerend:null,md:null,setdate:null,filterActionButton:null,ddlBooked:null,roomRevenue:null,noRoomRevenue:null,noRoomRevenueNet:null,cancellationFees:null,noShowFees:null,totalRevenue:null,newRevenue:null,taxes:null,commission:null,cardfees:null,advancedDeposits:null,kpiHolder1:null,kpiHolder2:null,bookingRevenueTable:null},R=null,x="eviivo.pms.kpis.generateKpis",S="bookingRevenue",C=[],T={},F={datepickerstart:"#datepickerstart",datepickerend:"#datepickerend",md:".md-dd",setdate:".set-date",filterActionButton:"#filter-actions-button",ddlBooked:"#ddlBooked",roomRevenue:"#roomRevenue",noRoomRevenue:"#noRoomRevenue",noRoomRevenueNet:"#noRoomRevenueNet",cancellationFees:"#cancellationFees",noShowFees:"#noShowFees",totalRevenue:"#totalRevenue",netRevenue:"#netRevenue",taxes:"#taxes",commission:"#commission",cardfees:"#cardFees",advancedDeposits:"#advancedDeposits",kpiHolder1:"div.kpi-section div.kpi-set:nth-child(1)",kpiHolder2:"div.kpi-section div.kpi-set:nth-child(2)",bookingRevenueTable:"#id_container_bookingRevenue"},_={},P=[],K=2,B={},N=new Date,O={today:"today",startDate:"startdate",endDate:"enddate",booked:"booked"},q=null,{init:function(e){if("function"!=typeof window.jQuery)throw x+": module depends on jQuery";b=window.jQuery,N=i(O.today),R={click:eviivo.util.namespacedEvent("click",x)},w.datepickerstart=b(F.datepickerstart),w.datepickerend=b(F.datepickerend),w.md=b(F.md),w.setdate=b(F.setdate),w.filterActionButton=b(F.filterActionButton),w.ddlBooked=b(F.ddlBooked),w.roomRevenue=b(F.roomRevenue),w.noRoomRevenue=b(F.noRoomRevenue),w.noRoomRevenueNet=b(F.noRoomRevenueNet),w.cancellationFees=b(F.cancellationFees),w.noShowFees=b(F.noShowFees),w.totalRevenue=b(F.totalRevenue),w.netRevenue=b(F.netRevenue),w.taxes=b(F.taxes),w.commission=b(F.commission),w.cardfees=b(F.cardfees),w.advancedDeposits=b(F.advancedDeposits),w.kpiHolder1=b(F.kpiHolder1),w.kpiHolder2=b(F.kpiHolder2),w.bookingRevenueTable=b(F.bookingRevenueTable),w.setdate.each(function(){var e=b(this),t=e.attr("data-index");t&&(t=parseInt(t),e.on(R.click,function(){n(t)}))});var t=(new Date).evStandardFirstDayCalendarOffset(eviivo.eagle.basePageModelState.userCultureCode);w.datepickerstart=eviivo.webcore.calendar.init(eviivo.webcore.calendar.CALENDAR_TYPE.initCalendar,{defaultCultureCode:eviivo.eagle.basePageModelState.userCultureCode,calendar:w.datepickerstart,changeMonth:!0,changeYear:!0,showButtonPanel:!1,firstDay:t,dateFormat:eviivo.eagle.dateFormat.getDateFormat("MEDIUM_DATE_FORMAT"),setInitialDate:i(O.startDate)}),w.datepickerend=eviivo.webcore.calendar.init(eviivo.webcore.calendar.CALENDAR_TYPE.initCalendar,{defaultCultureCode:eviivo.eagle.basePageModelState.userCultureCode,calendar:w.datepickerend,changeMonth:!0,changeYear:!0,showButtonPanel:!1,firstDay:t,dateFormat:eviivo.eagle.dateFormat.getDateFormat("MEDIUM_DATE_FORMAT"),setInitialDate:i(O.endDate)}),w.ddlBooked.val(i(O.booked)),m=eviivo.util.safeFunction("eviivo.pms.businessSettingsAndDefaultMessages.getValue"),eviivo.eagle.multiProperty.applyButtonCallBackFunction({callBackFunction:function(){s=a(eviivo.eagle.multiProperty.getSelectedBusinesses),r()}}),eviivo.pms.accessGroup.headerSearch.extendOptions({callBackFunction:function(){s=a(eviivo.eagle.multiProperty.getSelectedBusinesses),r()}}),s=o(e.selectedBusinesses),l(),w.filterActionButton.on("click",r)},generateKpis:l,setDate:n,ajaxCall:d,preactStateChangeHandler:function(e,t,i){B[t+"."+i]=e},getIsSameBusinessCurrency:function(){return s}})}},n={};function a(e){var t=n[e];return void 0!==t||(t=n[e]={exports:{}},i[e](t,t.exports,a)),t.exports}a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,{a:t}),t},a.d=function(e,t){for(var i in t)a.o(t,i)&&!a.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){"use strict";a(8910),a(1017)}();
//# sourceMappingURL=kpis.min.js.map